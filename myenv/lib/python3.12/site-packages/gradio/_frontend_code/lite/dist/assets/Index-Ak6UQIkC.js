import{a as kt,i as Ot,s as Lt,E as Gt,z as C,d as Z,C as j,D as Rt,l as K,$ as rt,f as I,q as ea,y as et,A as ot,u as ra,r as ia,v as sa,k as H,t as $,b2 as re,b as pt,c as yt,m as vt,H as It,n as bt,w as zr,x as Wi,p as Nr,M as Ui,a4 as na,b1 as vr,ao as gt,b3 as tc,aq as ce,e as be,h as ne,b9 as oa,ba as ec,j as oe,b4 as Be,K as At,g as rc,b5 as ws,bt as mn,R as Yr,J as br,as as Gi,o as Ze,O as Ia,P as aa,aA as nd,a7 as qt,a8 as Zt,a5 as la,by as ic,bz as od,aa as ad,Q as sc,I as Ts,aB as ld,bc as hd,ax as gn,at as cd,B as nc,Y as oc,S as ac,a0 as lc,a6 as hc}from"../lite.js";import ud from"./ImagePreview-BaWmB9VD.js";import{W as dd}from"./ImageUploader-Bp1C_INa.js";import"./Image-DewrJLf7.js";/* empty css                                              */import{r as fd}from"./___vite-browser-external_commonjs-proxy-CikhJfcZ.js";import{C as pd}from"./Check-DbzZ-PD_.js";import{T as md}from"./Trash-CLpHHavQ.js";import{U as gd}from"./Undo-50qkik3g.js";import{I as _d}from"./IconButtonWrapper-BQG8MTSb.js";import{t as _r,E as yd}from"./tinycolor-BpDABgnX.js";/* empty css                                             *//* empty css                                                   */import{I as ha}from"./FullscreenButton-DsVuMC2h.js";import{I as vd}from"./Upload-CYshamIj.js";import{W as bd}from"./SelectSource-X14PCdzX.js";import{U as xd}from"./Upload-CHvl3E40.js";import{B as wd}from"./BlockLabel-DWW9BWN3.js";import"./utils-BsGrhMNe.js";import"./Empty-Dns-ytKL.js";import"./ShareButton-Be-vgu5O.js";import"./Community-BFnPJcwx.js";import"./Download-RUpc9r8A.js";import"./utils-Gtzs_Zla.js";import"./DownloadLink-CqqU4pZ8.js";import"./file-url-xPYdE3p2.js";import"./Minimize-DOBO88I3.js";import"./DropdownArrow-DIboSv6l.js";import"./Square-CkbFMpLj.js";import"./index-B9I6rkKj.js";import"./StreamingBar-lVbwTGD1.js";import"./__vite-browser-external-D7Ct-6yo.js";function Td(i){let t,e,r;return{c(){t=Gt("svg"),e=Gt("path"),r=Gt("path"),C(e,"d","M28.828 3.172a4.094 4.094 0 0 0-5.656 0L4.05 22.292A6.954 6.954 0 0 0 2 27.242V30h2.756a6.952 6.952 0 0 0 4.95-2.05L28.828 8.829a3.999 3.999 0 0 0 0-5.657zM10.91 18.26l2.829 2.829l-2.122 2.121l-2.828-2.828zm-2.619 8.276A4.966 4.966 0 0 1 4.756 28H4v-.759a4.967 4.967 0 0 1 1.464-3.535l1.91-1.91l2.829 2.828zM27.415 7.414l-12.261 12.26l-2.829-2.828l12.262-12.26a2.047 2.047 0 0 1 2.828 0a2 2 0 0 1 0 2.828z"),C(e,"fill","currentColor"),C(r,"d","M6.5 15a3.5 3.5 0 0 1-2.475-5.974l3.5-3.5a1.502 1.502 0 0 0 0-2.121a1.537 1.537 0 0 0-2.121 0L3.415 5.394L2 3.98l1.99-1.988a3.585 3.585 0 0 1 4.95 0a3.504 3.504 0 0 1 0 4.949L5.439 10.44a1.502 1.502 0 0 0 0 2.121a1.537 1.537 0 0 0 2.122 0l4.024-4.024L13 9.95l-4.025 4.024A3.475 3.475 0 0 1 6.5 15z"),C(r,"fill","currentColor"),C(t,"width","100%"),C(t,"height","100%"),C(t,"viewBox","0 0 32 32")},m(s,n){Z(s,t,n),j(t,e),j(t,r)},p:Rt,i:Rt,o:Rt,d(s){s&&K(t)}}}let Ed=class extends kt{constructor(t){super(),Ot(this,t,null,Td,Lt,{})}};function Ad(i){let t,e;return{c(){t=Gt("svg"),e=Gt("path"),C(e,"fill","currentColor"),C(e,"d","M2.753 2.933a.75.75 0 0 1 .814-.68l3.043.272c2.157.205 4.224.452 5.922.732c1.66.273 3.073.594 3.844.983c.197.1.412.233.578.415c.176.192.352.506.28.9c-.067.356-.304.59-.487.729a3.001 3.001 0 0 1-.695.369c-1.02.404-2.952.79-5.984 1.169c-1.442.18-2.489.357-3.214.522c.205.045.43.089.674.132c.992.174 2.241.323 3.568.437a31.21 31.21 0 0 1 3.016.398c.46.087.893.186 1.261.296c.352.105.707.236.971.412c.13.086.304.225.42.437a.988.988 0 0 1 .063.141A1.75 1.75 0 0 0 14.5 12.25v.158c-.758.154-1.743.302-2.986.444c-2.124.243-3.409.55-4.117.859c-.296.128-.442.236-.508.3c.026.037.073.094.156.17c.15.138.369.29.65.45c.56.316 1.282.61 1.979.838l2.637.814a.75.75 0 1 1-.443 1.433l-2.655-.819c-.754-.247-1.58-.578-2.257-.96a5.082 5.082 0 0 1-.924-.65c-.255-.233-.513-.544-.62-.935c-.12-.441-.016-.88.274-1.244c.261-.328.656-.574 1.113-.773c.92-.4 2.387-.727 4.545-.974c1.366-.156 2.354-.313 3.041-.462a16.007 16.007 0 0 0-.552-.114a29.716 29.716 0 0 0-2.865-.378c-1.352-.116-2.649-.27-3.7-.454c-.524-.092-1-.194-1.395-.307c-.376-.106-.75-.241-1.021-.426a1.186 1.186 0 0 1-.43-.49a.934.934 0 0 1 .059-.873c.13-.213.32-.352.472-.442a3.23 3.23 0 0 1 .559-.251c.807-.287 2.222-.562 4.37-.83c2.695-.338 4.377-.666 5.295-.962c-.638-.21-1.623-.427-2.89-.635c-1.65-.273-3.679-.515-5.816-.718l-3.038-.272a.75.75 0 0 1-.68-.814M17 12.25a.75.75 0 0 0-1.5 0v4.19l-.72-.72a.75.75 0 1 0-1.06 1.06l2 2a.75.75 0 0 0 1.06 0l2-2a.75.75 0 1 0-1.06-1.06l-.72.72z"),C(t,"xmlns","http://www.w3.org/2000/svg"),C(t,"width","100%"),C(t,"height","100%"),C(t,"viewBox","0 0 24 24")},m(r,s){Z(r,t,s),j(t,e)},p:Rt,i:Rt,o:Rt,d(r){r&&K(t)}}}class Sd extends kt{constructor(t){super(),Ot(this,t,null,Ad,Lt,{})}}function Cd(i){let t,e;return{c(){t=Gt("svg"),e=Gt("path"),C(e,"fill","currentColor"),C(e,"d","M17 23v-4H7q-.825 0-1.413-.588T5 17V7H1V5h4V1h2v16h16v2h-4v4h-2Zm0-8V7H9V5h8q.825 0 1.413.588T19 7v8h-2Z"),C(t,"xmlns","http://www.w3.org/2000/svg"),C(t,"width","100%"),C(t,"height","100%"),C(t,"viewBox","0 0 24 24")},m(r,s){Z(r,t,s),j(t,e)},p:Rt,i:Rt,o:Rt,d(r){r&&K(t)}}}let Id=class extends kt{constructor(t){super(),Ot(this,t,null,Cd,Lt,{})}};function Rd(i){let t,e,r,s;return{c(){t=Gt("svg"),e=Gt("g"),r=Gt("path"),s=Gt("path"),C(r,"fill","currentColor"),C(r,"d","m5.505 11.41l.53.53l-.53-.53ZM3 14.952h-.75H3ZM9.048 21v.75V21ZM11.41 5.505l-.53-.53l.53.53Zm1.831 12.34a.75.75 0 0 0 1.06-1.061l-1.06 1.06ZM7.216 9.697a.75.75 0 1 0-1.06 1.061l1.06-1.06Zm10.749 2.362l-5.905 5.905l1.06 1.06l5.905-5.904l-1.06-1.06Zm-11.93-.12l5.905-5.905l-1.06-1.06l-5.905 5.904l1.06 1.06Zm0 6.025c-.85-.85-1.433-1.436-1.812-1.933c-.367-.481-.473-.79-.473-1.08h-1.5c0 .749.312 1.375.78 1.99c.455.596 1.125 1.263 1.945 2.083l1.06-1.06Zm-1.06-7.086c-.82.82-1.49 1.488-1.945 2.084c-.468.614-.78 1.24-.78 1.99h1.5c0-.29.106-.6.473-1.08c.38-.498.962-1.083 1.812-1.933l-1.06-1.06Zm7.085 7.086c-.85.85-1.435 1.433-1.933 1.813c-.48.366-.79.472-1.08.472v1.5c.75 0 1.376-.312 1.99-.78c.596-.455 1.264-1.125 2.084-1.945l-1.06-1.06Zm-7.085 1.06c.82.82 1.487 1.49 2.084 1.945c.614.468 1.24.78 1.989.78v-1.5c-.29 0-.599-.106-1.08-.473c-.497-.38-1.083-.962-1.933-1.812l-1.06 1.06Zm12.99-12.99c.85.85 1.433 1.436 1.813 1.933c.366.481.472.79.472 1.08h1.5c0-.749-.312-1.375-.78-1.99c-.455-.596-1.125-1.263-1.945-2.083l-1.06 1.06Zm1.06 7.086c.82-.82 1.49-1.488 1.945-2.084c.468-.614.78-1.24.78-1.99h-1.5c0 .29-.106.6-.473 1.08c-.38.498-.962 1.083-1.812 1.933l1.06 1.06Zm0-8.146c-.82-.82-1.487-1.49-2.084-1.945c-.614-.468-1.24-.78-1.989-.78v1.5c.29 0 .599.106 1.08.473c.497.38 1.083.962 1.933 1.812l1.06-1.06Zm-7.085 1.06c.85-.85 1.435-1.433 1.933-1.812c.48-.367.79-.473 1.08-.473v-1.5c-.75 0-1.376.312-1.99.78c-.596.455-1.264 1.125-2.084 1.945l1.06 1.06Zm2.362 10.749L7.216 9.698l-1.06 1.061l7.085 7.085l1.06-1.06Z"),C(s,"stroke","currentColor"),C(s,"stroke-linecap","round"),C(s,"stroke-width","1.5"),C(s,"d","M9 21h12"),C(e,"fill","none"),C(t,"xmlns","http://www.w3.org/2000/svg"),C(t,"width","100%"),C(t,"height","100%"),C(t,"viewBox","0 0 24 24")},m(n,o){Z(n,t,o),j(t,e),j(e,r),j(e,s)},p:Rt,i:Rt,o:Rt,d(n){n&&K(t)}}}class Pd extends kt{constructor(t){super(),Ot(this,t,null,Rd,Lt,{})}}function Md(i){let t,e,r;return{c(){t=Gt("svg"),e=Gt("path"),r=Gt("path"),C(e,"d","M1.35327 10.9495L6.77663 15.158C7.12221 15.4229 7.50051 15.5553 7.91154 15.5553C8.32258 15.5553 8.70126 15.4229 9.0476 15.158L14.471 10.9495"),C(e,"stroke","currentColor"),C(e,"stroke-width","1.5"),C(e,"stroke-linecap","round"),C(r,"d","M7.23461 11.4324C7.23406 11.432 7.2335 11.4316 7.23295 11.4312L1.81496 7.2268C1.81471 7.22661 1.81446 7.22641 1.8142 7.22621C1.52269 6.99826 1.39429 6.73321 1.39429 6.37014C1.39429 6.00782 1.52236 5.74301 1.81325 5.51507C1.8136 5.5148 1.81394 5.51453 1.81428 5.51426L7.2331 1.30812C7.45645 1.13785 7.67632 1.06653 7.91159 1.06653C8.14692 1.06653 8.36622 1.13787 8.58861 1.30787C8.58915 1.30828 8.58969 1.30869 8.59023 1.30911L14.0082 5.51462C14.0085 5.51485 14.0088 5.51507 14.0091 5.51529C14.3008 5.74345 14.4289 6.00823 14.4289 6.37014C14.4289 6.73356 14.3006 6.99862 14.01 7.22634C14.0096 7.22662 14.0093 7.22689 14.0089 7.22717L8.59007 11.4322C8.36672 11.6024 8.14686 11.6738 7.91159 11.6738C7.67628 11.6738 7.45699 11.6024 7.23461 11.4324Z"),C(r,"stroke","currentColor"),C(r,"stroke-width","1.5"),C(t,"width","100%"),C(t,"height","100%"),C(t,"viewBox","0 0 17 17"),C(t,"fill","none"),C(t,"xmlns","http://www.w3.org/2000/svg")},m(s,n){Z(s,t,n),j(t,e),j(t,r)},p:Rt,i:Rt,o:Rt,d(s){s&&K(t)}}}class Bd extends kt{constructor(t){super(),Ot(this,t,null,Md,Lt,{})}}function Dd(i){let t,e,r,s,n,o;return{c(){t=Gt("svg"),e=Gt("g"),r=Gt("path"),s=Gt("circle"),n=Gt("circle"),o=Gt("path"),C(r,"d","M2 12.026c0 5.146 3.867 9.387 8.847 9.96c.735.085 1.447-.228 1.97-.753a1.68 1.68 0 0 0 0-2.372c-.523-.525-.95-1.307-.555-1.934c1.576-2.508 9.738 3.251 9.738-4.9C22 6.488 17.523 2 12 2S2 6.489 2 12.026Z"),C(s,"cx","17.5"),C(s,"cy","11.5"),C(s,"r",".75"),C(n,"cx","6.5"),C(n,"cy","11.5"),C(n,"r",".75"),C(o,"d","M10.335 7a.75.75 0 1 1-1.5 0a.75.75 0 0 1 1.5 0Zm4.915 0a.75.75 0 1 1-1.5 0a.75.75 0 0 1 1.5 0Z"),C(e,"fill","none"),C(e,"stroke","currentColor"),C(e,"stroke-width","1.5"),C(t,"xmlns","http://www.w3.org/2000/svg"),C(t,"width","100%"),C(t,"height","100%"),C(t,"viewBox","0 0 24 24")},m(a,l){Z(a,t,l),j(t,e),j(e,r),j(e,s),j(e,n),j(e,o)},p:Rt,i:Rt,o:Rt,d(a){a&&K(t)}}}class Fd extends kt{constructor(t){super(),Ot(this,t,null,Dd,Lt,{})}}function kd(i){let t,e,r;return{c(){t=Gt("svg"),e=Gt("polyline"),r=Gt("path"),C(e,"points","1 4 1 10 7 10"),C(r,"d","M3.51 15a9 9 0 1 0 2.13-9.36L1 10"),C(t,"xmlns","http://www.w3.org/2000/svg"),C(t,"width","100%"),C(t,"height","100%"),C(t,"viewBox","0 0 24 24"),C(t,"fill","none"),C(t,"stroke","currentColor"),C(t,"stroke-width","2"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"class","feather feather-rotate-ccw"),rt(t,"transform","rotateY(180deg)")},m(s,n){Z(s,t,n),j(t,e),j(t,r)},p:Rt,i:Rt,o:Rt,d(s){s&&K(t)}}}class Od extends kt{constructor(t){super(),Ot(this,t,null,kd,Lt,{})}}function Nd(i){let t,e;const r=i[2].default,s=ea(r,i,i[1],null);return{c(){t=et("div"),s&&s.c(),C(t,"class","svelte-1ua59x3"),ot(t,"show_border",i[0])},m(n,o){Z(n,t,o),s&&s.m(t,null),e=!0},p(n,[o]){s&&s.p&&(!e||o&2)&&ra(s,r,n,n[1],e?sa(r,n[1],o,null):ia(n[1]),null),(!e||o&1)&&ot(t,"show_border",n[0])},i(n){e||(H(s,n),e=!0)},o(n){$(s,n),e=!1},d(n){n&&K(t),s&&s.d(n)}}}function Ld(i,t,e){let{$$slots:r={},$$scope:s}=t,{show_border:n=!1}=t;return i.$$set=o=>{"show_border"in o&&e(0,n=o.show_border),"$$scope"in o&&e(1,s=o.$$scope)},[n,s,r]}class Ud extends kt{constructor(t){super(),Ot(this,t,Ld,Nd,Lt,{show_border:0})}get show_border(){return this.$$.ctx[0]}set show_border(t){this.$$set({show_border:t}),I()}}function io(i){return{command:i||null,next:null,previous:null,push:function(t){const e=io(t);e.previous=this,this.next=e}}}function Gd(){let i=io();const t=re(!1),e=re(!1),r=re(i);return{undo:function(){i.previous&&(i.command?.undo(),i=i.previous),t.set(!!i.previous),e.set(!!i.next),r.set(i)},redo:function(){i.next&&(i.next.command?.execute(),i=i.next),t.set(!!i.previous),e.set(!!i.next),r.set(i)},execute:function(s){s.execute(),i.push(s),i=i.next,t.set(!!i.previous),e.set(!!i.next),r.set(i)},hydrate:function(s){setTimeout(()=>{for(;s.next;)this.execute(s.next.command),s=s.next},1e3)},can_undo:t,can_redo:e,current_history:r,reset:function(){i=io(),t.set(!1),e.set(!1),r.set(i)}}}function Ra(i){let t,e;return{c(){t=et("span"),e=zr(i[1]),C(t,"class","svelte-rk35yg")},m(r,s){Z(r,t,s),j(t,e)},p(r,s){s&2&&Wi(e,r[1])},d(r){r&&K(t)}}}function Hd(i){let t,e,r,s,n,o,a,l=i[2]&&Ra(i);return s=new i[0]({}),{c(){t=et("button"),l&&l.c(),e=pt(),r=et("div"),yt(s.$$.fragment),C(r,"class","svelte-rk35yg"),ot(r,"small",i[4]==="small"),ot(r,"large",i[4]==="large"),ot(r,"medium",i[4]==="medium"),t.disabled=i[7],C(t,"aria-label",i[1]),C(t,"aria-haspopup",i[8]),C(t,"title",i[1]),C(t,"class","svelte-rk35yg"),ot(t,"pending",i[3]),ot(t,"padded",i[5]),ot(t,"highlight",i[6]),ot(t,"transparent",i[9]),rt(t,"color",!i[7]&&i[12]?i[12]:"var(--block-label-text-color)"),rt(t,"--bg-color",i[7]?"auto":i[10]),rt(t,"margin-left",i[11]+"px")},m(h,c){Z(h,t,c),l&&l.m(t,null),j(t,e),j(t,r),vt(s,r,null),n=!0,o||(a=It(t,"click",i[14]),o=!0)},p(h,[c]){h[2]?l?l.p(h,c):(l=Ra(h),l.c(),l.m(t,e)):l&&(l.d(1),l=null),(!n||c&16)&&ot(r,"small",h[4]==="small"),(!n||c&16)&&ot(r,"large",h[4]==="large"),(!n||c&16)&&ot(r,"medium",h[4]==="medium"),(!n||c&128)&&(t.disabled=h[7]),(!n||c&2)&&C(t,"aria-label",h[1]),(!n||c&256)&&C(t,"aria-haspopup",h[8]),(!n||c&2)&&C(t,"title",h[1]),(!n||c&8)&&ot(t,"pending",h[3]),(!n||c&32)&&ot(t,"padded",h[5]),(!n||c&64)&&ot(t,"highlight",h[6]),(!n||c&512)&&ot(t,"transparent",h[9]),c&4224&&rt(t,"color",!h[7]&&h[12]?h[12]:"var(--block-label-text-color)"),c&1152&&rt(t,"--bg-color",h[7]?"auto":h[10]),c&2048&&rt(t,"margin-left",h[11]+"px")},i(h){n||(H(s.$$.fragment,h),n=!0)},o(h){$(s.$$.fragment,h),n=!1},d(h){h&&K(t),l&&l.d(),bt(s),o=!1,a()}}}function zd(i,t,e){let r,{Icon:s}=t,{label:n=""}=t,{show_label:o=!1}=t,{pending:a=!1}=t,{size:l="small"}=t,{padded:h=!0}=t,{highlight:c=!1}=t,{disabled:u=!1}=t,{hasPopup:d=!1}=t,{color:f="var(--block-label-text-color)"}=t,{transparent:p=!1}=t,{background:g="var(--background-fill-primary)"}=t,{offset:_=0}=t;function m(v){Nr.call(this,i,v)}return i.$$set=v=>{"Icon"in v&&e(0,s=v.Icon),"label"in v&&e(1,n=v.label),"show_label"in v&&e(2,o=v.show_label),"pending"in v&&e(3,a=v.pending),"size"in v&&e(4,l=v.size),"padded"in v&&e(5,h=v.padded),"highlight"in v&&e(6,c=v.highlight),"disabled"in v&&e(7,u=v.disabled),"hasPopup"in v&&e(8,d=v.hasPopup),"color"in v&&e(13,f=v.color),"transparent"in v&&e(9,p=v.transparent),"background"in v&&e(10,g=v.background),"offset"in v&&e(11,_=v.offset)},i.$$.update=()=>{i.$$.dirty&8256&&e(12,r=c?"var(--color-accent)":f)},[s,n,o,a,l,h,c,u,d,p,g,_,r,f,m]}class cc extends kt{constructor(t){super(),Ot(this,t,zd,Hd,Lt,{Icon:0,label:1,show_label:2,pending:3,size:4,padded:5,highlight:6,disabled:7,hasPopup:8,color:13,transparent:9,background:10,offset:11})}get Icon(){return this.$$.ctx[0]}set Icon(t){this.$$set({Icon:t}),I()}get label(){return this.$$.ctx[1]}set label(t){this.$$set({label:t}),I()}get show_label(){return this.$$.ctx[2]}set show_label(t){this.$$set({show_label:t}),I()}get pending(){return this.$$.ctx[3]}set pending(t){this.$$set({pending:t}),I()}get size(){return this.$$.ctx[4]}set size(t){this.$$set({size:t}),I()}get padded(){return this.$$.ctx[5]}set padded(t){this.$$set({padded:t}),I()}get highlight(){return this.$$.ctx[6]}set highlight(t){this.$$set({highlight:t}),I()}get disabled(){return this.$$.ctx[7]}set disabled(t){this.$$set({disabled:t}),I()}get hasPopup(){return this.$$.ctx[8]}set hasPopup(t){this.$$set({hasPopup:t}),I()}get color(){return this.$$.ctx[13]}set color(t){this.$$set({color:t}),I()}get transparent(){return this.$$.ctx[9]}set transparent(t){this.$$set({transparent:t}),I()}get background(){return this.$$.ctx[10]}set background(t){this.$$set({background:t}),I()}get offset(){return this.$$.ctx[11]}set offset(t){this.$$set({offset:t}),I()}}function Pa(i,t,e){const r=i.slice();return r[21]=t[e],r}function Ma(i,t){let e,r,s;function n(...o){return t[12](t[21],...o)}return r=new cc({props:{highlight:t[3]===t[21],Icon:t[7][t[21]].icon,size:"medium",padded:!1,label:t[7][t[21]].label+" button",transparent:!0,offset:t[21]==="draw"?-2:t[21]==="erase"?-6:0}}),r.$on("click",n),{key:i,first:null,c(){e=be(),yt(r.$$.fragment),this.first=e},m(o,a){Z(o,e,a),vt(r,o,a),s=!0},p(o,a){t=o;const l={};a&10&&(l.highlight=t[3]===t[21]),a&2&&(l.Icon=t[7][t[21]].icon),a&2&&(l.label=t[7][t[21]].label+" button"),a&2&&(l.offset=t[21]==="draw"?-2:t[21]==="erase"?-6:0),r.$set(l)},i(o){s||(H(r.$$.fragment,o),s=!0)},o(o){$(r.$$.fragment,o),s=!1},d(o){o&&K(e),bt(r,o)}}}function Xd(i){let t=[],e=new Map,r,s,n=ce(i[1]);const o=a=>a[21];for(let a=0;a<n.length;a+=1){let l=Pa(i,n,a),h=o(l);e.set(h,t[a]=Ma(h,l))}return{c(){for(let a=0;a<t.length;a+=1)t[a].c();r=be()},m(a,l){for(let h=0;h<t.length;h+=1)t[h]&&t[h].m(a,l);Z(a,r,l),s=!0},p(a,l){l&394&&(n=ce(a[1]),ne(),t=oa(t,l,o,1,a,n,e,r.parentNode,ec,Ma,r,Pa),oe())},i(a){if(!s){for(let l=0;l<n.length;l+=1)H(t[l]);s=!0}},o(a){for(let l=0;l<t.length;l+=1)$(t[l]);s=!1},d(a){a&&K(r);for(let l=0;l<t.length;l+=1)t[l].d(a)}}}function Vd(i){let t,e,r,s,n;const o=i[11].default,a=ea(o,i,i[15],null);return r=new Ud({props:{show_border:!1,$$slots:{default:[Xd]},$$scope:{ctx:i}}}),{c(){a&&a.c(),t=pt(),e=et("div"),yt(r.$$.fragment),C(e,"class","toolbar-wrap svelte-k9d7m2"),Ui(()=>i[13].call(e))},m(l,h){a&&a.m(l,h),Z(l,t,h),Z(l,e,h),vt(r,e,null),s=na(e,i[13].bind(e)),i[14](e),n=!0},p(l,[h]){a&&a.p&&(!n||h&32768)&&ra(a,o,l,l[15],n?sa(o,l[15],h,null):ia(l[15]),null);const c={};h&32778&&(c.$$scope={dirty:h,ctx:l}),r.$set(c)},i(l){n||(H(a,l),H(r.$$.fragment,l),n=!0)},o(l){$(a,l),$(r.$$.fragment,l),n=!1},d(l){l&&(K(t),K(e)),a&&a.d(l),bt(r),s(),i[14](null)}}}const Qs=Symbol("tool");function Wd(i,t,e){let r,s,n,{$$slots:o={},$$scope:a}=t;const{active_tool:l,toolbar_box:h,editor_box:c}=vr(xi);gt(i,l,T=>e(3,r=T)),gt(i,h,T=>e(17,s=T)),gt(i,c,T=>e(10,n=T));let{i18n:u}=t,d=[];const f={},g={current_color:re("#000000"),register_tool:(T,P)=>(e(1,d=[...d,T]),P?.cb&&(f[T]=P.cb),()=>{e(1,d=d.filter(F=>F!==T))}),active_tool:{subscribe:l.subscribe,set:l.set}};tc(Qs,g);const _={crop:{order:1,label:u("Transform"),icon:Id},draw:{order:2,label:u("Draw"),icon:Ed},erase:{order:2,label:u("Erase"),icon:Pd},bg:{order:0,label:u("Background"),icon:ha}};let m,v;function y(){v&&Be(h,s=v.getBoundingClientRect(),s)}function b(T,P){T.stopPropagation(),Be(l,r=P,r),f[P]&&f[P]()}const x=(T,P)=>b(P,T);function S(){m=this.clientWidth,e(0,m)}function w(T){At[T?"unshift":"push"](()=>{v=T,e(2,v)})}return i.$$set=T=>{"i18n"in T&&e(9,u=T.i18n),"$$scope"in T&&e(15,a=T.$$scope)},i.$$.update=()=>{i.$$.dirty&1025&&y()},[m,d,v,r,l,h,c,_,b,u,n,o,x,S,w,a]}class jd extends kt{constructor(t){super(),Ot(this,t,Wd,Vd,Lt,{i18n:9})}get i18n(){return this.$$.ctx[9]}set i18n(t){this.$$set({i18n:t}),I()}}var qr=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(qr||{}),uc=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS",i))(uc||{}),so=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(so||{}),ht=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(ht||{}),We=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(We||{}),L=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(L||{}),hi=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(hi||{}),at=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(at||{}),Q=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(Q||{}),rr=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(rr||{}),yr=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(yr||{}),qe=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(qe||{}),me=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(me||{}),Xe=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(Xe||{}),ca=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(ca||{}),Ee=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(Ee||{}),Yt=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(Yt||{}),Wt=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(Wt||{}),je=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(je||{});const Yd={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")},tt={ADAPTER:Yd,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var _n=/iPhone/i,Ba=/iPod/i,Da=/iPad/i,Fa=/\biOS-universal(?:.+)Mac\b/i,yn=/\bAndroid(?:.+)Mobile\b/i,ka=/Android/i,Kr=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Ki=/Silk/i,Je=/Windows Phone/i,Oa=/\bWindows(?:.+)ARM\b/i,Na=/BlackBerry/i,La=/BB10/i,Ua=/Opera Mini/i,Ga=/\b(CriOS|Chrome)(?:.+)Mobile/i,Ha=/Mobile(?:.+)Firefox\b/i,za=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function qd(i){return function(t){return t.test(i)}}function Xa(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,r=e.split("[FBAN");typeof r[1]<"u"&&(e=r[0]),r=e.split("Twitter"),typeof r[1]<"u"&&(e=r[0]);var s=qd(e),n={apple:{phone:s(_n)&&!s(Je),ipod:s(Ba),tablet:!s(_n)&&(s(Da)||za(t))&&!s(Je),universal:s(Fa),device:(s(_n)||s(Ba)||s(Da)||s(Fa)||za(t))&&!s(Je)},amazon:{phone:s(Kr),tablet:!s(Kr)&&s(Ki),device:s(Kr)||s(Ki)},android:{phone:!s(Je)&&s(Kr)||!s(Je)&&s(yn),tablet:!s(Je)&&!s(Kr)&&!s(yn)&&(s(Ki)||s(ka)),device:!s(Je)&&(s(Kr)||s(Ki)||s(yn)||s(ka))||s(/\bokhttp\b/i)},windows:{phone:s(Je),tablet:s(Oa),device:s(Je)||s(Oa)},other:{blackberry:s(Na),blackberry10:s(La),opera:s(Ua),firefox:s(Ha),chrome:s(Ga),device:s(Na)||s(La)||s(Ua)||s(Ha)||s(Ga)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const Zd=Xa.default??Xa,ir=Zd(globalThis.navigator);tt.RETINA_PREFIX=/@([0-9\.]+)x/;tt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var dc={exports:{}};(function(i){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function s(l,h,c){this.fn=l,this.context=h,this.once=c||!1}function n(l,h,c,u,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new s(c,u||l,d),p=e?e+h:h;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],f]:l._events[p].push(f):(l._events[p]=f,l._eventsCount++),l}function o(l,h){--l._eventsCount===0?l._events=new r:delete l._events[h]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],c,u;if(this._eventsCount===0)return h;for(u in c=this._events)t.call(c,u)&&h.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(c)):h},a.prototype.listeners=function(h){var c=e?e+h:h,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,f=u.length,p=new Array(f);d<f;d++)p[d]=u[d].fn;return p},a.prototype.listenerCount=function(h){var c=e?e+h:h,u=this._events[c];return u?u.fn?1:u.length:0},a.prototype.emit=function(h,c,u,d,f,p){var g=e?e+h:h;if(!this._events[g])return!1;var _=this._events[g],m=arguments.length,v,y;if(_.fn){switch(_.once&&this.removeListener(h,_.fn,void 0,!0),m){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,c),!0;case 3:return _.fn.call(_.context,c,u),!0;case 4:return _.fn.call(_.context,c,u,d),!0;case 5:return _.fn.call(_.context,c,u,d,f),!0;case 6:return _.fn.call(_.context,c,u,d,f,p),!0}for(y=1,v=new Array(m-1);y<m;y++)v[y-1]=arguments[y];_.fn.apply(_.context,v)}else{var b=_.length,x;for(y=0;y<b;y++)switch(_[y].once&&this.removeListener(h,_[y].fn,void 0,!0),m){case 1:_[y].fn.call(_[y].context);break;case 2:_[y].fn.call(_[y].context,c);break;case 3:_[y].fn.call(_[y].context,c,u);break;case 4:_[y].fn.call(_[y].context,c,u,d);break;default:if(!v)for(x=1,v=new Array(m-1);x<m;x++)v[x-1]=arguments[x];_[y].fn.apply(_[y].context,v)}}return!0},a.prototype.on=function(h,c,u){return n(this,h,c,u,!1)},a.prototype.once=function(h,c,u){return n(this,h,c,u,!0)},a.prototype.removeListener=function(h,c,u,d){var f=e?e+h:h;if(!this._events[f])return this;if(!c)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===c&&(!d||p.once)&&(!u||p.context===u)&&o(this,f);else{for(var g=0,_=[],m=p.length;g<m;g++)(p[g].fn!==c||d&&!p[g].once||u&&p[g].context!==u)&&_.push(p[g]);_.length?this._events[f]=_.length===1?_[0]:_:o(this,f)}return this},a.prototype.removeAllListeners=function(h){var c;return h?(c=e?e+h:h,this._events[c]&&o(this,c)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,i.exports=a})(dc);var Kd=dc.exports;const ji=rc(Kd);var ua={exports:{}};ua.exports=tn;ua.exports.default=tn;function tn(i,t,e){e=e||2;var r=t&&t.length,s=r?t[0]*e:i.length,n=fc(i,0,s,e,!0),o=[];if(!n||n.next===n.prev)return o;var a,l,h,c,u,d,f;if(r&&(n=ef(i,t,n,e)),i.length>80*e){a=h=i[0],l=c=i[1];for(var p=e;p<s;p+=e)u=i[p],d=i[p+1],u<a&&(a=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);f=Math.max(h-a,c-l),f=f!==0?32767/f:0}return Hi(n,o,e,a,l,f,0),o}function fc(i,t,e,r,s){var n,o;if(s===ao(i,t,e,r)>0)for(n=t;n<e;n+=r)o=Va(n,i[n],i[n+1],o);else for(n=e-r;n>=t;n-=r)o=Va(n,i[n],i[n+1],o);return o&&en(o,o.next)&&(Xi(o),o=o.next),o}function Xr(i,t){if(!i)return i;t||(t=i);var e=i,r;do if(r=!1,!e.steiner&&(en(e,e.next)||Ht(e.prev,e,e.next)===0)){if(Xi(e),e=t=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==t);return t}function Hi(i,t,e,r,s,n,o){if(i){!o&&n&&af(i,r,s,n);for(var a=i,l,h;i.prev!==i.next;){if(l=i.prev,h=i.next,n?Jd(i,r,s,n):$d(i)){t.push(l.i/e|0),t.push(i.i/e|0),t.push(h.i/e|0),Xi(i),i=h.next,a=h.next;continue}if(i=h,i===a){o?o===1?(i=Qd(Xr(i),t,e),Hi(i,t,e,r,s,n,2)):o===2&&tf(i,t,e,r,s,n):Hi(Xr(i),t,e,r,s,n,1);break}}}}function $d(i){var t=i.prev,e=i,r=i.next;if(Ht(t,e,r)>=0)return!1;for(var s=t.x,n=e.x,o=r.x,a=t.y,l=e.y,h=r.y,c=s<n?s<o?s:o:n<o?n:o,u=a<l?a<h?a:h:l<h?l:h,d=s>n?s>o?s:o:n>o?n:o,f=a>l?a>h?a:h:l>h?l:h,p=r.next;p!==t;){if(p.x>=c&&p.x<=d&&p.y>=u&&p.y<=f&&ai(s,a,n,l,o,h,p.x,p.y)&&Ht(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Jd(i,t,e,r){var s=i.prev,n=i,o=i.next;if(Ht(s,n,o)>=0)return!1;for(var a=s.x,l=n.x,h=o.x,c=s.y,u=n.y,d=o.y,f=a<l?a<h?a:h:l<h?l:h,p=c<u?c<d?c:d:u<d?u:d,g=a>l?a>h?a:h:l>h?l:h,_=c>u?c>d?c:d:u>d?u:d,m=no(f,p,t,e,r),v=no(g,_,t,e,r),y=i.prevZ,b=i.nextZ;y&&y.z>=m&&b&&b.z<=v;){if(y.x>=f&&y.x<=g&&y.y>=p&&y.y<=_&&y!==s&&y!==o&&ai(a,c,l,u,h,d,y.x,y.y)&&Ht(y.prev,y,y.next)>=0||(y=y.prevZ,b.x>=f&&b.x<=g&&b.y>=p&&b.y<=_&&b!==s&&b!==o&&ai(a,c,l,u,h,d,b.x,b.y)&&Ht(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;y&&y.z>=m;){if(y.x>=f&&y.x<=g&&y.y>=p&&y.y<=_&&y!==s&&y!==o&&ai(a,c,l,u,h,d,y.x,y.y)&&Ht(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;b&&b.z<=v;){if(b.x>=f&&b.x<=g&&b.y>=p&&b.y<=_&&b!==s&&b!==o&&ai(a,c,l,u,h,d,b.x,b.y)&&Ht(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Qd(i,t,e){var r=i;do{var s=r.prev,n=r.next.next;!en(s,n)&&pc(s,r,r.next,n)&&zi(s,n)&&zi(n,s)&&(t.push(s.i/e|0),t.push(r.i/e|0),t.push(n.i/e|0),Xi(r),Xi(r.next),r=i=n),r=r.next}while(r!==i);return Xr(r)}function tf(i,t,e,r,s,n){var o=i;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&cf(o,a)){var l=mc(o,a);o=Xr(o,o.next),l=Xr(l,l.next),Hi(o,t,e,r,s,n,0),Hi(l,t,e,r,s,n,0);return}a=a.next}o=o.next}while(o!==i)}function ef(i,t,e,r){var s=[],n,o,a,l,h;for(n=0,o=t.length;n<o;n++)a=t[n]*r,l=n<o-1?t[n+1]*r:i.length,h=fc(i,a,l,r,!1),h===h.next&&(h.steiner=!0),s.push(hf(h));for(s.sort(rf),n=0;n<s.length;n++)e=sf(s[n],e);return e}function rf(i,t){return i.x-t.x}function sf(i,t){var e=nf(i,t);if(!e)return t;var r=mc(e,i);return Xr(r,r.next),Xr(e,e.next)}function nf(i,t){var e=t,r=i.x,s=i.y,n=-1/0,o;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var a=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=r&&a>n&&(n=a,o=e.x<e.next.x?e:e.next,a===r))return o}e=e.next}while(e!==t);if(!o)return null;var l=o,h=o.x,c=o.y,u=1/0,d;e=o;do r>=e.x&&e.x>=h&&r!==e.x&&ai(s<c?r:n,s,h,c,s<c?n:r,s,e.x,e.y)&&(d=Math.abs(s-e.y)/(r-e.x),zi(e,i)&&(d<u||d===u&&(e.x>o.x||e.x===o.x&&of(o,e)))&&(o=e,u=d)),e=e.next;while(e!==l);return o}function of(i,t){return Ht(i.prev,i,t.prev)<0&&Ht(t.next,i,i.next)<0}function af(i,t,e,r){var s=i;do s.z===0&&(s.z=no(s.x,s.y,t,e,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,lf(s)}function lf(i){var t,e,r,s,n,o,a,l,h=1;do{for(e=i,i=null,n=null,o=0;e;){for(o++,r=e,a=0,t=0;t<h&&(a++,r=r.nextZ,!!r);t++);for(l=h;a>0||l>0&&r;)a!==0&&(l===0||!r||e.z<=r.z)?(s=e,e=e.nextZ,a--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:i=s,s.prevZ=n,n=s;e=r}n.nextZ=null,h*=2}while(o>1);return i}function no(i,t,e,r,s){return i=(i-e)*s|0,t=(t-r)*s|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function hf(i){var t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function ai(i,t,e,r,s,n,o,a){return(s-o)*(t-a)>=(i-o)*(n-a)&&(i-o)*(r-a)>=(e-o)*(t-a)&&(e-o)*(n-a)>=(s-o)*(r-a)}function cf(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!uf(i,t)&&(zi(i,t)&&zi(t,i)&&df(i,t)&&(Ht(i.prev,i,t.prev)||Ht(i,t.prev,t))||en(i,t)&&Ht(i.prev,i,i.next)>0&&Ht(t.prev,t,t.next)>0)}function Ht(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function en(i,t){return i.x===t.x&&i.y===t.y}function pc(i,t,e,r){var s=Ji(Ht(i,t,e)),n=Ji(Ht(i,t,r)),o=Ji(Ht(e,r,i)),a=Ji(Ht(e,r,t));return!!(s!==n&&o!==a||s===0&&$i(i,e,t)||n===0&&$i(i,r,t)||o===0&&$i(e,i,r)||a===0&&$i(e,t,r))}function $i(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function Ji(i){return i>0?1:i<0?-1:0}function uf(i,t){var e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&pc(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function zi(i,t){return Ht(i.prev,i,i.next)<0?Ht(i,t,i.next)>=0&&Ht(i,i.prev,t)>=0:Ht(i,t,i.prev)<0||Ht(i,i.next,t)<0}function df(i,t){var e=i,r=!1,s=(i.x+t.x)/2,n=(i.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&s<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==i);return r}function mc(i,t){var e=new oo(i.i,i.x,i.y),r=new oo(t.i,t.x,t.y),s=i.next,n=t.prev;return i.next=t,t.prev=i,e.next=s,s.prev=e,r.next=e,e.prev=r,n.next=r,r.prev=n,r}function Va(i,t,e,r){var s=new oo(i,t,e);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function Xi(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function oo(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}tn.deviation=function(i,t,e,r){var s=t&&t.length,n=s?t[0]*e:i.length,o=Math.abs(ao(i,0,n,e));if(s)for(var a=0,l=t.length;a<l;a++){var h=t[a]*e,c=a<l-1?t[a+1]*e:i.length;o-=Math.abs(ao(i,h,c,e))}var u=0;for(a=0;a<r.length;a+=3){var d=r[a]*e,f=r[a+1]*e,p=r[a+2]*e;u+=Math.abs((i[d]-i[p])*(i[f+1]-i[d+1])-(i[d]-i[f])*(i[p+1]-i[d+1]))}return o===0&&u===0?0:Math.abs((u-o)/o)};function ao(i,t,e,r){for(var s=0,n=t,o=e-r;n<e;n+=r)s+=(i[o]-i[n])*(i[n+1]+i[o+1]),o=n;return s}tn.flatten=function(i){for(var t=i[0][0].length,e={vertices:[],holes:[],dimensions:t},r=0,s=0;s<i.length;s++){for(var n=0;n<i[s].length;n++)for(var o=0;o<t;o++)e.vertices.push(i[s][n][o]);s>0&&(r+=i[s-1].length,e.holes.push(r))}return e};var ff=ua.exports;const pf=rc(ff);var Fs={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */Fs.exports;(function(i,t){(function(e){var r=t&&!t.nodeType&&t,s=i&&!i.nodeType&&i,n=typeof ws=="object"&&ws;(n.global===n||n.window===n||n.self===n)&&(e=n);var o,a=2147483647,l=36,h=1,c=26,u=38,d=700,f=72,p=128,g="-",_=/^xn--/,m=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=l-h,x=Math.floor,S=String.fromCharCode,w;function T(A){throw new RangeError(y[A])}function P(A,G){for(var J=A.length,O=[];J--;)O[J]=G(A[J]);return O}function F(A,G){var J=A.split("@"),O="";J.length>1&&(O=J[0]+"@",A=J[1]),A=A.replace(v,".");var M=A.split("."),ut=P(M,G).join(".");return O+ut}function B(A){for(var G=[],J=0,O=A.length,M,ut;J<O;)M=A.charCodeAt(J++),M>=55296&&M<=56319&&J<O?(ut=A.charCodeAt(J++),(ut&64512)==56320?G.push(((M&1023)<<10)+(ut&1023)+65536):(G.push(M),J--)):G.push(M);return G}function D(A){return P(A,function(G){var J="";return G>65535&&(G-=65536,J+=S(G>>>10&1023|55296),G=56320|G&1023),J+=S(G),J}).join("")}function E(A){return A-48<10?A-22:A-65<26?A-65:A-97<26?A-97:l}function R(A,G){return A+22+75*(A<26)-((G!=0)<<5)}function X(A,G,J){var O=0;for(A=J?x(A/d):A>>1,A+=x(A/G);A>b*c>>1;O+=l)A=x(A/b);return x(O+(b+1)*A/(A+u))}function q(A){var G=[],J=A.length,O,M=0,ut=p,ct=f,mt,Pt,Nt,Mt,xt,St,Tt,Dt,z;for(mt=A.lastIndexOf(g),mt<0&&(mt=0),Pt=0;Pt<mt;++Pt)A.charCodeAt(Pt)>=128&&T("not-basic"),G.push(A.charCodeAt(Pt));for(Nt=mt>0?mt+1:0;Nt<J;){for(Mt=M,xt=1,St=l;Nt>=J&&T("invalid-input"),Tt=E(A.charCodeAt(Nt++)),(Tt>=l||Tt>x((a-M)/xt))&&T("overflow"),M+=Tt*xt,Dt=St<=ct?h:St>=ct+c?c:St-ct,!(Tt<Dt);St+=l)z=l-Dt,xt>x(a/z)&&T("overflow"),xt*=z;O=G.length+1,ct=X(M-Mt,O,Mt==0),x(M/O)>a-ut&&T("overflow"),ut+=x(M/O),M%=O,G.splice(M++,0,ut)}return D(G)}function U(A){var G,J,O,M,ut,ct,mt,Pt,Nt,Mt,xt,St=[],Tt,Dt,z,Vt;for(A=B(A),Tt=A.length,G=p,J=0,ut=f,ct=0;ct<Tt;++ct)xt=A[ct],xt<128&&St.push(S(xt));for(O=M=St.length,M&&St.push(g);O<Tt;){for(mt=a,ct=0;ct<Tt;++ct)xt=A[ct],xt>=G&&xt<mt&&(mt=xt);for(Dt=O+1,mt-G>x((a-J)/Dt)&&T("overflow"),J+=(mt-G)*Dt,G=mt,ct=0;ct<Tt;++ct)if(xt=A[ct],xt<G&&++J>a&&T("overflow"),xt==G){for(Pt=J,Nt=l;Mt=Nt<=ut?h:Nt>=ut+c?c:Nt-ut,!(Pt<Mt);Nt+=l)Vt=Pt-Mt,z=l-Mt,St.push(S(R(Mt+Vt%z,0))),Pt=x(Vt/z);St.push(S(R(Pt,0))),ut=X(J,Dt,O==M),J=0,++O}++J,++G}return St.join("")}function lt(A){return F(A,function(G){return _.test(G)?q(G.slice(4).toLowerCase()):G})}function V(A){return F(A,function(G){return m.test(G)?"xn--"+U(G):G})}if(o={version:"1.4.1",ucs2:{decode:B,encode:D},decode:q,encode:U,toASCII:V,toUnicode:lt},r&&s)if(i.exports==r)s.exports=o;else for(w in o)o.hasOwnProperty(w)&&(r[w]=o[w]);else e.punycode=o})(ws)})(Fs,Fs.exports);var mf=Fs.exports,gf=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),r=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var s=42;t[e]=s;for(e in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var n=Object.getOwnPropertySymbols(t);if(n.length!==1||n[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(t,e);if(o.value!==s||o.enumerable!==!0)return!1}return!0},Wa=typeof Symbol<"u"&&Symbol,_f=gf,yf=function(){return typeof Wa!="function"||typeof Symbol!="function"||typeof Wa("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:_f()},ja={foo:{}},vf=Object,bf=function(){return{__proto__:ja}.foo===ja.foo&&!({__proto__:null}instanceof vf)},xf="Function.prototype.bind called on incompatible ",wf=Object.prototype.toString,Tf=Math.max,Ef="[object Function]",Ya=function(t,e){for(var r=[],s=0;s<t.length;s+=1)r[s]=t[s];for(var n=0;n<e.length;n+=1)r[n+t.length]=e[n];return r},Af=function(t,e){for(var r=[],s=e,n=0;s<t.length;s+=1,n+=1)r[n]=t[s];return r},Sf=function(i,t){for(var e="",r=0;r<i.length;r+=1)e+=i[r],r+1<i.length&&(e+=t);return e},Cf=function(t){var e=this;if(typeof e!="function"||wf.apply(e)!==Ef)throw new TypeError(xf+e);for(var r=Af(arguments,1),s,n=function(){if(this instanceof s){var c=e.apply(this,Ya(r,arguments));return Object(c)===c?c:this}return e.apply(t,Ya(r,arguments))},o=Tf(0,e.length-r.length),a=[],l=0;l<o;l++)a[l]="$"+l;if(s=Function("binder","return function ("+Sf(a,",")+"){ return binder.apply(this,arguments); }")(n),e.prototype){var h=function(){};h.prototype=e.prototype,s.prototype=new h,h.prototype=null}return s},If=Cf,da=Function.prototype.bind||If,Rf=Function.prototype.call,Pf=Object.prototype.hasOwnProperty,Mf=da,Bf=Mf.call(Rf,Pf),wt,mi=SyntaxError,gc=Function,ci=TypeError,vn=function(i){try{return gc('"use strict"; return ('+i+").constructor;")()}catch{}},Lr=Object.getOwnPropertyDescriptor;if(Lr)try{Lr({},"")}catch{Lr=null}var bn=function(){throw new ci},Df=Lr?function(){try{return arguments.callee,bn}catch{try{return Lr(arguments,"callee").get}catch{return bn}}}():bn,$r=yf(),Ff=bf(),Jt=Object.getPrototypeOf||(Ff?function(i){return i.__proto__}:null),ti={},kf=typeof Uint8Array>"u"||!Jt?wt:Jt(Uint8Array),Ur={"%AggregateError%":typeof AggregateError>"u"?wt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?wt:ArrayBuffer,"%ArrayIteratorPrototype%":$r&&Jt?Jt([][Symbol.iterator]()):wt,"%AsyncFromSyncIteratorPrototype%":wt,"%AsyncFunction%":ti,"%AsyncGenerator%":ti,"%AsyncGeneratorFunction%":ti,"%AsyncIteratorPrototype%":ti,"%Atomics%":typeof Atomics>"u"?wt:Atomics,"%BigInt%":typeof BigInt>"u"?wt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?wt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?wt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?wt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?wt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?wt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?wt:FinalizationRegistry,"%Function%":gc,"%GeneratorFunction%":ti,"%Int8Array%":typeof Int8Array>"u"?wt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?wt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?wt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":$r&&Jt?Jt(Jt([][Symbol.iterator]())):wt,"%JSON%":typeof JSON=="object"?JSON:wt,"%Map%":typeof Map>"u"?wt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!$r||!Jt?wt:Jt(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?wt:Promise,"%Proxy%":typeof Proxy>"u"?wt:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?wt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?wt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!$r||!Jt?wt:Jt(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?wt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":$r&&Jt?Jt(""[Symbol.iterator]()):wt,"%Symbol%":$r?Symbol:wt,"%SyntaxError%":mi,"%ThrowTypeError%":Df,"%TypedArray%":kf,"%TypeError%":ci,"%Uint8Array%":typeof Uint8Array>"u"?wt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?wt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?wt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?wt:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?wt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?wt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?wt:WeakSet};if(Jt)try{null.error}catch(i){var Of=Jt(Jt(i));Ur["%Error.prototype%"]=Of}var Nf=function i(t){var e;if(t==="%AsyncFunction%")e=vn("async function () {}");else if(t==="%GeneratorFunction%")e=vn("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=vn("async function* () {}");else if(t==="%AsyncGenerator%"){var r=i("%AsyncGeneratorFunction%");r&&(e=r.prototype)}else if(t==="%AsyncIteratorPrototype%"){var s=i("%AsyncGenerator%");s&&Jt&&(e=Jt(s.prototype))}return Ur[t]=e,e},qa={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Yi=da,ks=Bf,Lf=Yi.call(Function.call,Array.prototype.concat),Uf=Yi.call(Function.apply,Array.prototype.splice),Za=Yi.call(Function.call,String.prototype.replace),Os=Yi.call(Function.call,String.prototype.slice),Gf=Yi.call(Function.call,RegExp.prototype.exec),Hf=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,zf=/\\(\\)?/g,Xf=function(t){var e=Os(t,0,1),r=Os(t,-1);if(e==="%"&&r!=="%")throw new mi("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&e!=="%")throw new mi("invalid intrinsic syntax, expected opening `%`");var s=[];return Za(t,Hf,function(n,o,a,l){s[s.length]=a?Za(l,zf,"$1"):o||n}),s},Vf=function(t,e){var r=t,s;if(ks(qa,r)&&(s=qa[r],r="%"+s[0]+"%"),ks(Ur,r)){var n=Ur[r];if(n===ti&&(n=Nf(r)),typeof n>"u"&&!e)throw new ci("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:s,name:r,value:n}}throw new mi("intrinsic "+t+" does not exist!")},Zr=function(t,e){if(typeof t!="string"||t.length===0)throw new ci("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new ci('"allowMissing" argument must be a boolean');if(Gf(/^%?[^%]*%?$/,t)===null)throw new mi("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=Xf(t),s=r.length>0?r[0]:"",n=Vf("%"+s+"%",e),o=n.name,a=n.value,l=!1,h=n.alias;h&&(s=h[0],Uf(r,Lf([0,1],h)));for(var c=1,u=!0;c<r.length;c+=1){var d=r[c],f=Os(d,0,1),p=Os(d,-1);if((f==='"'||f==="'"||f==="`"||p==='"'||p==="'"||p==="`")&&f!==p)throw new mi("property names with quotes must have matching quotes");if((d==="constructor"||!u)&&(l=!0),s+="."+d,o="%"+s+"%",ks(Ur,o))a=Ur[o];else if(a!=null){if(!(d in a)){if(!e)throw new ci("base intrinsic for "+t+" exists, but the property is not available.");return}if(Lr&&c+1>=r.length){var g=Lr(a,d);u=!!g,u&&"get"in g&&!("originalValue"in g.get)?a=g.get:a=a[d]}else u=ks(a,d),a=a[d];u&&!l&&(Ur[o]=a)}}return a},_c={exports:{}},Wf=Zr,lo=Wf("%Object.defineProperty%",!0),ho=function(){if(lo)try{return lo({},"a",{value:1}),!0}catch{return!1}return!1};ho.hasArrayLengthDefineBug=function(){if(!ho())return null;try{return lo([],"length",{value:1}).length!==1}catch{return!0}};var yc=ho,jf=Zr,Es=jf("%Object.getOwnPropertyDescriptor%",!0);if(Es)try{Es([],"length")}catch{Es=null}var vc=Es,Yf=yc(),fa=Zr,Fi=Yf&&fa("%Object.defineProperty%",!0);if(Fi)try{Fi({},"a",{value:1})}catch{Fi=!1}var qf=fa("%SyntaxError%"),Jr=fa("%TypeError%"),Ka=vc,Zf=function(t,e,r){if(!t||typeof t!="object"&&typeof t!="function")throw new Jr("`obj` must be an object or a function`");if(typeof e!="string"&&typeof e!="symbol")throw new Jr("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Jr("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Jr("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Jr("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Jr("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,n=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,l=!!Ka&&Ka(t,e);if(Fi)Fi(t,e,{configurable:o===null&&l?l.configurable:!o,enumerable:s===null&&l?l.enumerable:!s,value:r,writable:n===null&&l?l.writable:!n});else if(a||!s&&!n&&!o)t[e]=r;else throw new qf("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},bc=Zr,$a=Zf,Kf=yc(),Ja=vc,Qa=bc("%TypeError%"),$f=bc("%Math.floor%"),Jf=function(t,e){if(typeof t!="function")throw new Qa("`fn` is not a function");if(typeof e!="number"||e<0||e>4294967295||$f(e)!==e)throw new Qa("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],s=!0,n=!0;if("length"in t&&Ja){var o=Ja(t,"length");o&&!o.configurable&&(s=!1),o&&!o.writable&&(n=!1)}return(s||n||!r)&&(Kf?$a(t,"length",e,!0,!0):$a(t,"length",e)),t};(function(i){var t=da,e=Zr,r=Jf,s=e("%TypeError%"),n=e("%Function.prototype.apply%"),o=e("%Function.prototype.call%"),a=e("%Reflect.apply%",!0)||t.call(o,n),l=e("%Object.defineProperty%",!0),h=e("%Math.max%");if(l)try{l({},"a",{value:1})}catch{l=null}i.exports=function(d){if(typeof d!="function")throw new s("a function is required");var f=a(t,o,arguments);return r(f,1+h(0,d.length-(arguments.length-1)),!0)};var c=function(){return a(t,n,arguments)};l?l(i.exports,"apply",{value:c}):i.exports.apply=c})(_c);var Qf=_c.exports,xc=Zr,wc=Qf,tp=wc(xc("String.prototype.indexOf")),ep=function(t,e){var r=xc(t,!!e);return typeof r=="function"&&tp(t,".prototype.")>-1?wc(r):r},pa=typeof Map=="function"&&Map.prototype,xn=Object.getOwnPropertyDescriptor&&pa?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Ns=pa&&xn&&typeof xn.get=="function"?xn.get:null,tl=pa&&Map.prototype.forEach,ma=typeof Set=="function"&&Set.prototype,wn=Object.getOwnPropertyDescriptor&&ma?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Ls=ma&&wn&&typeof wn.get=="function"?wn.get:null,el=ma&&Set.prototype.forEach,rp=typeof WeakMap=="function"&&WeakMap.prototype,ki=rp?WeakMap.prototype.has:null,ip=typeof WeakSet=="function"&&WeakSet.prototype,Oi=ip?WeakSet.prototype.has:null,sp=typeof WeakRef=="function"&&WeakRef.prototype,rl=sp?WeakRef.prototype.deref:null,np=Boolean.prototype.valueOf,op=Object.prototype.toString,ap=Function.prototype.toString,lp=String.prototype.match,ga=String.prototype.slice,pr=String.prototype.replace,hp=String.prototype.toUpperCase,il=String.prototype.toLowerCase,Tc=RegExp.prototype.test,sl=Array.prototype.concat,Ve=Array.prototype.join,cp=Array.prototype.slice,nl=Math.floor,co=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Tn=Object.getOwnPropertySymbols,uo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,gi=typeof Symbol=="function"&&typeof Symbol.iterator=="object",le=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===gi||!0)?Symbol.toStringTag:null,Ec=Object.prototype.propertyIsEnumerable,ol=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(i){return i.__proto__}:null);function al(i,t){if(i===1/0||i===-1/0||i!==i||i&&i>-1e3&&i<1e3||Tc.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof i=="number"){var r=i<0?-nl(-i):nl(i);if(r!==i){var s=String(r),n=ga.call(t,s.length+1);return pr.call(s,e,"$&_")+"."+pr.call(pr.call(n,/([0-9]{3})/g,"$&_"),/_$/,"")}}return pr.call(t,e,"$&_")}var fo=fd,ll=fo.custom,hl=Sc(ll)?ll:null,up=function i(t,e,r,s){var n=e||{};if(ur(n,"quoteStyle")&&n.quoteStyle!=="single"&&n.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(ur(n,"maxStringLength")&&(typeof n.maxStringLength=="number"?n.maxStringLength<0&&n.maxStringLength!==1/0:n.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=ur(n,"customInspect")?n.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(ur(n,"indent")&&n.indent!==null&&n.indent!=="	"&&!(parseInt(n.indent,10)===n.indent&&n.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(ur(n,"numericSeparator")&&typeof n.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=n.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Ic(t,n);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var l=String(t);return a?al(t,l):l}if(typeof t=="bigint"){var h=String(t)+"n";return a?al(t,h):h}var c=typeof n.depth>"u"?5:n.depth;if(typeof r>"u"&&(r=0),r>=c&&c>0&&typeof t=="object")return po(t)?"[Array]":"[Object]";var u=Rp(n,r);if(typeof s>"u")s=[];else if(Cc(s,t)>=0)return"[Circular]";function d(E,R,X){if(R&&(s=cp.call(s),s.push(R)),X){var q={depth:n.depth};return ur(n,"quoteStyle")&&(q.quoteStyle=n.quoteStyle),i(E,q,r+1,s)}return i(E,n,r+1,s)}if(typeof t=="function"&&!cl(t)){var f=bp(t),p=Qi(t,d);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(p.length>0?" { "+Ve.call(p,", ")+" }":"")}if(Sc(t)){var g=gi?pr.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):uo.call(t);return typeof t=="object"&&!gi?wi(g):g}if(Sp(t)){for(var _="<"+il.call(String(t.nodeName)),m=t.attributes||[],v=0;v<m.length;v++)_+=" "+m[v].name+"="+Ac(dp(m[v].value),"double",n);return _+=">",t.childNodes&&t.childNodes.length&&(_+="..."),_+="</"+il.call(String(t.nodeName))+">",_}if(po(t)){if(t.length===0)return"[]";var y=Qi(t,d);return u&&!Ip(y)?"["+mo(y,u)+"]":"[ "+Ve.call(y,", ")+" ]"}if(pp(t)){var b=Qi(t,d);return!("cause"in Error.prototype)&&"cause"in t&&!Ec.call(t,"cause")?"{ ["+String(t)+"] "+Ve.call(sl.call("[cause]: "+d(t.cause),b),", ")+" }":b.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Ve.call(b,", ")+" }"}if(typeof t=="object"&&o){if(hl&&typeof t[hl]=="function"&&fo)return fo(t,{depth:c-r});if(o!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(xp(t)){var x=[];return tl&&tl.call(t,function(E,R){x.push(d(R,t,!0)+" => "+d(E,t))}),ul("Map",Ns.call(t),x,u)}if(Ep(t)){var S=[];return el&&el.call(t,function(E){S.push(d(E,t))}),ul("Set",Ls.call(t),S,u)}if(wp(t))return En("WeakMap");if(Ap(t))return En("WeakSet");if(Tp(t))return En("WeakRef");if(gp(t))return wi(d(Number(t)));if(yp(t))return wi(d(co.call(t)));if(_p(t))return wi(np.call(t));if(mp(t))return wi(d(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===ws)return"{ [object globalThis] }";if(!fp(t)&&!cl(t)){var w=Qi(t,d),T=ol?ol(t)===Object.prototype:t instanceof Object||t.constructor===Object,P=t instanceof Object?"":"null prototype",F=!T&&le&&Object(t)===t&&le in t?ga.call(Er(t),8,-1):P?"Object":"",B=T||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",D=B+(F||P?"["+Ve.call(sl.call([],F||[],P||[]),": ")+"] ":"");return w.length===0?D+"{}":u?D+"{"+mo(w,u)+"}":D+"{ "+Ve.call(w,", ")+" }"}return String(t)};function Ac(i,t,e){var r=(e.quoteStyle||t)==="double"?'"':"'";return r+i+r}function dp(i){return pr.call(String(i),/"/g,"&quot;")}function po(i){return Er(i)==="[object Array]"&&(!le||!(typeof i=="object"&&le in i))}function fp(i){return Er(i)==="[object Date]"&&(!le||!(typeof i=="object"&&le in i))}function cl(i){return Er(i)==="[object RegExp]"&&(!le||!(typeof i=="object"&&le in i))}function pp(i){return Er(i)==="[object Error]"&&(!le||!(typeof i=="object"&&le in i))}function mp(i){return Er(i)==="[object String]"&&(!le||!(typeof i=="object"&&le in i))}function gp(i){return Er(i)==="[object Number]"&&(!le||!(typeof i=="object"&&le in i))}function _p(i){return Er(i)==="[object Boolean]"&&(!le||!(typeof i=="object"&&le in i))}function Sc(i){if(gi)return i&&typeof i=="object"&&i instanceof Symbol;if(typeof i=="symbol")return!0;if(!i||typeof i!="object"||!uo)return!1;try{return uo.call(i),!0}catch{}return!1}function yp(i){if(!i||typeof i!="object"||!co)return!1;try{return co.call(i),!0}catch{}return!1}var vp=Object.prototype.hasOwnProperty||function(i){return i in this};function ur(i,t){return vp.call(i,t)}function Er(i){return op.call(i)}function bp(i){if(i.name)return i.name;var t=lp.call(ap.call(i),/^function\s*([\w$]+)/);return t?t[1]:null}function Cc(i,t){if(i.indexOf)return i.indexOf(t);for(var e=0,r=i.length;e<r;e++)if(i[e]===t)return e;return-1}function xp(i){if(!Ns||!i||typeof i!="object")return!1;try{Ns.call(i);try{Ls.call(i)}catch{return!0}return i instanceof Map}catch{}return!1}function wp(i){if(!ki||!i||typeof i!="object")return!1;try{ki.call(i,ki);try{Oi.call(i,Oi)}catch{return!0}return i instanceof WeakMap}catch{}return!1}function Tp(i){if(!rl||!i||typeof i!="object")return!1;try{return rl.call(i),!0}catch{}return!1}function Ep(i){if(!Ls||!i||typeof i!="object")return!1;try{Ls.call(i);try{Ns.call(i)}catch{return!0}return i instanceof Set}catch{}return!1}function Ap(i){if(!Oi||!i||typeof i!="object")return!1;try{Oi.call(i,Oi);try{ki.call(i,ki)}catch{return!0}return i instanceof WeakSet}catch{}return!1}function Sp(i){return!i||typeof i!="object"?!1:typeof HTMLElement<"u"&&i instanceof HTMLElement?!0:typeof i.nodeName=="string"&&typeof i.getAttribute=="function"}function Ic(i,t){if(i.length>t.maxStringLength){var e=i.length-t.maxStringLength,r="... "+e+" more character"+(e>1?"s":"");return Ic(ga.call(i,0,t.maxStringLength),t)+r}var s=pr.call(pr.call(i,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Cp);return Ac(s,"single",t)}function Cp(i){var t=i.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+hp.call(t.toString(16))}function wi(i){return"Object("+i+")"}function En(i){return i+" { ? }"}function ul(i,t,e,r){var s=r?mo(e,r):Ve.call(e,", ");return i+" ("+t+") {"+s+"}"}function Ip(i){for(var t=0;t<i.length;t++)if(Cc(i[t],`
`)>=0)return!1;return!0}function Rp(i,t){var e;if(i.indent==="	")e="	";else if(typeof i.indent=="number"&&i.indent>0)e=Ve.call(Array(i.indent+1)," ");else return null;return{base:e,prev:Ve.call(Array(t+1),e)}}function mo(i,t){if(i.length===0)return"";var e=`
`+t.prev+t.base;return e+Ve.call(i,","+e)+`
`+t.prev}function Qi(i,t){var e=po(i),r=[];if(e){r.length=i.length;for(var s=0;s<i.length;s++)r[s]=ur(i,s)?t(i[s],i):""}var n=typeof Tn=="function"?Tn(i):[],o;if(gi){o={};for(var a=0;a<n.length;a++)o["$"+n[a]]=n[a]}for(var l in i)ur(i,l)&&(e&&String(Number(l))===l&&l<i.length||gi&&o["$"+l]instanceof Symbol||(Tc.call(/[^\w$]/,l)?r.push(t(l,i)+": "+t(i[l],i)):r.push(l+": "+t(i[l],i))));if(typeof Tn=="function")for(var h=0;h<n.length;h++)Ec.call(i,n[h])&&r.push("["+t(n[h])+"]: "+t(i[n[h]],i));return r}var _a=Zr,vi=ep,Pp=up,Mp=_a("%TypeError%"),ts=_a("%WeakMap%",!0),es=_a("%Map%",!0),Bp=vi("WeakMap.prototype.get",!0),Dp=vi("WeakMap.prototype.set",!0),Fp=vi("WeakMap.prototype.has",!0),kp=vi("Map.prototype.get",!0),Op=vi("Map.prototype.set",!0),Np=vi("Map.prototype.has",!0),ya=function(i,t){for(var e=i,r;(r=e.next)!==null;e=r)if(r.key===t)return e.next=r.next,r.next=i.next,i.next=r,r},Lp=function(i,t){var e=ya(i,t);return e&&e.value},Up=function(i,t,e){var r=ya(i,t);r?r.value=e:i.next={key:t,next:i.next,value:e}},Gp=function(i,t){return!!ya(i,t)},Hp=function(){var t,e,r,s={assert:function(n){if(!s.has(n))throw new Mp("Side channel does not contain "+Pp(n))},get:function(n){if(ts&&n&&(typeof n=="object"||typeof n=="function")){if(t)return Bp(t,n)}else if(es){if(e)return kp(e,n)}else if(r)return Lp(r,n)},has:function(n){if(ts&&n&&(typeof n=="object"||typeof n=="function")){if(t)return Fp(t,n)}else if(es){if(e)return Np(e,n)}else if(r)return Gp(r,n);return!1},set:function(n,o){ts&&n&&(typeof n=="object"||typeof n=="function")?(t||(t=new ts),Dp(t,n,o)):es?(e||(e=new es),Op(e,n,o)):(r||(r={key:{},next:null}),Up(r,n,o))}};return s},zp=String.prototype.replace,Xp=/%20/g,An={RFC1738:"RFC1738",RFC3986:"RFC3986"},va={default:An.RFC3986,formatters:{RFC1738:function(i){return zp.call(i,Xp,"+")},RFC3986:function(i){return String(i)}},RFC1738:An.RFC1738,RFC3986:An.RFC3986},Vp=va,Sn=Object.prototype.hasOwnProperty,kr=Array.isArray,Le=function(){for(var i=[],t=0;t<256;++t)i.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return i}(),Wp=function(t){for(;t.length>1;){var e=t.pop(),r=e.obj[e.prop];if(kr(r)){for(var s=[],n=0;n<r.length;++n)typeof r[n]<"u"&&s.push(r[n]);e.obj[e.prop]=s}}},Rc=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},s=0;s<t.length;++s)typeof t[s]<"u"&&(r[s]=t[s]);return r},jp=function i(t,e,r){if(!e)return t;if(typeof e!="object"){if(kr(t))t.push(e);else if(t&&typeof t=="object")(r&&(r.plainObjects||r.allowPrototypes)||!Sn.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var s=t;return kr(t)&&!kr(e)&&(s=Rc(t,r)),kr(t)&&kr(e)?(e.forEach(function(n,o){if(Sn.call(t,o)){var a=t[o];a&&typeof a=="object"&&n&&typeof n=="object"?t[o]=i(a,n,r):t.push(n)}else t[o]=n}),t):Object.keys(e).reduce(function(n,o){var a=e[o];return Sn.call(n,o)?n[o]=i(n[o],a,r):n[o]=a,n},s)},Yp=function(t,e){return Object.keys(e).reduce(function(r,s){return r[s]=e[s],r},t)},qp=function(i,t,e){var r=i.replace(/\+/g," ");if(e==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},Zp=function(t,e,r,s,n){if(t.length===0)return t;var o=t;if(typeof t=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),r==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(c){return"%26%23"+parseInt(c.slice(2),16)+"%3B"});for(var a="",l=0;l<o.length;++l){var h=o.charCodeAt(l);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||n===Vp.RFC1738&&(h===40||h===41)){a+=o.charAt(l);continue}if(h<128){a=a+Le[h];continue}if(h<2048){a=a+(Le[192|h>>6]+Le[128|h&63]);continue}if(h<55296||h>=57344){a=a+(Le[224|h>>12]+Le[128|h>>6&63]+Le[128|h&63]);continue}l+=1,h=65536+((h&1023)<<10|o.charCodeAt(l)&1023),a+=Le[240|h>>18]+Le[128|h>>12&63]+Le[128|h>>6&63]+Le[128|h&63]}return a},Kp=function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],s=0;s<e.length;++s)for(var n=e[s],o=n.obj[n.prop],a=Object.keys(o),l=0;l<a.length;++l){var h=a[l],c=o[h];typeof c=="object"&&c!==null&&r.indexOf(c)===-1&&(e.push({obj:o,prop:h}),r.push(c))}return Wp(e),t},$p=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},Jp=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},Qp=function(t,e){return[].concat(t,e)},tm=function(t,e){if(kr(t)){for(var r=[],s=0;s<t.length;s+=1)r.push(e(t[s]));return r}return e(t)},Pc={arrayToObject:Rc,assign:Yp,combine:Qp,compact:Kp,decode:qp,encode:Zp,isBuffer:Jp,isRegExp:$p,maybeMap:tm,merge:jp},Mc=Hp,As=Pc,Ni=va,em=Object.prototype.hasOwnProperty,dl={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},er=Array.isArray,rm=Array.prototype.push,Bc=function(i,t){rm.apply(i,er(t)?t:[t])},im=Date.prototype.toISOString,fl=Ni.default,ee={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:As.encode,encodeValuesOnly:!1,format:fl,formatter:Ni.formatters[fl],indices:!1,serializeDate:function(t){return im.call(t)},skipNulls:!1,strictNullHandling:!1},sm=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},Cn={},nm=function i(t,e,r,s,n,o,a,l,h,c,u,d,f,p,g,_){for(var m=t,v=_,y=0,b=!1;(v=v.get(Cn))!==void 0&&!b;){var x=v.get(t);if(y+=1,typeof x<"u"){if(x===y)throw new RangeError("Cyclic object value");b=!0}typeof v.get(Cn)>"u"&&(y=0)}if(typeof l=="function"?m=l(e,m):m instanceof Date?m=u(m):r==="comma"&&er(m)&&(m=As.maybeMap(m,function(q){return q instanceof Date?u(q):q})),m===null){if(n)return a&&!p?a(e,ee.encoder,g,"key",d):e;m=""}if(sm(m)||As.isBuffer(m)){if(a){var S=p?e:a(e,ee.encoder,g,"key",d);return[f(S)+"="+f(a(m,ee.encoder,g,"value",d))]}return[f(e)+"="+f(String(m))]}var w=[];if(typeof m>"u")return w;var T;if(r==="comma"&&er(m))p&&a&&(m=As.maybeMap(m,a)),T=[{value:m.length>0?m.join(",")||null:void 0}];else if(er(l))T=l;else{var P=Object.keys(m);T=h?P.sort(h):P}for(var F=s&&er(m)&&m.length===1?e+"[]":e,B=0;B<T.length;++B){var D=T[B],E=typeof D=="object"&&typeof D.value<"u"?D.value:m[D];if(!(o&&E===null)){var R=er(m)?typeof r=="function"?r(F,D):F:F+(c?"."+D:"["+D+"]");_.set(t,y);var X=Mc();X.set(Cn,_),Bc(w,i(E,R,r,s,n,o,r==="comma"&&p&&er(m)?null:a,l,h,c,u,d,f,p,g,X))}}return w},om=function(t){if(!t)return ee;if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||ee.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=Ni.default;if(typeof t.format<"u"){if(!em.call(Ni.formatters,t.format))throw new TypeError("Unknown format option provided.");r=t.format}var s=Ni.formatters[r],n=ee.filter;return(typeof t.filter=="function"||er(t.filter))&&(n=t.filter),{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:ee.addQueryPrefix,allowDots:typeof t.allowDots>"u"?ee.allowDots:!!t.allowDots,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:ee.charsetSentinel,delimiter:typeof t.delimiter>"u"?ee.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:ee.encode,encoder:typeof t.encoder=="function"?t.encoder:ee.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:ee.encodeValuesOnly,filter:n,format:r,formatter:s,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:ee.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:ee.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:ee.strictNullHandling}},am=function(i,t){var e=i,r=om(t),s,n;typeof r.filter=="function"?(n=r.filter,e=n("",e)):er(r.filter)&&(n=r.filter,s=n);var o=[];if(typeof e!="object"||e===null)return"";var a;t&&t.arrayFormat in dl?a=t.arrayFormat:t&&"indices"in t?a=t.indices?"indices":"repeat":a="indices";var l=dl[a];if(t&&"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var h=l==="comma"&&t&&t.commaRoundTrip;s||(s=Object.keys(e)),r.sort&&s.sort(r.sort);for(var c=Mc(),u=0;u<s.length;++u){var d=s[u];r.skipNulls&&e[d]===null||Bc(o,nm(e[d],d,l,h,r.strictNullHandling,r.skipNulls,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}var f=o.join(r.delimiter),p=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),f.length>0?p+f:""},_i=Pc,go=Object.prototype.hasOwnProperty,lm=Array.isArray,$t={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:_i.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},hm=function(i){return i.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},Dc=function(i,t){return i&&typeof i=="string"&&t.comma&&i.indexOf(",")>-1?i.split(","):i},cm="utf8=%26%2310003%3B",um="utf8=%E2%9C%93",dm=function(t,e){var r={__proto__:null},s=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,n=e.parameterLimit===1/0?void 0:e.parameterLimit,o=s.split(e.delimiter,n),a=-1,l,h=e.charset;if(e.charsetSentinel)for(l=0;l<o.length;++l)o[l].indexOf("utf8=")===0&&(o[l]===um?h="utf-8":o[l]===cm&&(h="iso-8859-1"),a=l,l=o.length);for(l=0;l<o.length;++l)if(l!==a){var c=o[l],u=c.indexOf("]="),d=u===-1?c.indexOf("="):u+1,f,p;d===-1?(f=e.decoder(c,$t.decoder,h,"key"),p=e.strictNullHandling?null:""):(f=e.decoder(c.slice(0,d),$t.decoder,h,"key"),p=_i.maybeMap(Dc(c.slice(d+1),e),function(g){return e.decoder(g,$t.decoder,h,"value")})),p&&e.interpretNumericEntities&&h==="iso-8859-1"&&(p=hm(p)),c.indexOf("[]=")>-1&&(p=lm(p)?[p]:p),go.call(r,f)?r[f]=_i.combine(r[f],p):r[f]=p}return r},fm=function(i,t,e,r){for(var s=r?t:Dc(t,e),n=i.length-1;n>=0;--n){var o,a=i[n];if(a==="[]"&&e.parseArrays)o=[].concat(s);else{o=e.plainObjects?Object.create(null):{};var l=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,h=parseInt(l,10);!e.parseArrays&&l===""?o={0:s}:!isNaN(h)&&a!==l&&String(h)===l&&h>=0&&e.parseArrays&&h<=e.arrayLimit?(o=[],o[h]=s):l!=="__proto__"&&(o[l]=s)}s=o}return s},pm=function(t,e,r,s){if(t){var n=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,l=r.depth>0&&o.exec(n),h=l?n.slice(0,l.index):n,c=[];if(h){if(!r.plainObjects&&go.call(Object.prototype,h)&&!r.allowPrototypes)return;c.push(h)}for(var u=0;r.depth>0&&(l=a.exec(n))!==null&&u<r.depth;){if(u+=1,!r.plainObjects&&go.call(Object.prototype,l[1].slice(1,-1))&&!r.allowPrototypes)return;c.push(l[1])}return l&&c.push("["+n.slice(l.index)+"]"),fm(c,e,r,s)}},mm=function(t){if(!t)return $t;if(t.decoder!==null&&t.decoder!==void 0&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?$t.charset:t.charset;return{allowDots:typeof t.allowDots>"u"?$t.allowDots:!!t.allowDots,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:$t.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:$t.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:$t.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:$t.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:$t.comma,decoder:typeof t.decoder=="function"?t.decoder:$t.decoder,delimiter:typeof t.delimiter=="string"||_i.isRegExp(t.delimiter)?t.delimiter:$t.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:$t.depth,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:$t.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:$t.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:$t.plainObjects,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:$t.strictNullHandling}},gm=function(i,t){var e=mm(t);if(i===""||i===null||typeof i>"u")return e.plainObjects?Object.create(null):{};for(var r=typeof i=="string"?dm(i,e):i,s=e.plainObjects?Object.create(null):{},n=Object.keys(r),o=0;o<n.length;++o){var a=n[o],l=pm(a,r[a],e,typeof i=="string");s=_i.merge(s,l,e)}return e.allowSparse===!0?s:_i.compact(s)},_m=am,ym=gm,vm=va,bm={formats:vm,parse:ym,stringify:_m},xm=mf;function or(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var wm=/^([a-z0-9.+-]+:)/i,Tm=/:[0-9]*$/,Em=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,Am=["<",">",'"',"`"," ","\r",`
`,"	"],Sm=["{","}","|","\\","^","`"].concat(Am),_o=["'"].concat(Sm),pl=["%","/","?",";","#"].concat(_o),ml=["/","?","#"],Cm=255,gl=/^[+a-z0-9A-Z_-]{0,63}$/,Im=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Rm={javascript:!0,"javascript:":!0},yo={javascript:!0,"javascript:":!0},ui={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},vo=bm;function Pm(i,t,e){if(i&&typeof i=="object"&&i instanceof or)return i;var r=new or;return r.parse(i,t,e),r}or.prototype.parse=function(i,t,e){if(typeof i!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var r=i.indexOf("?"),s=r!==-1&&r<i.indexOf("#")?"?":"#",n=i.split(s),o=/\\/g;n[0]=n[0].replace(o,"/"),i=n.join(s);var a=i;if(a=a.trim(),!e&&i.split("#").length===1){var l=Em.exec(a);if(l)return this.path=a,this.href=a,this.pathname=l[1],l[2]?(this.search=l[2],t?this.query=vo.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var h=wm.exec(a);if(h){h=h[0];var c=h.toLowerCase();this.protocol=c,a=a.substr(h.length)}if(e||h||a.match(/^\/\/[^@/]+@[^@/]+/)){var u=a.substr(0,2)==="//";u&&!(h&&yo[h])&&(a=a.substr(2),this.slashes=!0)}if(!yo[h]&&(u||h&&!ui[h])){for(var d=-1,f=0;f<ml.length;f++){var p=a.indexOf(ml[f]);p!==-1&&(d===-1||p<d)&&(d=p)}var g,_;d===-1?_=a.lastIndexOf("@"):_=a.lastIndexOf("@",d),_!==-1&&(g=a.slice(0,_),a=a.slice(_+1),this.auth=decodeURIComponent(g)),d=-1;for(var f=0;f<pl.length;f++){var p=a.indexOf(pl[f]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var m=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!m)for(var v=this.hostname.split(/\./),f=0,y=v.length;f<y;f++){var b=v[f];if(b&&!b.match(gl)){for(var x="",S=0,w=b.length;S<w;S++)b.charCodeAt(S)>127?x+="x":x+=b[S];if(!x.match(gl)){var T=v.slice(0,f),P=v.slice(f+1),F=b.match(Im);F&&(T.push(F[1]),P.unshift(F[2])),P.length&&(a="/"+P.join(".")+a),this.hostname=T.join(".");break}}}this.hostname.length>Cm?this.hostname="":this.hostname=this.hostname.toLowerCase(),m||(this.hostname=xm.toASCII(this.hostname));var B=this.port?":"+this.port:"",D=this.hostname||"";this.host=D+B,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!Rm[c])for(var f=0,y=_o.length;f<y;f++){var E=_o[f];if(a.indexOf(E)!==-1){var R=encodeURIComponent(E);R===E&&(R=escape(E)),a=a.split(E).join(R)}}var X=a.indexOf("#");X!==-1&&(this.hash=a.substr(X),a=a.slice(0,X));var q=a.indexOf("?");if(q!==-1?(this.search=a.substr(q),this.query=a.substr(q+1),t&&(this.query=vo.parse(this.query)),a=a.slice(0,q)):t&&(this.search="",this.query={}),a&&(this.pathname=a),ui[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var B=this.pathname||"",U=this.search||"";this.path=B+U}return this.href=this.format(),this};or.prototype.format=function(){var i=this.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var t=this.protocol||"",e=this.pathname||"",r=this.hash||"",s=!1,n="";this.host?s=i+this.host:this.hostname&&(s=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(n=vo.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||n&&"?"+n||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||ui[t])&&s!==!1?(s="//"+(s||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):s||(s=""),r&&r.charAt(0)!=="#"&&(r="#"+r),o&&o.charAt(0)!=="?"&&(o="?"+o),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),t+s+e+o+r};or.prototype.resolve=function(i){return this.resolveObject(Pm(i,!1,!0)).format()};or.prototype.resolveObject=function(i){if(typeof i=="string"){var t=new or;t.parse(i,!1,!0),i=t}for(var e=new or,r=Object.keys(this),s=0;s<r.length;s++){var n=r[s];e[n]=this[n]}if(e.hash=i.hash,i.href==="")return e.href=e.format(),e;if(i.slashes&&!i.protocol){for(var o=Object.keys(i),a=0;a<o.length;a++){var l=o[a];l!=="protocol"&&(e[l]=i[l])}return ui[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(i.protocol&&i.protocol!==e.protocol){if(!ui[i.protocol]){for(var h=Object.keys(i),c=0;c<h.length;c++){var u=h[c];e[u]=i[u]}return e.href=e.format(),e}if(e.protocol=i.protocol,!i.host&&!yo[i.protocol]){for(var y=(i.pathname||"").split("/");y.length&&!(i.host=y.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),y[0]!==""&&y.unshift(""),y.length<2&&y.unshift(""),e.pathname=y.join("/")}else e.pathname=i.pathname;if(e.search=i.search,e.query=i.query,e.host=i.host||"",e.auth=i.auth,e.hostname=i.hostname||i.host,e.port=i.port,e.pathname||e.search){var d=e.pathname||"",f=e.search||"";e.path=d+f}return e.slashes=e.slashes||i.slashes,e.href=e.format(),e}var p=e.pathname&&e.pathname.charAt(0)==="/",g=i.host||i.pathname&&i.pathname.charAt(0)==="/",_=g||p||e.host&&i.pathname,m=_,v=e.pathname&&e.pathname.split("/")||[],y=i.pathname&&i.pathname.split("/")||[],b=e.protocol&&!ui[e.protocol];if(b&&(e.hostname="",e.port=null,e.host&&(v[0]===""?v[0]=e.host:v.unshift(e.host)),e.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(y[0]===""?y[0]=i.host:y.unshift(i.host)),i.host=null),_=_&&(y[0]===""||v[0]==="")),g)e.host=i.host||i.host===""?i.host:e.host,e.hostname=i.hostname||i.hostname===""?i.hostname:e.hostname,e.search=i.search,e.query=i.query,v=y;else if(y.length)v||(v=[]),v.pop(),v=v.concat(y),e.search=i.search,e.query=i.query;else if(i.search!=null){if(b){e.host=v.shift(),e.hostname=e.host;var x=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;x&&(e.auth=x.shift(),e.hostname=x.shift(),e.host=e.hostname)}return e.search=i.search,e.query=i.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!v.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var S=v.slice(-1)[0],w=(e.host||i.host||v.length>1)&&(S==="."||S==="..")||S==="",T=0,P=v.length;P>=0;P--)S=v[P],S==="."?v.splice(P,1):S===".."?(v.splice(P,1),T++):T&&(v.splice(P,1),T--);if(!_&&!m)for(;T--;T)v.unshift("..");_&&v[0]!==""&&(!v[0]||v[0].charAt(0)!=="/")&&v.unshift(""),w&&v.join("/").substr(-1)!=="/"&&v.push("");var F=v[0]===""||v[0]&&v[0].charAt(0)==="/";if(b){e.hostname=F?"":v.length?v.shift():"",e.host=e.hostname;var x=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;x&&(e.auth=x.shift(),e.hostname=x.shift(),e.host=e.hostname)}return _=_||e.host&&v.length,_&&!F&&v.unshift(""),v.length>0?e.pathname=v.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=i.auth||e.auth,e.slashes=e.slashes||i.slashes,e.href=e.format(),e};or.prototype.parseHost=function(){var i=this.host,t=Tm.exec(i);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),i=i.substr(0,i.length-t.length)),i&&(this.hostname=i)};const _l={};function _t(i,t,e=3){if(_l[t])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`):(r=r.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${i}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`),console.warn(r))),_l[t]=!0}function Ie(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function Ti(i){return i.split("?")[0].split("#")[0]}function Mm(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Bm(i,t,e){return i.replace(new RegExp(Mm(t),"g"),e)}function Dm(i,t){let e="",r=0,s=-1,n=0,o=-1;for(let a=0;a<=i.length;++a){if(a<i.length)o=i.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(s===a-1||n===1))if(s!==a-1&&n===2){if(e.length<2||r!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const l=e.lastIndexOf("/");if(l!==e.length-1){l===-1?(e="",r=0):(e=e.slice(0,l),r=e.length-1-e.lastIndexOf("/")),s=a,n=0;continue}}else if(e.length===2||e.length===1){e="",r=0,s=a,n=0;continue}}}else e.length>0?e+=`/${i.slice(s+1,a)}`:e=i.slice(s+1,a),r=a-s-1;s=a,n=0}else o===46&&n!==-1?++n:n=-1}return e}const Kt={toPosix(i){return Bm(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},isBlobUrl(i){return i.startsWith("blob:")},hasProtocol(i){return/^[^/:]+:/.test(this.toPosix(i))},getProtocol(i){Ie(i),i=this.toPosix(i);const t=/^file:\/\/\//.exec(i);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(i);return e?e[0]:""},toAbsolute(i,t,e){if(Ie(i),this.isDataUrl(i)||this.isBlobUrl(i))return i;const r=Ti(this.toPosix(t??tt.ADAPTER.getBaseUrl())),s=Ti(this.toPosix(e??this.rootname(r)));return i=this.toPosix(i),i.startsWith("/")?Kt.join(s,i.slice(1)):this.isAbsolute(i)?i:this.join(r,i)},normalize(i){if(Ie(i),i.length===0)return".";if(this.isDataUrl(i)||this.isBlobUrl(i))return i;i=this.toPosix(i);let t="";const e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));const r=i.endsWith("/");return i=Dm(i),i.length>0&&r&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return Ie(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){if(i.length===0)return".";let t;for(let e=0;e<i.length;++e){const r=i[e];if(Ie(r),r.length>0)if(t===void 0)t=r;else{const s=i[e-1]??"";this.extname(s)?t+=`/../${r}`:t+=`/${r}`}}return t===void 0?".":this.normalize(t)},dirname(i){if(Ie(i),i.length===0)return".";i=this.toPosix(i);let t=i.charCodeAt(0);const e=t===47;let r=-1,s=!0;const n=this.getProtocol(i),o=i;i=i.slice(n.length);for(let a=i.length-1;a>=1;--a)if(t=i.charCodeAt(a),t===47){if(!s){r=a;break}}else s=!1;return r===-1?e?"/":this.isUrl(o)?n+i:n:e&&r===1?"//":n+i.slice(0,r)},rootname(i){Ie(i),i=this.toPosix(i);let t="";if(i.startsWith("/")?t="/":t=this.getProtocol(i),this.isUrl(i)){const e=i.indexOf("/",t.length);e!==-1?t=i.slice(0,e):t=i,t.endsWith("/")||(t+="/")}return t},basename(i,t){Ie(i),t&&Ie(t),i=Ti(this.toPosix(i));let e=0,r=-1,s=!0,n;if(t!==void 0&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let o=t.length-1,a=-1;for(n=i.length-1;n>=0;--n){const l=i.charCodeAt(n);if(l===47){if(!s){e=n+1;break}}else a===-1&&(s=!1,a=n+1),o>=0&&(l===t.charCodeAt(o)?--o===-1&&(r=n):(o=-1,r=a))}return e===r?r=a:r===-1&&(r=i.length),i.slice(e,r)}for(n=i.length-1;n>=0;--n)if(i.charCodeAt(n)===47){if(!s){e=n+1;break}}else r===-1&&(s=!1,r=n+1);return r===-1?"":i.slice(e,r)},extname(i){Ie(i),i=Ti(this.toPosix(i));let t=-1,e=0,r=-1,s=!0,n=0;for(let o=i.length-1;o>=0;--o){const a=i.charCodeAt(o);if(a===47){if(!s){e=o+1;break}continue}r===-1&&(s=!1,r=o+1),a===46?t===-1?t=o:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||r===-1||n===0||n===1&&t===r-1&&t===e+1?"":i.slice(t,r)},parse(i){Ie(i);const t={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return t;i=Ti(this.toPosix(i));let e=i.charCodeAt(0);const r=this.isAbsolute(i);let s;t.root=this.rootname(i),r||this.hasProtocol(i)?s=1:s=0;let n=-1,o=0,a=-1,l=!0,h=i.length-1,c=0;for(;h>=s;--h){if(e=i.charCodeAt(h),e===47){if(!l){o=h+1;break}continue}a===-1&&(l=!1,a=h+1),e===46?n===-1?n=h:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||a===-1||c===0||c===1&&n===a-1&&n===o+1?a!==-1&&(o===0&&r?t.base=t.name=i.slice(1,a):t.base=t.name=i.slice(o,a)):(o===0&&r?(t.name=i.slice(1,n),t.base=i.slice(1,a)):(t.name=i.slice(o,n),t.base=i.slice(o,a)),t.ext=i.slice(n,a)),t.dir=this.dirname(i),t},sep:"/",delimiter:":"};let In;async function Fm(){return In??(In=(async()=>{const i=document.createElement("canvas").getContext("webgl");if(!i)return me.UNPACK;const t=await new Promise(n=>{const o=document.createElement("video");o.onloadeddata=()=>n(o),o.onerror=()=>n(null),o.autoplay=!1,o.crossOrigin="anonymous",o.preload="auto",o.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",o.load()});if(!t)return me.UNPACK;const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);const r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t);const s=new Uint8Array(4);return i.readPixels(0,0,1,1,i.RGBA,i.UNSIGNED_BYTE,s),i.deleteFramebuffer(r),i.deleteTexture(e),i.getExtension("WEBGL_lose_context")?.loseContext(),s[0]<=s[3]?me.PMA:me.UNPACK})()),In}let Rn;function km(){return typeof Rn>"u"&&(Rn=function(){const i={stencil:!0,failIfMajorPerformanceCaveat:tt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!tt.ADAPTER.getWebGLRenderingContext())return!1;const t=tt.ADAPTER.createCanvas();let e=t.getContext("webgl",i)||t.getContext("experimental-webgl",i);const r=!!e?.getContextAttributes()?.stencil;if(e){const s=e.getExtension("WEBGL_lose_context");s&&s.loseContext()}return e=null,r}catch{return!1}}()),Rn}var Om={grad:.9,turn:360,rad:360/(2*Math.PI)},Qe=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},Qt=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*i)/e+0},Ae=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),i>e?e:i>t?i:t},Fc=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},yl=function(i){return{r:Ae(i.r,0,255),g:Ae(i.g,0,255),b:Ae(i.b,0,255),a:Ae(i.a)}},Pn=function(i){return{r:Qt(i.r),g:Qt(i.g),b:Qt(i.b),a:Qt(i.a,3)}},Nm=/^#([0-9a-f]{3,8})$/i,rs=function(i){var t=i.toString(16);return t.length<2?"0"+t:t},kc=function(i){var t=i.r,e=i.g,r=i.b,s=i.a,n=Math.max(t,e,r),o=n-Math.min(t,e,r),a=o?n===t?(e-r)/o:n===e?2+(r-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:s}},Oc=function(i){var t=i.h,e=i.s,r=i.v,s=i.a;t=t/360*6,e/=100,r/=100;var n=Math.floor(t),o=r*(1-e),a=r*(1-(t-n)*e),l=r*(1-(1-t+n)*e),h=n%6;return{r:255*[r,a,o,o,l,r][h],g:255*[l,r,r,a,o,o][h],b:255*[o,o,l,r,r,a][h],a:s}},vl=function(i){return{h:Fc(i.h),s:Ae(i.s,0,100),l:Ae(i.l,0,100),a:Ae(i.a)}},bl=function(i){return{h:Qt(i.h),s:Qt(i.s),l:Qt(i.l),a:Qt(i.a,3)}},xl=function(i){return Oc((e=(t=i).s,{h:t.h,s:(e*=((r=t.l)<50?r:100-r)/100)>0?2*e/(r+e)*100:0,v:r+e,a:t.a}));var t,e,r},Li=function(i){return{h:(t=kc(i)).h,s:(s=(200-(e=t.s))*(r=t.v)/100)>0&&s<200?e*r/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a};var t,e,r,s},Lm=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Um=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Gm=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Hm=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,bo={string:[[function(i){var t=Nm.exec(i);return t?(i=t[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?Qt(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?Qt(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var t=Gm.exec(i)||Hm.exec(i);return t?t[2]!==t[4]||t[4]!==t[6]?null:yl({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(i){var t=Lm.exec(i)||Um.exec(i);if(!t)return null;var e,r,s=vl({h:(e=t[1],r=t[2],r===void 0&&(r="deg"),Number(e)*(Om[r]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return xl(s)},"hsl"]],object:[[function(i){var t=i.r,e=i.g,r=i.b,s=i.a,n=s===void 0?1:s;return Qe(t)&&Qe(e)&&Qe(r)?yl({r:Number(t),g:Number(e),b:Number(r),a:Number(n)}):null},"rgb"],[function(i){var t=i.h,e=i.s,r=i.l,s=i.a,n=s===void 0?1:s;if(!Qe(t)||!Qe(e)||!Qe(r))return null;var o=vl({h:Number(t),s:Number(e),l:Number(r),a:Number(n)});return xl(o)},"hsl"],[function(i){var t=i.h,e=i.s,r=i.v,s=i.a,n=s===void 0?1:s;if(!Qe(t)||!Qe(e)||!Qe(r))return null;var o=function(a){return{h:Fc(a.h),s:Ae(a.s,0,100),v:Ae(a.v,0,100),a:Ae(a.a)}}({h:Number(t),s:Number(e),v:Number(r),a:Number(n)});return Oc(o)},"hsv"]]},wl=function(i,t){for(var e=0;e<t.length;e++){var r=t[e][0](i);if(r)return[r,t[e][1]]}return[null,void 0]},zm=function(i){return typeof i=="string"?wl(i.trim(),bo.string):typeof i=="object"&&i!==null?wl(i,bo.object):[null,void 0]},Mn=function(i,t){var e=Li(i);return{h:e.h,s:Ae(e.s+100*t,0,100),l:e.l,a:e.a}},Bn=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},Tl=function(i,t){var e=Li(i);return{h:e.h,s:e.s,l:Ae(e.l+100*t,0,100),a:e.a}},xo=function(){function i(t){this.parsed=zm(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return Qt(Bn(this.rgba),2)},i.prototype.isDark=function(){return Bn(this.rgba)<.5},i.prototype.isLight=function(){return Bn(this.rgba)>=.5},i.prototype.toHex=function(){return t=Pn(this.rgba),e=t.r,r=t.g,s=t.b,o=(n=t.a)<1?rs(Qt(255*n)):"","#"+rs(e)+rs(r)+rs(s)+o;var t,e,r,s,n,o},i.prototype.toRgb=function(){return Pn(this.rgba)},i.prototype.toRgbString=function(){return t=Pn(this.rgba),e=t.r,r=t.g,s=t.b,(n=t.a)<1?"rgba("+e+", "+r+", "+s+", "+n+")":"rgb("+e+", "+r+", "+s+")";var t,e,r,s,n},i.prototype.toHsl=function(){return bl(Li(this.rgba))},i.prototype.toHslString=function(){return t=bl(Li(this.rgba)),e=t.h,r=t.s,s=t.l,(n=t.a)<1?"hsla("+e+", "+r+"%, "+s+"%, "+n+")":"hsl("+e+", "+r+"%, "+s+"%)";var t,e,r,s,n},i.prototype.toHsv=function(){return t=kc(this.rgba),{h:Qt(t.h),s:Qt(t.s),v:Qt(t.v),a:Qt(t.a,3)};var t},i.prototype.invert=function(){return Ue({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},i.prototype.saturate=function(t){return t===void 0&&(t=.1),Ue(Mn(this.rgba,t))},i.prototype.desaturate=function(t){return t===void 0&&(t=.1),Ue(Mn(this.rgba,-t))},i.prototype.grayscale=function(){return Ue(Mn(this.rgba,-1))},i.prototype.lighten=function(t){return t===void 0&&(t=.1),Ue(Tl(this.rgba,t))},i.prototype.darken=function(t){return t===void 0&&(t=.1),Ue(Tl(this.rgba,-t))},i.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},i.prototype.alpha=function(t){return typeof t=="number"?Ue({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Qt(this.rgba.a,3);var e},i.prototype.hue=function(t){var e=Li(this.rgba);return typeof t=="number"?Ue({h:t,s:e.s,l:e.l,a:e.a}):Qt(e.h)},i.prototype.isEqual=function(t){return this.toHex()===Ue(t).toHex()},i}(),Ue=function(i){return i instanceof xo?i:new xo(i)},El=[],Xm=function(i){i.forEach(function(t){El.indexOf(t)<0&&(t(xo,bo),El.push(t))})};function Vm(i,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var s in e)r[e[s]]=s;var n={};i.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,h=r[this.toHex()];if(h)return h;if(o?.closest){var c=this.toRgb(),u=1/0,d="black";if(!n.length)for(var f in e)n[f]=new i(e[f]).toRgb();for(var p in e){var g=(a=c,l=n[p],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));g<u&&(u=g,d=p)}return d}},t.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":e[a];return l?new i(l).toRgb():null},"name"])}Xm([Vm]);const ei=class Ss{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Ss)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if(r==="number"||r==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,n)=>s===e[n]);if(t!==null&&e!==null){const s=Object.keys(t),n=Object.keys(e);return s.length!==n.length?!1:s.every(o=>t[o]===e[o])}return t===e}toRgba(){const[t,e,r,s]=this._components;return{r:t,g:e,b:r,a:s}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,s]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(r*255),t[2]=Math.round(s*255),t}toRgbArray(t){t=t??[];const[e,r,s]=this._components;return t[0]=e,t[1]=r,t[2]=s,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,r,s,n]=Ss.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=r,this._components[2]*=s,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let r=this._int>>16&255,s=this._int>>8&255,n=this._int&255;return e&&(r=r*t+.5|0,s=s*t+.5|0,n=n*t+.5|0),(t*255<<24)+(r<<16)+(s<<8)+n}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,r,s]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(r*t)/t,this._components[2]=Math.round(s*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,r,s,n]=this._components;return t[0]=e,t[1]=r,t[2]=s,t[3]=n,t}normalize(t){let e,r,s,n;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,r=(o>>8&255)/255,s=(o&255)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,r,s,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,r,s,n=255]=t,e/=255,r/=255,s/=255,n/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const a=Ss.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}const o=Ue(t);o.isValid()&&({r:e,g:r,b:s,a:n}=o.rgba,e/=255,r/=255,s/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=r,this._components[2]=s,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(t*255<<16)+(e*255<<8)+(r*255|0)}_clamp(t,e=0,r=1){return typeof t=="number"?Math.min(Math.max(t,e),r):(t.forEach((s,n)=>{t[n]=Math.min(Math.max(s,e),r)}),t)}};ei.shared=new ei,ei.temp=new ei,ei.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Ct=ei;function Wm(i){return _t("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Ct.shared.setValue(i).toHex()}function jm(i){return _t("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Ct.shared.setValue(i).toNumber()}function Ym(){const i=[],t=[];for(let r=0;r<32;r++)i[r]=r,t[r]=r;i[ht.NORMAL_NPM]=ht.NORMAL,i[ht.ADD_NPM]=ht.ADD,i[ht.SCREEN_NPM]=ht.SCREEN,t[ht.NORMAL]=ht.NORMAL_NPM,t[ht.ADD]=ht.ADD_NPM,t[ht.SCREEN]=ht.SCREEN_NPM;const e=[];return e.push(t),e.push(i),e}const Nc=Ym();function Lc(i,t){return Nc[t?1:0][i]}function qm(i,t=null){const e=i*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let r=0,s=0;r<e;r+=6,s+=4)t[r+0]=s+0,t[r+1]=s+1,t[r+2]=s+2,t[r+3]=s+0,t[r+4]=s+2,t[r+5]=s+3;return t}function Uc(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}function Us(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function Al(i){return!(i&i-1)&&!!i}function Sl(i){let t=(i>65535?1:0)<<4;i>>>=t;let e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function di(i,t,e){const r=i.length;let s;if(t>=r||e===0)return;e=t+e>r?r-t:e;const n=r-e;for(s=t;s<n;++s)i[s]=i[s+e];i.length=n}function mr(i){return i===0?0:i<0?-1:1}let Zm=0;function Vr(){return++Zm}const wo=class{constructor(i,t,e,r){this.left=i,this.top=t,this.right=e,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};wo.EMPTY=new wo(0,0,0,0);let Cl=wo;const Il={},Ge=Object.create(null),lr=Object.create(null);class Km{constructor(t,e,r){this._canvas=tt.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||tt.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Rl(i,t,e){for(let r=0,s=4*e*t;r<t;++r,s+=4)if(i[s+3]!==0)return!1;return!0}function Pl(i,t,e,r,s){const n=4*t;for(let o=r,a=r*n+4*e;o<=s;++o,a+=n)if(i[a+3]!==0)return!1;return!0}function $m(i){const{width:t,height:e}=i,r=i.getContext("2d",{willReadFrequently:!0});if(r===null)throw new TypeError("Failed to get canvas 2D context");const s=r.getImageData(0,0,t,e).data;let n=0,o=0,a=t-1,l=e-1;for(;o<e&&Rl(s,t,o);)++o;if(o===e)return Cl.EMPTY;for(;Rl(s,t,l);)--l;for(;Pl(s,t,n,o,l);)++n;for(;Pl(s,t,a,o,l);)--a;return++a,++l,new Cl(n,o,a,l)}function Jm(i){const t=$m(i),{width:e,height:r}=t;let s=null;if(!t.isEmpty()){const n=i.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");s=n.getImageData(t.left,t.top,e,r)}return{width:e,height:r,data:s}}function Qm(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(i,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function ar(i,t=1){const e=tt.RETINA_PREFIX?.exec(i);return e?parseFloat(e[1]):t}var Y=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(Y||{});const To=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}}if(typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},Ml=(i,t)=>To(i).priority??t,st={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(To).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...i){return i.map(To).forEach(t=>{t.type.forEach(e=>{const r=this._addHandlers,s=this._queue;r[e]?r[e](t):(s[e]=s[e]||[],s[e].push(t))})}),this},handle(i,t,e){const r=this._addHandlers,s=this._removeHandlers;if(r[i]||s[i])throw new Error(`Extension type ${i} already has a handler`);r[i]=t,s[i]=e;const n=this._queue;return n[i]&&(n[i].forEach(o=>t(o)),delete n[i]),this},handleByMap(i,t){return this.handle(i,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(i,t,e=-1){return this.handle(i,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((s,n)=>Ml(n,e)-Ml(s,e)))},r=>{const s=t.indexOf(r.ref);s!==-1&&t.splice(s,1)})}};class Eo{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const tg=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function eg(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function rg(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const r=tg.replace(/%forloop%/gi,eg(i));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}const Dn=0,Fn=1,kn=2,On=3,Nn=4,Ln=5;class Ke{constructor(){this.data=0,this.blendMode=ht.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Dn)}set blend(t){!!(this.data&1<<Dn)!==t&&(this.data^=1<<Dn)}get offsets(){return!!(this.data&1<<Fn)}set offsets(t){!!(this.data&1<<Fn)!==t&&(this.data^=1<<Fn)}get culling(){return!!(this.data&1<<kn)}set culling(t){!!(this.data&1<<kn)!==t&&(this.data^=1<<kn)}get depthTest(){return!!(this.data&1<<On)}set depthTest(t){!!(this.data&1<<On)!==t&&(this.data^=1<<On)}get depthMask(){return!!(this.data&1<<Ln)}set depthMask(t){!!(this.data&1<<Ln)!==t&&(this.data^=1<<Ln)}get clockwiseFrontFace(){return!!(this.data&1<<Nn)}set clockwiseFrontFace(t){!!(this.data&1<<Nn)!==t&&(this.data^=1<<Nn)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==ht.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new Ke;return t.depthTest=!1,t.blend=!0,t}}Ke.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const Ao=[];function Gc(i,t){if(!i)return null;let e="";if(typeof i=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(e=r[1].toLowerCase())}for(let r=Ao.length-1;r>=0;--r){const s=Ao[r];if(s.test&&s.test(i,e))return new s(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Fe{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,s,n,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:c}=this;this._aliasCount++;for(let u=0,d=c.length;u<d;u++)c[u][h](t,e,r,s,n,o,a,l);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Fe.prototype,{dispatch:{value:Fe.prototype.emit},run:{value:Fe.prototype.emit}});class Vi{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Fe("setRealSize"),this.onUpdate=new Fe("update"),this.onError=new Fe("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class rn extends Vi{constructor(t,e){const{width:r,height:s}=e||{};if(!r||!s)throw new Error("BufferResource width or height invalid");super(r,s),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,r){const s=t.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===me.UNPACK);const n=e.realWidth,o=e.realHeight;return r.width===n&&r.height===o?s.texSubImage2D(e.target,0,0,0,n,o,e.format,r.type,this.data):(r.width=n,r.height=o,s.texImage2D(e.target,0,r.internalFormat,n,o,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const ig={scaleMode:rr.NEAREST,alphaMode:me.NPM},So=class ri extends ji{constructor(t=null,e=null){super(),e=Object.assign({},ri.defaultOptions,e);const{alphaMode:r,mipmap:s,anisotropicLevel:n,scaleMode:o,width:a,height:l,wrapMode:h,format:c,type:u,target:d,resolution:f,resourceOptions:p}=e;t&&!(t instanceof Vi)&&(t=Gc(t,p),t.internal=!0),this.resolution=f||tt.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((l||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=n,this._wrapMode=h,this._scaleMode=o,this.format=c,this.type=u,this.target=d,this.alphaMode=r,this.uid=Vr(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&l>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let r;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this}setSize(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)}setRealSize(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Al(this.realWidth)&&Al(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete lr[this.cacheId],delete Ge[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),ri.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,r=tt.STRICT_TEXTURE_CACHE){const s=typeof t=="string";let n=null;if(s)n=t;else{if(!t._pixiId){const a=e?.pixiIdPrefix||"pixiid";t._pixiId=`${a}_${Vr()}`}n=t._pixiId}let o=lr[n];if(s&&r&&!o)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return o||(o=new ri(t,e),o.cacheId=n,ri.addToCache(o,n)),o}static fromBuffer(t,e,r,s){t=t||new Float32Array(e*r*4);const n=new rn(t,{width:e,height:r,...s?.resourceOptions});let o,a;return t instanceof Float32Array?(o=L.RGBA,a=at.FLOAT):t instanceof Int32Array?(o=L.RGBA_INTEGER,a=at.INT):t instanceof Uint32Array?(o=L.RGBA_INTEGER,a=at.UNSIGNED_INT):t instanceof Int16Array?(o=L.RGBA_INTEGER,a=at.SHORT):t instanceof Uint16Array?(o=L.RGBA_INTEGER,a=at.UNSIGNED_SHORT):t instanceof Int8Array?(o=L.RGBA,a=at.BYTE):(o=L.RGBA,a=at.UNSIGNED_BYTE),n.internal=!0,new ri(n,Object.assign({},ig,{type:a,format:o},s))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),lr[e]&&lr[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),lr[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=lr[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete lr[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete lr[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};So.defaultOptions={mipmap:qe.POW2,anisotropicLevel:0,scaleMode:rr.LINEAR,wrapMode:yr.CLAMP,alphaMode:me.UNPACK,target:hi.TEXTURE_2D,format:L.RGBA,type:at.UNSIGNED_BYTE},So._globalBatch=0;let ft=So;class Co{constructor(){this.texArray=null,this.blend=0,this.type=We.TRIANGLES,this.start=0,this.size=0,this.data=null}}let sg=0;class Xt{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=sg++,this.disposeRunner=new Fe("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?je.ELEMENT_ARRAY_BUFFER:je.ARRAY_BUFFER}get index(){return this.type===je.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Xt(t)}}class Gs{constructor(t,e=0,r=!1,s=at.FLOAT,n,o,a,l=1){this.buffer=t,this.size=e,this.normalized=r,this.type=s,this.stride=n,this.start=o,this.instance=a,this.divisor=l}destroy(){this.buffer=null}static from(t,e,r,s,n){return new Gs(t,e,r,s,n)}}const ng={Float32Array,Uint32Array,Int32Array,Uint8Array};function og(i,t){let e=0,r=0;const s={};for(let l=0;l<i.length;l++)r+=t[l],e+=i[l].length;const n=new ArrayBuffer(e*4);let o=null,a=0;for(let l=0;l<i.length;l++){const h=t[l],c=i[l],u=Uc(c);s[u]||(s[u]=new ng[u](n)),o=s[u];for(let d=0;d<c.length;d++){const f=(d/h|0)*r+a,p=d%h;o[f+p]=c[d]}a+=h}return new Float32Array(n)}const Bl={5126:4,5123:2,5121:1};let ag=0;const lg={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class xr{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=ag++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Fe("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,s=!1,n,o,a,l=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Xt||(e instanceof Array&&(e=new Float32Array(e)),e=new Xt(e));const h=t.split("|");if(h.length>1){for(let u=0;u<h.length;u++)this.addAttribute(h[u],e,r,s,n);return this}let c=this.buffers.indexOf(e);return c===-1&&(this.buffers.push(e),c=this.buffers.length-1),this.attributes[t]=new Gs(c,r,s,n,o,a,l),this.instanced=this.instanced||l,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Xt||(t instanceof Array&&(t=new Uint16Array(t)),t=new Xt(t)),t.type=je.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],r=new Xt;let s;for(s in this.attributes){const n=this.attributes[s],o=this.buffers[n.buffer];t.push(o.data),e.push(n.size*Bl[n.type]/4),n.buffer=0}for(r.data=og(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new xr;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Xt(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new Gs(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=je.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new xr,r=[],s=[],n=[];let o;for(let a=0;a<t.length;a++){o=t[a];for(let l=0;l<o.buffers.length;l++)s[l]=s[l]||0,s[l]+=o.buffers[l].data.length,n[l]=0}for(let a=0;a<o.buffers.length;a++)r[a]=new lg[Uc(o.buffers[a].data)](s[a]),e.buffers[a]=new Xt(r[a]);for(let a=0;a<t.length;a++){o=t[a];for(let l=0;l<o.buffers.length;l++)r[l].set(o.buffers[l].data,n[l]),n[l]+=o.buffers[l].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=je.ELEMENT_ARRAY_BUFFER;let a=0,l=0,h=0,c=0;for(let u=0;u<o.buffers.length;u++)if(o.buffers[u]!==o.indexBuffer){c=u;break}for(const u in o.attributes){const d=o.attributes[u];(d.buffer|0)===c&&(l+=d.size*Bl[d.type]/4)}for(let u=0;u<t.length;u++){const d=t[u].indexBuffer.data;for(let f=0;f<d.length;f++)e.indexBuffer.data[f+h]+=a;a+=t[u].buffers[c].data.length/l,h+=d.length}}return e}}class Hc extends xr{constructor(t=!1){super(),this._buffer=new Xt(null,t,!1),this._indexBuffer=new Xt(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,at.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,at.FLOAT).addAttribute("aColor",this._buffer,4,!0,at.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,at.FLOAT).addIndex(this._indexBuffer)}}const Hs=Math.PI*2,hg=180/Math.PI,cg=Math.PI/180;var te=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(te||{});class Et{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Et(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}Et.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const is=[new Et,new Et,new Et,new Et];class dt{constructor(t=0,e=0,r=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(s),this.type=te.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new dt(0,0,0,0)}clone(){return new dt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const T=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=T)return!1;const P=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>P}const r=this.left,s=this.right,n=this.top,o=this.bottom;if(s<=r||o<=n)return!1;const a=is[0].set(t.left,t.top),l=is[1].set(t.left,t.bottom),h=is[2].set(t.right,t.top),c=is[3].set(t.right,t.bottom);if(h.x<=a.x||l.y<=a.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(u===0||(e.apply(a,a),e.apply(l,l),e.apply(h,h),e.apply(c,c),Math.max(a.x,l.x,h.x,c.x)<=r||Math.min(a.x,l.x,h.x,c.x)>=s||Math.max(a.y,l.y,h.y,c.y)<=n||Math.min(a.y,l.y,h.y,c.y)>=o))return!1;const d=u*(l.y-a.y),f=u*(a.x-l.x),p=d*r+f*n,g=d*s+f*n,_=d*r+f*o,m=d*s+f*o;if(Math.max(p,g,_,m)<=d*a.x+f*a.y||Math.min(p,g,_,m)>=d*c.x+f*c.y)return!1;const v=u*(a.y-h.y),y=u*(h.x-a.x),b=v*r+y*n,x=v*s+y*n,S=v*r+y*o,w=v*s+y*o;return!(Math.max(b,x,S,w)<=v*a.x+y*a.y||Math.min(b,x,S,w)>=v*c.x+y*c.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=s-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=s,this.height=n-s,this}}dt.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class sn{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.radius=r,this.type=te.CIRC}clone(){return new sn(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let s=this.x-t,n=this.y-e;return s*=s,n*=n,s+n<=r}getBounds(){return new dt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}sn.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class nn{constructor(t=0,e=0,r=0,s=0){this.x=t,this.y=e,this.width=r,this.height=s,this.type=te.ELIP}clone(){return new nn(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let r=(t-this.x)/this.width,s=(e-this.y)/this.height;return r*=r,s*=s,r+s<=1}getBounds(){return new dt(this.x-this.width,this.y-this.height,this.width,this.height)}}nn.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Gr{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const r=[];for(let s=0,n=e.length;s<n;s++)r.push(e[s].x,e[s].y);e=r}this.points=e,this.type=te.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Gr(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let r=!1;const s=this.points.length/2;for(let n=0,o=s-1;n<s;o=n++){const a=this.points[n*2],l=this.points[n*2+1],h=this.points[o*2],c=this.points[o*2+1];l>e!=c>e&&t<(h-a)*((e-l)/(c-l))+a&&(r=!r)}return r}}Gr.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((i,t)=>`${i}, ${t}`,"")}]`};class on{constructor(t=0,e=0,r=0,s=0,n=20){this.x=t,this.y=e,this.width=r,this.height=s,this.radius=n,this.type=te.RREC}clone(){return new on(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let s=t-(this.x+r),n=e-(this.y+r);const o=r*r;if(s*s+n*n<=o||(s=t-(this.x+this.width-r),s*s+n*n<=o)||(n=e-(this.y+this.height-r),s*s+n*n<=o)||(s=t-(this.x+r),s*s+n*n<=o))return!0}return!1}}on.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class Ft{constructor(t=1,e=0,r=0,s=1,n=0,o=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=s,this.tx=n,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,s,n,o){return this.a=t,this.b=e,this.c=r,this.d=s,this.tx=n,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new Et;const r=t.x,s=t.y;return e.x=this.a*r+this.c*s+this.tx,e.y=this.b*r+this.d*s+this.ty,e}applyInverse(t,e){e=e||new Et;const r=1/(this.a*this.d+this.c*-this.b),s=t.x,n=t.y;return e.x=this.d*r*s+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*n+-this.b*r*s+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),s=this.a,n=this.c,o=this.tx;return this.a=s*e-this.b*r,this.b=s*r+this.b*e,this.c=n*e-this.d*r,this.d=n*r+this.d*e,this.tx=o*e-this.ty*r,this.ty=o*r+this.ty*e,this}append(t){const e=this.a,r=this.b,s=this.c,n=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*r+t.b*n,this.c=t.c*e+t.d*s,this.d=t.c*r+t.d*n,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*r+t.ty*n+this.ty,this}setTransform(t,e,r,s,n,o,a,l,h){return this.a=Math.cos(a+h)*n,this.b=Math.sin(a+h)*n,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=t-(r*this.a+s*this.c),this.ty=e-(r*this.b+s*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,s=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,s=this.c,n=this.d,o=t.pivot,a=-Math.atan2(-s,n),l=Math.atan2(r,e),h=Math.abs(a+l);return h<1e-5||Math.abs(Hs-h)<1e-5?(t.rotation=l,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=l),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(s*s+n*n),t.position.x=this.tx+(o.x*e+o.y*s),t.position.y=this.ty+(o.x*r+o.y*n),t}invert(){const t=this.a,e=this.b,r=this.c,s=this.d,n=this.tx,o=t*s-e*r;return this.a=s/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-s*n)/o,this.ty=-(t*this.ty-e*n)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Ft;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new Ft}static get TEMP_MATRIX(){return new Ft}}Ft.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const Rr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Pr=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Mr=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Br=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Io=[],zc=[],ss=Math.sign;function ug(){for(let i=0;i<16;i++){const t=[];Io.push(t);for(let e=0;e<16;e++){const r=ss(Rr[i]*Rr[e]+Mr[i]*Pr[e]),s=ss(Pr[i]*Rr[e]+Br[i]*Pr[e]),n=ss(Rr[i]*Mr[e]+Mr[i]*Br[e]),o=ss(Pr[i]*Mr[e]+Br[i]*Br[e]);for(let a=0;a<16;a++)if(Rr[a]===r&&Pr[a]===s&&Mr[a]===n&&Br[a]===o){t.push(a);break}}}for(let i=0;i<16;i++){const t=new Ft;t.set(Rr[i],Pr[i],Mr[i],Br[i],0,0),zc.push(t)}}ug();const Ut={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>Rr[i],uY:i=>Pr[i],vX:i=>Mr[i],vY:i=>Br[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>Io[i][t],sub:(i,t)=>Io[i][Ut.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?Ut.S:Ut.N:Math.abs(t)*2<=Math.abs(i)?i>0?Ut.E:Ut.W:t>0?i>0?Ut.SE:Ut.SW:i>0?Ut.NE:Ut.NW,matrixAppendRotationInv:(i,t,e=0,r=0)=>{const s=zc[Ut.inv(t)];s.tx=e,s.ty=r,i.append(s)}};class sr{constructor(t,e,r=0,s=0){this._x=r,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new sr(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}sr.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Ro=class{constructor(){this.worldTransform=new Ft,this.localTransform=new Ft,this.position=new sr(this.onChange,this,0,0),this.scale=new sr(this.onChange,this,1,1),this.pivot=new sr(this.onChange,this,0,0),this.skew=new sr(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){const e=i.worldTransform,r=this.worldTransform;r.a=t.a*e.a+t.b*e.c,r.b=t.a*e.b+t.b*e.d,r.c=t.c*e.a+t.d*e.c,r.d=t.c*e.b+t.d*e.d,r.tx=t.tx*e.a+t.ty*e.c+e.tx,r.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};Ro.IDENTITY=new Ro;let ba=Ro;ba.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var dg=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,fg=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Dl(i,t,e){const r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}function Un(i){const t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function Xc(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Un(2*t);case"bvec3":return Un(3*t);case"bvec4":return Un(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const fi=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,t)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(t==null||t.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,t)=>i.type==="mat3"&&i.size===1&&!i.isArray&&t.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,t)=>i.type==="vec2"&&i.size===1&&!i.isArray&&t.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${i}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(i,t)=>i.type==="vec3"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${i}"].location, v.red, v.green, v.blue)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}],pg={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},mg={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function gg(i,t){const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const r in i.uniforms){const s=t[r];if(!s){i.uniforms[r]?.group===!0&&(i.uniforms[r].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}const n=i.uniforms[r];let o=!1;for(let a=0;a<fi.length;a++)if(fi[a].test(s,n)){e.push(fi[a].code(r,n)),o=!0;break}if(!o){const a=(s.size===1&&!s.isArray?pg:mg)[s.type].replace("location",`ud["${r}"].location`);e.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${a};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const Vc={};let ns=Vc;function _g(){if(ns===Vc||ns?.isContextLost()){const i=tt.ADAPTER.createCanvas();let t;tt.PREFER_ENV>=qr.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),ns=t}return ns}let os;function yg(){if(!os){os=Ee.MEDIUM;const i=_g();if(i&&i.getShaderPrecisionFormat){const t=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);t&&(os=t.precision?Ee.HIGH:Ee.MEDIUM)}}return os}function Fl(i,t){const e=i.getShaderSource(t).split(`
`).map((h,c)=>`${c}: ${h}`),r=i.getShaderInfoLog(t),s=r.split(`
`),n={},o=s.map(h=>parseFloat(h.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(h=>h&&!n[h]?(n[h]=!0,!0):!1),a=[""];o.forEach(h=>{e[h-1]=`%c${e[h-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const l=e.join(`
`);a[0]=l,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function vg(i,t,e,r){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||Fl(i,e),i.getShaderParameter(r,i.COMPILE_STATUS)||Fl(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}const bg={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Wc(i){return bg[i]}let as=null;const kl={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function jc(i,t){if(!as){const e=Object.keys(kl);as={};for(let r=0;r<e.length;++r){const s=e[r];as[i[s]]=kl[s]}}return as[t]}function Ol(i,t,e){if(i.substring(0,9)!=="precision"){let r=t;return t===Ee.HIGH&&e!==Ee.HIGH&&(r=Ee.MEDIUM),`precision ${r} float;
${i}`}else if(e!==Ee.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}let Ei;function xg(){if(typeof Ei=="boolean")return Ei;try{Ei=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Ei=!1}return Ei}let wg=0;const ls={},Po=class ii{constructor(t,e,r="pixi-shader",s={}){this.extra={},this.id=wg++,this.vertexSrc=t||ii.defaultVertexSrc,this.fragmentSrc=e||ii.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),ls[r]?(ls[r]++,r+=`-${ls[r]}`):ls[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=Ol(this.vertexSrc,ii.defaultVertexPrecision,Ee.HIGH),this.fragmentSrc=Ol(this.fragmentSrc,ii.defaultFragmentPrecision,yg())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return fg}static get defaultFragmentSrc(){return dg}static from(t,e,r){const s=t+e;let n=Il[s];return n||(Il[s]=n=new ii(t,e,r)),n}};Po.defaultVertexPrecision=Ee.HIGH,Po.defaultFragmentPrecision=ir.apple.device?Ee.HIGH:Ee.MEDIUM;let nr=Po,Tg=0;class ke{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Tg++,this.static=!!e,this.ubo=!!r,t instanceof Xt?(this.buffer=t,this.buffer.type=je.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Xt(new Float32Array(1)),this.buffer.type=je.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(!this.ubo)this.uniforms[t]=new ke(e,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,r){return new ke(t,e,r)}static uboFrom(t,e){return new ke(t,e??!0,!0)}}class Ye{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof ke?this.uniformGroup=e:this.uniformGroup=new ke(e):this.uniformGroup=new ke({}),this.disposeRunner=new Fe("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const s=e.uniforms[r];if(s.group===!0&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const s=nr.from(t,e);return new Ye(s,r)}}class Eg{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=n;this.defaultGroupCache[t]=ke.from({uSamplers:r},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new nr(this.vertexSrc,s)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ft,default:this.defaultGroupCache[t]};return new Ye(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let r=0;r<t;r++)r>0&&(e+=`
else `),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class Mo{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function Ag(){return!ir.apple.device}function Sg(i){let t=!0;const e=tt.ADAPTER.getNavigator();if(ir.tablet||ir.phone){if(ir.apple.device){const r=e.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(t=!1)}if(ir.android.device){const r=e.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(t=!1)}}return t?i:4}class an{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var Cg=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,Ig=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const Ci=class Pe extends an{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=Hc,this.vertexSize=6,this.state=Ke.for2d(),this.size=Pe.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??Sg(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??Ag(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return _t("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return Ig}static get defaultFragmentTemplate(){return Cg}setShaderGenerator({vertex:t=Pe.defaultVertexSrc,fragment:e=Pe.defaultFragmentTemplate}={}){this.shaderGenerator=new Eg(t,e)}contextChange(){const t=this.renderer.gl;tt.PREFER_ENV===qr.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Pe.defaultMaxTextures),this.maxTextures=rg(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=Pe,r=this.size/4,s=Math.floor(r/this.maxTextures)+1;for(;t.length<r;)t.push(new Co);for(;e.length<s;)e.push(new Mo);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,r=Pe._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count;let a=++ft._globalBatch,l=0,h=r[0],c=0;s.copyBoundTextures(n,e);for(let u=0;u<this._bufferSize;++u){const d=t[u];t[u]=null,d._batchEnabled!==a&&(h.count>=e&&(s.boundArray(h,n,a,e),this.buildDrawCalls(h,c,u),c=u,h=r[++l],++a),d._batchEnabled=a,d.touched=o,h.elements[h.count++]=d)}h.count>0&&(s.boundArray(h,n,a,e),this.buildDrawCalls(h,c,this._bufferSize),++l,++a);for(let u=0;u<n.length;u++)n[u]=null;ft._globalBatch=a}buildDrawCalls(t,e,r){const{_bufferedElements:s,_attributeBuffer:n,_indexBuffer:o,vertexSize:a}=this,l=Pe._drawCallPool;let h=this._dcIndex,c=this._aIndex,u=this._iIndex,d=l[h];d.start=this._iIndex,d.texArray=t;for(let f=e;f<r;++f){const p=s[f],g=p._texture.baseTexture,_=Nc[g.alphaMode?1:0][p.blendMode];s[f]=null,e<f&&d.blend!==_&&(d.size=u-d.start,e=f,d=l[++h],d.texArray=t,d.start=u),this.packInterleavedGeometry(p,n,o,c,u),c+=p.vertexData.length/2*a,u+=p.indices.length,d.blend=_}e<r&&(d.size=u-d.start,++h),this._dcIndex=h,this._aIndex=c,this._iIndex=u}bindAndClearTexArray(t){const e=this.renderer.texture;for(let r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:r}=this;Pe.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:r}=this.renderer,s=Pe._drawCallPool;let n=null;for(let o=0;o<t;o++){const{texArray:a,type:l,size:h,start:c,blend:u}=s[o];n!==a&&(n=a,this.bindAndClearTexArray(a)),this.state.blendMode=u,r.set(this.state),e.drawElements(l,h,e.UNSIGNED_SHORT,c*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Pe.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=Us(Math.ceil(t/8)),r=Sl(e),s=e*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._aBuffers[s];return n||(this._aBuffers[s]=n=new Eo(s*this.vertexSize*4)),n}getIndexBuffer(t){const e=Us(Math.ceil(t/12)),r=Sl(e),s=e*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(s)),n}packInterleavedGeometry(t,e,r,s,n){const{uint32View:o,float32View:a}=e,l=s/this.vertexSize,h=t.uvs,c=t.indices,u=t.vertexData,d=t._texture.baseTexture._batchLocation,f=Math.min(t.worldAlpha,1),p=Ct.shared.setValue(t._tintRGB).toPremultiplied(f,t._texture.baseTexture.alphaMode>0);for(let g=0;g<u.length;g+=2)a[s++]=u[g],a[s++]=u[g+1],a[s++]=h[g],a[s++]=h[g+1],o[s++]=p,a[s++]=d;for(let g=0;g<c.length;g++)r[n++]=l+c[g]}};Ci.defaultBatchSize=4096,Ci.extension={name:"batch",type:Y.RendererPlugin},Ci._drawCallPool=[],Ci._textureArrayPool=[];let Dr=Ci;st.add(Dr);var Rg=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,Pg=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Bo=class Ii extends Ye{constructor(t,e,r){const s=nr.from(t||Ii.defaultVertexSrc,e||Ii.defaultFragmentSrc);super(s,r),this.padding=0,this.resolution=Ii.defaultResolution,this.multisample=Ii.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Ke}apply(t,e,r,s,n){t.applyFilter(this,e,r,s)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return Pg}static get defaultFragmentSrc(){return Rg}};Bo.defaultResolution=1,Bo.defaultMultisample=Wt.NONE;let ie=Bo;class zs{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Ct(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:r,backgroundAlpha:s}=t,n=r??e;n!==void 0&&(this.color=n),this.alpha=s}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}zs.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},zs.extension={type:[Y.RendererSystem,Y.CanvasRendererSystem],name:"background"};st.add(zs);class Yc{constructor(t){this.renderer=t,this.emptyRenderer=new an(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=r[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,r,s){const{elements:n,ids:o,count:a}=t;let l=0;for(let h=0;h<a;h++){const c=n[h],u=c._batchLocation;if(u>=0&&u<s&&e[u]===c){o[h]=u;continue}for(;l<s;){const d=e[l];if(d&&d._batchEnabled===r&&d._batchLocation===l){l++;continue}o[h]=l,c._batchLocation=l,e[l]=c;break}}}destroy(){this.renderer=null}}Yc.extension={type:Y.RendererSystem,name:"batch"};st.add(Yc);let Nl=0;class Xs{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Nl++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Nl++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(tt.PREFER_ENV>=qr.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Xs.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Xs.extension={type:Y.RendererSystem,name:"context"};st.add(Xs);class Do{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Fe("disposeFramebuffer"),this.multisample=Wt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new ft(null,{scaleMode:rr.NEAREST,resolution:1,mipmap:qe.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new ft(null,{scaleMode:rr.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:qe.OFF,format:L.DEPTH_COMPONENT,type:at.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const s=this.colorTextures[r],n=s.resolution;s.setSize(t/n,e/n)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class qc extends ft{constructor(t={}){if(typeof t=="number"){const e=arguments[0],r=arguments[1],s=arguments[2],n=arguments[3];t={width:e,height:r,scaleMode:s,resolution:n}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=Wt.NONE),super(null,t),this.mipmap=qe.OFF,this.valid=!0,this._clear=new Ct([0,0,0,0]),this.framebuffer=new Do(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class wr extends Vi{constructor(t){const e=t,r=e.naturalWidth||e.videoWidth||e.width,s=e.naturalHeight||e.videoHeight||e.height;super(r,s),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=Qm(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}upload(t,e,r,s){const n=t.gl,o=e.realWidth,a=e.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===me.UNPACK),!this.noSubImage&&e.target===n.TEXTURE_2D&&r.width===o&&r.height===a?n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,r.type,s):(r.width=o,r.height=a,n.texImage2D(e.target,0,r.internalFormat,e.format,r.type,s)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class Zc extends wr{constructor(t,e){if(e=e||{},typeof t=="string"){const r=new Image;wr.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??tt.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,r)=>{const s=this.source;this.url=s.src;const n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=o=>{r(o),this.onError.emit(o)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then(s=>s.blob()).then(s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===me.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,r){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let s=!0;const n=e._glTextures;for(const o in n){const a=n[o];if(a!==r&&a.dirtyId!==e.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class xa{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const s=e.width,n=e.height;if(r){const o=t.width/2/s,a=t.height/2/n,l=t.x/s+o,h=t.y/n+a;r=Ut.add(r,Ut.NW),this.x0=l+o*Ut.uX(r),this.y0=h+a*Ut.uY(r),r=Ut.add(r,2),this.x1=l+o*Ut.uX(r),this.y1=h+a*Ut.uY(r),r=Ut.add(r,2),this.x2=l+o*Ut.uX(r),this.y2=h+a*Ut.uY(r),r=Ut.add(r,2),this.x3=l+o*Ut.uX(r),this.y3=h+a*Ut.uY(r)}else this.x0=t.x/s,this.y0=t.y/n,this.x1=(t.x+t.width)/s,this.y1=t.y/n,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/n,this.x3=t.x/s,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}xa.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Ll=new xa;function hs(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}class it extends ji{constructor(t,e,r,s,n,o,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new dt(0,0,1,1)),t instanceof it&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=Ll,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new Et(o.x,o.y):new Et(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e?.url&&Ge[e.url]&&it.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,it.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new it(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===Ll&&(this._uvs=new xa),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=tt.STRICT_TEXTURE_CACHE){const s=typeof t=="string";let n=null;if(s)n=t;else if(t instanceof ft){if(!t.cacheId){const a=e?.pixiIdPrefix||"pixiid";t.cacheId=`${a}-${Vr()}`,ft.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const a=e?.pixiIdPrefix||"pixiid";t._pixiId=`${a}_${Vr()}`}n=t._pixiId}let o=Ge[n];if(s&&r&&!o)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!o&&!(t instanceof ft)?(e.resolution||(e.resolution=ar(t)),o=new it(new ft(t,e)),o.baseTexture.cacheId=n,ft.addToCache(o.baseTexture,n),it.addToCache(o,n)):!o&&t instanceof ft&&(o=new it(t),it.addToCache(o,n)),o}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e?.resourceOptions),s=it.from(t,Object.assign({resourceOptions:r},e),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(t,e,r,s){return new it(ft.fromBuffer(t,e,r,s))}static fromLoader(t,e,r,s){const n=new ft(t,Object.assign({scaleMode:ft.defaultOptions.scaleMode,resolution:ar(e)},s)),{resource:o}=n;o instanceof Zc&&(o.url=e);const a=new it(n);return r||(r=e),ft.addToCache(a.baseTexture,r),it.addToCache(a,r),r!==e&&(ft.addToCache(a.baseTexture,e),it.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(l=>{a.baseTexture.once("loaded",()=>l(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Ge[e]&&Ge[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Ge[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Ge[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Ge[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Ge[t.textureCacheIds[e]]===t&&delete Ge[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:s,height:n}=t,o=e+s>this.baseTexture.width,a=r+n>this.baseTexture.height;if(o||a){const l=o&&a?"and":"or",h=`X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width}`,c=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${h} ${l} ${c}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return it._EMPTY||(it._EMPTY=new it(new ft),hs(it._EMPTY),hs(it._EMPTY.baseTexture)),it._EMPTY}static get WHITE(){if(!it._WHITE){const t=tt.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),it._WHITE=new it(ft.from(t)),hs(it._WHITE),hs(it._WHITE.baseTexture)}return it._WHITE}}class ae extends it{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const s=this.baseTexture.resolution,n=Math.round(t*s)/s,o=Math.round(e*s)/s;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,r&&this.baseTexture.resize(n,o),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new ae(new qc(t))}}class Kc{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=Wt.NONE){const s=new qc(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new ae(s)}getOptimalTexture(t,e,r=1,s=Wt.NONE){let n;t=Math.max(Math.ceil(t*r-1e-6),1),e=Math.max(Math.ceil(e*r-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=Us(t),e=Us(e),n=((t&65535)<<16|e&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let o=this.texturePool[n].pop();return o||(o=this.createTexture(t,e,s)),o.filterPoolKey=n,o.setResolution(r),o}getFilterTexture(t,e,r){const s=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||Wt.NONE);return s.filterFrame=t.filterFrame,s}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const r=this.texturePool[e];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const r=this.texturePool[e];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Kc.SCREEN_KEY=-1;class Mg extends xr{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class $c extends xr{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Xt(this.vertices),this.uvBuffer=new Xt(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,s=0;return this.uvs[0]=r,this.uvs[1]=s,this.uvs[2]=r+e.width/t.width,this.uvs[3]=s,this.uvs[4]=r+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=r,this.uvs[7]=s+e.height/t.height,r=e.x,s=e.y,this.vertices[0]=r,this.vertices[1]=s,this.vertices[2]=r+e.width,this.vertices[3]=s,this.vertices[4]=r+e.width,this.vertices[5]=s+e.height,this.vertices[6]=r,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Bg{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Wt.NONE,this.sourceFrame=new dt,this.destinationFrame=new dt,this.bindingSourceFrame=new dt,this.bindingDestinationFrame=new dt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const cs=[new Et,new Et,new Et,new Et],Gn=new Ft;class Jc{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Kc,this.statePool=[],this.quad=new Mg,this.quadUv=new $c,this.tempRect=new dt,this.activeState={},this.globalUniforms=new ke({outputFrame:new dt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const r=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new Bg,o=r.renderTexture;let a,l;if(o.current){const _=o.current;a=_.resolution,l=_.multisample}else a=r.resolution,l=r.multisample;let h=e[0].resolution||a,c=e[0].multisample??l,u=e[0].padding,d=e[0].autoFit,f=e[0].legacy??!0;for(let _=1;_<e.length;_++){const m=e[_];h=Math.min(h,m.resolution||a),c=Math.min(c,m.multisample??l),u=this.useMaxPadding?Math.max(u,m.padding):u+m.padding,d=d&&m.autoFit,f=f||(m.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),s.push(n),n.resolution=h,n.multisample=c,n.legacy=f,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(u);const p=this.tempRect.copyFrom(o.sourceFrame);r.projection.transform&&this.transformAABB(Gn.copyFrom(r.projection.transform).invert(),p),d?(n.sourceFrame.fit(p),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(p)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,o.current?o.current.resolution:r.resolution,o.sourceFrame,o.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,h,c),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const g=this.tempRect;g.x=0,g.y=0,g.width=n.sourceFrame.width,g.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,g),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;const n=s.inputSize,o=s.inputPixel,a=s.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*e.resolution),o[1]=Math.round(n[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*n[2]-.5*o[2],a[3]=e.sourceFrame.height*n[3]-.5*o[3],e.legacy){const h=s.filterArea;h[0]=e.destinationFrame.width,h[1]=e.destinationFrame.height,h[2]=e.sourceFrame.x,h[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const l=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,e.renderTexture,l.renderTexture,Xe.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let h=e.renderTexture,c=this.getOptimalFilterTexture(h.width,h.height,e.resolution);c.filterFrame=h.filterFrame;let u=0;for(u=0;u<r.length-1;++u){u===1&&e.multisample>1&&(c=this.getOptimalFilterTexture(h.width,h.height,e.resolution),c.filterFrame=h.filterFrame),r[u].apply(this,h,c,Xe.CLEAR,e);const d=h;h=c,c=d}r[u].apply(this,h,l.renderTexture,Xe.BLEND,e),u>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(c)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=Xe.CLEAR){const{renderTexture:r,state:s}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,r.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=s.stateId&1||this.forceClear;(e===Xe.CLEAR||e===Xe.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,s){const n=this.renderer;n.state.set(t.state),this.bindAndClear(r,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(We.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(We.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:s}=this.activeState,{orig:n}=e._texture,o=t.set(s.width,0,0,s.height,r.x,r.y),a=e.worldTransform.copyTo(Ft.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/n.width,1/n.height),o.translate(e.anchor.x,e.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,s=Wt.NONE){return this.texturePool.getOptimalTexture(t,e,r,s)}getFilterTexture(t,e,r){if(typeof t=="number"){const n=t;t=e,e=n}t=t||this.activeState.renderTexture;const s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||Wt.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=cs[0],s=cs[1],n=cs[2],o=cs[3];r.set(e.left,e.top),s.set(e.left,e.bottom),n.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(r,r),t.apply(s,s),t.apply(n,n),t.apply(o,o);const a=Math.min(r.x,s.x,n.x,o.x),l=Math.min(r.y,s.y,n.y,o.y),h=Math.max(r.x,s.x,n.x,o.x),c=Math.max(r.y,s.y,n.y,o.y);e.x=a,e.y=l,e.width=h-a,e.height=c-l}roundFrame(t,e,r,s,n){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(n){const{a:o,b:a,c:l,d:h}=n;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(h)>1e-4))return}n=n?Gn.copyFrom(n):Gn.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)}}}Jc.extension={type:Y.RendererSystem,name:"filter"};st.add(Jc);class Dg{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Wt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Fg=new dt;class Qc{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Do(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new dt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;tt.PREFER_ENV===qr.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=s=>e.drawBuffersWEBGL(s):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:s}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=r),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){const a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const o=e.width>>r,a=e.height>>r,l=o/e.width;this.setViewport(e.x*l,e.y*l,o,a)}else{const o=t.width>>r,a=t.height>>r;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,s){const n=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),s=Math.round(s),(n.width!==r||n.height!==s||n.x!==t||n.y!==e)&&(n.x=t,n.y=e,n.width=r,n.height=s,this.gl.viewport(t,e,r,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,s,n=so.COLOR|so.DEPTH){const{gl:o}=this;o.clearColor(t,e,r,s),o.clear(n)}initFramebuffer(t){const{gl:e}=this,r=new Dg(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];if(r.stencil){e.bindRenderbuffer(e.RENDERBUFFER,r.stencil);let o;this.renderer.context.webGLVersion===1?o=e.DEPTH_STENCIL:t.depth&&t.stencil?o=e.DEPTH24_STENCIL8:t.depth?o=e.DEPTH_COMPONENT24:o=e.STENCIL_INDEX8,r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,o,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,o,t.width,t.height)}const s=t.colorTextures;let n=s.length;e.drawBuffers||(n=Math.min(n,1));for(let o=0;o<n;o++){const a=s[o],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),o===0&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,s=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let o=n.length;r.drawBuffers||(o=Math.min(o,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||r.createRenderbuffer():s.msaaBuffer&&(r.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const a=[];for(let l=0;l<o;l++){const h=n[l],c=h.parentTextureArray||h;this.renderer.texture.bind(c,0),l===0&&s.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,s.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,s.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+l,h.target,c._glTextures[this.CONTEXT_UID].texture,e),a.push(r.COLOR_ATTACHMENT0+l))}if(a.length>1&&r.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const l=t.depthTexture;this.renderer.texture.bind(l,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,l._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||r.createRenderbuffer();let l,h;this.renderer.context.webGLVersion===1?(l=r.DEPTH_STENCIL_ATTACHMENT,h=r.DEPTH_STENCIL):t.depth&&t.stencil?(l=r.DEPTH_STENCIL_ATTACHMENT,h=r.DEPTH24_STENCIL8):t.depth?(l=r.DEPTH_ATTACHMENT,h=r.DEPTH_COMPONENT24):(l=r.STENCIL_ATTACHMENT,h=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,s.stencil),s.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,h,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,h,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,l,r.RENDERBUFFER,s.stencil)}else s.stencil&&(r.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=Wt.NONE;if(t<=1||e===null)return r;for(let s=0;s<e.length;s++)if(e[s]<=t){r=e[s];break}return r===1&&(r=Wt.NONE),r}blit(t,e,r){const{current:s,renderer:n,gl:o,CONTEXT_UID:a}=this;if(n.context.webGLVersion!==2||!s)return;const l=s.glFramebuffers[a];if(!l)return;if(!t){if(!l.msaaBuffer)return;const c=s.colorTextures[0];if(!c)return;l.blitFramebuffer||(l.blitFramebuffer=new Do(s.width,s.height),l.blitFramebuffer.addColorTexture(0,c)),t=l.blitFramebuffer,t.colorTextures[0]!==c&&(t.colorTextures[0]=c,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||(e=Fg,e.width=s.width,e.height=s.height),r||(r=e);const h=e.width===r.width&&e.height===r.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,l.framebuffer),o.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,o.COLOR_BUFFER_BIT,h?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&s.deleteRenderbuffer(r.msaaBuffer),r.stencil&&s.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const r=t.width,s=t.height,n=this.gl,o=e.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o);let a,l;this.renderer.context.webGLVersion===1?(a=n.DEPTH_STENCIL_ATTACHMENT,l=n.DEPTH_STENCIL):t.depth?(a=n.DEPTH_STENCIL_ATTACHMENT,l=n.DEPTH24_STENCIL8):(a=n.STENCIL_ATTACHMENT,l=n.STENCIL_INDEX8),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,l,r,s):n.renderbufferStorage(n.RENDERBUFFER,l,r,s),n.framebufferRenderbuffer(n.FRAMEBUFFER,a,n.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new dt}destroy(){this.renderer=null}}Qc.extension={type:Y.RendererSystem,name:"framebuffer"};st.add(Qc);const Hn={5126:4,5123:2,5121:1};class tu{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;tt.PREFER_ENV===qr.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=()=>r.createVertexArrayOES(),t.bindVertexArray=s=>r.bindVertexArrayOES(s),t.deleteVertexArray=s=>r.deleteVertexArrayOES(s)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=(s,n)=>r.vertexAttribDivisorANGLE(s,n),t.drawElementsInstanced=(s,n,o,a,l)=>r.drawElementsInstancedANGLE(s,n,o,a,l),t.drawArraysInstanced=(s,n,o,a)=>r.drawArraysInstancedANGLE(s,n,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let s=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);const o=s[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?r.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const s=t.buffers[r];e.update(s)}}checkCompatibility(t,e){const r=t.attributes,s=e.attributeData;for(const n in s)if(!r[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,e){const r=t.attributes,s=e.attributeData,n=["g",t.id];for(const o in r)s[o]&&n.push(o,s[o].location);return n.join("-")}initGeometryVao(t,e,r=!0){const s=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=e.program;a.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const l=this.getSignature(t,a),h=t.glVertexArrayObjects[this.CONTEXT_UID];let c=h[l];if(c)return h[a.id]=c,c;const u=t.buffers,d=t.attributes,f={},p={};for(const g in u)f[g]=0,p[g]=0;for(const g in d)!d[g].size&&a.attributeData[g]?d[g].size=a.attributeData[g].size:d[g].size||console.warn(`PIXI Geometry attribute '${g}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[g].buffer]+=d[g].size*Hn[d[g].type];for(const g in d){const _=d[g],m=_.size;_.stride===void 0&&(f[_.buffer]===m*Hn[_.type]?_.stride=0:_.stride=f[_.buffer]),_.start===void 0&&(_.start=p[_.buffer],p[_.buffer]+=m*Hn[_.type])}c=s.createVertexArray(),s.bindVertexArray(c);for(let g=0;g<u.length;g++){const _=u[g];o.bind(_),r&&_._glBuffers[n].refCount++}return this.activateVao(t,a),h[a.id]=c,h[l]=c,s.bindVertexArray(null),o.unbind(je.ARRAY_BUFFER),c}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=t.buffers,o=this.renderer?.buffer;if(t.disposeRunner.remove(this),!!r){if(o)for(let a=0;a<n.length;a++){const l=n[a]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!e&&o.dispose(n[a],e))}if(!e){for(const a in r)if(a[0]==="g"){const l=r[a];this._activeVao===l&&this.unbind(),s.deleteVertexArray(l)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let l=null;for(const h in a){const c=a[h],u=o[c.buffer],d=u._glBuffers[s];if(e.attributeData[h]){l!==d&&(n.bind(u),l=d);const f=e.attributeData[h].location;if(r.enableVertexAttribArray(f),r.vertexAttribPointer(f,c.size,c.type||r.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)r.vertexAttribDivisor(f,c.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,r,s){const{gl:n}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,l=a===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(t,e||o.indexBuffer.data.length,l,(r||0)*a,s||1):n.drawElements(t,e||o.indexBuffer.data.length,l,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(t,r,e||o.getSize(),s||1):n.drawArrays(t,r,e||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}tu.extension={type:Y.RendererSystem,name:"geometry"};st.add(tu);const Ul=new Ft;class eu{constructor(t,e){this._texture=t,this.mapCoord=new Ft,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const r=this.mapCoord;for(let s=0;s<t.length;s+=2){const n=t[s],o=t[s+1];e[s]=n*r.a+o*r.c+r.tx,e[s+1]=n*r.b+o*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const s=e.orig,n=e.trim;n&&(Ul.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Ul));const o=e.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,h=this.clampOffset;return a[0]=(e._frame.x+l+h)/o.width,a[1]=(e._frame.y+l+h)/o.height,a[2]=(e._frame.x+e._frame.width-l+h)/o.width,a[3]=(e._frame.y+e._frame.height-l+h)/o.height,this.uClampOffset[0]=h/o.realWidth,this.uClampOffset[1]=h/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&e.rotate===0,!0}}var kg=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,Og=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class Ng extends ie{constructor(t,e,r){let s=null;typeof t!="string"&&e===void 0&&r===void 0&&(s=t,t=void 0,e=void 0,r=void 0),super(t||Og,e||kg,r),this.maskSprite=s,this.maskMatrix=new Ft}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,s){const n=this._maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new eu(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,r,s))}}class Lg{constructor(t=null){this.type=Yt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=ie.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Yt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class ru{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const n=this.maskDataPool.pop()||new Lg;n.pooled=!0,n.maskObject=e,r=n}const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(s),r._colorMask=s?s._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==Yt.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case Yt.SCISSOR:this.renderer.scissor.push(r);break;case Yt.STENCIL:this.renderer.stencil.push(r);break;case Yt.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case Yt.COLOR:this.pushColorMask(r);break}r.type===Yt.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case Yt.SCISSOR:this.renderer.scissor.pop(e);break;case Yt.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case Yt.SPRITE:this.popSpriteMask(e);break;case Yt.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===Yt.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=Yt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=Yt.SCISSOR:t.type=Yt.STENCIL:t.type=Yt.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new Ng])),s[0].resolution=t.resolution,s[0].multisample=t.multisample,s[0].maskSprite=e;const n=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,s),r.filterArea=n,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}ru.extension={type:Y.RendererSystem,name:"mask"};st.add(ru);class iu{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const s=this.getStackLength();s!==r&&(s===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Gl=new Ft,Hl=[],su=class Cs extends iu{constructor(t){super(t),this.glConst=tt.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:r}=t,{renderer:s}=this,n=s.renderTexture,o=r.getBounds(!0,Hl.pop()??new dt);this.roundFrameToPixels(o,n.current?n.current.resolution:s.resolution,n.sourceFrame,n.destinationFrame,s.projection.transform),e&&o.fit(e),t._scissorRectLocal=o}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:r,c:s,d:n}=t;return(Math.abs(r)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(n)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||Cs.isMatrixRotated(e.worldTransform)||Cs.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const r=t._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(t,e,r,s,n){Cs.isMatrixRotated(n)||(n=n?Gl.copyFrom(n):Gl.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.renderer.filter.transformAABB(n,t),t.fit(s),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Hl.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};su.extension={type:Y.RendererSystem,name:"scissor"};let Ug=su;st.add(Ug);class nu extends iu{constructor(t){super(t),this.glConst=tt.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;n!==0&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,s,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(t._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=r?r._colorMask:15;s!==0&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(r._colorMask=s,e.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}nu.extension={type:Y.RendererSystem,name:"stencil"};st.add(nu);class ou{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return _t("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return _t("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return _t("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}ou.extension={type:[Y.RendererSystem,Y.CanvasRendererSystem],name:"_plugin"};st.add(ou);class au{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Ft,this.transform=null}update(t,e,r,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,s),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,e,r,s){const n=this.projectionMatrix,o=s?-1:1;n.identity(),n.a=1/e.width*2,n.d=o*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-o-e.y*n.d}setTransform(t){}destroy(){this.renderer=null}}au.extension={type:Y.RendererSystem,name:"projection"};st.add(au);const Gg=new ba,zl=new dt;class lu{constructor(t){this.renderer=t,this._tempMatrix=new Ft}generateTexture(t,e){const{region:r,...s}=e||{},n=r?.copyTo(zl)||t.getLocalBounds(zl,!0),o=s.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/o),n.height=Math.max(n.height,1/o),s.width=n.width,s.height=n.height,s.resolution=o,s.multisample??(s.multisample=this.renderer.multisample);const a=ae.create(s);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const l=t.transform;return t.transform=Gg,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=l,a}destroy(){}}lu.extension={type:[Y.RendererSystem,Y.CanvasRendererSystem],name:"textureGenerator"};st.add(lu);const Cr=new dt,Ai=new dt;class hu{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new dt,this.destinationFrame=new dt,this.viewportFrame=new dt}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,r){const s=this.renderer;this.current=t;let n,o,a;t?(n=t.baseTexture,a=n.resolution,e||(Cr.width=t.frame.width,Cr.height=t.frame.height,e=Cr),r||(Ai.x=t.frame.x,Ai.y=t.frame.y,Ai.width=e.width,Ai.height=e.height,r=Ai),o=n.framebuffer):(a=s.resolution,e||(Cr.width=s._view.screen.width,Cr.height=s._view.screen.height,e=Cr),r||(r=Cr,r.width=e.width,r.height=e.height));const l=this.viewportFrame;l.x=r.x*a,l.y=r.y*a,l.width=r.width*a,l.height=r.height*a,t||(l.y=s.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(o,l),this.renderer.projection.update(r,e,a,!o),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=Ct.shared.setValue(t||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);const n=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=n.width!==o.width||n.height!==o.height;if(a){let{x:l,y:h,width:c,height:u}=this.viewportFrame;l=Math.round(l),h=Math.round(h),c=Math.round(c),u=Math.round(u),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,h,c,u)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}hu.extension={type:Y.RendererSystem,name:"renderTexture"};st.add(hu);class Hg{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function zg(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){const n=t.getActiveAttrib(i,s);if(n.name.startsWith("gl_"))continue;const o=jc(t,n.type),a={type:o,name:n.name,size:Wc(o),location:t.getAttribLocation(i,n.name)};e[n.name]=a}return e}function Xg(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){const n=t.getActiveUniform(i,s),o=n.name.replace(/\[.*?\]$/,""),a=!!n.name.match(/\[.*?\]$/),l=jc(t,n.type);e[o]={name:o,index:s,type:l,size:n.size,isArray:a,value:Xc(l,n.size)}}return e}function Vg(i,t){const e=Dl(i,i.VERTEX_SHADER,t.vertexSrc),r=Dl(i,i.FRAGMENT_SHADER,t.fragmentSrc),s=i.createProgram();i.attachShader(s,e),i.attachShader(s,r);const n=t.extra?.transformFeedbackVaryings;if(n&&(typeof i.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):i.transformFeedbackVaryings(s,n.names,n.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(s),i.getProgramParameter(s,i.LINK_STATUS)||vg(i,s,e,r),t.attributeData=zg(s,i),t.uniformData=Xg(s,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const a=Object.keys(t.attributeData);a.sort((l,h)=>l>h?1:-1);for(let l=0;l<a.length;l++)t.attributeData[a[l]].location=l,i.bindAttribLocation(s,l,a[l]);i.linkProgram(s)}i.deleteShader(e),i.deleteShader(r);const o={};for(const a in t.uniformData){const l=t.uniformData[a];o[a]={location:i.getUniformLocation(s,a),value:Xc(l.type,l.size)}}return new Hg(s,o)}function Wg(i,t,e,r,s){e.buffer.update(s)}const jg={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},cu={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function Yg(i){const t=i.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let e=0,r=0,s=0;for(let n=0;n<t.length;n++){const o=t[n];if(e=cu[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,r%e!==0&&r<16){const a=r%e%16;r+=a,s+=a}r+e>16?(s=Math.ceil(s/16)*16,o.offset=s,s+=e,r=e):(o.offset=s,r+=e,s+=e)}return s=Math.ceil(s/16)*16,{uboElements:t,size:s}}function qg(i,t){const e=[];for(const r in i)t[r]&&e.push(t[r]);return e.sort((r,s)=>r.index-s.index),e}function Zg(i,t){if(!i.autoManage)return{size:0,syncFunc:Wg};const e=qg(i.uniforms,t),{uboElements:r,size:s}=Yg(e),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<r.length;o++){const a=r[o],l=i.uniforms[a.data.name],h=a.data.name;let c=!1;for(let u=0;u<fi.length;u++){const d=fi[u];if(d.codeUbo&&d.test(a.data,l)){n.push(`offset = ${a.offset/4};`,fi[u].codeUbo(a.data.name,l)),c=!0;break}}if(!c)if(a.data.size>1){const u=Wc(a.data.type),d=Math.max(cu[a.data.type]/16,1),f=u/d,p=(4-f%4)%4;n.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const u=jg[a.data.type];n.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${a.offset/4};
                ${u};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let Kg=0;const us={textureCount:0,uboCount:0};class uu{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Kg++}systemCheck(){if(!xg())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,s=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(s.program)),e||(us.textureCount=0,us.uboCount=0,this.syncUniformGroup(t.uniformGroup,us)),s}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=gg(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;const s=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),s(r.uniformData,t.uniforms,this.renderer,us,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=Zg(t,this.shader.program.uniformData)),t.autoManage){const l=new Float32Array(a.size/4);t.buffer.update(l)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const s=t.uniforms,n=[`${r}-`];for(const o in s)n.push(o),e[o]&&n.push(e[o].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,s=Vg(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}uu.extension={type:Y.RendererSystem,name:"shader"};st.add(uu);class Vs{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.3.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}Vs.defaultOptions={hello:!1},Vs.extension={type:[Y.RendererSystem,Y.CanvasRendererSystem],name:"startup"};st.add(Vs);function $g(i,t=[]){return t[ht.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.ADD]=[i.ONE,i.ONE],t[ht.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.NONE]=[0,0],t[ht.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[ht.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ht.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[ht.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[ht.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[ht.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[ht.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[ht.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[ht.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[ht.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[ht.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}const Jg=0,Qg=1,t_=2,e_=3,r_=4,i_=5,du=class Fo{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ht.NONE,this._blendEq=!1,this.map=[],this.map[Jg]=this.setBlend,this.map[Qg]=this.setOffset,this.map[t_]=this.setCullFace,this.map[e_]=this.setDepthTest,this.map[r_]=this.setFrontFace,this.map[i_]=this.setDepthMask,this.checks=[],this.defaultState=new Ke,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=$g(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)e&1&&this.map[r].call(this,!!(t.data&1<<r)),e=e>>1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(Fo.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(Fo.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],r=this.gl;e.length===2?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const r=this.checks.indexOf(t);e&&r===-1?this.checks.push(t):!e&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};du.extension={type:Y.RendererSystem,name:"state"};let s_=du;st.add(s_);class n_ extends ji{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(s=>t.systems[s]),r=[...e,...Object.keys(t.systems).filter(s=>!e.includes(s))];for(const s of r)this.addSystem(t.systems[s],s)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Fe(e)})}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const s in this.runners)this.runners[s].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach(s=>{const n=r.find(o=>this._systemsHash[o]===s);s[t.name](e[n])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const Ri=class Is{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Is.defaultMaxIdle,this.checkCountMax=Is.defaultCheckCountMax,this.mode=Is.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==ca.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let s=0;s<e.length;s++){const n=e[s];n.resource&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[s]=null,r=!0)}if(r){let s=0;for(let n=0;n<e.length;n++)e[n]!==null&&(e[s++]=e[n]);e.length=s}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let s=t.children.length-1;s>=0;s--)this.unload(t.children[s])}destroy(){this.renderer=null}};Ri.defaultMode=ca.AUTO,Ri.defaultMaxIdle=60*60,Ri.defaultCheckCountMax=60*10,Ri.extension={type:Y.RendererSystem,name:"textureGC"};let Fr=Ri;st.add(Fr);class zn{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=at.UNSIGNED_BYTE,this.internalFormat=L.RGBA,this.samplerType=0}}function o_(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[i.RGB]:Q.FLOAT,[i.RGBA]:Q.FLOAT,[i.ALPHA]:Q.FLOAT,[i.LUMINANCE]:Q.FLOAT,[i.LUMINANCE_ALPHA]:Q.FLOAT,[i.R8]:Q.FLOAT,[i.R8_SNORM]:Q.FLOAT,[i.RG8]:Q.FLOAT,[i.RG8_SNORM]:Q.FLOAT,[i.RGB8]:Q.FLOAT,[i.RGB8_SNORM]:Q.FLOAT,[i.RGB565]:Q.FLOAT,[i.RGBA4]:Q.FLOAT,[i.RGB5_A1]:Q.FLOAT,[i.RGBA8]:Q.FLOAT,[i.RGBA8_SNORM]:Q.FLOAT,[i.RGB10_A2]:Q.FLOAT,[i.RGB10_A2UI]:Q.FLOAT,[i.SRGB8]:Q.FLOAT,[i.SRGB8_ALPHA8]:Q.FLOAT,[i.R16F]:Q.FLOAT,[i.RG16F]:Q.FLOAT,[i.RGB16F]:Q.FLOAT,[i.RGBA16F]:Q.FLOAT,[i.R32F]:Q.FLOAT,[i.RG32F]:Q.FLOAT,[i.RGB32F]:Q.FLOAT,[i.RGBA32F]:Q.FLOAT,[i.R11F_G11F_B10F]:Q.FLOAT,[i.RGB9_E5]:Q.FLOAT,[i.R8I]:Q.INT,[i.R8UI]:Q.UINT,[i.R16I]:Q.INT,[i.R16UI]:Q.UINT,[i.R32I]:Q.INT,[i.R32UI]:Q.UINT,[i.RG8I]:Q.INT,[i.RG8UI]:Q.UINT,[i.RG16I]:Q.INT,[i.RG16UI]:Q.UINT,[i.RG32I]:Q.INT,[i.RG32UI]:Q.UINT,[i.RGB8I]:Q.INT,[i.RGB8UI]:Q.UINT,[i.RGB16I]:Q.INT,[i.RGB16UI]:Q.UINT,[i.RGB32I]:Q.INT,[i.RGB32UI]:Q.UINT,[i.RGBA8I]:Q.INT,[i.RGBA8UI]:Q.UINT,[i.RGBA16I]:Q.INT,[i.RGBA16UI]:Q.UINT,[i.RGBA32I]:Q.INT,[i.RGBA32UI]:Q.UINT,[i.DEPTH_COMPONENT16]:Q.FLOAT,[i.DEPTH_COMPONENT24]:Q.FLOAT,[i.DEPTH_COMPONENT32F]:Q.FLOAT,[i.DEPTH_STENCIL]:Q.FLOAT,[i.DEPTH24_STENCIL8]:Q.FLOAT,[i.DEPTH32F_STENCIL8]:Q.FLOAT}:t={[i.RGB]:Q.FLOAT,[i.RGBA]:Q.FLOAT,[i.ALPHA]:Q.FLOAT,[i.LUMINANCE]:Q.FLOAT,[i.LUMINANCE_ALPHA]:Q.FLOAT,[i.DEPTH_STENCIL]:Q.FLOAT},t}function a_(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[at.UNSIGNED_BYTE]:{[L.RGBA]:i.RGBA8,[L.RGB]:i.RGB8,[L.RG]:i.RG8,[L.RED]:i.R8,[L.RGBA_INTEGER]:i.RGBA8UI,[L.RGB_INTEGER]:i.RGB8UI,[L.RG_INTEGER]:i.RG8UI,[L.RED_INTEGER]:i.R8UI,[L.ALPHA]:i.ALPHA,[L.LUMINANCE]:i.LUMINANCE,[L.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[at.BYTE]:{[L.RGBA]:i.RGBA8_SNORM,[L.RGB]:i.RGB8_SNORM,[L.RG]:i.RG8_SNORM,[L.RED]:i.R8_SNORM,[L.RGBA_INTEGER]:i.RGBA8I,[L.RGB_INTEGER]:i.RGB8I,[L.RG_INTEGER]:i.RG8I,[L.RED_INTEGER]:i.R8I},[at.UNSIGNED_SHORT]:{[L.RGBA_INTEGER]:i.RGBA16UI,[L.RGB_INTEGER]:i.RGB16UI,[L.RG_INTEGER]:i.RG16UI,[L.RED_INTEGER]:i.R16UI,[L.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[at.SHORT]:{[L.RGBA_INTEGER]:i.RGBA16I,[L.RGB_INTEGER]:i.RGB16I,[L.RG_INTEGER]:i.RG16I,[L.RED_INTEGER]:i.R16I},[at.UNSIGNED_INT]:{[L.RGBA_INTEGER]:i.RGBA32UI,[L.RGB_INTEGER]:i.RGB32UI,[L.RG_INTEGER]:i.RG32UI,[L.RED_INTEGER]:i.R32UI,[L.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[at.INT]:{[L.RGBA_INTEGER]:i.RGBA32I,[L.RGB_INTEGER]:i.RGB32I,[L.RG_INTEGER]:i.RG32I,[L.RED_INTEGER]:i.R32I},[at.FLOAT]:{[L.RGBA]:i.RGBA32F,[L.RGB]:i.RGB32F,[L.RG]:i.RG32F,[L.RED]:i.R32F,[L.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[at.HALF_FLOAT]:{[L.RGBA]:i.RGBA16F,[L.RGB]:i.RGB16F,[L.RG]:i.RG16F,[L.RED]:i.R16F},[at.UNSIGNED_SHORT_5_6_5]:{[L.RGB]:i.RGB565},[at.UNSIGNED_SHORT_4_4_4_4]:{[L.RGBA]:i.RGBA4},[at.UNSIGNED_SHORT_5_5_5_1]:{[L.RGBA]:i.RGB5_A1},[at.UNSIGNED_INT_2_10_10_10_REV]:{[L.RGBA]:i.RGB10_A2,[L.RGBA_INTEGER]:i.RGB10_A2UI},[at.UNSIGNED_INT_10F_11F_11F_REV]:{[L.RGB]:i.R11F_G11F_B10F},[at.UNSIGNED_INT_5_9_9_9_REV]:{[L.RGB]:i.RGB9_E5},[at.UNSIGNED_INT_24_8]:{[L.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[at.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[L.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:t={[at.UNSIGNED_BYTE]:{[L.RGBA]:i.RGBA,[L.RGB]:i.RGB,[L.ALPHA]:i.ALPHA,[L.LUMINANCE]:i.LUMINANCE,[L.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[at.UNSIGNED_SHORT_5_6_5]:{[L.RGB]:i.RGB},[at.UNSIGNED_SHORT_4_4_4_4]:{[L.RGBA]:i.RGBA},[at.UNSIGNED_SHORT_5_5_5_1]:{[L.RGBA]:i.RGBA}},t}class fu{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new ft,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=a_(t),this.samplerTypes=o_(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let s=0;s<e;s++)this.boundTextures[s]=null;this.emptyTextures={};const r=new zn(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new zn(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(t,e=0){const{gl:r}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<r.length;s++)r[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<r.length;s++)r[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[s]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:s}=this;if(r)for(let n=t-1;n>=0;--n){const o=e[n];o&&o._glTextures[s].samplerType!==Q.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){const e=new zn(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??Q.FLOAT,this.webGLVersion===2&&t.type===at.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const r=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(r,t,e))e.samplerType!==Q.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,n=t.realHeight,o=r.gl;(e.width!==s||e.height!==n||e.dirtyId<0)&&(e.width=s,e.height=n,o.texImage2D(t.target,0,e.internalFormat,s,n,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const s=this.managedTextures.indexOf(t);s!==-1&&di(this.managedTextures,s,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===qe.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=yr.CLAMP:e.wrapMode=t.wrapMode,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==qe.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===rr.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===rr.LINEAR){const n=Math.min(t.anisotropicLevel,r.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===rr.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===rr.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}fu.extension={type:Y.RendererSystem,name:"texture"};st.add(fu);class pu{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,s=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:s}=this;e&&s.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:s}=this,n=e.createTransformFeedback();t._glTransformFeedbacks[s]=n,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n);for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];a&&(r.buffer.update(a),a._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];if(!a)continue;const l=a._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!e&&n.dispose(a,e))}r&&(e||s.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}pu.extension={type:Y.RendererSystem,name:"transformFeedback"};st.add(pu);class Ws{constructor(t){this.renderer=t}init(t){this.screen=new dt(0,0,t.width,t.height),this.element=t.view||tt.ADAPTER.createCanvas(),this.resolution=t.resolution||tt.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=r,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",r,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}Ws.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Ws.extension={type:[Y.RendererSystem,Y.CanvasRendererSystem],name:"_view"};st.add(Ws);tt.PREFER_ENV=qr.WEBGL2;tt.STRICT_TEXTURE_CACHE=!1;tt.RENDER_OPTIONS={...Xs.defaultOptions,...zs.defaultOptions,...Ws.defaultOptions,...Vs.defaultOptions};Object.defineProperties(tt,{WRAP_MODE:{get(){return ft.defaultOptions.wrapMode},set(i){_t("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),ft.defaultOptions.wrapMode=i}},SCALE_MODE:{get(){return ft.defaultOptions.scaleMode},set(i){_t("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),ft.defaultOptions.scaleMode=i}},MIPMAP_TEXTURES:{get(){return ft.defaultOptions.mipmap},set(i){_t("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),ft.defaultOptions.mipmap=i}},ANISOTROPIC_LEVEL:{get(){return ft.defaultOptions.anisotropicLevel},set(i){_t("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),ft.defaultOptions.anisotropicLevel=i}},FILTER_RESOLUTION:{get(){return _t("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),ie.defaultResolution},set(i){ie.defaultResolution=i}},FILTER_MULTISAMPLE:{get(){return _t("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),ie.defaultMultisample},set(i){ie.defaultMultisample=i}},SPRITE_MAX_TEXTURES:{get(){return Dr.defaultMaxTextures},set(i){_t("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Dr.defaultMaxTextures=i}},SPRITE_BATCH_SIZE:{get(){return Dr.defaultBatchSize},set(i){_t("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Dr.defaultBatchSize=i}},CAN_UPLOAD_SAME_BUFFER:{get(){return Dr.canUploadSameBuffer},set(i){_t("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Dr.canUploadSameBuffer=i}},GC_MODE:{get(){return Fr.defaultMode},set(i){_t("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Fr.defaultMode=i}},GC_MAX_IDLE:{get(){return Fr.defaultMaxIdle},set(i){_t("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Fr.defaultMaxIdle=i}},GC_MAX_CHECK_COUNT:{get(){return Fr.defaultCheckCountMax},set(i){_t("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Fr.defaultCheckCountMax=i}},PRECISION_VERTEX:{get(){return nr.defaultVertexPrecision},set(i){_t("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),nr.defaultVertexPrecision=i}},PRECISION_FRAGMENT:{get(){return nr.defaultFragmentPrecision},set(i){_t("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),nr.defaultFragmentPrecision=i}}});var Wr=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(Wr||{});class Xn{constructor(t,e=null,r=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const mu=class _e{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Xn(null,null,1/0),this.deltaMS=1/_e.targetFPMS,this.elapsedMS=1/_e.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=Wr.NORMAL){return this._addListener(new Xn(t,e,r))}addOnce(t,e,r=Wr.NORMAL){return this._addListener(new Xn(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*_e.targetFPMS;const r=this._head;let s=r.next;for(;s;)s=s.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,_e.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!_e._shared){const t=_e._shared=new _e;t.autoStart=!0,t._protected=!0}return _e._shared}static get system(){if(!_e._system){const t=_e._system=new _e;t.autoStart=!0,t._protected=!0}return _e._system}};mu.targetFPMS=.06;let ve=mu;Object.defineProperties(tt,{TARGET_FPMS:{get(){return ve.targetFPMS},set(i){_t("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),ve.targetFPMS=i}}});class gu{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Wr.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?ve.shared:new ve,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}gu.extension=Y.Application;st.add(gu);const _u=[];st.handleByList(Y.Renderer,_u);function l_(i){for(const t of _u)if(t.test(i))return new t(i);throw new Error("Unable to auto-detect a suitable renderer.")}var h_=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,c_=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const u_=h_,yu=c_;class vu{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=Wt.HIGH?this.multisample=Wt.HIGH:e>=Wt.MEDIUM?this.multisample=Wt.MEDIUM:e>=Wt.LOW?this.multisample=Wt.LOW:this.multisample=Wt.NONE}destroy(){}}vu.extension={type:Y.RendererSystem,name:"_multisample"};st.add(vu);class d_{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class bu{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){const n=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,n.buffer)}}bindBufferRange(t,e,r){const{gl:s,CONTEXT_UID:n}=this;r=r||0;const o=t._glBuffers[n]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,o.buffer,r*256,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const n=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),r&&(e||s.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new d_(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}bu.extension={type:Y.RendererSystem,name:"buffer"};st.add(bu);class xu{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let s,n,o,a;if(e&&(s=e.renderTexture,n=e.clear,o=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!s,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=o,!r.context.isLost){if(s||(this.lastObjectRendered=t),!a){const l=t.enableTempParent();t.updateTransform(),t.disableTempParent(l)}r.renderTexture.bind(s),r.batch.currentRenderer.start(),(n??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),s&&(e.blit&&r.framebuffer.blit(),s.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}xu.extension={type:Y.RendererSystem,name:"objectRenderer"};st.add(xu);const Rs=class ko extends n_{constructor(t){super(),this.type=uc.WEBGL,t=Object.assign({},tt.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new ke({projectionMatrix:new Ft},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:ko.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(_t("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=ko.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t?.forceCanvas?!1:km()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return _t("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return _t("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return _t("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return _t("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){_t("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return _t("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){_t("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return _t("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Rs.extension={type:Y.Renderer,priority:1},Rs.__plugins={},Rs.__systems={};let wa=Rs;st.handleByMap(Y.RendererPlugin,wa.__plugins);st.handleByMap(Y.RendererSystem,wa.__systems);st.add(wa);class wu extends Vi{constructor(t,e){const{width:r,height:s}=e||{};super(r,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const o=new ft;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof Vi?this.addResourceAt(t[r],r):this.addResourceAt(Gc(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:r}=this.items[0];return this.resize(e,r),this.update(),Promise.resolve(this)}),this._load}}class f_ extends wu{constructor(t,e){const{width:r,height:s}=e||{};let n,o;Array.isArray(t)?(n=t,o=t.length):o=t,super(o,{width:r,height:s}),n&&this.initFromArray(n,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=hi.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:s,itemDirtyIds:n,items:o}=this,{gl:a}=t;r.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,s,0,e.format,r.type,null);for(let l=0;l<s;l++){const h=o[l];n[l]<h.dirtyId&&(n[l]=h.dirtyId,h.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,h.resource.width,h.resource.height,1,e.format,r.type,h.resource.source))}return!0}}class p_ extends wr{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const Tu=class Pi extends wu{constructor(t,e){const{width:r,height:s,autoLoad:n,linkBaseTexture:o}=e||{};if(t&&t.length!==Pi.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:r,height:s});for(let a=0;a<Pi.SIDES;a++)this.items[a].target=hi.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=o!==!1,t&&this.initFromArray(t,e),n!==!1&&this.load()}bind(t){super.bind(t),t.target=hi.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=hi.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,r){const s=this.itemDirtyIds;for(let n=0;n<Pi.SIDES;n++){const o=this.items[n];(s[n]<o.dirtyId||r.dirtyId<e.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(t,o,r),s[n]=o.dirtyId):s[n]<-1&&(t.gl.texImage2D(o.target,0,r.internalFormat,e.realWidth,e.realHeight,0,e.format,r.type,null),s[n]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Pi.SIDES}};Tu.SIDES=6;let m_=Tu;class li extends wr{constructor(t,e){e=e||{};let r,s,n;typeof t=="string"?(r=li.EMPTY,s=t,n=!0):(r=t,s=null,n=!1),super(r),this.url=s,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??n,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const r=await tt.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const s=await r.blob();if(this.destroyed)return;const n=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===me.UNPACK?"premultiply":"none"});if(this.destroyed){n.close();return}this.source=n,this.update(),t(this)}catch(r){if(this.destroyed)return;e(r),this.onError.emit(r)}}),this._load)}upload(t,e,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return li._EMPTY=li._EMPTY??tt.ADAPTER.createCanvas(0,0),li._EMPTY}}const Oo=class Ps extends wr{constructor(t,e){e=e||{},super(tt.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},Ps.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;wr.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,r=t.height;if(!e||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=e*this.scale,n=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/r*e,n=this._overrideHeight||this._overrideWidth/e*r),s=Math.round(s),n=Math.round(n);const o=this.source;o.width=s,o.height=n,o._pixiId=`canvas_${Vr()}`,o.getContext("2d").drawImage(t,0,0,e,r,0,0,s,n),this._resolve(),this._resolve=null}}static getSize(t){const e=Ps.SVG_SIZE.exec(t),r={};return e&&(r[e[1]]=Math.round(parseFloat(e[3])),r[e[5]]=Math.round(parseFloat(e[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&Ps.SVG_XML.test(t)}};Oo.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Oo.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let No=Oo;const Lo=class Uo extends wr{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const r=document.createElement("video");e.autoLoad!==!1&&r.setAttribute("preload","auto"),e.playsinline!==!1&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),e.muted===!0&&(r.setAttribute("muted",""),r.muted=!0),e.loop===!0&&r.setAttribute("loop",""),e.autoPlay!==!1&&r.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const s=t[0].src||t[0];wr.crossOrigin(r,s,e.crossorigin);for(let n=0;n<t.length;++n){const o=document.createElement("source");let{src:a,mime:l}=t[n];if(a=a||t[n],a.startsWith("data:"))l=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){const h=a.split("?").shift().toLowerCase(),c=h.slice(h.lastIndexOf(".")+1);l=l||Uo.MIME_TYPES[c]||`video/${c}`}o.src=a,l&&(o.type=l),r.appendChild(o)}t=r}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=ve.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,r)=>{this.valid?e(this):(this._resolve=e,this._reject=r,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(ve.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(ve.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(ve.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Uo.TYPES.includes(e)}};Lo.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Lo.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Eu=Lo;Ao.push(li,Zc,p_,Eu,No,rn,m_,f_);class js{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?dt.EMPTY:(t=t||new dt(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:s,c:n,d:o,tx:a,ty:l}=t,h=r*e.x+n*e.y+a,c=s*e.x+o*e.y+l;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(t){let e=this.minX,r=this.minY,s=this.maxX,n=this.maxY,o=t[0],a=t[1];e=o<e?o:e,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=t[2],a=t[3],e=o<e?o:e,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=t[4],a=t[5],e=o<e?o:e,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=t[6],a=t[7],e=o<e?o:e,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,this.minX=e,this.minY=r,this.maxX=s,this.maxY=n}addFrame(t,e,r,s,n){this.addFrameMatrix(t.worldTransform,e,r,s,n)}addFrameMatrix(t,e,r,s,n){const o=t.a,a=t.b,l=t.c,h=t.d,c=t.tx,u=t.ty;let d=this.minX,f=this.minY,p=this.maxX,g=this.maxY,_=o*e+l*r+c,m=a*e+h*r+u;d=_<d?_:d,f=m<f?m:f,p=_>p?_:p,g=m>g?m:g,_=o*s+l*r+c,m=a*s+h*r+u,d=_<d?_:d,f=m<f?m:f,p=_>p?_:p,g=m>g?m:g,_=o*e+l*n+c,m=a*e+h*n+u,d=_<d?_:d,f=m<f?m:f,p=_>p?_:p,g=m>g?m:g,_=o*s+l*n+c,m=a*s+h*n+u,d=_<d?_:d,f=m<f?m:f,p=_>p?_:p,g=m>g?m:g,this.minX=d,this.minY=f,this.maxX=p,this.maxY=g}addVertexData(t,e,r){let s=this.minX,n=this.minY,o=this.maxX,a=this.maxY;for(let l=e;l<r;l+=2){const h=t[l],c=t[l+1];s=h<s?h:s,n=c<n?c:n,o=h>o?h:o,a=c>a?c:a}this.minX=s,this.minY=n,this.maxX=o,this.maxY=a}addVertices(t,e,r,s){this.addVerticesMatrix(t.worldTransform,e,r,s)}addVerticesMatrix(t,e,r,s,n=0,o=n){const a=t.a,l=t.b,h=t.c,c=t.d,u=t.tx,d=t.ty;let f=this.minX,p=this.minY,g=this.maxX,_=this.maxY;for(let m=r;m<s;m+=2){const v=e[m],y=e[m+1],b=a*v+h*y+u,x=c*y+l*v+d;f=Math.min(f,b-n),g=Math.max(g,b+n),p=Math.min(p,x-o),_=Math.max(_,x+o)}this.minX=f,this.minY=p,this.maxX=g,this.maxY=_}addBounds(t){const e=this.minX,r=this.minY,s=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=n&&s<=o){const a=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=r<a?r:a,this.minY=s<l?s:l,this.maxX=n>h?n:h,this.maxY=o>c?o:c}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=n&&s<=o){const a=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=r<a?r:a,this.minY=s<l?s:l,this.maxX=n>h?n:h,this.maxY=o>c?o:c}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,s,n,o){t-=n,e-=o,r+=n,s+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}}class zt extends ji{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new ba,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new js,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const s=e[r];Object.defineProperty(zt.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new dt),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new dt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new js);const e=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=r?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-n,o}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,s){return e&&(t=e.toGlobal(t,r,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,r=1,s=1,n=0,o=0,a=0,l=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=s||1,this.rotation=n,this.skew.x=o,this.skew.y=a,this.pivot.x=l,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new g_),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*hg}set angle(t){this.transform.rotation=t*cg}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class g_ extends zt{constructor(){super(...arguments),this.sortDirty=null}}zt.prototype.displayObjectUpdateTransform=zt.prototype.updateTransform;const __=new Ft;function y_(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}const Au=class Go extends zt{constructor(){super(),this.children=[],this.sortableChildren=Go.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),s=this.getChildIndex(e);this.children[r]=e,this.children[s]=t,this.onChildrenChange(r<s?r:s)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);di(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(r===-1)return null;e.parent=null,e.transform._parentID=-1,di(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,di(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,s=e,n=s-r;let o;if(n>0&&n<=s){o=this.children.splice(r,n);for(let a=0;a<o.length;++a)o[a].parent=null,o[a].transform&&(o[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let a=0;a<o.length;++a)o[a].emit("removed",this),this.emit("childRemoved",o[a],this,a);return o}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const s=this.children[e];s._lastSortedIndex=e,!t&&s.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(y_),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const r=this.children[t];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const r=e._mask.isMaskData?e._mask.maskObject:e._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let s=0,n=this.children.length;s<n;++s){const o=this.children[s];o.visible&&o.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let r,s;this.cullArea?(r=this.cullArea,s=this.worldTransform):this._render!==Go.prototype._render&&(r=this.getBounds(!0));const n=t.projection.transform;if(n&&(s?(s=__.copyFrom(s),s.prepend(n)):s=n),r&&e.intersects(r,s))this._render(t);else if(this.cullArea)return;for(let o=0,a=this.children.length;o<a;++o){const l=this.children[o],h=l.cullable;l.cullable=h||!this.cullArea,l.render(t),l.cullable=h}}render(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let n=0;n<e.length;n++)e[n].enabled&&this._enabledFilters.push(e[n])}const s=e&&this._enabledFilters?.length||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==Yt.NONE));if(s&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let n=0,o=this.children.length;n<o;++n)this.children[n].render(t)}s&&t.batch.flush(),r&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t?.children,r=this.removeChildren(0,this.children.length);if(e)for(let s=0;s<r.length;++s)r[s].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};Au.defaultSortableChildren=!1;let se=Au;se.prototype.containerUpdateTransform=se.prototype.updateTransform;Object.defineProperties(tt,{SORTABLE_CHILDREN:{get(){return se.defaultSortableChildren},set(i){_t("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),se.defaultSortableChildren=i}}});const Si=new Et,v_=new Uint16Array([0,1,2,0,2,3]);class ue extends se{constructor(t){super(),this._anchor=new sr(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Ct(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=ht.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||it.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=v_,this.pluginName="batch",this.isSprite=!0,this._roundPixels=tt.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=mr(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=mr(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,r=e.a,s=e.b,n=e.c,o=e.d,a=e.tx,l=e.ty,h=this.vertexData,c=t.trim,u=t.orig,d=this._anchor;let f=0,p=0,g=0,_=0;if(c?(p=c.x-d._x*u.width,f=p+c.width,_=c.y-d._y*u.height,g=_+c.height):(p=-d._x*u.width,f=p+u.width,_=-d._y*u.height,g=_+u.height),h[0]=r*p+n*_+a,h[1]=o*_+s*p+l,h[2]=r*f+n*_+a,h[3]=o*_+s*f+l,h[4]=r*f+n*g+a,h[5]=o*g+s*f+l,h[6]=r*p+n*g+a,h[7]=o*g+s*p+l,this._roundPixels){const m=tt.RESOLUTION;for(let v=0;v<h.length;++v)h[v]=Math.round(h[v]*m)/m}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,r=t.orig,s=this._anchor,n=this.transform.worldTransform,o=n.a,a=n.b,l=n.c,h=n.d,c=n.tx,u=n.ty,d=-s._x*r.width,f=d+r.width,p=-s._y*r.height,g=p+r.height;if(e[0]=o*d+l*p+c,e[1]=h*p+a*d+u,e[2]=o*f+l*p+c,e[3]=h*p+a*f+u,e[4]=o*f+l*g+c,e[5]=h*g+a*f+u,e[6]=o*d+l*g+c,e[7]=h*g+a*d+u,this._roundPixels){const _=tt.RESOLUTION;for(let m=0;m<e.length;++m)e[m]=Math.round(e[m]*_)/_}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new js),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new dt),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Si);const e=this._texture.orig.width,r=this._texture.orig.height,s=-e*this.anchor.x;let n=0;return Si.x>=s&&Si.x<s+e&&(n=-r*this.anchor.y,Si.y>=n&&Si.y<n+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t?.texture){const e=typeof t=="boolean"?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const r=t instanceof it?t:it.from(t,e);return new ue(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=mr(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=mr(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||it.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const Su=new Ft;zt.prototype._cacheAsBitmap=!1;zt.prototype._cacheData=null;zt.prototype._cacheAsBitmapResolution=null;zt.prototype._cacheAsBitmapMultisample=null;class b_{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(zt.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(i){i!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(i){i!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(i){if(this._cacheAsBitmap===i)return;this._cacheAsBitmap=i;let t;i?(this._cacheData||(this._cacheData=new b_),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});zt.prototype._renderCached=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(i),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(i))};zt.prototype._initCachedDisplayObject=function(i){if(this._cacheData?.sprite)return;const t=this.alpha;this.alpha=1,i.batch.flush();const e=this.getLocalBounds(new dt,!0);if(this.filters?.length){const d=this.filters[0].padding;e.pad(d)}const r=this.cacheAsBitmapResolution||i.resolution;e.ceil(r),e.width=Math.max(e.width,1/r),e.height=Math.max(e.height,1/r);const s=i.renderTexture.current,n=i.renderTexture.sourceFrame.clone(),o=i.renderTexture.destinationFrame.clone(),a=i.projection.transform,l=ae.create({width:e.width,height:e.height,resolution:r,multisample:this.cacheAsBitmapMultisample??i.multisample}),h=`cacheAsBitmap_${Vr()}`;this._cacheData.textureCacheId=h,ft.addToCache(l.baseTexture,h),it.addToCache(l,h);const c=this.transform.localTransform.copyTo(Su).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,i.render(this,{renderTexture:l,clear:!0,transform:c,skipUpdateTransform:!1}),i.framebuffer.blit(),i.projection.transform=a,i.renderTexture.bind(s,n,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const u=new ue(l);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(e.x/e.width),u.anchor.y=-(e.y/e.height),u.alpha=t,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)};zt.prototype._renderCachedCanvas=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(i),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(i))};zt.prototype._initCachedDisplayObjectCanvas=function(i){if(this._cacheData?.sprite)return;const t=this.getLocalBounds(new dt,!0),e=this.alpha;this.alpha=1;const r=i.canvasContext.activeContext,s=i._projTransform,n=this.cacheAsBitmapResolution||i.resolution;t.ceil(n),t.width=Math.max(t.width,1/n),t.height=Math.max(t.height,1/n);const o=ae.create({width:t.width,height:t.height,resolution:n}),a=`cacheAsBitmap_${Vr()}`;this._cacheData.textureCacheId=a,ft.addToCache(o.baseTexture,a),it.addToCache(o,a);const l=Su;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=t.x,l.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,i.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),i.canvasContext.activeContext=r,i._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const h=new ue(o);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-(t.x/t.width),h.anchor.y=-(t.y/t.height),h.alpha=e,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=i._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)};zt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};zt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};zt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,ft.removeFromCache(this._cacheData.textureCacheId),it.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};zt.prototype._cacheAsBitmapDestroy=function(i){this.cacheAsBitmap=!1,this.destroy(i)};zt.prototype.name=null;se.prototype.getChildByName=function(i,t){for(let e=0,r=this.children.length;e<r;e++)if(this.children[e].name===i)return this.children[e];if(t)for(let e=0,r=this.children.length;e<r;e++){const s=this.children[e];if(!s.getChildByName)continue;const n=s.getChildByName(i,!0);if(n)return n}return null};zt.prototype.getGlobalPosition=function(i=new Et,t=!1){return this.parent?this.parent.toGlobal(this.position,i,t):(i.x=this.position.x,i.y=this.position.y),i};var x_=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class w_ extends ie{constructor(t=1){super(u_,x_,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const T_={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},E_=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function A_(i){const t=T_[i],e=t.length;let r=E_,s="";const n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let o;for(let a=0;a<i;a++){let l=n.replace("%index%",a.toString());o=a,a>=e&&(o=i-a-1),l=l.replace("%value%",t[o].toString()),s+=l,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",i.toString()),r}const S_=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function C_(i,t){const e=Math.ceil(i/2);let r=S_,s="",n;t?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<i;o++){let a=n.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(e-1)}.0`),s+=a,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",i.toString()),r}class Ho extends ie{constructor(t,e=8,r=4,s=ie.defaultResolution,n=5){const o=C_(n,t),a=A_(n);super(o,a),this.horizontal=t,this.resolution=s,this._quality=0,this.quality=r,this.blur=e}apply(t,e,r,s){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,r,s);else{const n=t.getFilterTexture(),o=t.renderer;let a=e,l=n;this.state.blend=!1,t.applyFilter(this,a,l,Xe.CLEAR);for(let h=1;h<this.passes-1;h++){t.bindAndClear(a,Xe.BLIT),this.uniforms.uSampler=l;const c=l;l=a,a=c,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,l,r,s),t.returnFilterTexture(n)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class I_ extends ie{constructor(t=8,e=4,r=ie.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Ho(!0,t,e,r,s),this.blurYFilter=new Ho(!1,t,e,r,s),this.resolution=r,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,r,s){const n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(n&&o){const a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,Xe.CLEAR),this.blurYFilter.apply(t,a,r,s),t.returnFilterTexture(a)}else o?this.blurYFilter.apply(t,e,r,s):this.blurXFilter.apply(t,e,r,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var R_=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class zo extends ie{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(yu,R_,t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const[r,s,n]=Ct.shared.setValue(t).toArray(),o=[r,0,0,0,0,0,s,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(o,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),s=Math.sin(t),n=Math.sqrt,o=1/3,a=n(o),l=r+(1-r)*o,h=o*(1-r)-a*s,c=o*(1-r)+a*s,u=o*(1-r)+a*s,d=r+o*(1-r),f=o*(1-r)-a*s,p=o*(1-r)-a*s,g=o*(1-r)+a*s,_=r+o*(1-r),m=[l,h,c,0,0,u,d,f,0,0,p,g,_,0,0,0,0,0,1,0];this._loadMatrix(m,e)}contrast(t,e){const r=(t||0)+1,s=-.5*(r-1),n=[r,0,0,0,s,0,r,0,0,s,0,0,r,0,s,0,0,0,1,0];this._loadMatrix(n,e)}saturate(t=0,e){const r=t*2/3+1,s=(r-1)*-.5,n=[r,s,s,0,0,s,r,s,0,0,s,s,r,0,0,0,0,0,1,0];this._loadMatrix(n,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,r,s,n){t=t||.2,e=e||.15,r=r||16770432,s=s||3375104;const o=Ct.shared,[a,l,h]=o.setValue(r).toArray(),[c,u,d]=o.setValue(s).toArray(),f=[.3,.59,.11,0,0,a,l,h,t,0,c,u,d,e,0,a-c,l-u,h-d,0,0];this._loadMatrix(f,n)}night(t,e){t=t||.1;const r=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}zo.prototype.grayscale=zo.prototype.greyscale;var P_=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,M_=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class B_ extends ie{constructor(t,e){const r=new Ft;t.renderable=!1,super(M_,P_,{mapSampler:t._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=r,e==null&&(e=20),this.scale=new Et(e,e)}apply(t,e,r,s){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const n=this.maskSprite.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),a=Math.sqrt(n.c*n.c+n.d*n.d);o!==0&&a!==0&&(this.uniforms.rotation[0]=n.a/o,this.uniforms.rotation[1]=n.b/o,this.uniforms.rotation[2]=n.c/a,this.uniforms.rotation[3]=n.d/a),t.applyFilter(this,e,r,s)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var D_=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,F_=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class k_ extends ie{constructor(){super(F_,D_)}}var O_=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class N_ extends ie{constructor(t=.5,e=Math.random()){super(yu,O_,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const Xl={AlphaFilter:w_,BlurFilter:I_,BlurFilterPass:Ho,ColorMatrixFilter:zo,DisplacementFilter:B_,FXAAFilter:k_,NoiseFilter:N_};Object.entries(Xl).forEach(([i,t])=>{Object.defineProperty(Xl,i,{get(){return _t("7.1.0",`filters.${i} has moved to ${i}`),t}})});class L_{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(ve.system.add(this.tickerUpdate,this,Wr.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(ve.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const fr=new L_;class qi{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=qi.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Et,this.page=new Et,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,r,s,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Ys extends qi{constructor(){super(...arguments),this.client=new Et,this.movement=new Et,this.offset=new Et,this.global=new Et,this.screen=new Et}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,r,s,n,o,a,l,h,c,u,d,f,p,g){throw new Error("Method not implemented.")}}class Me extends Ys{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class pi extends Ys{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}pi.DOM_DELTA_PIXEL=0,pi.DOM_DELTA_LINE=1,pi.DOM_DELTA_PAGE=2;const U_=2048,G_=new Et,Vn=new Et;class H_{constructor(t){this.dispatch=new ji,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((r,s)=>r.priority-s.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let r=0,s=e.length;r<s;r++)e[r].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){fr.pauseUpdate=!0;const r=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",s=this[r](this.rootTarget,this.rootTarget.eventMode,G_.set(t,e),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(t,e){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let s=0,n=r.length-1;s<n;s++)if(t.currentTarget=r[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let s=r.length-2;s>=0;s--)if(t.currentTarget=r[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,r=this._allInteractiveElements){if(r.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const s=Array.isArray(e)?e:[e];for(let n=r.length-1;n>=0;n--)s.forEach(o=>{t.currentTarget=r[n],this.notifyTarget(t,o)})}propagationPath(t){const e=[t];for(let r=0;r<U_&&t!==this.rootTarget;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,r,s,n,o=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(fr.pauseUpdate=!1),t.interactiveChildren&&t.children){const c=t.children;for(let u=c.length-1;u>=0;u--){const d=c[u],f=this.hitTestMoveRecursive(d,this._isInteractive(e)?e:d.eventMode,r,s,n,o||n(t,r));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const p=t.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(t),f.push(t)),this._hitElements.length===0&&(this._hitElements=f),a=!0}}}const l=this._isInteractive(e),h=t.isInteractive();return l&&h&&this._allInteractiveElements.push(t),o||this._hitElements.length>0?null:a?this._hitElements:l&&!n(t,r)&&s(t,r)?h?[t]:[]:null}hitTestRecursive(t,e,r,s,n){if(this._interactivePrune(t)||n(t,r))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(fr.pauseUpdate=!1),t.interactiveChildren&&t.children){const l=t.children;for(let h=l.length-1;h>=0;h--){const c=l[h],u=this.hitTestRecursive(c,this._isInteractive(e)?e:c.eventMode,r,s,n);if(u){if(u.length>0&&!u[u.length-1].parent)continue;const d=t.isInteractive();return(u.length>0||d)&&u.push(t),u}}}const o=this._isInteractive(e),a=t.isInteractive();return o&&s(t,r)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,Vn),!t.hitArea.contains(Vn.x,Vn.y)))return!0;if(t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;if(r&&!r.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){e=e??t.type;const r=`on${e}`;t.currentTarget[r]?.(t);const s=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,s),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Me)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const s=e.button===2;this.dispatchEvent(e,s?"rightdown":"mousedown")}const r=this.trackingData(t.pointerId);r.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof Me)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const r=e.pointerType==="mouse"||e.pointerType==="pen",s=this.trackingData(t.pointerId),n=this.findMountedTarget(s.overTargets);if(s.overTargets?.length>0&&n!==e.target){const l=t.type==="mousemove"?"mouseout":"pointerout",h=this.createPointerEvent(t,l,n);if(this.dispatchEvent(h,"pointerout"),r&&this.dispatchEvent(h,"mouseout"),!e.composedPath().includes(n)){const c=this.createPointerEvent(t,"pointerleave",n);for(c.eventPhase=c.AT_TARGET;c.target&&!e.composedPath().includes(c.target);)c.currentTarget=c.target,this.notifyTarget(c),r&&this.notifyTarget(c,"mouseleave"),c.target=c.target.parent;this.freeEvent(c)}this.freeEvent(h)}if(n!==e.target){const l=t.type==="mousemove"?"mouseover":"pointerover",h=this.clonePointerEvent(e,l);this.dispatchEvent(h,"pointerover"),r&&this.dispatchEvent(h,"mouseover");let c=n?.parent;for(;c&&c!==this.rootTarget.parent&&c!==e.target;)c=c.parent;if(!c||c===this.rootTarget.parent){const u=this.clonePointerEvent(e,"pointerenter");for(u.eventPhase=u.AT_TARGET;u.target&&u.target!==n&&u.target!==this.rootTarget.parent;)u.currentTarget=u.target,this.notifyTarget(u),r&&this.notifyTarget(u,"mouseenter"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(h)}const o=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(e,"pointermove"),a&&o.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),a&&o.push("globaltouchmove")),r&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),a&&o.push("globalmousemove"),this.cursor=e.target?.cursor),o.length>0&&this.all(e,o),this._allInteractiveElements.length=0,this._hitElements.length=0,s.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof Me)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),r=this.createPointerEvent(t),s=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),s&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=r.target?.cursor);const n=this.clonePointerEvent(r,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),s&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;e.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(n)}mapPointerOut(t){if(!(t instanceof Me)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const r=t.pointerType==="mouse"||t.pointerType==="pen",s=this.findMountedTarget(e.overTargets),n=this.createPointerEvent(t,"pointerout",s);this.dispatchEvent(n),r&&this.dispatchEvent(n,"mouseout");const o=this.createPointerEvent(t,"pointerleave",s);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),r&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;e.overTargets=null,this.freeEvent(n),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Me)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const a=r.button===2;this.dispatchEvent(r,a?"rightup":"mouseup")}const s=this.trackingData(t.pointerId),n=this.findMountedTarget(s.pressTargetsByButton[t.button]);let o=n;if(n&&!r.composedPath().includes(n)){let a=n;for(;a&&!r.composedPath().includes(a);){if(r.currentTarget=a,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const l=r.button===2;this.notifyTarget(r,l?"rightupoutside":"mouseupoutside")}a=a.parent}delete s.pressTargetsByButton[t.button],o=a}if(o){const a=this.clonePointerEvent(r,"click");a.target=o,a.path=null,s.clicksByButton[t.button]||(s.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});const l=s.clicksByButton[t.button];if(l.target===a.target&&e-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=a.target,l.timeStamp=e,a.detail=l.clickCount,a.pointerType==="mouse"){const h=a.button===2;this.dispatchEvent(a,h?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof Me)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),r=this.findMountedTarget(e.pressTargetsByButton[t.button]),s=this.createPointerEvent(t);if(r){let n=r;for(;n;)s.currentTarget=n,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch"?this.notifyTarget(s,"touchendoutside"):(s.pointerType==="mouse"||s.pointerType==="pen")&&this.notifyTarget(s,s.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(s)}mapWheel(t){if(!(t instanceof pi)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let r=1;r<t.length&&t[r].parent===e;r++)e=t[r];return e}createPointerEvent(t,e,r){const s=this.allocateEvent(Me);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=r??this.hitTest(s.global.x,s.global.y)??this._hitElements[0],typeof e=="string"&&(s.type=e),s}createWheelEvent(t){const e=this.allocateEvent(pi);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const r=this.allocateEvent(Me);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=e??r.type,r}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Me&&e instanceof Me&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Ys&&e instanceof Ys&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const r=t.currentTarget._events[e];if(r&&t.currentTarget.isInteractive())if("fn"in r)r.once&&t.currentTarget.removeListener(e,r.fn,void 0,!0),r.fn.call(r.context,t);else for(let s=0,n=r.length;s<n&&!t.propagationImmediatelyStopped;s++)r[s].once&&t.currentTarget.removeListener(e,r[s].fn,void 0,!0),r[s].fn.call(r[s].context,t)}}const z_=1,X_={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Xo=class Vo{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new H_(null),fr.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Me(null),this.rootWheelEvent=new pi(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Vo.defaultEventFeatures},{set:(e,r,s)=>(r==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=s),e[r]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:r}=this.renderer;this.setTargetElement(e),this.resolution=r,Vo._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.domElement.style,r);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let r=0,s=e.length;r<s;r++){const n=e[r],o=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,fr.pointerMoved();const e=this.normalizeToPointerData(t);for(let r=0,s=e.length;r<s;r++){const n=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const r=e!==this.domElement?"outside":"",s=this.normalizeToPointerData(t);for(let n=0,o=s.length;n<o;n++){const a=this.bootstrapEvent(this.rootPointerEvent,s[n]);a.type+=r,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let r=0,s=e.length;r<s;r++){const n=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,fr.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;fr.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;fr.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,r){const s=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},n=1/this.resolution;t.x=(e-s.left)*(this.domElement.width/s.width)*n,t.y=(r-s.top)*(this.domElement.height/s.height)*n}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,s=t.changedTouches.length;r<s;r++){const n=t.changedTouches[r];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const r=t;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=z_),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,e.push(r)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=X_[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};Xo.extension={name:"events",type:[Y.RendererSystem,Y.CanvasRendererSystem]},Xo.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let Wo=Xo;st.add(Wo);function Vl(i){return i==="dynamic"||i==="static"}const V_={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??Vl(Wo.defaultEventMode)},set interactive(i){_t("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=i,this.eventMode=i?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Wo.defaultEventMode},set eventMode(i){this._internalInteractive=Vl(i),this._internalEventMode=i},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,s=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.on(i,t,s)},removeEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,s=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.off(i,t,s)},dispatchEvent(i){if(!(i instanceof qi))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return i.defaultPrevented=!1,i.path=null,i.target=this,i.manager.dispatchEvent(i),!i.defaultPrevented}};zt.mixin(V_);const W_={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};zt.mixin(W_);const j_=9,ds=100,Y_=0,q_=0,Wl=2,jl=1,Z_=-1e3,K_=-1e3,$_=2;class Cu{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(ir.tablet||ir.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${ds}px`,e.style.height=`${ds}px`,e.style.position="absolute",e.style.top=`${Y_}px`,e.style.left=`${q_}px`,e.style.zIndex=Wl.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${jl}px`,t.style.height=`${jl}px`,t.style.position="absolute",t.style.top=`${Z_}px`,t.style.left=`${K_}px`,t.style.zIndex=$_.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let r=0;r<e.length;r++)this.updateAccessibleObjects(e[r])}update(){const t=performance.now();if(ir.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:r,width:s,height:n}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:l}=this.renderer,h=s/o*l,c=n/a*l;let u=this.div;u.style.left=`${e}px`,u.style.top=`${r}px`,u.style.width=`${o}px`,u.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,di(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{u=f._accessibleDiv;let p=f.hitArea;const g=f.worldTransform;f.hitArea?(u.style.left=`${(g.tx+p.x*g.a)*h}px`,u.style.top=`${(g.ty+p.y*g.d)*c}px`,u.style.width=`${p.width*g.a*h}px`,u.style.height=`${p.height*g.d*c}px`):(p=f.getBounds(),this.capHitArea(p),u.style.left=`${p.x*h}px`,u.style.top=`${p.y*c}px`,u.style.width=`${p.width*h}px`,u.style.height=`${p.height*c}px`,u.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(u.title=f.accessibleTitle),u.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&u.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==u.title||f.tabIndex!==u.tabIndex)&&(u.title=f.accessibleTitle,u.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:r}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>r&&(t.height=r-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${ds}px`,e.style.height=`${ds}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=Wl.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:r}=t.target,s=this.renderer.events.rootBoundary,n=Object.assign(new qi(s),{target:r});s.rootTarget=this.renderer.lastObjectRendered,e.forEach(o=>s.dispatchEvent(n,o))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===j_&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Cu.extension={name:"accessibility",type:[Y.RendererPlugin,Y.CanvasRendererPlugin]};st.add(Cu);const Iu=class jo{constructor(t){this.stage=new se,t=Object.assign({forceCanvas:!1},t),this.renderer=l_(t),jo._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(t,e){const r=jo._plugins.slice(0);r.reverse(),r.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Iu._plugins=[];let Ru=Iu;st.handleByList(Y.Application,Ru._plugins);class Pu{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,r;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:n}=this._resizeTo;e=s,r=n}this.renderer.resize(e,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Pu.extension=Y.Application;st.add(Pu);const Yl={loader:Y.LoadParser,resolver:Y.ResolveParser,cache:Y.CacheParser,detection:Y.DetectionParser};st.handle(Y.Asset,i=>{const t=i.ref;Object.entries(Yl).filter(([e])=>!!t[e]).forEach(([e,r])=>st.add(Object.assign(t[e],{extension:t[e].extension??r})))},i=>{const t=i.ref;Object.keys(Yl).filter(e=>!!t[e]).forEach(e=>st.remove(t[e]))});class J_{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function bi(i,t){if(Array.isArray(t)){for(const e of t)if(i.startsWith(`data:${e}`))return!0;return!1}return i.startsWith(`data:${t}`)}function Ar(i,t){const e=i.split("?")[0],r=Kt.extname(e).toLowerCase();return Array.isArray(t)?t.includes(r):r===t}const De=(i,t,e=!1)=>(Array.isArray(i)||(i=[i]),t?i.map(r=>typeof r=="string"||e?t(r):r):i),Yo=(i,t)=>{const e=t.split("?")[1];return e&&(i+=`?${e}`),i};function Mu(i,t,e,r,s){const n=t[e];for(let o=0;o<n.length;o++){const a=n[o];e<t.length-1?Mu(i.replace(r[e],a),t,e+1,r,s):s.push(i.replace(r[e],a))}}function Q_(i){const t=/\{(.*?)\}/g,e=i.match(t),r=[];if(e){const s=[];e.forEach(n=>{const o=n.substring(1,n.length-1).split(",");s.push(o)}),Mu(i,s,0,e,r)}else r.push(i);return r}const qs=i=>!Array.isArray(i);class t0{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const r=De(t);let s;for(let a=0;a<this.parsers.length;a++){const l=this.parsers[a];if(l.test(e)){s=l.getCacheableAssets(r,e);break}}s||(s={},r.forEach(a=>{s[a]=e}));const n=Object.keys(s),o={cacheKeys:n,keys:r};if(r.forEach(a=>{this._cacheMap.set(a,o)}),n.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==e&&console.warn("[Cache] already has key:",a),this._cache.set(a,s[a])}),e instanceof it){const a=e;r.forEach(l=>{a.baseTexture!==it.EMPTY.baseTexture&&ft.addToCache(a.baseTexture,l),it.addToCache(a,l)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(r=>{this._cache.delete(r)}),e.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const Or=new t0;class e0{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,r)=>(this._parsersValidated=!1,t[e]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{let s=null,n=null;if(e.loadParser&&(n=this._parserHash[e.loadParser],n||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!n){for(let o=0;o<this.parsers.length;o++){const a=this.parsers[o];if(a.load&&a.test?.(t,e,this)){n=a;break}}if(!n)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}s=await n.load(t,e,this),r.parser=n;for(let o=0;o<this.parsers.length;o++){const a=this.parsers[o];a.parse&&a.parse&&await a.testParse?.(s,e,this)&&(s=await a.parse(s,e,this)||s,r.parser=a)}return s})(),r}async load(t,e){this._parsersValidated||this._validateParsers();let r=0;const s={},n=qs(t),o=De(t,h=>({alias:[h],src:h})),a=o.length,l=o.map(async h=>{const c=Kt.toAbsolute(h.src);if(!s[h.src])try{this.promiseCache[c]||(this.promiseCache[c]=this._getLoadPromiseAndParser(c,h)),s[h.src]=await this.promiseCache[c].promise,e&&e(++r/a)}catch(u){throw delete this.promiseCache[c],delete s[h.src],new Error(`[Loader.load] Failed to load ${c}.
${u}`)}});return await Promise.all(l),n?s[o[0].src]:s}async unload(t){const e=De(t,r=>({alias:[r],src:r})).map(async r=>{const s=Kt.toAbsolute(r.src),n=this.promiseCache[s];if(n){const o=await n.promise;delete this.promiseCache[s],n.parser?.unload?.(o,r,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}}var Oe=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(Oe||{});const r0=".json",i0="application/json",s0={extension:{type:Y.LoadParser,priority:Oe.Low},name:"loadJson",test(i){return bi(i,i0)||Ar(i,r0)},async load(i){return await(await tt.ADAPTER.fetch(i)).json()}};st.add(s0);const n0=".txt",o0="text/plain",a0={name:"loadTxt",extension:{type:Y.LoadParser,priority:Oe.Low},test(i){return bi(i,o0)||Ar(i,n0)},async load(i){return await(await tt.ADAPTER.fetch(i)).text()}};st.add(a0);const l0=["normal","bold","100","200","300","400","500","600","700","800","900"],h0=[".ttf",".otf",".woff",".woff2"],c0=["font/ttf","font/otf","font/woff","font/woff2"],u0=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function d0(i){const t=Kt.extname(i),e=Kt.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1));let r=e.length>0;for(const n of e)if(!n.match(u0)){r=!1;break}let s=e.join(" ");return r||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}const f0=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function p0(i){return f0.test(i)?i:encodeURI(i)}const m0={extension:{type:Y.LoadParser,priority:Oe.Low},name:"loadWebFont",test(i){return bi(i,c0)||Ar(i,h0)},async load(i,t){const e=tt.ADAPTER.getFontFaceSet();if(e){const r=[],s=t.data?.family??d0(i),n=t.data?.weights?.filter(a=>l0.includes(a))??["normal"],o=t.data??{};for(let a=0;a<n.length;a++){const l=n[a],h=new FontFace(s,`url(${p0(i)})`,{...o,weight:l});await h.load(),e.add(h),r.push(h)}return r.length===1?r[0]:r}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(i){(Array.isArray(i)?i:[i]).forEach(t=>tt.ADAPTER.getFontFaceSet().delete(t))}};st.add(m0);let ql=0,Wn;const g0="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",_0={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${g0}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},y0={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let jn;class v0{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([_0.code],{type:"application/javascript"})),r=new Worker(e);r.addEventListener("message",s=>{r.terminate(),URL.revokeObjectURL(e),t(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){Wn===void 0&&(Wn=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Wn&&(jn||(jn=URL.createObjectURL(new Blob([y0.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(jn),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const r=new Promise((s,n)=>{this.queue.push({id:t,arguments:e,resolve:s,reject:n})});return this.next(),r}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),r=e.id;this.resolveHash[ql]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:ql++,id:r})}}const Zl=new v0;function Zi(i,t,e){i.resource.internal=!0;const r=new it(i),s=()=>{delete t.promiseCache[e],Or.has(e)&&Or.remove(e)};return r.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),s())}),r.once("destroyed",()=>{i.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())}),r}const b0=[".jpeg",".jpg",".png",".webp",".avif"],x0=["image/jpeg","image/png","image/webp","image/avif"];async function w0(i){const t=await tt.ADAPTER.fetch(i);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const ln={name:"loadTextures",extension:{type:Y.LoadParser,priority:Oe.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(i){return bi(i,x0)||Ar(i,b0)},async load(i,t,e){const r=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let s;r?this.config.preferWorkers&&await Zl.isImageBitmapSupported()?s=await Zl.loadImageBitmap(i):s=await w0(i):s=await new Promise((a,l)=>{const h=new Image;h.crossOrigin=this.config.crossOrigin,h.src=i,h.complete?a(h):(h.onload=()=>a(h),h.onerror=c=>l(c))});const n={...t.data};n.resolution??(n.resolution=ar(i)),r&&n.resourceOptions?.ownsImageBitmap===void 0&&(n.resourceOptions={...n.resourceOptions},n.resourceOptions.ownsImageBitmap=!0);const o=new ft(s,n);return o.resource.src=i,Zi(o,e,i)},unload(i){i.destroy(!0)}};st.add(ln);const T0=".svg",E0="image/svg+xml",A0={extension:{type:Y.LoadParser,priority:Oe.High},name:"loadSVG",test(i){return bi(i,E0)||Ar(i,T0)},async testParse(i){return No.test(i)},async parse(i,t,e){const r=new No(i,t?.data?.resourceOptions);await r.load();const s=new ft(r,{resolution:ar(i),...t?.data});return s.resource.src=t.src,Zi(s,e,t.src)},async load(i,t){return(await tt.ADAPTER.fetch(i)).text()},unload:ln.unload};st.add(A0);const S0=[".mp4",".m4v",".webm",".ogv"],C0=["video/mp4","video/webm","video/ogg"],I0={name:"loadVideo",extension:{type:Y.LoadParser,priority:Oe.High},config:{defaultAutoPlay:!0},test(i){return bi(i,C0)||Ar(i,S0)},async load(i,t,e){let r;const s=await(await tt.ADAPTER.fetch(i)).blob(),n=URL.createObjectURL(s);try{const o={autoPlay:this.config.defaultAutoPlay,...t?.data?.resourceOptions},a=new Eu(n,o);await a.load();const l=new ft(a,{alphaMode:await Fm(),resolution:ar(i),...t?.data});l.resource.src=i,r=Zi(l,e,i),r.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(n)})}catch(o){throw URL.revokeObjectURL(n),o}return r},unload(i){i.destroy(!0)}};st.add(I0);class R0{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(e[r])}`).join("&")}}getAlias(t){const{alias:e,name:r,src:s,srcs:n}=t;return De(e||r||s||n,o=>typeof o=="string"?o:Array.isArray(o)?o.map(a=>a?.src??a?.srcs??a):o?.src||o?.srcs?o.src??o.srcs:o,!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const r=[];Array.isArray(e)?e.forEach(s=>{const n=s.src??s.srcs,o=s.alias??s.name;let a;if(typeof o=="string"){const l=this._createBundleAssetId(t,o);r.push(l),a=[o,l]}else{const l=o.map(h=>this._createBundleAssetId(t,h));r.push(...l),a=[...o,...l]}this.add({...s,alias:a,src:n})}):Object.keys(e).forEach(s=>{const n=[s,this._createBundleAssetId(t,s)];if(typeof e[s]=="string")this.add({alias:n,src:e[s]});else if(Array.isArray(e[s]))this.add({alias:n,src:e[s]});else{const o=e[s],a=o.src??o.srcs;this.add({...o,alias:n,src:Array.isArray(a)?a:[a]})}r.push(...n)}),this._bundles[t]=r}add(t,e,r,s,n){const o=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(_t("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),o.push({alias:t,src:e,data:r,format:s,loadParser:n})):Array.isArray(t)?o.push(...t):o.push(t);let a;a=l=>{this.hasKey(l)&&console.warn(`[Resolver] already has key: ${l} overwriting`)},De(o).forEach(l=>{const{src:h,srcs:c}=l;let{data:u,format:d,loadParser:f}=l;const p=De(h||c).map(m=>typeof m=="string"?Q_(m):Array.isArray(m)?m:[m]),g=this.getAlias(l);Array.isArray(g)?g.forEach(a):a(g);const _=[];p.forEach(m=>{m.forEach(v=>{let y={};if(typeof v!="object"){y.src=v;for(let b=0;b<this._parsers.length;b++){const x=this._parsers[b];if(x.test(v)){y=x.parse(v);break}}}else u=v.data??u,d=v.format??d,f=v.loadParser??f,y={...y,...v};if(!g)throw new Error(`[Resolver] alias is undefined for this asset: ${y.src}`);y=this.buildResolvedAsset(y,{aliases:g,data:u,format:d,loadParser:f}),_.push(y)})}),g.forEach(m=>{this._assetMap[m]=_})})}resolveBundle(t){const e=qs(t);t=De(t);const r={};return t.forEach(s=>{const n=this._bundles[s];if(n){const o=this.resolve(n),a={};for(const l in o){const h=o[l];a[this._extractAssetIdFromBundle(s,l)]=h}r[s]=a}}),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const r={};for(const s in e)r[s]=e[s].src;return r}return e.src}resolve(t){const e=qs(t);t=De(t);const r={};return t.forEach(s=>{if(!this._resolverHash[s])if(this._assetMap[s]){let n=this._assetMap[s];const o=n[0],a=this._getPreferredOrder(n);a?.priority.forEach(l=>{a.params[l].forEach(h=>{const c=n.filter(u=>u[l]?u[l]===h:!1);c.length&&(n=c)})}),this._resolverHash[s]=n[0]??o}else this._resolverHash[s]=this.buildResolvedAsset({alias:[s],src:s},{});r[s]=this._resolverHash[s]}),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const r=t[0],s=this._preferredOrder.find(n=>n.params.format.includes(r.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:r,data:s,loadParser:n,format:o}=e;return(this._basePath||this._rootPath)&&(t.src=Kt.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=r??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...s||{},...t.data},t.loadParser=n??t.loadParser,t.format=o??Kt.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}class P0{constructor(){this._detections=[],this._initialized=!1,this.resolver=new R0,this.loader=new e0,this.cache=Or,this._backgroundLoader=new J_(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let n=t.manifest;typeof n=="string"&&(n=await this.load(n)),this.resolver.addManifest(n)}const e=t.texturePreference?.resolution??1,r=typeof e=="number"?[e]:e,s=await this._detectFormats({preferredFormats:t.texturePreference?.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:s,resolution:r}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,r,s,n){this.resolver.add(t,e,r,s,n)}async load(t,e){this._initialized||await this.init();const r=qs(t),s=De(t).map(a=>{if(typeof a!="string"){const l=this.resolver.getAlias(a);return l.some(h=>!this.resolver.hasKey(h))&&this.add(a),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),n=this.resolver.resolve(s),o=await this._mapLoadToResolve(n,e);return r?o[s[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;typeof t=="string"&&(r=!0,t=[t]);const s=this.resolver.resolveBundle(t),n={},o=Object.keys(s);let a=0,l=0;const h=()=>{e?.(++a/l)},c=o.map(u=>{const d=s[u];return l+=Object.keys(d).length,this._mapLoadToResolve(d,h).then(f=>{n[u]=f})});return await Promise.all(c),r?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return Or.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=Or.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=Object.values(t),s=Object.keys(t);this._backgroundLoader.active=!1;const n=await this.loader.load(r,e);this._backgroundLoader.active=!0;const o={};return r.forEach((a,l)=>{const h=n[a.src],c=[a.src];a.alias&&c.push(...a.alias),o[s[l]]=h,Or.set(c,h)}),o}async unload(t){this._initialized||await this.init();const e=De(t).map(s=>typeof s!="string"?s.src:s),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=De(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map(s=>this._unloadFromResolved(e[s]));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(r=>{Or.remove(r.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const r of t.detections)t.skipDetections||await r.test()?e=await r.add(e):t.skipDetections||(e=await r.remove(e));return e=e.filter((r,s)=>e.indexOf(r)===s),e}get detections(){return this._detections}get preferWorkers(){return ln.config.preferWorkers}set preferWorkers(t){_t("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(r=>r in t).forEach(r=>{e.config[r]=t[r]})})}}const fs=new P0;st.handleByList(Y.LoadParser,fs.loader.parsers).handleByList(Y.ResolveParser,fs.resolver.parsers).handleByList(Y.CacheParser,fs.cache.parsers).handleByList(Y.DetectionParser,fs.detections);const M0={extension:Y.CacheParser,test:i=>Array.isArray(i)&&i.every(t=>t instanceof it),getCacheableAssets:(i,t)=>{const e={};return i.forEach(r=>{t.forEach((s,n)=>{e[r+(n===0?"":n+1)]=s})}),e}};st.add(M0);async function Bu(i){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=i});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(i)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const B0={extension:{type:Y.DetectionParser,priority:1},test:async()=>Bu("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async i=>[...i,"avif"],remove:async i=>i.filter(t=>t!=="avif")};st.add(B0);const D0={extension:{type:Y.DetectionParser,priority:0},test:async()=>Bu("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async i=>[...i,"webp"],remove:async i=>i.filter(t=>t!=="webp")};st.add(D0);const Kl=["png","jpg","jpeg"],F0={extension:{type:Y.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...Kl],remove:async i=>i.filter(t=>!Kl.includes(t))};st.add(F0);const k0="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Ta(i){return k0?!1:document.createElement("video").canPlayType(i)!==""}const O0={extension:{type:Y.DetectionParser,priority:0},test:async()=>Ta("video/webm"),add:async i=>[...i,"webm"],remove:async i=>i.filter(t=>t!=="webm")};st.add(O0);const N0={extension:{type:Y.DetectionParser,priority:0},test:async()=>Ta("video/mp4"),add:async i=>[...i,"mp4","m4v"],remove:async i=>i.filter(t=>t!=="mp4"&&t!=="m4v")};st.add(N0);const L0={extension:{type:Y.DetectionParser,priority:0},test:async()=>Ta("video/ogg"),add:async i=>[...i,"ogv"],remove:async i=>i.filter(t=>t!=="ogv")};st.add(L0);const U0={extension:Y.ResolveParser,test:ln.test,parse:i=>({resolution:parseFloat(tt.RETINA_PREFIX.exec(i)?.[1]??"1"),format:Kt.extname(i).slice(1),src:i})};st.add(U0);var ye=(i=>(i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i))(ye||{});const Zs={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let tr,si;function $l(){si={s3tc:tr.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:tr.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:tr.getExtension("WEBGL_compressed_texture_etc"),etc1:tr.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:tr.getExtension("WEBGL_compressed_texture_pvrtc")||tr.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:tr.getExtension("WEBGL_compressed_texture_atc"),astc:tr.getExtension("WEBGL_compressed_texture_astc")}}const G0={extension:{type:Y.DetectionParser,priority:2},test:async()=>{const i=tt.ADAPTER.createCanvas().getContext("webgl");return i?(tr=i,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async i=>{si||$l();const t=[];for(const e in si)si[e]&&t.push(e);return[...t,...i]},remove:async i=>(si||$l(),i.filter(t=>!(t in si)))};st.add(G0);class H0 extends rn{constructor(t,e={width:1,height:1,autoLoad:!0}){let r,s;typeof t=="string"?(r=t,s=new Uint8Array):(r=null,s=t),super(s,e),this.origin=r,this.buffer=s?new Eo(s):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new Eo(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class Hr extends H0{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=Hr._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||Hr._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,r){const s=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;s.pixelStorei(s.UNPACK_ALIGNMENT,4);for(let n=0,o=this.levels;n<o;n++){const{levelID:a,levelWidth:l,levelHeight:h,levelBuffer:c}=this._levelBuffers[n];s.compressedTexImage2D(s.TEXTURE_2D,a,this.format,l,h,0,c)}return!0}onBlobLoaded(){this._levelBuffers=Hr._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,r,s,n,o,a){const l=new Array(r);let h=t.byteOffset,c=o,u=a,d=c+s-1&~(s-1),f=u+n-1&~(n-1),p=d*f*Zs[e];for(let g=0;g<r;g++)l[g]={levelID:g,levelWidth:r>1?c:d,levelHeight:r>1?u:f,levelBuffer:new Uint8Array(t.buffer,h,p)},h+=p,c=c>>1||1,u=u>>1||1,d=c+s-1&~(s-1),f=u+n-1&~(n-1),p=d*f*Zs[e];return l}}const Yn=4,ps=124,z0=32,Jl=20,X0=542327876,ms={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},V0={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},gs={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},W0=1,j0=2,Y0=4,q0=64,Z0=512,K0=131072,$0=827611204,J0=861165636,Q0=894720068,t1=808540228,e1=4,r1={[$0]:ye.COMPRESSED_RGBA_S3TC_DXT1_EXT,[J0]:ye.COMPRESSED_RGBA_S3TC_DXT3_EXT,[Q0]:ye.COMPRESSED_RGBA_S3TC_DXT5_EXT},i1={70:ye.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:ye.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:ye.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:ye.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:ye.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:ye.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:ye.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:ye.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:ye.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function s1(i){const t=new Uint32Array(i);if(t[0]!==X0)throw new Error("Invalid DDS file magic word");const e=new Uint32Array(i,0,ps/Uint32Array.BYTES_PER_ELEMENT),r=e[ms.HEIGHT],s=e[ms.WIDTH],n=e[ms.MIPMAP_COUNT],o=new Uint32Array(i,ms.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,z0/Uint32Array.BYTES_PER_ELEMENT),a=o[W0];if(a&Y0){const l=o[V0.FOURCC];if(l!==t1){const v=r1[l],y=Yn+ps,b=new Uint8Array(i,y);return[new Hr(b,{format:v,width:s,height:r,levels:n})]}const h=Yn+ps,c=new Uint32Array(t.buffer,h,Jl/Uint32Array.BYTES_PER_ELEMENT),u=c[gs.DXGI_FORMAT],d=c[gs.RESOURCE_DIMENSION],f=c[gs.MISC_FLAG],p=c[gs.ARRAY_SIZE],g=i1[u];if(g===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${u}`);if(f===e1)throw new Error("DDSParser does not support cubemap textures");if(d===6)throw new Error("DDSParser does not supported 3D texture data");const _=new Array,m=Yn+ps+Jl;if(p===1)_.push(new Uint8Array(i,m));else{const v=Zs[g];let y=0,b=s,x=r;for(let w=0;w<n;w++){const T=Math.max(1,b+3&-4),P=Math.max(1,x+3&-4),F=T*P*v;y+=F,b=b>>>1,x=x>>>1}let S=m;for(let w=0;w<p;w++)_.push(new Uint8Array(i,S,y)),S+=y}return _.map(v=>new Hr(v,{format:g,width:s,height:r,levels:n}))}throw a&q0?new Error("DDSParser does not support uncompressed texture data."):a&Z0?new Error("DDSParser does not supported YUV uncompressed texture data."):a&K0?new Error("DDSParser does not support single-channel (lumninance) texture data!"):a&j0?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Ql=[171,75,84,88,32,49,49,187,13,10,26,10],n1=67305985,Re={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},qo=64,th={[at.UNSIGNED_BYTE]:1,[at.UNSIGNED_SHORT]:2,[at.INT]:4,[at.UNSIGNED_INT]:4,[at.FLOAT]:4,[at.HALF_FLOAT]:8},o1={[L.RGBA]:4,[L.RGB]:3,[L.RG]:2,[L.RED]:1,[L.LUMINANCE]:1,[L.LUMINANCE_ALPHA]:2,[L.ALPHA]:1},a1={[at.UNSIGNED_SHORT_4_4_4_4]:2,[at.UNSIGNED_SHORT_5_5_5_1]:2,[at.UNSIGNED_SHORT_5_6_5]:2};function l1(i,t,e=!1){const r=new DataView(t);if(!h1(i,r))return null;const s=r.getUint32(Re.ENDIANNESS,!0)===n1,n=r.getUint32(Re.GL_TYPE,s),o=r.getUint32(Re.GL_FORMAT,s),a=r.getUint32(Re.GL_INTERNAL_FORMAT,s),l=r.getUint32(Re.PIXEL_WIDTH,s),h=r.getUint32(Re.PIXEL_HEIGHT,s)||1,c=r.getUint32(Re.PIXEL_DEPTH,s)||1,u=r.getUint32(Re.NUMBER_OF_ARRAY_ELEMENTS,s)||1,d=r.getUint32(Re.NUMBER_OF_FACES,s),f=r.getUint32(Re.NUMBER_OF_MIPMAP_LEVELS,s),p=r.getUint32(Re.BYTES_OF_KEY_VALUE_DATA,s);if(h===0||c!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(u!==1)throw new Error("WebGL does not support array textures");const g=4,_=4,m=l+3&-4,v=h+3&-4,y=new Array(u);let b=l*h;n===0&&(b=m*v);let x;if(n!==0?th[n]?x=th[n]*o1[o]:x=a1[n]:x=Zs[a],x===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const S=e?u1(r,p,s):null;let w=b*x,T=l,P=h,F=m,B=v,D=qo+p;for(let E=0;E<f;E++){const R=r.getUint32(D,s);let X=D+4;for(let q=0;q<u;q++){let U=y[q];U||(U=y[q]=new Array(f)),U[E]={levelID:E,levelWidth:f>1||n!==0?T:F,levelHeight:f>1||n!==0?P:B,levelBuffer:new Uint8Array(t,X,w)},X+=w}D+=R+4,D=D%4!==0?D+4-D%4:D,T=T>>1||1,P=P>>1||1,F=T+g-1&~(g-1),B=P+_-1&~(_-1),w=F*B*x}return n!==0?{uncompressed:y.map(E=>{let R=E[0].levelBuffer,X=!1;return n===at.FLOAT?R=new Float32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4):n===at.UNSIGNED_INT?(X=!0,R=new Uint32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4)):n===at.INT&&(X=!0,R=new Int32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4)),{resource:new rn(R,{width:E[0].levelWidth,height:E[0].levelHeight}),type:n,format:X?c1(o):o}}),kvData:S}:{compressed:y.map(E=>new Hr(null,{format:a,width:l,height:h,levels:f,levelBuffers:E})),kvData:S}}function h1(i,t){for(let e=0;e<Ql.length;e++)if(t.getUint8(e)!==Ql[e])return console.error(`${i} is not a valid *.ktx file!`),!1;return!0}function c1(i){switch(i){case L.RGBA:return L.RGBA_INTEGER;case L.RGB:return L.RGB_INTEGER;case L.RG:return L.RG_INTEGER;case L.RED:return L.RED_INTEGER;default:return i}}function u1(i,t,e){const r=new Map;let s=0;for(;s<t;){const n=i.getUint32(qo+s,e),o=qo+s+4,a=3-(n+3)%4;if(n===0||n>t-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<n&&i.getUint8(o+l)!==0;l++);if(l===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const h=new TextDecoder().decode(new Uint8Array(i.buffer,o,l)),c=new DataView(i.buffer,o+l+1,n-l-1);r.set(h,c),s+=4+n+a}return r}const d1={extension:{type:Y.LoadParser,priority:Oe.High},name:"loadDDS",test(i){return Ar(i,".dds")},async load(i,t,e){const r=await(await tt.ADAPTER.fetch(i)).arrayBuffer(),s=s1(r).map(n=>{const o=new ft(n,{mipmap:qe.OFF,alphaMode:me.NO_PREMULTIPLIED_ALPHA,resolution:ar(i),...t.data});return Zi(o,e,i)});return s.length===1?s[0]:s},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};st.add(d1);const f1={extension:{type:Y.LoadParser,priority:Oe.High},name:"loadKTX",test(i){return Ar(i,".ktx")},async load(i,t,e){const r=await(await tt.ADAPTER.fetch(i)).arrayBuffer(),{compressed:s,uncompressed:n,kvData:o}=l1(i,r),a=s??n,l={mipmap:qe.OFF,alphaMode:me.NO_PREMULTIPLIED_ALPHA,resolution:ar(i),...t.data},h=a.map(c=>{a===n&&Object.assign(l,{type:c.type,format:c.format});const u=c.resource??c,d=new ft(u,l);return d.ktxKeyValueData=o,Zi(d,e,i)});return h.length===1?h[0]:h},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};st.add(f1);const p1={extension:Y.ResolveParser,test:i=>{const t=Kt.extname(i).slice(1);return["basis","ktx","dds"].includes(t)},parse:i=>{const t=Kt.extname(i).slice(1);if(t==="ktx"){const e=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(e.some(r=>i.endsWith(r)))return{resolution:parseFloat(tt.RETINA_PREFIX.exec(i)?.[1]??"1"),format:e.find(r=>i.endsWith(r)),src:i}}return{resolution:parseFloat(tt.RETINA_PREFIX.exec(i)?.[1]??"1"),format:t,src:i}}};st.add(p1);const _s=new dt,m1=4,Du=class Mi{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,r,s){const n=new Image;return n.src=await this.base64(t,e,r,s),n}async base64(t,e,r,s){const n=this.canvas(t,s);if(n.toBlob!==void 0)return new Promise((o,a)=>{n.toBlob(l=>{if(!l){a(new Error("ICanvas.toBlob failed!"));return}const h=new FileReader;h.onload=()=>o(h.result),h.onerror=a,h.readAsDataURL(l)},e,r)});if(n.toDataURL!==void 0)return n.toDataURL(e,r);if(n.convertToBlob!==void 0){const o=await n.convertToBlob({type:e,quality:r});return new Promise((a,l)=>{const h=new FileReader;h.onload=()=>a(h.result),h.onerror=l,h.readAsDataURL(o)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:r,width:s,height:n,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,e);o&&Mi._flipY(r,s,n),a&&Mi._unpremultiplyAlpha(r);const l=new Km(s,n,1),h=new ImageData(new Uint8ClampedArray(r.buffer),s,n);return l.context.putImageData(h,0,0),l.canvas}pixels(t,e){const{pixels:r,width:s,height:n,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,e);return o&&Mi._flipY(r,s,n),a&&Mi._unpremultiplyAlpha(r),r}_rawPixels(t,e){const r=this.renderer;if(!r)throw new Error("The Extract has already been destroyed");let s,n=!1,o=!1,a,l=!1;t&&(t instanceof ae?a=t:(a=r.generateTexture(t,{region:e,resolution:r.resolution,multisample:r.multisample}),l=!0,e&&(_s.width=e.width,_s.height=e.height,e=_s)));const h=r.gl;if(a){if(s=a.baseTexture.resolution,e=e??a.frame,n=!1,o=a.baseTexture.alphaMode>0&&a.baseTexture.format===L.RGBA,!l){r.renderTexture.bind(a);const f=a.framebuffer.glFramebuffers[r.CONTEXT_UID];f.blitFramebuffer&&r.framebuffer.bind(f.blitFramebuffer)}}else s=r.resolution,e||(e=_s,e.width=r.width/s,e.height=r.height/s),n=!0,o=this._rendererPremultipliedAlpha,r.renderTexture.bind();const c=Math.max(Math.round(e.width*s),1),u=Math.max(Math.round(e.height*s),1),d=new Uint8Array(m1*c*u);return h.readPixels(Math.round(e.x*s),Math.round(e.y*s),c,u,h.RGBA,h.UNSIGNED_BYTE,d),l&&a?.destroy(!0),{pixels:d,width:c,height:u,flipY:n,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(t,e,r){const s=e<<2,n=r>>1,o=new Uint8Array(s);for(let a=0;a<n;a++){const l=a*s,h=(r-a-1)*s;o.set(t.subarray(l,l+s)),t.copyWithin(l,h,h+s),t.set(o,h)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let r=0;r<e;r+=4){const s=t[r+3];if(s!==0){const n=255.001/s;t[r]=t[r]*n+.5,t[r+1]=t[r+1]*n+.5,t[r+2]=t[r+2]*n+.5}}}};Du.extension={name:"extract",type:Y.RendererSystem};let g1=Du;st.add(g1);const Ks={build(i){const t=i.points;let e,r,s,n,o,a;if(i.type===te.CIRC){const p=i.shape;e=p.x,r=p.y,o=a=p.radius,s=n=0}else if(i.type===te.ELIP){const p=i.shape;e=p.x,r=p.y,o=p.width,a=p.height,s=n=0}else{const p=i.shape,g=p.width/2,_=p.height/2;e=p.x+g,r=p.y+_,o=a=Math.max(0,Math.min(p.radius,Math.min(g,_))),s=g-o,n=_-a}if(!(o>=0&&a>=0&&s>=0&&n>=0)){t.length=0;return}const l=Math.ceil(2.3*Math.sqrt(o+a)),h=l*8+(s?4:0)+(n?4:0);if(t.length=h,h===0)return;if(l===0){t.length=8,t[0]=t[6]=e+s,t[1]=t[3]=r+n,t[2]=t[4]=e-s,t[5]=t[7]=r-n;return}let c=0,u=l*4+(s?2:0)+2,d=u,f=h;{const p=s+o,g=n,_=e+p,m=e-p,v=r+g;if(t[c++]=_,t[c++]=v,t[--u]=v,t[--u]=m,n){const y=r-g;t[d++]=m,t[d++]=y,t[--f]=y,t[--f]=_}}for(let p=1;p<l;p++){const g=Math.PI/2*(p/l),_=s+Math.cos(g)*o,m=n+Math.sin(g)*a,v=e+_,y=e-_,b=r+m,x=r-m;t[c++]=v,t[c++]=b,t[--u]=b,t[--u]=y,t[d++]=y,t[d++]=x,t[--f]=x,t[--f]=v}{const p=s,g=n+a,_=e+p,m=e-p,v=r+g,y=r-g;t[c++]=_,t[c++]=v,t[--f]=y,t[--f]=_,s&&(t[c++]=m,t[c++]=v,t[--f]=y,t[--f]=m)}},triangulate(i,t){const e=i.points,r=t.points,s=t.indices;if(e.length===0)return;let n=r.length/2;const o=n;let a,l;if(i.type!==te.RREC){const c=i.shape;a=c.x,l=c.y}else{const c=i.shape;a=c.x+c.width/2,l=c.y+c.height/2}const h=i.matrix;r.push(i.matrix?h.a*a+h.c*l+h.tx:a,i.matrix?h.b*a+h.d*l+h.ty:l),n++,r.push(e[0],e[1]);for(let c=2;c<e.length;c+=2)r.push(e[c],e[c+1]),s.push(n++,o,n);s.push(o+1,o,n)}};function eh(i,t=!1){const e=i.length;if(e<6)return;let r=0;for(let s=0,n=i[e-2],o=i[e-1];s<e;s+=2){const a=i[s],l=i[s+1];r+=(a-n)*(l+o),n=a,o=l}if(!t&&r>0||t&&r<=0){const s=e/2;for(let n=s+s%2;n<e;n+=2){const o=e-n-2,a=e-n-1,l=n,h=n+1;[i[o],i[l]]=[i[l],i[o]],[i[a],i[h]]=[i[h],i[a]]}}}const Fu={build(i){i.points=i.shape.points.slice()},triangulate(i,t){let e=i.points;const r=i.holes,s=t.points,n=t.indices;if(e.length>=6){eh(e,!1);const o=[];for(let h=0;h<r.length;h++){const c=r[h];eh(c.points,!0),o.push(e.length/2),e=e.concat(c.points)}const a=pf(e,o,2);if(!a)return;const l=s.length/2;for(let h=0;h<a.length;h+=3)n.push(a[h]+l),n.push(a[h+1]+l),n.push(a[h+2]+l);for(let h=0;h<e.length;h++)s.push(e[h])}}},_1={build(i){const t=i.shape,e=t.x,r=t.y,s=t.width,n=t.height,o=i.points;o.length=0,s>=0&&n>=0&&o.push(e,r,e+s,r,e+s,r+n,e,r+n)},triangulate(i,t){const e=i.points,r=t.points;if(e.length===0)return;const s=r.length/2;r.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},y1={build(i){Ks.build(i)},triangulate(i,t){Ks.triangulate(i,t)}};var Te=(i=>(i.MITER="miter",i.BEVEL="bevel",i.ROUND="round",i))(Te||{}),gr=(i=>(i.BUTT="butt",i.ROUND="round",i.SQUARE="square",i))(gr||{});const yi={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(i,t=20){if(!this.adaptive||!i||isNaN(i))return t;let e=Math.ceil(i/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class rh{static curveTo(t,e,r,s,n,o){const a=o[o.length-2],l=o[o.length-1]-e,h=a-t,c=s-e,u=r-t,d=Math.abs(l*u-h*c);if(d<1e-8||n===0)return(o[o.length-2]!==t||o[o.length-1]!==e)&&o.push(t,e),null;const f=l*l+h*h,p=c*c+u*u,g=l*c+h*u,_=n*Math.sqrt(f)/d,m=n*Math.sqrt(p)/d,v=_*g/f,y=m*g/p,b=_*u+m*h,x=_*c+m*l,S=h*(m+v),w=l*(m+v),T=u*(_+y),P=c*(_+y),F=Math.atan2(w-x,S-b),B=Math.atan2(P-x,T-b);return{cx:b+t,cy:x+e,radius:n,startAngle:F,endAngle:B,anticlockwise:h*c>u*l}}static arc(t,e,r,s,n,o,a,l,h){const c=a-o,u=yi._segmentsCount(Math.abs(c)*n,Math.ceil(Math.abs(c)/Hs)*40),d=c/(u*2),f=d*2,p=Math.cos(d),g=Math.sin(d),_=u-1,m=_%1/_;for(let v=0;v<=_;++v){const y=v+m*v,b=d+o+f*y,x=Math.cos(b),S=-Math.sin(b);h.push((p*x+g*S)*n+r,(p*-S+g*x)*n+s)}}}class v1{constructor(){this.reset()}begin(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class Ea{static curveLength(t,e,r,s,n,o,a,l){let h=0,c=0,u=0,d=0,f=0,p=0,g=0,_=0,m=0,v=0,y=0,b=t,x=e;for(let S=1;S<=10;++S)c=S/10,u=c*c,d=u*c,f=1-c,p=f*f,g=p*f,_=g*t+3*p*c*r+3*f*u*n+d*a,m=g*e+3*p*c*s+3*f*u*o+d*l,v=b-_,y=x-m,b=_,x=m,h+=Math.sqrt(v*v+y*y);return h}static curveTo(t,e,r,s,n,o,a){const l=a[a.length-2],h=a[a.length-1];a.length-=2;const c=yi._segmentsCount(Ea.curveLength(l,h,t,e,r,s,n,o));let u=0,d=0,f=0,p=0,g=0;a.push(l,h);for(let _=1,m=0;_<=c;++_)m=_/c,u=1-m,d=u*u,f=d*u,p=m*m,g=p*m,a.push(f*l+3*d*m*t+3*u*p*r+g*n,f*h+3*d*m*e+3*u*p*s+g*o)}}function ih(i,t,e,r,s,n,o,a){const l=i-e*s,h=t-r*s,c=i+e*n,u=t+r*n;let d,f;o?(d=r,f=-e):(d=-r,f=e);const p=l+d,g=h+f,_=c+d,m=u+f;return a.push(p,g,_,m),2}function Ir(i,t,e,r,s,n,o,a){const l=e-i,h=r-t;let c=Math.atan2(l,h),u=Math.atan2(s-i,n-t);a&&c<u?c+=Math.PI*2:!a&&c>u&&(u+=Math.PI*2);let d=c;const f=u-c,p=Math.abs(f),g=Math.sqrt(l*l+h*h),_=(15*p*Math.sqrt(g)/Math.PI>>0)+1,m=f/_;if(d+=m,a){o.push(i,t,e,r);for(let v=1,y=d;v<_;v++,y+=m)o.push(i,t,i+Math.sin(y)*g,t+Math.cos(y)*g);o.push(i,t,s,n)}else{o.push(e,r,i,t);for(let v=1,y=d;v<_;v++,y+=m)o.push(i+Math.sin(y)*g,t+Math.cos(y)*g,i,t);o.push(s,n,i,t)}return _*2}function b1(i,t){const e=i.shape;let r=i.points||e.points.slice();const s=t.closePointEps;if(r.length===0)return;const n=i.lineStyle,o=new Et(r[0],r[1]),a=new Et(r[r.length-2],r[r.length-1]),l=e.type!==te.POLY||e.closeStroke,h=Math.abs(o.x-a.x)<s&&Math.abs(o.y-a.y)<s;if(l){r=r.slice(),h&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));const U=(o.x+a.x)*.5,lt=(a.y+o.y)*.5;r.unshift(U,lt),r.push(U,lt)}const c=t.points,u=r.length/2;let d=r.length;const f=c.length/2,p=n.width/2,g=p*p,_=n.miterLimit*n.miterLimit;let m=r[0],v=r[1],y=r[2],b=r[3],x=0,S=0,w=-(v-b),T=m-y,P=0,F=0,B=Math.sqrt(w*w+T*T);w/=B,T/=B,w*=p,T*=p;const D=n.alignment,E=(1-D)*2,R=D*2;l||(n.cap===gr.ROUND?d+=Ir(m-w*(E-R)*.5,v-T*(E-R)*.5,m-w*E,v-T*E,m+w*R,v+T*R,c,!0)+2:n.cap===gr.SQUARE&&(d+=ih(m,v,w,T,E,R,!0,c))),c.push(m-w*E,v-T*E,m+w*R,v+T*R);for(let U=1;U<u-1;++U){m=r[(U-1)*2],v=r[(U-1)*2+1],y=r[U*2],b=r[U*2+1],x=r[(U+1)*2],S=r[(U+1)*2+1],w=-(v-b),T=m-y,B=Math.sqrt(w*w+T*T),w/=B,T/=B,w*=p,T*=p,P=-(b-S),F=y-x,B=Math.sqrt(P*P+F*F),P/=B,F/=B,P*=p,F*=p;const lt=y-m,V=v-b,A=y-x,G=S-b,J=lt*A+V*G,O=V*A-G*lt,M=O<0;if(Math.abs(O)<.001*Math.abs(J)){c.push(y-w*E,b-T*E,y+w*R,b+T*R),J>=0&&(n.join===Te.ROUND?d+=Ir(y,b,y-w*E,b-T*E,y-P*E,b-F*E,c,!1)+4:d+=2,c.push(y-P*R,b-F*R,y+P*E,b+F*E));continue}const ut=(-w+m)*(-T+b)-(-w+y)*(-T+v),ct=(-P+x)*(-F+b)-(-P+y)*(-F+S),mt=(lt*ct-A*ut)/O,Pt=(G*ut-V*ct)/O,Nt=(mt-y)*(mt-y)+(Pt-b)*(Pt-b),Mt=y+(mt-y)*E,xt=b+(Pt-b)*E,St=y-(mt-y)*R,Tt=b-(Pt-b)*R,Dt=Math.min(lt*lt+V*V,A*A+G*G),z=M?E:R,Vt=Dt+z*z*g,he=Nt<=Vt;let N=n.join;if(N===Te.MITER&&Nt/g>_&&(N=Te.BEVEL),he)switch(N){case Te.MITER:{c.push(Mt,xt,St,Tt);break}case Te.BEVEL:{M?c.push(Mt,xt,y+w*R,b+T*R,Mt,xt,y+P*R,b+F*R):c.push(y-w*E,b-T*E,St,Tt,y-P*E,b-F*E,St,Tt),d+=2;break}case Te.ROUND:{M?(c.push(Mt,xt,y+w*R,b+T*R),d+=Ir(y,b,y+w*R,b+T*R,y+P*R,b+F*R,c,!0)+4,c.push(Mt,xt,y+P*R,b+F*R)):(c.push(y-w*E,b-T*E,St,Tt),d+=Ir(y,b,y-w*E,b-T*E,y-P*E,b-F*E,c,!1)+4,c.push(y-P*E,b-F*E,St,Tt));break}}else{switch(c.push(y-w*E,b-T*E,y+w*R,b+T*R),N){case Te.MITER:{M?c.push(St,Tt,St,Tt):c.push(Mt,xt,Mt,xt),d+=2;break}case Te.ROUND:{M?d+=Ir(y,b,y+w*R,b+T*R,y+P*R,b+F*R,c,!0)+2:d+=Ir(y,b,y-w*E,b-T*E,y-P*E,b-F*E,c,!1)+2;break}}c.push(y-P*E,b-F*E,y+P*R,b+F*R),d+=2}}m=r[(u-2)*2],v=r[(u-2)*2+1],y=r[(u-1)*2],b=r[(u-1)*2+1],w=-(v-b),T=m-y,B=Math.sqrt(w*w+T*T),w/=B,T/=B,w*=p,T*=p,c.push(y-w*E,b-T*E,y+w*R,b+T*R),l||(n.cap===gr.ROUND?d+=Ir(y-w*(E-R)*.5,b-T*(E-R)*.5,y-w*E,b-T*E,y+w*R,b+T*R,c,!1)+2:n.cap===gr.SQUARE&&(d+=ih(y,b,w,T,E,R,!1,c)));const X=t.indices,q=yi.epsilon*yi.epsilon;for(let U=f;U<d+f-2;++U)m=c[U*2],v=c[U*2+1],y=c[(U+1)*2],b=c[(U+1)*2+1],x=c[(U+2)*2],S=c[(U+2)*2+1],!(Math.abs(m*(b-S)+y*(S-v)+x*(v-b))<q)&&X.push(U,U+1,U+2)}function x1(i,t){let e=0;const r=i.shape,s=i.points||r.points,n=r.type!==te.POLY||r.closeStroke;if(s.length===0)return;const o=t.points,a=t.indices,l=s.length/2,h=o.length/2;let c=h;for(o.push(s[0],s[1]),e=1;e<l;e++)o.push(s[e*2],s[e*2+1]),a.push(c,c+1),c++;n&&a.push(c,h)}function sh(i,t){i.lineStyle.native?x1(i,t):b1(i,t)}class Aa{static curveLength(t,e,r,s,n,o){const a=t-2*r+n,l=e-2*s+o,h=2*r-2*t,c=2*s-2*e,u=4*(a*a+l*l),d=4*(a*h+l*c),f=h*h+c*c,p=2*Math.sqrt(u+d+f),g=Math.sqrt(u),_=2*u*g,m=2*Math.sqrt(f),v=d/g;return(_*p+g*d*(p-m)+(4*f*u-d*d)*Math.log((2*g+v+p)/(v+m)))/(4*_)}static curveTo(t,e,r,s,n){const o=n[n.length-2],a=n[n.length-1],l=yi._segmentsCount(Aa.curveLength(o,a,t,e,r,s));let h=0,c=0;for(let u=1;u<=l;++u){const d=u/l;h=o+(t-o)*d,c=a+(e-a)*d,n.push(h+(t+(r-t)*d-h)*d,c+(e+(s-e)*d-c)*d)}}}const qn={[te.POLY]:Fu,[te.CIRC]:Ks,[te.ELIP]:Ks,[te.RECT]:_1,[te.RREC]:y1},nh=[],ys=[];class $s{constructor(t,e=null,r=null,s=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=s,this.type=t.type}clone(){return new $s(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Qr=new Et,ku=class Ou extends Hc{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new js,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),ys.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),nh.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,r=null,s=null){const n=new $s(t,e,r,s);return this.graphicsData.push(n),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const r=new $s(t,null,null,e),s=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=s.lineStyle,s.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let r=0;r<e.length;++r){const s=e[r];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(t,Qr):Qr.copyFrom(t),s.shape.contains(Qr.x,Qr.y))){let n=!1;if(s.holes){for(let o=0;o<s.holes.length;o++)if(s.holes[o].shape.contains(Qr.x,Qr.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let r=null,s=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],s=r.style);for(let l=this.shapeIndex;l<e.length;l++){this.shapeIndex++;const h=e[l],c=h.fillStyle,u=h.lineStyle;qn[h.type].build(h),h.matrix&&this.transformPoints(h.points,h.matrix),(c.visible||u.visible)&&this.processHoles(h.holes);for(let d=0;d<2;d++){const f=d===0?c:u;if(!f.visible)continue;const p=f.texture.baseTexture,g=this.indices.length,_=this.points.length/2;p.wrapMode=yr.REPEAT,d===0?this.processFill(h):this.processLine(h);const m=this.points.length/2-_;m!==0&&(r&&!this._compareStyles(s,f)&&(r.end(g,_),r=null),r||(r=nh.pop()||new v1,r.begin(f,g,_),this.batches.push(r),s=f),this.addUvs(this.points,t,f.texture,_,m,f.matrix))}}const n=this.indices.length,o=this.points.length/2;if(r&&r.end(n,o),this.batches.length===0){this.batchable=!0;return}const a=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const r=this.graphicsData[t],s=r.fillStyle,n=r.lineStyle;if(s&&!s.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,r=t.length;e<r;e++){const s=t[e];for(let n=0;n<s.size;n++){const o=s.start+n;this.indicesUint16[o]=this.indicesUint16[o]-s.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<Ou.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++ft._globalBatch;for(let u=0;u<this.drawCalls.length;u++)this.drawCalls[u].texArray.clear(),ys.push(this.drawCalls[u]);this.drawCalls.length=0;const e=this.colors,r=this.textureIds;let s=ys.pop();s||(s=new Co,s.texArray=new Mo),s.texArray.count=0,s.start=0,s.size=0,s.type=We.TRIANGLES;let n=0,o=null,a=0,l=!1,h=We.TRIANGLES,c=0;this.drawCalls.push(s);for(let u=0;u<this.batches.length;u++){const d=this.batches[u],f=8,p=d.style,g=p.texture.baseTexture;l!==!!p.native&&(l=!!p.native,h=l?We.LINES:We.TRIANGLES,o=null,n=f,t++),o!==g&&(o=g,g._batchEnabled!==t&&(n===f&&(t++,n=0,s.size>0&&(s=ys.pop(),s||(s=new Co,s.texArray=new Mo),this.drawCalls.push(s)),s.start=c,s.size=0,s.texArray.count=0,s.type=h),g.touched=1,g._batchEnabled=t,g._batchLocation=n,g.wrapMode=yr.REPEAT,s.texArray.elements[s.texArray.count++]=g,n++)),s.size+=d.size,c+=d.size,a=g._batchLocation,this.addColors(e,p.color,p.alpha,d.attribSize,d.attribStart),this.addTextureIds(r,a,d.attribSize,d.attribStart)}ft._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,r=this.colors,s=this.textureIds,n=new ArrayBuffer(t.length*3*4),o=new Float32Array(n),a=new Uint32Array(n);let l=0;for(let h=0;h<t.length/2;h++)o[l++]=t[h*2],o[l++]=t[h*2+1],o[l++]=e[h*2],o[l++]=e[h*2+1],a[l++]=r[h],o[l++]=s[h];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?Fu.triangulate(t,this):qn[t.type].triangulate(t,this)}processLine(t){sh(t,this);for(let e=0;e<t.holes.length;e++)sh(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const r=t[e];qn[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let r=0;r<t.length/2;r++){const s=t[r*2],n=t[r*2+1];t[r*2]=e.a*s+e.c*n+e.tx,t[r*2+1]=e.b*s+e.d*n+e.ty}}addColors(t,e,r,s,n=0){const o=Ct.shared.setValue(e).toLittleEndianNumber(),a=Ct.shared.setValue(o).toPremultiplied(r);t.length=Math.max(t.length,n+s);for(let l=0;l<s;l++)t[n+l]=a}addTextureIds(t,e,r,s=0){t.length=Math.max(t.length,s+r);for(let n=0;n<r;n++)t[s+n]=e}addUvs(t,e,r,s,n,o=null){let a=0;const l=e.length,h=r.frame;for(;a<n;){let u=t[(s+a)*2],d=t[(s+a)*2+1];if(o){const f=o.a*u+o.c*d+o.tx;d=o.b*u+o.d*d+o.ty,u=f}a++,e.push(u/h.width,d/h.height)}const c=r.baseTexture;(h.width<c.width||h.height<c.height)&&this.adjustUvs(e,r,l,n)}adjustUvs(t,e,r,s){const n=e.baseTexture,o=1e-6,a=r+s*2,l=e.frame,h=l.width/n.width,c=l.height/n.height;let u=l.x/l.width,d=l.y/l.height,f=Math.floor(t[r]+o),p=Math.floor(t[r+1]+o);for(let g=r+2;g<a;g+=2)f=Math.min(f,Math.floor(t[g]+o)),p=Math.min(p,Math.floor(t[g+1]+o));u-=f,d-=p;for(let g=r;g<a;g+=2)t[g]=(t[g]+u)*h,t[g+1]=(t[g+1]+d)*c}};ku.BATCHABLE_SIZE=100;let w1=ku;class hn{constructor(){this.color=16777215,this.alpha=1,this.texture=it.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new hn;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=it.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Sa extends hn{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=gr.BUTT,this.join=Te.MITER,this.miterLimit=10}clone(){const t=new Sa;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=gr.BUTT,this.join=Te.MITER,this.miterLimit=10}}const Zn={},Zo=class Ms extends se{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new hn,this._lineStyle=new Sa,this._matrix=null,this._holeMode=!1,this.state=Ke.for2d(),this._geometry=t||new w1,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Ct(16777215),this.blendMode=ht.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Ms(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,r,s=.5,n=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:r,alignment:s,native:n}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:it.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:gr.BUTT,join:Te.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.width>0&&t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:r},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Gr,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Gr,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,s=r[r.length-2],n=r[r.length-1];return(s!==t||n!==e)&&r.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,r,s){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),Aa.curveTo(t,e,r,s,n),this}bezierCurveTo(t,e,r,s,n,o){return this._initCurve(),Ea.curveTo(t,e,r,s,n,o,this.currentPath.points),this}arcTo(t,e,r,s,n){this._initCurve(t,e);const o=this.currentPath.points,a=rh.curveTo(t,e,r,s,n,o);if(a){const{cx:l,cy:h,radius:c,startAngle:u,endAngle:d,anticlockwise:f}=a;this.arc(l,h,c,u,d,f)}return this}arc(t,e,r,s,n,o=!1){if(s===n)return this;if(!o&&n<=s?n+=Hs:o&&s<=n&&(s+=Hs),n-s===0)return this;const a=t+Math.cos(s)*r,l=e+Math.sin(s)*r,h=this._geometry.closePointEps;let c=this.currentPath?this.currentPath.points:null;if(c){const u=Math.abs(c[c.length-2]-a),d=Math.abs(c[c.length-1]-l);u<h&&d<h||c.push(a,l)}else this.moveTo(a,l),c=this.currentPath.points;return rh.arc(a,l,t,e,r,s,n,o,c),this}beginFill(t=0,e){return this.beginTextureFill({texture:it.WHITE,color:t,alpha:e})}normalizeColor(t){const e=Ct.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:it.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:r},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,r,s){return this.drawShape(new dt(t,e,r,s))}drawRoundedRect(t,e,r,s,n){return this.drawShape(new on(t,e,r,s,n))}drawCircle(t,e,r){return this.drawShape(new sn(t,e,r))}drawEllipse(t,e,r,s){return this.drawShape(new nn(t,e,r,s))}drawPolygon(...t){let e,r=!0;const s=t[0];s.points?(r=s.closeStroke,e=s.points):Array.isArray(t[0])?e=t[0]:e=t;const n=new Gr(e);return n.closeStroke=r,this.drawShape(n),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===te.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,r=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(t.points);for(let s=0;s<r;s++){const n=t.batches[s],o=n.style.color,a=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),l=new Float32Array(t.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),h=new Uint16Array(t.indicesUint16.buffer,n.start*2,n.size),c={vertexData:a,blendMode:e,indices:h,uvs:l,_batchRGB:Ct.shared.setValue(o).toRgbArray(),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[s]=c}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,r=this.batches.length;e<r;e++){const s=this.batches[e];s.worldAlpha=this.worldAlpha*s.alpha,t.plugins[this.pluginName].render(s)}}}_renderDirect(t){const e=this._resolveDirectShader(t),r=this._geometry,s=this.worldAlpha,n=e.uniforms,o=r.drawCalls;n.translationMatrix=this.transform.worldTransform,Ct.shared.setValue(this._tintColor).premultiply(s).toArray(n.tint),t.shader.bind(e),t.geometry.bind(r,e),t.state.set(this.state);for(let a=0,l=o.length;a<l;a++)this._renderDrawCallDirect(t,r.drawCalls[a])}_renderDrawCallDirect(t,e){const{texArray:r,type:s,size:n,start:o}=e,a=r.count;for(let l=0;l<a;l++)t.texture.bind(r.elements[l],l);t.geometry.draw(s,n,o)}_resolveDirectShader(t){let e=this.shader;const r=this.pluginName;if(!e){if(!Zn[r]){const{maxTextures:s}=t.plugins[r],n=new Int32Array(s);for(let l=0;l<s;l++)n[l]=l;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ft,default:ke.from({uSamplers:n},!0)},a=t.plugins[r]._shader.program;Zn[r]=new Ye(a,o)}e=Zn[r]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:r,maxX:s,maxY:n}=t.bounds;this._bounds.addFrame(this.transform,e,r,s,n)}containsPoint(t){return this.worldTransform.applyInverse(t,Ms._TEMP_POINT),this._geometry.containsPoint(Ms._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=Ct.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,r=e.a,s=e.b,n=e.c,o=e.d,a=e.tx,l=e.ty,h=this._geometry.points,c=this.vertexData;let u=0;for(let d=0;d<h.length;d+=2){const f=h[d],p=h[d+1];c[u++]=r*f+n*p+a,c[u++]=o*p+s*f+l}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};Zo.curves=yi,Zo._TEMP_POINT=new Et;let jr=Zo;class T1{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const Kn=new Et,oh=new Gr,Nu=class Lu extends se{constructor(t,e,r,s=We.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=r||Ke.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=tt.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===We.TRIANGLES&&e.length<Lu.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const s=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[s]),t.plugins[s].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const s=this.transform.worldTransform,n=s.a,o=s.b,a=s.c,l=s.d,h=s.tx,c=s.ty,u=this.vertexData;for(let d=0;d<u.length/2;d++){const f=e[d*2],p=e[d*2+1];u[d*2]=n*f+a*p+h,u[d*2+1]=o*f+l*p+c}if(this._roundPixels){const d=tt.RESOLUTION;for(let f=0;f<u.length;++f)u[f]=Math.round(u[f]*d)/d}this.vertexDirty=r}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new T1(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,Kn);const e=this.geometry.getBuffer("aVertexPosition").data,r=oh.points,s=this.geometry.getIndex().data,n=s.length,o=this.drawMode===4?3:1;for(let a=0;a+2<n;a+=o){const l=s[a]*2,h=s[a+1]*2,c=s[a+2]*2;if(r[0]=e[l],r[1]=e[l+1],r[2]=e[h],r[3]=e[h+1],r[4]=e[c],r[5]=e[c+1],oh.contains(Kn.x,Kn.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};Nu.BATCHABLE_SIZE=100;let ah=Nu;class E1 extends xr{constructor(t,e,r){super();const s=new Xt(t),n=new Xt(e,!0),o=new Xt(r,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,at.FLOAT).addAttribute("aTextureCoord",n,2,!1,at.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var A1=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,S1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class lh extends Ye{constructor(t,e){const r={uSampler:t,alpha:1,uTextureMatrix:Ft.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(r,e.uniforms),super(e.program||nr.from(S1,A1),r),this._colorDirty=!1,this.uvMatrix=new eu(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new Ct(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;Ct.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class hh{constructor(t,e,r){this.geometry=new xr,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<t.length;++s){let n=t[s];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||at.FLOAT,offset:n.offset},e[s]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new Xt(qm(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=e,e+=a.size,this.dynamicStride+=a.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new Xt(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=s,s+=a.size,this.staticStride+=a.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new Xt(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===at.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===at.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(t,e,r){for(let s=0;s<this.dynamicProperties.length;s++){const n=this.dynamicProperties[s];n.uploadFunction(t,e,r,n.type===at.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,r){for(let s=0;s<this.staticProperties.length;s++){const n=this.staticProperties[s];n.uploadFunction(t,e,r,n.type===at.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var C1=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,I1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Uu extends an{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Ft,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:at.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Ye.from(I1,C1,{}),this.state=Ke.for2d()}render(t){const e=t.children,r=t._maxSize,s=t._batchSize,n=this.renderer;let o=e.length;if(o===0)return;o>r&&!t.autoResize&&(o=r);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const l=e[0]._texture.baseTexture,h=l.alphaMode>0;this.state.blendMode=Lc(t.blendMode,h),n.state.set(this.state);const c=n.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=Ct.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<o;f+=s,p+=1){let g=o-f;g>s&&(g=s),p>=a.length&&a.push(this._generateOneMoreBuffer(t));const _=a[p];_.uploadDynamic(e,f,g);const m=t._bufferUpdateIDs[p]||0;d=d||_._updateID<m,d&&(_._updateID=t._updateID,_.uploadStatic(e,f,g)),n.geometry.bind(_.geometry),c.drawElements(c.TRIANGLES,g*6,c.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],r=t._maxSize,s=t._batchSize,n=t._properties;for(let o=0;o<r;o+=s)e.push(new hh(this.properties,n,s));return e}_generateOneMoreBuffer(t){const e=t._batchSize,r=t._properties;return new hh(this.properties,r,e)}uploadVertices(t,e,r,s,n,o){let a=0,l=0,h=0,c=0;for(let u=0;u<r;++u){const d=t[e+u],f=d._texture,p=d.scale.x,g=d.scale.y,_=f.trim,m=f.orig;_?(l=_.x-d.anchor.x*m.width,a=l+_.width,c=_.y-d.anchor.y*m.height,h=c+_.height):(a=m.width*(1-d.anchor.x),l=m.width*-d.anchor.x,h=m.height*(1-d.anchor.y),c=m.height*-d.anchor.y),s[o]=l*p,s[o+1]=c*g,s[o+n]=a*p,s[o+n+1]=c*g,s[o+n*2]=a*p,s[o+n*2+1]=h*g,s[o+n*3]=l*p,s[o+n*3+1]=h*g,o+=n*4}}uploadPosition(t,e,r,s,n,o){for(let a=0;a<r;a++){const l=t[e+a].position;s[o]=l.x,s[o+1]=l.y,s[o+n]=l.x,s[o+n+1]=l.y,s[o+n*2]=l.x,s[o+n*2+1]=l.y,s[o+n*3]=l.x,s[o+n*3+1]=l.y,o+=n*4}}uploadRotation(t,e,r,s,n,o){for(let a=0;a<r;a++){const l=t[e+a].rotation;s[o]=l,s[o+n]=l,s[o+n*2]=l,s[o+n*3]=l,o+=n*4}}uploadUvs(t,e,r,s,n,o){for(let a=0;a<r;++a){const l=t[e+a]._texture._uvs;l?(s[o]=l.x0,s[o+1]=l.y0,s[o+n]=l.x1,s[o+n+1]=l.y1,s[o+n*2]=l.x2,s[o+n*2+1]=l.y2,s[o+n*3]=l.x3,s[o+n*3+1]=l.y3,o+=n*4):(s[o]=0,s[o+1]=0,s[o+n]=0,s[o+n+1]=0,s[o+n*2]=0,s[o+n*2+1]=0,s[o+n*3]=0,s[o+n*3+1]=0,o+=n*4)}}uploadTint(t,e,r,s,n,o){for(let a=0;a<r;++a){const l=t[e+a],h=Ct.shared.setValue(l._tintRGB).toPremultiplied(l.alpha,l.texture.baseTexture.alphaMode>0);s[o]=h,s[o+n]=h,s[o+n*2]=h,s[o+n*3]=h,o+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Uu.extension={name:"particle",type:Y.RendererPlugin};st.add(Uu);var cn=(i=>(i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",i))(cn||{});const vs={willReadFrequently:!0},He=class nt{static get experimentalLetterSpacingSupported(){let t=nt._experimentalLetterSpacingSupported;if(t!==void 0){const e=tt.ADAPTER.getCanvasRenderingContext2D().prototype;t=nt._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,r,s,n,o,a,l,h){this.text=t,this.style=e,this.width=r,this.height=s,this.lines=n,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=h}static measureText(t,e,r,s=nt._canvas){r=r??e.wordWrap;const n=e.toFontString(),o=nt.measureFont(n);o.fontSize===0&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);const a=s.getContext("2d",vs);a.font=n;const l=(r?nt.wordWrap(t,e,s):t).split(/(?:\r\n|\r|\n)/),h=new Array(l.length);let c=0;for(let p=0;p<l.length;p++){const g=nt._measureText(l[p],e.letterSpacing,a);h[p]=g,c=Math.max(c,g)}let u=c+e.strokeThickness;e.dropShadow&&(u+=e.dropShadowDistance);const d=e.lineHeight||o.fontSize+e.strokeThickness;let f=Math.max(d,o.fontSize+e.strokeThickness*2)+e.leading+(l.length-1)*(d+e.leading);return e.dropShadow&&(f+=e.dropShadowDistance),new nt(t,e,u,f,l,h,d+e.leading,c,o)}static _measureText(t,e,r){let s=!1;nt.experimentalLetterSpacingSupported&&(nt.experimentalLetterSpacing?(r.letterSpacing=`${e}px`,r.textLetterSpacing=`${e}px`,s=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let n=r.measureText(t).width;return n>0&&(s?n-=e:n+=(nt.graphemeSegmenter(t).length-1)*e),n}static wordWrap(t,e,r=nt._canvas){const s=r.getContext("2d",vs);let n=0,o="",a="";const l=Object.create(null),{letterSpacing:h,whiteSpace:c}=e,u=nt.collapseSpaces(c),d=nt.collapseNewlines(c);let f=!u;const p=e.wordWrapWidth+h,g=nt.tokenize(t);for(let _=0;_<g.length;_++){let m=g[_];if(nt.isNewline(m)){if(!d){a+=nt.addLine(o),f=!u,o="",n=0;continue}m=" "}if(u){const y=nt.isBreakingSpace(m),b=nt.isBreakingSpace(o[o.length-1]);if(y&&b)continue}const v=nt.getFromCache(m,h,l,s);if(v>p)if(o!==""&&(a+=nt.addLine(o),o="",n=0),nt.canBreakWords(m,e.breakWords)){const y=nt.wordWrapSplit(m);for(let b=0;b<y.length;b++){let x=y[b],S=x,w=1;for(;y[b+w];){const P=y[b+w];if(!nt.canBreakChars(S,P,m,b,e.breakWords))x+=P;else break;S=P,w++}b+=w-1;const T=nt.getFromCache(x,h,l,s);T+n>p&&(a+=nt.addLine(o),f=!1,o="",n=0),o+=x,n+=T}}else{o.length>0&&(a+=nt.addLine(o),o="",n=0);const y=_===g.length-1;a+=nt.addLine(m,!y),f=!1,o="",n=0}else v+n>p&&(f=!1,a+=nt.addLine(o),o="",n=0),(o.length>0||!nt.isBreakingSpace(m)||f)&&(o+=m,n+=v)}return a+=nt.addLine(o,!1),a}static addLine(t,e=!0){return t=nt.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,r,s){let n=r[t];return typeof n!="number"&&(n=nt._measureText(t,e,s)+e,r[t]=n),n}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const r=t[e];if(!nt.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:nt._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:nt._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let r="";if(typeof t!="string")return e;for(let s=0;s<t.length;s++){const n=t[s],o=t[s+1];if(nt.isBreakingSpace(n,o)||nt.isNewline(n)){r!==""&&(e.push(r),r=""),e.push(n);continue}r+=n}return r!==""&&e.push(r),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,s,n){return!0}static wordWrapSplit(t){return nt.graphemeSegmenter(t)}static measureFont(t){if(nt._fonts[t])return nt._fonts[t];const e={ascent:0,descent:0,fontSize:0},r=nt._canvas,s=nt._context;s.font=t;const n=nt.METRICS_STRING+nt.BASELINE_SYMBOL,o=Math.ceil(s.measureText(n).width);let a=Math.ceil(s.measureText(nt.BASELINE_SYMBOL).width);const l=Math.ceil(nt.HEIGHT_MULTIPLIER*a);if(a=a*nt.BASELINE_MULTIPLIER|0,o===0||l===0)return nt._fonts[t]=e,e;r.width=o,r.height=l,s.fillStyle="#f00",s.fillRect(0,0,o,l),s.font=t,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(n,0,a);const h=s.getImageData(0,0,o,l).data,c=h.length,u=o*4;let d=0,f=0,p=!1;for(d=0;d<a;++d){for(let g=0;g<u;g+=4)if(h[f+g]!==255){p=!0;break}if(!p)f+=u;else break}for(e.ascent=a-d,f=c-u,p=!1,d=l;d>a;--d){for(let g=0;g<u;g+=4)if(h[f+g]!==255){p=!0;break}if(!p)f-=u;else break}return e.descent=d-a,e.fontSize=e.ascent+e.descent,nt._fonts[t]=e,e}static clearMetrics(t=""){t?delete nt._fonts[t]:nt._fonts={}}static get _canvas(){if(!nt.__canvas){let t;try{const e=new OffscreenCanvas(0,0);if(e.getContext("2d",vs)?.measureText)return nt.__canvas=e,e;t=tt.ADAPTER.createCanvas()}catch{t=tt.ADAPTER.createCanvas()}t.width=t.height=10,nt.__canvas=t}return nt.__canvas}static get _context(){return nt.__context||(nt.__context=nt._canvas.getContext("2d",vs)),nt.__context}};He.METRICS_STRING="|ÉqÅ",He.BASELINE_SYMBOL="M",He.BASELINE_MULTIPLIER=1.4,He.HEIGHT_MULTIPLIER=2,He.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){const i=new Intl.Segmenter;return t=>[...i.segment(t)].map(e=>e.segment)}return i=>[...i]})(),He.experimentalLetterSpacing=!1,He._fonts={},He._newlines=[10,13],He._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let dr=He;const R1=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Gu=class Bi{constructor(t){this.styleID=0,this.reset(),Jn(this,t,t)}clone(){const t={};return Jn(t,this,Bi.defaultStyle),new Bi(t)}reset(){Jn(this,Bi.defaultStyle,Bi.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=$n(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=$n(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){P1(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=$n(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let r=e.length-1;r>=0;r--){let s=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!R1.includes(s)&&(s=`"${s}"`),e[r]=s}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};Gu.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:cn.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Tr=Gu;function $n(i){const t=Ct.shared,e=r=>{const s=t.setValue(r);return s.alpha===1?s.toHex():s.toRgbaString()};return Array.isArray(i)?i.map(e):e(i)}function P1(i,t){if(!Array.isArray(i)||!Array.isArray(t)||i.length!==t.length)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}function Jn(i,t,e){for(const r in e)Array.isArray(t[r])?i[r]=t[r].slice():i[r]=t[r]}const M1={texture:!0,children:!1,baseTexture:!0},Hu=class Ko extends ue{constructor(t,e,r){let s=!1;r||(r=tt.ADAPTER.createCanvas(),s=!0),r.width=3,r.height=3;const n=it.from(r);n.orig=new dt,n.trim=new dt,super(n),this._ownCanvas=s,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=Ko.defaultResolution??tt.RESOLUTION,this._autoResolution=Ko.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return dr.experimentalLetterSpacing}static set experimentalLetterSpacing(t){_t("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),dr.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const r=this.context,s=dr.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=s.width,o=s.height,a=s.lines,l=s.lineHeight,h=s.lineWidths,c=s.maxLineWidth,u=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+e.padding*2)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=e.strokeThickness,r.textBaseline=e.textBaseline,r.lineJoin=e.lineJoin,r.miterLimit=e.miterLimit;let d,f;const p=e.dropShadow?2:1;for(let g=0;g<p;++g){const _=e.dropShadow&&g===0,m=_?Math.ceil(Math.max(1,o)+e.padding*2):0,v=m*this._resolution;if(_){r.fillStyle="black",r.strokeStyle="black";const b=e.dropShadowColor,x=e.dropShadowBlur*this._resolution,S=e.dropShadowDistance*this._resolution;r.shadowColor=Ct.shared.setValue(b).setAlpha(e.dropShadowAlpha).toRgbaString(),r.shadowBlur=x,r.shadowOffsetX=Math.cos(e.dropShadowAngle)*S,r.shadowOffsetY=Math.sin(e.dropShadowAngle)*S+v}else r.fillStyle=this._generateFillStyle(e,a,s),r.strokeStyle=e.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let y=(l-u.fontSize)/2;l-u.fontSize<0&&(y=0);for(let b=0;b<a.length;b++)d=e.strokeThickness/2,f=e.strokeThickness/2+b*l+u.ascent+y,e.align==="right"?d+=c-h[b]:e.align==="center"&&(d+=(c-h[b])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[b],d+e.padding,f+e.padding-m,!0),e.fill&&this.drawLetterSpacing(a[b],d+e.padding,f+e.padding-m)}this.updateTexture()}drawLetterSpacing(t,e,r,s=!1){const n=this._style.letterSpacing;let o=!1;if(dr.experimentalLetterSpacingSupported&&(dr.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||o){s?this.context.strokeText(t,e,r):this.context.fillText(t,e,r);return}let a=e;const l=dr.graphemeSegmenter(t);let h=this.context.measureText(t).width,c=0;for(let u=0;u<l.length;++u){const d=l[u];s?this.context.strokeText(d,a,r):this.context.fillText(d,a,r);let f="";for(let p=u+1;p<l.length;++p)f+=l[p];c=this.context.measureText(f).width,a+=h-c+n,h=c}}updateTexture(){const t=this.canvas;if(this._style.trim){const o=Jm(t);o.data&&(t.width=o.width,t.height=o.height,this.context.putImageData(o.data,0,0))}const e=this._texture,r=this._style,s=r.trim?0:r.padding,n=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),n.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,r){const s=t.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;let n;const o=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,l=this.canvas.width/this._resolution-o-a*2,h=this.canvas.height/this._resolution-o-a*2,c=s.slice(),u=t.fillGradientStops.slice();if(!u.length){const d=c.length+1;for(let f=1;f<d;++f)u.push(f/d)}if(c.unshift(s[0]),u.unshift(0),c.push(s[s.length-1]),u.push(1),t.fillGradientType===cn.LINEAR_VERTICAL){n=this.context.createLinearGradient(l/2,a,l/2,h+a);const d=r.fontProperties.fontSize+t.strokeThickness;for(let f=0;f<e.length;f++){const p=r.lineHeight*(f-1)+d,g=r.lineHeight*f;let _=g;f>0&&p>g&&(_=(g+p)/2);const m=g+d,v=r.lineHeight*(f+1);let y=m;f+1<e.length&&v<m&&(y=(m+v)/2);const b=(y-_)/h;for(let x=0;x<c.length;x++){let S=0;typeof u[x]=="number"?S=u[x]:S=x/c.length;let w=Math.min(1,Math.max(0,_/h+S*b));w=Number(w.toFixed(5)),n.addColorStop(w,c[x])}}}else{n=this.context.createLinearGradient(a,h/2,l+a,h/2);const d=c.length+1;let f=1;for(let p=0;p<c.length;p++){let g;typeof u[p]=="number"?g=u[p]:g=f/d,n.addColorStop(g,c[p]),f++}}return n}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},M1,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=mr(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=mr(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof Tr?this._style=t:this._style=new Tr(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};Hu.defaultAutoResolution=!0;let zu=Hu;class B1{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function D1(i,t){let e=!1;if(i?._textures?.length){for(let r=0;r<i._textures.length;r++)if(i._textures[r]instanceof it){const s=i._textures[r].baseTexture;t.includes(s)||(t.push(s),e=!0)}}return e}function F1(i,t){if(i.baseTexture instanceof ft){const e=i.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function k1(i,t){if(i._texture&&i._texture instanceof it){const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function O1(i,t){return t instanceof zu?(t.updateText(!0),!0):!1}function N1(i,t){if(t instanceof Tr){const e=t.toFontString();return dr.measureFont(e),!0}return!1}function L1(i,t){if(i instanceof zu){t.includes(i.style)||t.push(i.style),t.includes(i)||t.push(i);const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function U1(i,t){return i instanceof Tr?(t.includes(i)||t.push(i),!0):!1}const Xu=class Vu{constructor(t){this.limiter=new B1(Vu.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(L1),this.registerFindHook(U1),this.registerFindHook(D1),this.registerFindHook(F1),this.registerFindHook(k1),this.registerUploadHook(O1),this.registerUploadHook(N1)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,ve.system.addOnce(this.tick,this,Wr.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let r=0,s=this.uploadHooks.length;r<s;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)ve.system.addOnce(this.tick,this,Wr.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,r=t.length;e<r;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof se)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&ve.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Xu.uploadsPerFrame=4;let $o=Xu;Object.defineProperties(tt,{UPLOADS_PER_FRAME:{get(){return $o.uploadsPerFrame},set(i){_t("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),$o.uploadsPerFrame=i}}});function Wu(i,t){return t instanceof ft?(t._glTextures[i.CONTEXT_UID]||i.texture.bind(t),!0):!1}function G1(i,t){if(!(t instanceof jr))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:r}=e;for(let s=0;s<r.length;s++){const{texture:n}=r[s].style;n&&Wu(i,n.baseTexture)}return e.batchable||i.geometry.bind(e,t._resolveDirectShader(i)),!0}function H1(i,t){return i instanceof jr?(t.push(i),!0):!1}class ju extends $o{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(H1),this.registerUploadHook(Wu),this.registerUploadHook(G1)}}ju.extension={name:"prepare",type:Y.RendererSystem};st.add(ju);var z1=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,X1=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,V1=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,ch=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,W1=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const bs=new Ft;class Yu extends an{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new $c,this.state=Ke.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Ye.from(ch,W1,e),this.shader=t.context.webGLVersion>1?Ye.from(X1,z1,e):Ye.from(ch,V1,e)}render(t){const e=this.renderer,r=this.quad;let s=r.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y);const n=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;s=r.uvs,s[0]=s[6]=-n,s[1]=s[3]=-o,s[2]=s[4]=1-n,s[5]=s[7]=1-o,r.invalidate();const a=t._texture,l=a.baseTexture,h=l.alphaMode>0,c=t.tileTransform.localTransform,u=t.uvMatrix;let d=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;d&&(l._glTextures[e.CONTEXT_UID]?d=l.wrapMode!==yr.CLAMP:l.wrapMode===yr.CLAMP&&(l.wrapMode=yr.REPEAT));const f=d?this.simpleShader:this.shader,p=a.width,g=a.height,_=t._width,m=t._height;bs.set(c.a*p/_,c.b*p/m,c.c*g/_,c.d*g/m,c.tx/_,c.ty/m),bs.invert(),d?bs.prepend(u.mapCoord):(f.uniforms.uMapCoord=u.mapCoord.toArray(!0),f.uniforms.uClampFrame=u.uClampFrame,f.uniforms.uClampOffset=u.uClampOffset),f.uniforms.uTransform=bs.toArray(!0),f.uniforms.uColor=Ct.shared.setValue(t.tint).premultiply(t.worldAlpha,h).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=a,e.shader.bind(f),e.geometry.bind(r),this.state.blendMode=Lc(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Yu.extension={name:"tilingSprite",type:Y.RendererPlugin};st.add(Yu);const qu=class Di{constructor(t,e,r=null){this.linkedSheets=[],this._texture=t instanceof it?t:null,this.baseTexture=t instanceof ft?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const s=this.baseTexture.resource;this.resolution=this._updateResolution(r||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let r=ar(t,null);return r===null&&(r=parseFloat(e??"1")),r!==1&&this.baseTexture.setResolution(r),r}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Di.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const r=Di.BATCH_SIZE;for(;e-t<r&&e<this._frameKeys.length;){const s=this._frameKeys[e],n=this._frames[s],o=n.frame;if(o){let a=null,l=null;const h=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,c=new dt(0,0,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution);n.rotated?a=new dt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new dt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(l=new dt(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[s]=new it(this.baseTexture,a,c,l,n.rotated?2:0,n.anchor,n.borders),it.addToCache(this.textures[s],s.toString())}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let r=0;r<t[e].length;r++){const s=t[e][r];this.animations[e].push(this.textures[s])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Di.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Di.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};qu.BATCH_SIZE=1e3;let uh=qu;const j1=["jpg","png","jpeg","avif","webp"];function Zu(i,t,e){const r={};if(i.forEach(s=>{r[s]=t}),Object.keys(t.textures).forEach(s=>{r[s]=t.textures[s]}),!e){const s=Kt.dirname(i[0]);t.linkedSheets.forEach((n,o)=>{const a=Zu([`${s}/${t.data.meta.related_multi_packs[o]}`],n,!0);Object.assign(r,a)})}return r}const Y1={extension:Y.Asset,cache:{test:i=>i instanceof uh,getCacheableAssets:(i,t)=>Zu(i,t,!1)},resolver:{test:i=>{const t=i.split("?")[0].split("."),e=t.pop(),r=t.pop();return e==="json"&&j1.includes(r)},parse:i=>{const t=i.split(".");return{resolution:parseFloat(tt.RETINA_PREFIX.exec(i)?.[1]??"1"),format:t[t.length-2],src:i}}},loader:{name:"spritesheetLoader",extension:{type:Y.LoadParser,priority:Oe.Normal},async testParse(i,t){return Kt.extname(t.src).toLowerCase()===".json"&&!!i.frames},async parse(i,t,e){let r=Kt.dirname(t.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");let s=r+i.meta.image;s=Yo(s,t.src);const n=(await e.load([s]))[s],o=new uh(n.baseTexture,i,t.src);await o.parse();const a=i?.meta?.related_multi_packs;if(Array.isArray(a)){const l=[];for(const c of a){if(typeof c!="string")continue;let u=r+c;t.data?.ignoreMultiPack||(u=Yo(u,t.src),l.push(e.load({src:u,data:{ignoreMultiPack:!0}})))}const h=await Promise.all(l);o.linkedSheets=h,h.forEach(c=>{c.linkedSheets=[o].concat(o.linkedSheets.filter(u=>u!==c))})}return o},unload(i){i.destroy(!0)}}};st.add(Y1);class Js{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Bs{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const n in e){const o=e[n].match(/^[a-z]+/gm)[0],a=e[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(const h in a){const c=a[h].split("="),u=c[0],d=c[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;l[u]=p}r[o].push(l)}const s=new Js;return r.info.forEach(n=>s.info.push({face:n.face,size:parseInt(n.size,10)})),r.common.forEach(n=>s.common.push({lineHeight:parseInt(n.lineHeight,10)})),r.page.forEach(n=>s.page.push({id:parseInt(n.id,10),file:n.file})),r.char.forEach(n=>s.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),r.kerning.forEach(n=>s.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),r.distanceField.forEach(n=>s.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),s}}class Jo{static test(t){const e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new Js,r=t.getElementsByTagName("info"),s=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),l=t.getElementsByTagName("distanceField");for(let h=0;h<r.length;h++)e.info.push({face:r[h].getAttribute("face"),size:parseInt(r[h].getAttribute("size"),10)});for(let h=0;h<s.length;h++)e.common.push({lineHeight:parseInt(s[h].getAttribute("lineHeight"),10)});for(let h=0;h<n.length;h++)e.page.push({id:parseInt(n[h].getAttribute("id"),10)||0,file:n[h].getAttribute("file")});for(let h=0;h<o.length;h++){const c=o[h];e.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(let h=0;h<a.length;h++)e.kerning.push({first:parseInt(a[h].getAttribute("first"),10),second:parseInt(a[h].getAttribute("second"),10),amount:parseInt(a[h].getAttribute("amount"),10)});for(let h=0;h<l.length;h++)e.distanceField.push({fieldType:l[h].getAttribute("fieldType"),distanceRange:parseInt(l[h].getAttribute("distanceRange"),10)});return e}}class Qo{static test(t){return typeof t=="string"&&t.includes("<font>")?Jo.test(tt.ADAPTER.parseXML(t)):!1}static parse(t){return Jo.parse(tt.ADAPTER.parseXML(t))}}const Qn=[Bs,Jo,Qo];function q1(i){for(let t=0;t<Qn.length;t++)if(Qn[t].test(i))return Qn[t];return null}function Z1(i,t,e,r,s,n){const o=e.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a;const l=e.dropShadow?e.dropShadowDistance:0,h=e.padding||0,c=i.width/r-l-h*2,u=i.height/r-l-h*2,d=o.slice(),f=e.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let g=1;g<p;++g)f.push(g/p)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),e.fillGradientType===cn.LINEAR_VERTICAL){a=t.createLinearGradient(c/2,h,c/2,u+h);let p=0;const g=(n.fontProperties.fontSize+e.strokeThickness)/u;for(let _=0;_<s.length;_++){const m=n.lineHeight*_;for(let v=0;v<d.length;v++){let y=0;typeof f[v]=="number"?y=f[v]:y=v/d.length;const b=m/u+y*g;let x=Math.max(p,b);x=Math.min(x,1),a.addColorStop(x,d[v]),p=x}}}else{a=t.createLinearGradient(h,u/2,c+h,u/2);const p=d.length+1;let g=1;for(let _=0;_<d.length;_++){let m;typeof f[_]=="number"?m=f[_]:m=g/p,a.addColorStop(m,d[_]),g++}}return a}function K1(i,t,e,r,s,n,o){const a=e.text,l=e.fontProperties;t.translate(r,s),t.scale(n,n);const h=o.strokeThickness/2,c=-(o.strokeThickness/2);if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=Z1(i,t,o,n,[a],e),t.strokeStyle=o.stroke,o.dropShadow){const u=o.dropShadowColor,d=o.dropShadowBlur*n,f=o.dropShadowDistance*n;t.shadowColor=Ct.shared.setValue(u).setAlpha(o.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*f,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*f}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,h,c+e.lineHeight-l.descent),o.fill&&t.fillText(a,h,c+e.lineHeight-l.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function Ds(i){return i.codePointAt?i.codePointAt(0):i.charCodeAt(0)}function Ku(i){return Array.from?Array.from(i):i.split("")}function $1(i){typeof i=="string"&&(i=[i]);const t=[];for(let e=0,r=i.length;e<r;e++){const s=i[e];if(Array.isArray(s)){if(s.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);const n=s[0].charCodeAt(0),o=s[1].charCodeAt(0);if(o<n)throw new Error("[BitmapFont]: Invalid character range.");for(let a=n,l=o;a<=l;a++)t.push(String.fromCharCode(a))}else t.push(...Ku(s))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const hr=class ze{constructor(t,e,r){const[s]=t.info,[n]=t.common,[o]=t.page,[a]=t.distanceField,l=ar(o.file),h={};this._ownsTextures=r,this.font=s.face,this.size=s.size,this.lineHeight=n.lineHeight/l,this.chars={},this.pageTextures=h;for(let c=0;c<t.page.length;c++){const{id:u,file:d}=t.page[c];h[u]=e instanceof Array?e[c]:e[d],a?.fieldType&&a.fieldType!=="none"&&(h[u].baseTexture.alphaMode=me.NO_PREMULTIPLIED_ALPHA,h[u].baseTexture.mipmap=qe.OFF)}for(let c=0;c<t.char.length;c++){const{id:u,page:d}=t.char[c];let{x:f,y:p,width:g,height:_,xoffset:m,yoffset:v,xadvance:y}=t.char[c];f/=l,p/=l,g/=l,_/=l,m/=l,v/=l,y/=l;const b=new dt(f+h[d].frame.x/l,p+h[d].frame.y/l,g,_);this.chars[u]={xOffset:m,yOffset:v,xAdvance:y,kerning:{},texture:new it(h[d].baseTexture,b),page:d}}for(let c=0;c<t.kerning.length;c++){let{first:u,second:d,amount:f}=t.kerning[c];u/=l,d/=l,f/=l,this.chars[d]&&(this.chars[d].kerning[u]=f)}this.distanceFieldRange=a?.distanceRange,this.distanceFieldType=a?.fieldType?.toLowerCase()??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,r){let s;if(t instanceof Js)s=t;else{const o=q1(t);if(!o)throw new Error("Unrecognized data format for font.");s=o.parse(t)}e instanceof it&&(e=[e]);const n=new ze(s,e,r);return ze.available[n.font]=n,n}static uninstall(t){const e=ze.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete ze.available[t]}static from(t,e,r){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:s,padding:n,resolution:o,textureWidth:a,textureHeight:l,...h}=Object.assign({},ze.defaultOptions,r),c=$1(s),u=e instanceof Tr?e:new Tr(e),d=a,f=new Js;f.info[0]={face:u.fontFamily,size:u.fontSize},f.common[0]={lineHeight:u.fontSize};let p=0,g=0,_,m,v,y=0;const b=[];for(let S=0;S<c.length;S++){_||(_=tt.ADAPTER.createCanvas(),_.width=a,_.height=l,m=_.getContext("2d"),v=new ft(_,{resolution:o,...h}),b.push(new it(v)),f.page.push({id:b.length-1,file:""}));const w=c[S],T=dr.measureText(w,u,!1,_),P=T.width,F=Math.ceil(T.height),B=Math.ceil((u.fontStyle==="italic"?2:1)*P);if(g>=l-F*o){if(g===0)throw new Error(`[BitmapFont] textureHeight ${l}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${w}')`);--S,_=null,m=null,v=null,g=0,p=0,y=0;continue}if(y=Math.max(F+T.fontProperties.descent,y),B*o+p>=d){if(p===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${w}')`);--S,g+=y*o,g=Math.ceil(g),p=0,y=0;continue}K1(_,m,T,p,g,o,u);const D=Ds(T.text);f.char.push({id:D,page:b.length-1,x:p/o,y:g/o,width:B,height:F,xoffset:0,yoffset:0,xadvance:P-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0)}),p+=(B+2*n)*o,p=Math.ceil(p)}if(!r?.skipKerning)for(let S=0,w=c.length;S<w;S++){const T=c[S];for(let P=0;P<w;P++){const F=c[P],B=m.measureText(T).width,D=m.measureText(F).width,E=m.measureText(T+F).width-(B+D);E&&f.kerning.push({first:Ds(T),second:Ds(F),amount:E})}}const x=new ze(f,b,!0);return ze.available[t]!==void 0&&ze.uninstall(t),ze.available[t]=x,x}};hr.ALPHA=[["a","z"],["A","Z"]," "],hr.NUMERIC=[["0","9"]],hr.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],hr.ASCII=[[" ","~"]],hr.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:hr.ALPHANUMERIC},hr.available={};let cr=hr;var J1=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,Q1=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const dh=[],fh=[],ph=[],ty=class $u extends se{constructor(t,e={}){super();const{align:r,tint:s,maxWidth:n,letterSpacing:o,fontName:a,fontSize:l}=Object.assign({},$u.styleDefaults,e);if(!cr.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tintColor=new Ct(s),this._font=void 0,this._fontName=a,this._fontSize=l,this.text=t,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new sr(()=>{this.dirty=!0},this,0,0),this._roundPixels=tt.ROUND_PIXELS,this.dirty=!0,this._resolution=tt.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const t=cr.available[this._fontName],e=this.fontSize,r=e/t.size,s=new Et,n=[],o=[],a=[],l=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",h=Ku(l),c=this._maxWidth*t.size/e,u=t.distanceFieldType==="none"?dh:fh;let d=null,f=0,p=0,g=0,_=-1,m=0,v=0,y=0,b=0;for(let B=0;B<h.length;B++){const D=h[B],E=Ds(D);if(/(?:\s)/.test(D)&&(_=B,m=f,b++),D==="\r"||D===`
`){o.push(f),a.push(-1),p=Math.max(p,f),++g,++v,s.x=0,s.y+=t.lineHeight,d=null,b=0;continue}const R=t.chars[E];if(!R)continue;d&&R.kerning[d]&&(s.x+=R.kerning[d]);const X=ph.pop()||{texture:it.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Et};X.texture=R.texture,X.line=g,X.charCode=E,X.position.x=Math.round(s.x+R.xOffset+this._letterSpacing/2),X.position.y=Math.round(s.y+R.yOffset),X.prevSpaces=b,n.push(X),f=X.position.x+Math.max(R.xAdvance-R.xOffset,R.texture.orig.width),s.x+=R.xAdvance+this._letterSpacing,y=Math.max(y,R.yOffset+R.texture.height),d=E,_!==-1&&c>0&&s.x>c&&(++v,di(n,1+_-v,1+B-_),B=_,_=-1,o.push(m),a.push(n.length>0?n[n.length-1].prevSpaces:0),p=Math.max(p,m),g++,s.x=0,s.y+=t.lineHeight,d=null,b=0)}const x=h[h.length-1];x!=="\r"&&x!==`
`&&(/(?:\s)/.test(x)&&(f=m),o.push(f),p=Math.max(p,f),a.push(-1));const S=[];for(let B=0;B<=g;B++){let D=0;this._align==="right"?D=p-o[B]:this._align==="center"?D=(p-o[B])/2:this._align==="justify"&&(D=a[B]<0?0:(p-o[B])/a[B]),S.push(D)}const w=n.length,T={},P=[],F=this._activePagesMeshData;u.push(...F);for(let B=0;B<w;B++){const D=n[B].texture,E=D.baseTexture.uid;if(!T[E]){let R=u.pop();if(!R){const q=new E1;let U,lt;t.distanceFieldType==="none"?(U=new lh(it.EMPTY),lt=ht.NORMAL):(U=new lh(it.EMPTY,{program:nr.from(Q1,J1),uniforms:{uFWidth:0}}),lt=ht.NORMAL_NPM);const V=new ah(q,U);V.blendMode=lt,R={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:V,vertices:null,uvs:null,indices:null}}R.index=0,R.indexCount=0,R.vertexCount=0,R.uvsCount=0,R.total=0;const{_textureCache:X}=this;X[E]=X[E]||new it(D.baseTexture),R.mesh.texture=X[E],R.mesh.tint=this._tintColor.value,P.push(R),T[E]=R}T[E].total++}for(let B=0;B<F.length;B++)P.includes(F[B])||this.removeChild(F[B].mesh);for(let B=0;B<P.length;B++)P[B].mesh.parent!==this&&this.addChild(P[B].mesh);this._activePagesMeshData=P;for(const B in T){const D=T[B],E=D.total;if(!(D.indices?.length>6*E)||D.vertices.length<ah.BATCHABLE_SIZE*2)D.vertices=new Float32Array(4*2*E),D.uvs=new Float32Array(4*2*E),D.indices=new Uint16Array(6*E);else{const R=D.total,X=D.vertices;for(let q=R*4*2;q<X.length;q++)X[q]=0}D.mesh.size=6*E}for(let B=0;B<w;B++){const D=n[B];let E=D.position.x+S[D.line]*(this._align==="justify"?D.prevSpaces:1);this._roundPixels&&(E=Math.round(E));const R=E*r,X=D.position.y*r,q=D.texture,U=T[q.baseTexture.uid],lt=q.frame,V=q._uvs,A=U.index++;U.indices[A*6+0]=0+A*4,U.indices[A*6+1]=1+A*4,U.indices[A*6+2]=2+A*4,U.indices[A*6+3]=0+A*4,U.indices[A*6+4]=2+A*4,U.indices[A*6+5]=3+A*4,U.vertices[A*8+0]=R,U.vertices[A*8+1]=X,U.vertices[A*8+2]=R+lt.width*r,U.vertices[A*8+3]=X,U.vertices[A*8+4]=R+lt.width*r,U.vertices[A*8+5]=X+lt.height*r,U.vertices[A*8+6]=R,U.vertices[A*8+7]=X+lt.height*r,U.uvs[A*8+0]=V.x0,U.uvs[A*8+1]=V.y0,U.uvs[A*8+2]=V.x1,U.uvs[A*8+3]=V.y1,U.uvs[A*8+4]=V.x2,U.uvs[A*8+5]=V.y2,U.uvs[A*8+6]=V.x3,U.uvs[A*8+7]=V.y3}this._textWidth=p*r,this._textHeight=(s.y+t.lineHeight)*r;for(const B in T){const D=T[B];if(this.anchor.x!==0||this.anchor.y!==0){let q=0;const U=this._textWidth*this.anchor.x,lt=this._textHeight*this.anchor.y;for(let V=0;V<D.total;V++)D.vertices[q++]-=U,D.vertices[q++]-=lt,D.vertices[q++]-=U,D.vertices[q++]-=lt,D.vertices[q++]-=U,D.vertices[q++]-=lt,D.vertices[q++]-=U,D.vertices[q++]-=lt}this._maxLineHeight=y*r;const E=D.mesh.geometry.getBuffer("aVertexPosition"),R=D.mesh.geometry.getBuffer("aTextureCoord"),X=D.mesh.geometry.getIndex();E.data=D.vertices,R.data=D.uvs,X.data=D.indices,E.update(),R.update(),X.update()}for(let B=0;B<n.length;B++)ph.push(n[B]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:r,size:s}=cr.available[this._fontName];if(r!=="none"){const{a:n,b:o,c:a,d:l}=this.worldTransform,h=Math.sqrt(n*n+o*o),c=Math.sqrt(a*a+l*l),u=(Math.abs(h)+Math.abs(c))/2,d=this.fontSize/s,f=t._view.resolution;for(const p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=u*e*d*f}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=cr.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!cr.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??cr.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,r=cr.available[this._fontName].distanceFieldType==="none"?dh:fh;r.push(...this._activePagesMeshData);for(const s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],r.filter(s=>e[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=it.EMPTY});for(const s in e)e[s].destroy(),delete e[s];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};ty.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const ey=[".xml",".fnt"],ry={extension:{type:Y.LoadParser,priority:Oe.Normal},name:"loadBitmapFont",test(i){return ey.includes(Kt.extname(i).toLowerCase())},async testParse(i){return Bs.test(i)||Qo.test(i)},async parse(i,t,e){const r=Bs.test(i)?Bs.parse(i):Qo.parse(i),{src:s}=t,{page:n}=r,o=[];for(let h=0;h<n.length;++h){const c=n[h].file;let u=Kt.join(Kt.dirname(s),c);u=Yo(u,s),o.push(u)}const a=await e.load(o),l=o.map(h=>a[h]);return cr.install(r,l,!0)},async load(i,t){return(await tt.ADAPTER.fetch(i)).text()},unload(i){i.destroy()}};st.add(ry);const ta=class ni extends Tr{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new ni(Object.keys(ni.defaultOptions).reduce((e,r)=>({...e,[r]:t[r]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete ni.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:r}=ni;if(r[t]){const s=r[t];return this._fonts.push(s),s.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return tt.ADAPTER.fetch(t).then(s=>s.blob()).then(async s=>new Promise((n,o)=>{const a=URL.createObjectURL(s),l=new FileReader;l.onload=()=>n([a,l.result]),l.onerror=o,l.readAsDataURL(s)})).then(async([s,n])=>{const o=Object.assign({family:Kt.basename(t,Kt.extname(t)),weight:"normal",style:"normal",display:"auto",src:s,dataSrc:n,refs:1,originalUrl:t,fontFace:null},e);r[t]=o,this._fonts.push(o),this.styleID++;const a=new FontFace(o.family,`url(${o.src})`,{weight:o.weight,style:o.style,display:o.display});o.fontFace=a,await a.load(),document.fonts.add(a),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){const e=t.filter(r=>!this._overrides.includes(r));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(r=>this._overrides.includes(r));e.length>0&&(this._overrides=this._overrides.filter(r=>!e.includes(r)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style};
                font-display: ${e.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=jm(t)),typeof t=="number"?Wm(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),s=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));const n=`${r}px ${s}px`;return this.dropShadowBlur>0?`text-shadow: ${n} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${n} ${t}`}reset(){Object.assign(this,ni.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=tt.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};ta.availableFonts={},ta.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let to=ta;const xs=class oi extends ue{constructor(t="",e={}){super(it.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const r=new Image,s=it.from(r,{scaleMode:tt.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new dt,s.trim=new dt,this.texture=s;const n="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",a=document.createElementNS(n,"svg"),l=document.createElementNS(n,"foreignObject"),h=document.createElementNS(o,"div"),c=document.createElementNS(o,"style");l.setAttribute("width","10000"),l.setAttribute("height","10000"),l.style.overflow="hidden",a.appendChild(l),this.maxWidth=oi.defaultMaxWidth,this.maxHeight=oi.defaultMaxHeight,this._domElement=h,this._styleElement=c,this._svgRoot=a,this._foreignObject=l,this._foreignObject.appendChild(c),this._foreignObject.appendChild(h),this._image=r,this._loadImage=new Image,this._autoResolution=oi.defaultAutoResolution,this._resolution=oi.defaultResolution??tt.RESOLUTION,this.text=t,this.style=e}measureText(t){const{text:e,style:r,resolution:s}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:r.toCSS(s)}),this._styleElement.textContent=r.toGlobalCSS(),document.body.appendChild(this._svgRoot);const n=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:o,height:a}=n;(o>this.maxWidth||a>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const l=Math.min(this.maxWidth,Math.ceil(o)),h=Math.min(this.maxHeight,Math.ceil(a));return this._svgRoot.setAttribute("width",l.toString()),this._svgRoot.setAttribute("height",h.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),r!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(s)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:l+r.padding*2,height:h+r.padding*2}}async updateText(t=!0){const{style:e,_image:r,_loadImage:s}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:n,height:o}=this.measureText();r.width=s.width=Math.ceil(Math.max(1,n)),r.height=s.height=Math.ceil(Math.max(1,o)),this._updateID++;const a=this._updateID;await new Promise(l=>{s.onload=async()=>{if(a<this._updateID){l();return}await e.onBeforeDraw(),r.src=s.src,s.onload=null,s.src="",this.updateTexture(),l()};const h=new XMLSerializer().serializeToString(this._svgRoot);s.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(h)}`})}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:r,resolution:s}=this,{padding:n}=t,{baseTexture:o}=e;e.trim.width=e._frame.width=r.width/s,e.trim.height=e._frame.height=r.height/s,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-n*2,e.orig.height=e._frame.height-n*2,this._onTextureUpdate(),o.setRealSize(r.width,r.height,s),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},oi.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=e,this._svgRoot?.remove(),this._svgRoot=e,this._domElement?.remove(),this._domElement=e,this._foreignObject?.remove(),this._foreignObject=e,this._styleElement?.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=mr(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=mr(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof to?(this.ownsStyle=!1,this._style=t):t instanceof Tr?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=to.from(t)):(this.ownsStyle=!0,this._style=new to(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};xs.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},xs.defaultMaxWidth=2024,xs.defaultMaxHeight=2024,xs.defaultAutoResolution=!0;const iy=`
precision highp float;

uniform sampler2D uDrawingTexture;
uniform sampler2D uEraserTexture;

varying vec2 vTextureCoord;

void main(void) {
	vec4 drawingColor = texture2D(uDrawingTexture,vTextureCoord);
	vec4 eraserColor = texture2D(uEraserTexture, vTextureCoord);

	// Use the alpha of the eraser to determine how much to "erase" from the drawing
	float alpha = 1.0 - eraserColor.a;
	gl_FragColor = vec4(drawingColor.rgb * alpha, drawingColor.a * alpha);
}`;function mh(i,t){if(t<0||t>=i.length-1)throw new Error("Index out of bounds");[i[t],i[t+1]]=[i[t+1],i[t]]}function sy(){let i=[],t=0;return{add_layer:function(e,r,s,n,o){let a,l,h=this;return{execute:function(){a=new se,t++,a.zIndex=t;const c=ae.create({width:s,height:n}),u=new ue(c);a.addChild(u),u.zIndex=t;const d={draw_texture:ae.create({width:s,height:n}),erase_texture:ae.create({width:s,height:n}),composite:u},f=new ie(void 0,iy,{uEraserTexture:d.erase_texture,uDrawingTexture:d.draw_texture});u.filters=[f],e.addChild(a),i.push(d),h.layers.update(p=>[...p,d]),h.active_layer.set(d),l=mn(h.layers).length-1,o&&r.render(o,{renderTexture:d.draw_texture})},undo:function(){e.removeChild(a),i=mn(h.layers),i=i.filter((u,d)=>d!==l),h.layers.set(i);const c=i[l-1]||i[0]||null;h.active_layer.set(c)}}},swap_layers:function(e,r){return r==="up"?mh(i,e):mh(i,e-1),i[e]},change_active_layer:function(e){return this.active_layer.set(mn(this.layers)[e]),i[e]},reset(){i.forEach(e=>{e.draw_texture.destroy(!0),e.erase_texture.destroy(!0),e.composite.destroy(!0)}),i=[],t=0,this.active_layer.set(null),this.layers.set([])},async add_layer_from_blob(e,r,s,n){const o=await createImageBitmap(s),a=it.from(o),[l,h]=ny(a.width,a.height,n.width,n.height),c=new ue(a);return c.zIndex=0,c.width=l,c.height=h,this.add_layer(e,r,n.width,n.height,c)},get_layers(){return i},layers:re([]),active_layer:re(null)}}function ny(i,t,e,r){if(i<=e&&t<=r)return[i,t];const s=i/t,n=e/r;let o,a;return s>n?(o=e,a=e/s):(a=r,o=r*s),[o,a]}function oy({target:i,dimensions:[t,e],antialias:r}){const s=window.devicePixelRatio||1,n=new Ru({width:t,height:e,antialias:r,backgroundAlpha:0,eventMode:"static"}),o=n.view;n.stage.sortableChildren=!0,o.style.maxWidth=`${t/s}px`,o.style.maxHeight=`${e/s}px`,o.style.width="100%",o.style.height="100%",i.appendChild(n.view);const a=new se;a.zIndex=0;const l=new se;l.zIndex=1,l.sortableChildren=!0;const h=new se;h.zIndex=1;const c=new se;c.zIndex=0,h.addChild(a),h.addChild(l),n.stage.addChild(h),n.stage.addChild(c);const u=new jr;let d=ae.create({width:t,height:e});const f=new ue(d);h.mask=f,n.render();function p(m,v){a.removeChildren(),u.beginFill(16777215,1),u.drawRect(0,0,m,v),u.endFill(),d=ae.create({width:m,height:v}),n.renderer.render(u,{renderTexture:d});const y=new ue(d);h.mask=y}function g(m,v){n.renderer.resize(m,v),o.style.maxWidth=`${m/s}px`,o.style.maxHeight=`${v/s}px`,p(m,v)}async function _(m,v,[y,b]){const x=await eo(n.renderer,a,v,y,b),S=await Promise.all(m.map(T=>eo(n.renderer,T.composite,v,y,b))),w=await eo(n.renderer,h,v,y,b);return{background:x,layers:S,composite:w}}return{layer_container:l,renderer:n.renderer,destroy:()=>n.destroy(!0),view:n.view,background_container:a,mask_container:h,resize:g,get_blobs:_}}function Ju(i){const t=new jr;return t.eventMode="none",t.zIndex=i,t}function pe(i,t,e){return i<t?t:i>e?e:i}function eo(i,t,e,r,s){return new Promise(n=>{const o=i.extract.canvas(t,new dt(0,0,r,s));let a=document.createElement("canvas");a.width=e.width,a.height=e.height;let l=a.getContext("2d");if(!l)throw n(null),new Error("Could not create canvas context");l.drawImage(o,e.x,e.y,e.width,e.height,0,0,e.width,e.height),a.toBlob?.(h=>{h||n(null),n(h)})})}function ro(i,t,e,r=new Ct("black"),s){const n=new Ct(r);i.beginFill(n),i.drawCircle(t,e,s),i.endFill()}function ay(i,t){let e=[];const r=t.x-i.x,s=t.y-i.y,n=Math.sqrt(r*r+s*s),o=Math.ceil(n/2),a=r/o,l=s/o;for(let h=0;h<o;h++){const c=i.x+h*a,u=i.y+h*l;e.push({x:c,y:u})}return e}function ly(i,t,e,r){const s=[];let n,o,a,l=!1,h=0;return{drawing:!1,start:function({x:c,y:u,size:d,color:f=new Ct("black"),opacity:p,set_initial_texture:g=!0}){g&&(a=ae.create({width:e.draw_texture.width,height:e.draw_texture.height}),i.render(e.composite,{renderTexture:a})),n={x:c,y:u,size:d,color:f,opacity:p},s.push({x:c,y:u}),o=Ju(h++),ro(o,c,u,f,d),i.render(o,{renderTexture:r==="draw"?e.draw_texture:e.erase_texture,clear:!1}),this.drawing=!0},continue:function({x:c,y:u}){const d=s[s.length-1],f=ay(d,{x:c,y:u});for(let p=0;p<f.length;p++){const{x:g,y:_}=f[p];ro(o,g,_,n.color,n.size),s.push({x:g,y:_})}i.render(o,{renderTexture:r==="draw"?e.draw_texture:e.erase_texture,clear:!1}),o.clear()},stop:function(){const c=ae.create({width:e.draw_texture.width,height:e.draw_texture.height});i.render(e.composite,{renderTexture:c}),i.render(new ue(c),{renderTexture:e.draw_texture});const u=new jr().beginFill(0,0).drawRect(0,0,e.erase_texture.width,e.erase_texture.height).endFill();i.render(u,{renderTexture:e.erase_texture,clear:!0}),l=!0,this.drawing=!1},execute:function(){if(!l){for(let c=1;c<s.length;c++){const{x:u,y:d}=s[c];ro(o,u,d,n.color,n.size)}i.render(o,{renderTexture:r==="draw"?e.draw_texture:e.erase_texture,clear:!1}),this.stop()}},undo:function(){const c=new jr().beginFill(0,0).drawRect(0,0,e.erase_texture.width,e.erase_texture.height).endFill();i.render(new ue(a),{renderTexture:e.draw_texture}),i.render(c,{renderTexture:e.erase_texture,clear:!0}),this.stop(),l=!1}}}function Ca(i,t){const e=r=>{i&&!i.contains(r.target)&&!r.defaultPrevented&&t(r)};return document.addEventListener("mousedown",e,!0),{destroy(){document.removeEventListener("mousedown",e,!0)}}}function hy(i){let t,e,r=`translate(${i[1][0]}px,${i[1][1]}px)`,s,n,o,a=`translateX(${i[3]}px)`,l,h;return{c(){t=et("div"),e=et("div"),s=pt(),n=et("div"),o=et("div"),C(e,"class","marker svelte-90y9cx"),rt(e,"transform",r),rt(e,"background",i[0]),C(t,"class","color-gradient svelte-90y9cx"),rt(t,"--hue",i[2]),C(o,"class","marker svelte-90y9cx"),rt(o,"background","hsl("+i[2]+", 100%, 50%)"),rt(o,"transform",a),C(n,"class","hue-slider svelte-90y9cx")},m(c,u){Z(c,t,u),j(t,e),i[10](t),Z(c,s,u),Z(c,n,u),j(n,o),i[11](n),l||(h=[It(window,"mousemove",i[8]),It(window,"mouseup",i[9]),It(t,"mousedown",i[7]),It(n,"mousedown",i[6])],l=!0)},p(c,[u]){u&2&&r!==(r=`translate(${c[1][0]}px,${c[1][1]}px)`)&&rt(e,"transform",r),u&1&&rt(e,"background",c[0]),u&4&&rt(t,"--hue",c[2]),u&4&&rt(o,"background","hsl("+c[2]+", 100%, 50%)"),u&8&&a!==(a=`translateX(${c[3]}px)`)&&rt(o,"transform",a)},i:Rt,o:Rt,d(c){c&&(K(t),K(s),K(n)),i[10](null),i[11](null),l=!1,Yr(h)}}}function gh(i){const t=i.s,e=i.v;let r=t*e;const s=i.h/60;let n=r*(1-Math.abs(s%2-1));const o=e-r;r=r+o,n=n+o;const a=Math.floor(s)%6,l=[r,n,o,o,n,r][a],h=[n,r,r,n,o,o][a],c=[o,o,n,r,r,n][a];return`rgba(${l*255}, ${h*255}, ${c*255}, ${i.a})`}function cy(i,t,e){let{color:r="rgb(255, 255, 255)"}=t,s=[0,0],n=null,o=!1,a=[0,0],l=0,h=0,c=null,u=!1;function d(w){c=w.currentTarget.getBoundingClientRect(),u=!0,f(w.clientX)}function f(w){if(!c)return;const T=pe(w-c.left,0,c.width);e(3,h=T);const P=T/c.width*360;e(2,l=P),e(0,r=gh({h:P,s:a[0],v:a[1],a:1}))}function p(w,T){if(!n)return;const P=pe(w-n.left,0,n.width),F=pe(T-n.top,0,n.height);e(1,s=[P,F]);const B={h:l*1,s:P/n.width,v:1-F/n.height,a:1};a=[B.s,B.v],e(0,r=gh(B))}function g(w){o=!0,n=w.currentTarget.getBoundingClientRect(),p(w.clientX,w.clientY)}function _(w){o&&p(w.clientX,w.clientY),u&&f(w.clientX)}function m(){o&&(o=!1),u&&(u=!1)}async function v(w){if(o||u||(await br(),!w))return;n||(n=y.getBoundingClientRect()),c||(c=b.getBoundingClientRect());const T=_r(w).toHsv(),P=T.s*n.width,F=(1-T.v)*n.height;e(1,s=[P,F]),a=[T.s,T.v],e(2,l=T.h),e(3,h=T.h/360*c.width)}let y,b;function x(w){At[w?"unshift":"push"](()=>{y=w,e(4,y)})}function S(w){At[w?"unshift":"push"](()=>{b=w,e(5,b)})}return i.$$set=w=>{"color"in w&&e(0,r=w.color)},i.$$.update=()=>{i.$$.dirty&1&&v(r)},[r,s,l,h,y,b,d,g,_,m,x,S]}class uy extends kt{constructor(t){super(),Ot(this,t,cy,hy,Lt,{color:0})}get color(){return this.$$.ctx[0]}set color(t){this.$$set({color:t}),I()}}function _h(i,t,e){const r=i.slice();return r[14]=t[e],r[16]=e,r}function yh(i,t,e){const r=i.slice();return r[14]=t[e],r[16]=e,r}function vh(i){let t;return{c(){t=et("span"),C(t,"class","svelte-287ern"),ot(t,"lg",i[1])},m(e,r){Z(e,t,r)},p(e,r){r&2&&ot(t,"lg",e[1])},d(e){e&&K(t)}}}function bh(i){let t,e,r,s,n,o=ce(i[1]),a=[];for(let l=0;l<o.length;l+=1)a[l]=xh(yh(i,o,l));return{c(){t=et("div");for(let l=0;l<a.length;l+=1)a[l].c();e=pt(),r=et("button"),C(r,"class","color colorpicker svelte-287ern"),ot(r,"hidden",!i[0]),C(t,"class","swatch svelte-287ern")},m(l,h){Z(l,t,h);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(t,null);j(t,e),j(t,r),s||(n=It(r,"click",i[5]),s=!0)},p(l,h){if(h&22){o=ce(l[1]);let c;for(c=0;c<o.length;c+=1){const u=yh(l,o,c);a[c]?a[c].p(u,h):(a[c]=xh(u),a[c].c(),a[c].m(t,e))}for(;c<a.length;c+=1)a[c].d(1);a.length=o.length}h&1&&ot(r,"hidden",!l[0])},d(l){l&&K(t),Gi(a,l),s=!1,n()}}}function xh(i){let t,e,r;function s(){return i[10](i[16],i[14])}return{c(){t=et("button"),C(t,"class","color svelte-287ern"),rt(t,"background-color",i[14]),ot(t,"empty",i[14]===null),ot(t,"selected",`edit-${i[16]}`===i[2])},m(n,o){Z(n,t,o),e||(r=It(t,"click",s),e=!0)},p(n,o){i=n,o&2&&rt(t,"background-color",i[14]),o&2&&ot(t,"empty",i[14]===null),o&4&&ot(t,"selected",`edit-${i[16]}`===i[2])},d(n){n&&K(t),e=!1,r()}}}function wh(i){let t,e,r;function s(){return i[11](i[16],i[14])}return{c(){t=et("button"),C(t,"class","color svelte-287ern"),rt(t,"background-color",i[14]),ot(t,"empty",i[14]===null),ot(t,"selected",`select-${i[16]}`===i[2])},m(n,o){Z(n,t,o),e||(r=It(t,"click",s),e=!0)},p(n,o){i=n,o&8&&rt(t,"background-color",i[14]),o&8&&ot(t,"empty",i[14]===null),o&4&&ot(t,"selected",`select-${i[16]}`===i[2])},d(n){n&&K(t),e=!1,r()}}}function dy(i){let t,e,r,s,n,o,a,l,h,c=!i[0]&&vh(i);s=new Fd({});let u=i[1]&&bh(i),d=ce(i[3]),f=[];for(let p=0;p<d.length;p+=1)f[p]=wh(_h(i,d,p));return{c(){c&&c.c(),t=pt(),e=et("div"),r=et("span"),yt(s.$$.fragment),n=pt(),o=et("div"),u&&u.c(),a=pt(),l=et("menu");for(let p=0;p<f.length;p+=1)f[p].c();C(r,"class","icon-wrap svelte-287ern"),C(l,"class","swatch svelte-287ern"),C(e,"class","swatch-wrap svelte-287ern")},m(p,g){c&&c.m(p,g),Z(p,t,g),Z(p,e,g),j(e,r),vt(s,r,null),j(e,n),j(e,o),u&&u.m(o,null),j(o,a),j(o,l);for(let _=0;_<f.length;_+=1)f[_]&&f[_].m(l,null);h=!0},p(p,[g]){if(p[0]?c&&(c.d(1),c=null):c?c.p(p,g):(c=vh(p),c.c(),c.m(t.parentNode,t)),p[1]?u?u.p(p,g):(u=bh(p),u.c(),u.m(o,a)):u&&(u.d(1),u=null),g&28){d=ce(p[3]);let _;for(_=0;_<d.length;_+=1){const m=_h(p,d,_);f[_]?f[_].p(m,g):(f[_]=wh(m),f[_].c(),f[_].m(l,null))}for(;_<f.length;_+=1)f[_].d(1);f.length=d.length}},i(p){h||(H(s.$$.fragment,p),h=!0)},o(p){$(s.$$.fragment,p),h=!1},d(p){p&&(K(t),K(e)),c&&c.d(p),bt(s),u&&u.d(),Gi(f,p)}}}function fy(i,t,e){let r,{selected_color:s}=t,{colors:n}=t,{user_colors:o=[]}=t,{show_empty:a=!1}=t,{current_mode:l="hex"}=t,{color_picker:h=!1}=t;const c=Ze();function u(m,v){return v==="hex"?_r(m).toHexString():v==="rgb"?_r(m).toRgbString():_r(m).toHslString()}let d=`select-${n.findIndex(m=>u(m,l)===u(s,l))}`;function f(m,v){e(2,d=`${m}-${v.index}`),c(m,v)}function p(){c("select",{index:null,color:s}),e(0,h=!h)}const g=(m,v)=>f("edit",{index:m,color:v}),_=(m,v)=>f("select",{index:m,color:v});return i.$$set=m=>{"selected_color"in m&&e(6,s=m.selected_color),"colors"in m&&e(7,n=m.colors),"user_colors"in m&&e(1,o=m.user_colors),"show_empty"in m&&e(8,a=m.show_empty),"current_mode"in m&&e(9,l=m.current_mode),"color_picker"in m&&e(0,h=m.color_picker)},i.$$.update=()=>{i.$$.dirty&384&&e(3,r=a?n:n.filter(m=>m))},[h,o,d,r,f,p,s,n,a,l,g,_]}class py extends kt{constructor(t){super(),Ot(this,t,fy,dy,Lt,{selected_color:6,colors:7,user_colors:1,show_empty:8,current_mode:9,color_picker:0})}get selected_color(){return this.$$.ctx[6]}set selected_color(t){this.$$set({selected_color:t}),I()}get colors(){return this.$$.ctx[7]}set colors(t){this.$$set({colors:t}),I()}get user_colors(){return this.$$.ctx[1]}set user_colors(t){this.$$set({user_colors:t}),I()}get show_empty(){return this.$$.ctx[8]}set show_empty(t){this.$$set({show_empty:t}),I()}get current_mode(){return this.$$.ctx[9]}set current_mode(t){this.$$set({current_mode:t}),I()}get color_picker(){return this.$$.ctx[0]}set color_picker(t){this.$$set({color_picker:t}),I()}}function Th(i,t,e){const r=i.slice();return r[11]=t[e][0],r[12]=t[e][1],r}function my(i){let t,e;return t=new yd({}),{c(){yt(t.$$.fragment)},m(r,s){vt(t,r,s),e=!0},i(r){e||(H(t.$$.fragment,r),e=!0)},o(r){$(t.$$.fragment,r),e=!1},d(r){bt(t,r)}}}function Eh(i){let t,e,r;function s(){return i[8](i[12])}return{c(){t=et("button"),t.textContent=`${i[11]}`,C(t,"class","button svelte-w84deg"),ot(t,"active",i[1]===i[12])},m(n,o){Z(n,t,o),e||(r=It(t,"click",s),e=!0)},p(n,o){i=n,o&10&&ot(t,"active",i[1]===i[12])},d(n){n&&K(t),e=!1,r()}}}function gy(i){let t,e,r,s,n,o,a,l,h,c,u,d,f,p=i[5]&&my(),g=ce(i[3]),_=[];for(let m=0;m<g.length;m+=1)_[m]=Eh(Th(i,g,m));return{c(){t=et("div"),e=et("button"),r=pt(),s=et("div"),n=et("div"),o=et("input"),a=pt(),l=et("button"),p&&p.c(),h=pt(),c=et("div");for(let m=0;m<_.length;m+=1)_[m].c();C(e,"class","swatch svelte-w84deg"),rt(e,"background",i[0]),C(o,"type","text"),o.value=i[2],C(o,"class","svelte-w84deg"),C(l,"class","eyedropper svelte-w84deg"),C(n,"class","input-wrap svelte-w84deg"),C(c,"class","buttons svelte-w84deg"),C(t,"class","input svelte-w84deg")},m(m,v){Z(m,t,v),j(t,e),j(t,r),j(t,s),j(s,n),j(n,o),j(n,a),j(n,l),p&&p.m(l,null),j(s,h),j(s,c);for(let y=0;y<_.length;y+=1)_[y]&&_[y].m(c,null);u=!0,d||(f=[It(e,"click",i[6]),It(o,"change",i[7]),It(l,"click",i[4])],d=!0)},p(m,[v]){if(v&1&&rt(e,"background",m[0]),(!u||v&4&&o.value!==m[2])&&(o.value=m[2]),v&10){g=ce(m[3]);let y;for(y=0;y<g.length;y+=1){const b=Th(m,g,y);_[y]?_[y].p(b,v):(_[y]=Eh(b),_[y].c(),_[y].m(c,null))}for(;y<_.length;y+=1)_[y].d(1);_.length=g.length}},i(m){u||(H(p),u=!0)},o(m){$(p),u=!1},d(m){m&&K(t),p&&p.d(),Gi(_,m),d=!1,Yr(f)}}}function _y(i,t,e){let r,{color:s}=t,{current_mode:n="hex"}=t;const o=Ze(),a=[["Hex","hex"],["RGB","rgb"],["HSL","hsl"]];function l(p,g){return g==="hex"?_r(p).toHexString():g==="rgb"?_r(p).toRgbString():_r(p).toHslString()}function h(){new EyeDropper().open().then(g=>{e(0,s=g.sRGBHex)})}const c=!!window.EyeDropper;function u(){o("selected",r),o("close")}const d=p=>e(0,s=p.currentTarget.value),f=p=>e(1,n=p);return i.$$set=p=>{"color"in p&&e(0,s=p.color),"current_mode"in p&&e(1,n=p.current_mode)},i.$$.update=()=>{i.$$.dirty&3&&e(2,r=l(s,n)),i.$$.dirty&4&&r&&o("selected",r)},[s,n,r,a,h,c,u,d,f]}class yy extends kt{constructor(t){super(),Ot(this,t,_y,gy,Lt,{color:0,current_mode:1})}get color(){return this.$$.ctx[0]}set color(t){this.$$set({color:t}),I()}get current_mode(){return this.$$.ctx[1]}set current_mode(t){this.$$set({current_mode:t}),I()}}function vy(i){let t,e,r,s,n,o,a,l,h;return Ui(i[11]),r=new Sd({}),{c(){t=et("div"),e=et("span"),yt(r.$$.fragment),s=pt(),n=et("input"),C(e,"class","svelte-12m4nbd"),C(n,"type","range"),C(n,"min",i[1]),C(n,"max",i[2]),C(n,"step",1),C(n,"class","svelte-12m4nbd"),C(t,"class","wrap svelte-12m4nbd"),Ui(()=>i[15].call(t)),ot(t,"right",i[8]),ot(t,"top",i[9]),ot(t,"bottom",!i[9])},m(c,u){Z(c,t,u),j(t,e),vt(r,e,null),j(t,s),j(t,n),Ia(n,i[0]),i[14](t),o=na(t,i[15].bind(t)),a=!0,l||(h=[It(window,"resize",i[11]),It(n,"change",i[12]),It(n,"input",i[12]),aa(Ca.call(null,t,i[13]))],l=!0)},p(c,[u]){(!a||u&2)&&C(n,"min",c[1]),(!a||u&4)&&C(n,"max",c[2]),u&1&&Ia(n,c[0]),(!a||u&256)&&ot(t,"right",c[8]),(!a||u&512)&&ot(t,"top",c[9]),(!a||u&512)&&ot(t,"bottom",!c[9])},i(c){a||(H(r.$$.fragment,c),a=!0)},o(c){$(r.$$.fragment,c),a=!1},d(c){c&&K(t),bt(r),i[14](null),o(),l=!1,Yr(h)}}}function by(i,t,e){let{selected_size:r}=t,{min:s}=t,{max:n}=t;const o=Ze();let a=0,l=0,h=0,c=0,u,d=!1,f=!1;function p(){e(4,l=window.innerHeight),e(3,a=window.innerWidth)}function g(){r=nd(this.value),e(0,r)}const _=()=>o("click_outside");function m(y){At[y?"unshift":"push"](()=>{u=y,e(7,u)})}function v(){h=this.clientWidth,c=this.clientHeight,e(5,h),e(6,c)}return i.$$set=y=>{"selected_size"in y&&e(0,r=y.selected_size),"min"in y&&e(1,s=y.min),"max"in y&&e(2,n=y.max)},i.$$.update=()=>{if(i.$$.dirty&248&&u&&(a||l||c||h)){const y=u.getBoundingClientRect();e(8,d=y.width+30>a/2),e(9,f=y.y<80)}},[r,s,n,a,l,h,c,u,d,f,o,p,g,_,m,v]}class xy extends kt{constructor(t){super(),Ot(this,t,by,vy,Lt,{selected_size:0,min:1,max:2})}get selected_size(){return this.$$.ctx[0]}set selected_size(t){this.$$set({selected_size:t}),I()}get min(){return this.$$.ctx[1]}set min(t){this.$$set({min:t}),I()}get max(){return this.$$.ctx[2]}set max(t){this.$$set({max:t}),I()}}function Ah(i){let t,e,r=i[7]&&Sh(i);return{c(){r&&r.c(),t=be()},m(s,n){r&&r.m(s,n),Z(s,t,n),e=!0},p(s,n){s[7]?r?(r.p(s,n),n[0]&128&&H(r,1)):(r=Sh(s),r.c(),H(r,1),r.m(t.parentNode,t)):r&&(ne(),$(r,1,1,()=>{r=null}),oe())},i(s){e||(H(r),e=!0)},o(s){$(r),e=!1},d(s){s&&K(t),r&&r.d(s)}}}function Sh(i){let t,e,r,s,n,o;function a(u){i[23](u)}let l={};i[0]!==void 0&&(l.color=i[0]),t=new uy({props:l}),At.push(()=>qt(t,"color",a));function h(u){i[24](u)}let c={color:i[0]};return i[13]!==void 0&&(c.current_mode=i[13]),s=new yy({props:c}),At.push(()=>qt(s,"current_mode",h)),s.$on("close",i[25]),s.$on("selected",i[26]),{c(){yt(t.$$.fragment),r=pt(),yt(s.$$.fragment)},m(u,d){vt(t,u,d),Z(u,r,d),vt(s,u,d),o=!0},p(u,d){const f={};!e&&d[0]&1&&(e=!0,f.color=u[0],Zt(()=>e=!1)),t.$set(f);const p={};d[0]&1&&(p.color=u[0]),!n&&d[0]&8192&&(n=!0,p.current_mode=u[13],Zt(()=>n=!1)),s.$set(p)},i(u){o||(H(t.$$.fragment,u),H(s.$$.fragment,u),o=!0)},o(u){$(t.$$.fragment,u),$(s.$$.fragment,u),o=!1},d(u){u&&K(r),bt(t,u),bt(s,u)}}}function Ch(i){let t,e,r;function s(o){i[27](o)}let n={colors:i[3],user_colors:i[4]==="defaults"?i[1]:null,selected_color:i[0],current_mode:i[13]};return i[7]!==void 0&&(n.color_picker=i[7]),t=new py({props:n}),At.push(()=>qt(t,"color_picker",s)),t.$on("select",i[28]),t.$on("edit",i[29]),{c(){yt(t.$$.fragment)},m(o,a){vt(t,o,a),r=!0},p(o,a){const l={};a[0]&8&&(l.colors=o[3]),a[0]&18&&(l.user_colors=o[4]==="defaults"?o[1]:null),a[0]&1&&(l.selected_color=o[0]),a[0]&8192&&(l.current_mode=o[13]),!e&&a[0]&128&&(e=!0,l.color_picker=o[7],Zt(()=>e=!1)),t.$set(l)},i(o){r||(H(t.$$.fragment,o),r=!0)},o(o){$(t.$$.fragment,o),r=!1},d(o){bt(t,o)}}}function Ih(i){let t;return{c(){t=et("div"),C(t,"class","sep svelte-gtuiq3")},m(e,r){Z(e,t,r)},d(e){e&&K(t)}}}function wy(i){let t,e,r,s,n,o,a,l,h,c;Ui(i[22]);let u=i[4]==="defaults"&&Ah(i),d=i[6]&&Ch(i),f=(i[7]||i[6])&&Ih();function p(_){i[30](_)}let g={max:i[5][0]/10,min:1};return i[2]!==void 0&&(g.selected_size=i[2]),n=new xy({props:g}),At.push(()=>qt(n,"selected_size",p)),{c(){t=et("div"),u&&u.c(),e=pt(),d&&d.c(),r=pt(),f&&f.c(),s=pt(),yt(n.$$.fragment),C(t,"class","wrap svelte-gtuiq3"),Ui(()=>i[33].call(t)),ot(t,"padded",!i[7]),ot(t,"anchor_default",i[14]==="default"),ot(t,"anchor_center",i[14]==="center"),ot(t,"anchor_top",i[14]==="top"),ot(t,"anchor",`${i[15]}px`)},m(_,m){Z(_,t,m),u&&u.m(t,null),j(t,e),d&&d.m(t,null),j(t,r),f&&f.m(t,null),j(t,s),vt(n,t,null),i[32](t),a=na(t,i[33].bind(t)),l=!0,h||(c=[It(window,"resize",i[22]),aa(Ca.call(null,t,i[31]))],h=!0)},p(_,m){_[4]==="defaults"?u?(u.p(_,m),m[0]&16&&H(u,1)):(u=Ah(_),u.c(),H(u,1),u.m(t,e)):u&&(ne(),$(u,1,1,()=>{u=null}),oe()),_[6]?d?(d.p(_,m),m[0]&64&&H(d,1)):(d=Ch(_),d.c(),H(d,1),d.m(t,r)):d&&(ne(),$(d,1,1,()=>{d=null}),oe()),_[7]||_[6]?f||(f=Ih(),f.c(),f.m(t,s)):f&&(f.d(1),f=null);const v={};m[0]&32&&(v.max=_[5][0]/10),!o&&m[0]&4&&(o=!0,v.selected_size=_[2],Zt(()=>o=!1)),n.$set(v),(!l||m[0]&128)&&ot(t,"padded",!_[7]),(!l||m[0]&16384)&&ot(t,"anchor_default",_[14]==="default"),(!l||m[0]&16384)&&ot(t,"anchor_center",_[14]==="center"),(!l||m[0]&16384)&&ot(t,"anchor_top",_[14]==="top"),(!l||m[0]&32768)&&ot(t,"anchor",`${_[15]}px`)},i(_){l||(H(u),H(d),H(n.$$.fragment,_),l=!0)},o(_){$(u),$(d),$(n.$$.fragment,_),l=!1},d(_){_&&K(t),u&&u.d(),d&&d.d(),f&&f.d(),bt(n),i[32](null),a(),h=!1,Yr(c)}}}function Ty(i,t,e){let{colors:r}=t,{selected_color:s}=t,{color_mode:n=void 0}=t,{recent_colors:o=[]}=t,{selected_size:a}=t,{dimensions:l}=t,{parent_width:h}=t,{parent_height:c}=t,{parent_left:u}=t,{toolbar_box:d}=t,{show_swatch:f}=t,p=!1,g="hex",_=null;const m=Ze();function v({index:O,color:M},ut){ut==="user"&&!M&&(_=O,e(7,p=!0)),M&&(e(0,s=M),ut==="core"&&e(7,p=!1))}function y(O){_!==null&&e(1,o[_]=O,o)}let b=0,x=0,S=0,w=0,T,P="default",F=0;function B(){e(9,x=window.innerHeight),e(8,b=window.innerWidth)}function D(O){s=O,e(0,s)}function E(O){g=O,e(13,g)}const R=()=>e(7,p=!1),X=({detail:O})=>e(0,s=O);function q(O){p=O,e(7,p)}const U=({detail:O})=>v(O,"core"),lt=({detail:O})=>v(O,"user");function V(O){a=O,e(2,a)}const A=()=>m("click_outside");function G(O){At[O?"unshift":"push"](()=>{T=O,e(12,T)})}function J(){S=this.clientWidth,w=this.clientHeight,e(10,S),e(11,w)}return i.$$set=O=>{"colors"in O&&e(3,r=O.colors),"selected_color"in O&&e(0,s=O.selected_color),"color_mode"in O&&e(4,n=O.color_mode),"recent_colors"in O&&e(1,o=O.recent_colors),"selected_size"in O&&e(2,a=O.selected_size),"dimensions"in O&&e(5,l=O.dimensions),"parent_width"in O&&e(18,h=O.parent_width),"parent_height"in O&&e(19,c=O.parent_height),"parent_left"in O&&e(20,u=O.parent_left),"toolbar_box"in O&&e(21,d=O.toolbar_box),"show_swatch"in O&&e(6,f=O.show_swatch)},i.$$.update=()=>{if(i.$$.dirty[0]&1&&y(s),i.$$.dirty[0]&3940224&&T&&(b||x||w||S)){const O=T.getBoundingClientRect();O.width>h||(h>O.width+230*2+25?(e(14,P="default"),e(15,F=d.right-u+24)):e(14,P="center")),O.height+50>c&&e(14,P="top")}},[s,o,a,r,n,l,f,p,b,x,S,w,T,g,P,F,m,v,h,c,u,d,B,D,E,R,X,q,U,lt,V,A,G,J]}class Ey extends kt{constructor(t){super(),Ot(this,t,Ty,wy,Lt,{colors:3,selected_color:0,color_mode:4,recent_colors:1,selected_size:2,dimensions:5,parent_width:18,parent_height:19,parent_left:20,toolbar_box:21,show_swatch:6},null,[-1,-1])}get colors(){return this.$$.ctx[3]}set colors(t){this.$$set({colors:t}),I()}get selected_color(){return this.$$.ctx[0]}set selected_color(t){this.$$set({selected_color:t}),I()}get color_mode(){return this.$$.ctx[4]}set color_mode(t){this.$$set({color_mode:t}),I()}get recent_colors(){return this.$$.ctx[1]}set recent_colors(t){this.$$set({recent_colors:t}),I()}get selected_size(){return this.$$.ctx[2]}set selected_size(t){this.$$set({selected_size:t}),I()}get dimensions(){return this.$$.ctx[5]}set dimensions(t){this.$$set({dimensions:t}),I()}get parent_width(){return this.$$.ctx[18]}set parent_width(t){this.$$set({parent_width:t}),I()}get parent_height(){return this.$$.ctx[19]}set parent_height(t){this.$$set({parent_height:t}),I()}get parent_left(){return this.$$.ctx[20]}set parent_left(t){this.$$set({parent_left:t}),I()}get toolbar_box(){return this.$$.ctx[21]}set toolbar_box(t){this.$$set({toolbar_box:t}),I()}get show_swatch(){return this.$$.ctx[6]}set show_swatch(t){this.$$set({show_swatch:t}),I()}}function Rh(i){let t,e,r,s,n,o;function a(u){i[25](u)}function l(u){i[26](u)}function h(u){i[27](u)}let c={show_swatch:i[1]==="draw",colors:i[6],color_mode:i[0],dimensions:i[5],parent_width:i[4].parent_width,parent_height:i[4].parent_height,parent_left:i[4].parent_left,toolbar_box:i[12]};return i[2]!==void 0&&(c.selected_color=i[2]),i[9]!==void 0&&(c.recent_colors=i[9]),i[3]!==void 0&&(c.selected_size=i[3]),e=new Ey({props:c}),At.push(()=>qt(e,"selected_color",a)),At.push(()=>qt(e,"recent_colors",l)),At.push(()=>qt(e,"selected_size",h)),e.$on("click_outside",i[28]),{c(){t=et("div"),yt(e.$$.fragment)},m(u,d){Z(u,t,d),vt(e,t,null),o=!0},p(u,d){const f={};d[0]&2&&(f.show_swatch=u[1]==="draw"),d[0]&64&&(f.colors=u[6]),d[0]&1&&(f.color_mode=u[0]),d[0]&32&&(f.dimensions=u[5]),d[0]&16&&(f.parent_width=u[4].parent_width),d[0]&16&&(f.parent_height=u[4].parent_height),d[0]&16&&(f.parent_left=u[4].parent_left),d[0]&4096&&(f.toolbar_box=u[12]),!r&&d[0]&4&&(r=!0,f.selected_color=u[2],Zt(()=>r=!1)),!s&&d[0]&512&&(s=!0,f.recent_colors=u[9],Zt(()=>s=!1)),!n&&d[0]&8&&(n=!0,f.selected_size=u[3],Zt(()=>n=!1)),e.$set(f)},i(u){o||(H(e.$$.fragment,u),o=!0)},o(u){$(e.$$.fragment,u),o=!1},d(u){u&&K(t),bt(e)}}}function Ay(i){let t,e=`translate(${i[10].x}px, ${i[10].y}px)`,r=`${i[4].child_top-i[4].parent_top-i[11]/2}px`,s=`${i[4].child_left-i[4].parent_left-i[11]/2}px`,n=`${i[11]}px`,o=`${i[11]}px`,a,l,h,c,u,d=i[7]&&Rh(i);return{c(){t=et("span"),a=pt(),d&&d.c(),l=be(),C(t,"class","svelte-btgkrd"),rt(t,"transform",e),rt(t,"top",r),rt(t,"left",s),rt(t,"width",n),rt(t,"height",o),rt(t,"opacity",i[8]?1:0)},m(f,p){Z(f,t,p),Z(f,a,p),d&&d.m(f,p),Z(f,l,p),h=!0,c||(u=It(window,"keydown",i[24]),c=!0)},p(f,p){p[0]&1024&&e!==(e=`translate(${f[10].x}px, ${f[10].y}px)`)&&rt(t,"transform",e),p[0]&2064&&r!==(r=`${f[4].child_top-f[4].parent_top-f[11]/2}px`)&&rt(t,"top",r),p[0]&2064&&s!==(s=`${f[4].child_left-f[4].parent_left-f[11]/2}px`)&&rt(t,"left",s),p[0]&2048&&n!==(n=`${f[11]}px`)&&rt(t,"width",n),p[0]&2048&&o!==(o=`${f[11]}px`)&&rt(t,"height",o),p[0]&256&&rt(t,"opacity",f[8]?1:0),f[7]?d?(d.p(f,p),p[0]&128&&H(d,1)):(d=Rh(f),d.c(),H(d,1),d.m(l.parentNode,l)):d&&(ne(),$(d,1,1,()=>{d=null}),oe())},i(f){h||(H(d),h=!0)},o(f){$(d),h=!1},d(f){f&&(K(t),K(a),K(l)),d&&d.d(f),c=!1,u()}}}function Sy(i,t,e){let r,s,n,o,a,l,h,c,{default_size:u}=t,{default_color:d=void 0}=t,{colors:f=void 0}=t,{color_mode:p=void 0}=t,{mode:g}=t,_=[],m=[];f&&JSON.stringify(m)!==JSON.stringify(f)&&(_=f.map(mt).filter((z,Vt)=>Vt<4),m=_);let v=mt(d||"#000000"),y=!1;const{pixi:b,dimensions:x,current_layer:S,command_manager:w,register_context:T,editor_box:P,crop:F,toolbar_box:B}=vr(xi);gt(i,b,z=>e(32,o=z)),gt(i,x,z=>e(5,n=z)),gt(i,S,z=>e(35,h=z)),gt(i,P,z=>e(4,s=z)),gt(i,F,z=>e(34,l=z)),gt(i,B,z=>e(12,c=z));const{active_tool:D,register_tool:E,current_color:R}=vr(Qs);gt(i,D,z=>e(33,a=z));let X=!1,q;function U(z,Vt){const he=pe(Math.min(z,Vt),500,1e3);return Math.round(he*2/100)}let lt=u==="auto"?U(...n):u;function V(z){a===g&&(X=!0,!(!o||!h)&&(q=ly(o.renderer,o.layer_container,h,g),q.start({x:z.screen.x,y:z.screen.y,color:v||void 0,size:lt,opacity:1})))}function A(z){!o||!h||a===g&&(q.stop(),w.execute(q),X=!1)}function G(z){if(a!==g)return;X&&q.continue({x:z.screen.x,y:z.screen.y});const Vt=l[0]*n[0],he=l[1]*n[1];Vt>z.screen.x||he>z.screen.y||z.screen.x>Vt+l[2]*n[0]||z.screen.y>he+l[3]*n[1]?(e(8,J=!1),document.body.style.cursor="auto"):(e(8,J=!0),document.body.style.cursor="none"),J&&e(10,Pt={x:z.clientX-s.child_left,y:z.clientY-s.child_top})}let J=!1;async function O(z){o?.layer_container[z]("pointerdown",V),o?.layer_container[z]("pointerup",A),o?.layer_container[z]("pointermove",G),o?.layer_container[z]("pointerenter",Vt=>{a===g&&(e(8,J=!0),document.body.style.cursor="none")}),o?.layer_container[z]("pointerleave",()=>(e(8,J=!1),document.body.style.cursor="auto"))}T(g,{init_fn:()=>{O("on")},reset_fn:()=>{O("off")}});const M=Nt(),ut=E(g,{cb:M});la(()=>()=>{ut(),O("off")});let ct=[null,null,null];function mt(z){return _r(z).toRgbString()}let Pt={x:0,y:0};function Nt(){let z=null;return function(he){const N=()=>{if(z&&clearTimeout(z),he!==void 0){e(7,y=he);return}e(7,y=!y)};z&&clearTimeout(z),z=setTimeout(N,100)}}const Mt=({key:z})=>z==="Escape"&&M(!1);function xt(z){v=z,e(2,v)}function St(z){ct=z,e(9,ct)}function Tt(z){lt=z,e(3,lt)}const Dt=()=>M();return i.$$set=z=>{"default_size"in z&&e(21,u=z.default_size),"default_color"in z&&e(22,d=z.default_color),"colors"in z&&e(23,f=z.colors),"color_mode"in z&&e(0,p=z.color_mode),"mode"in z&&e(1,g=z.mode)},i.$$.update=()=>{i.$$.dirty[0]&6&&g==="draw"&&R.set(v),i.$$.dirty[0]&6&&g==="draw"&&R.set(v),i.$$.dirty[0]&56&&e(11,r=lt/n[0]*s.child_width*2)},[p,g,v,lt,s,n,_,y,J,ct,Pt,r,c,b,x,S,P,F,B,D,M,u,d,f,Mt,xt,St,Tt,Dt]}class Qu extends kt{constructor(t){super(),Ot(this,t,Sy,Ay,Lt,{default_size:21,default_color:22,colors:23,color_mode:0,mode:1},null,[-1,-1])}get default_size(){return this.$$.ctx[21]}set default_size(t){this.$$set({default_size:t}),I()}get default_color(){return this.$$.ctx[22]}set default_color(t){this.$$set({default_color:t}),I()}get colors(){return this.$$.ctx[23]}set colors(t){this.$$set({colors:t}),I()}get color_mode(){return this.$$.ctx[0]}set color_mode(t){this.$$set({color_mode:t}),I()}get mode(){return this.$$.ctx[1]}set mode(t){this.$$set({mode:t}),I()}}function Ph(i,t,e,r=0){let s,n;const o=new jr;let a,l,h,c,u=ic(r,{stiffness:.1,damping:.5}),d=r;u.subscribe(_=>{l&&(d=_,f(h,c,l,!0))});function f(_,m,v,y){o.clear(),y&&(o.beginFill(16777215,d),o.drawRect(0,0,_,m),o.endFill()),o.beginFill(16777215,1),o.drawRect(...v),o.endFill(),i.render(o,{renderTexture:s})}let p=!0,g=!1;return{start:(_,m,v,y=!0,b=!0)=>{p=!1,s=ae.create({width:_,height:m}),f(_,m,v,y),n=new ue(s),t.mask=n,h=_,c=m,b&&(a=JSON.parse(JSON.stringify(v)))},continue:(_,m=!0)=>{l=JSON.parse(JSON.stringify(_)),d===.2?f(h,c,l,m):u.set(.2)},undo(){this.start(h,c,a,!1),e.set([a[0]/h,a[1]/c,a[2]/h,a[3]/c]),p=!0},stop(){return g=!0,d},execute(){p?(this.start(h,c,l,!1),e.set([l[0]/h,l[1]/c,l[2]/h,l[3]/c]),p=!0):(g||u.set(0,{hard:!0}),e.set([l[0]/h,l[1]/c,l[2]/h,l[3]/c]),p=!0)}}}function td(i,t,e,r,s,n){let o=i,a=t;(e.includes("t")||e.includes("b")||e=="c")&&(o=t*r),(e.includes("l")||e.includes("r")||e=="c")&&(a=i/r),a=a||o/r,o=o||a*r,o>s&&(o=s,a=o/r),a>n&&(a=n,o=a*r);let l=0,h=0;return e.includes("r")?l=i-o:e.includes("l")?l=0:l=(i-o)/2,e.includes("b")?h=t-a:e.includes("t")?h=0:h=(t-a)/2,{new_width:o,new_height:a,x_offset:l,y_offset:h}}function Cy(i){let t,e,r,s,n,o;return{c(){t=et("div"),e=et("div"),C(e,"class",r="handle "+i[0]+" "+i[1]+" svelte-1x33xzn"),C(t,"class",s="hitbox "+i[1]+" svelte-1x33xzn"),rt(t,"transform",i[3])},m(a,l){Z(a,t,l),j(t,e),i[12](e),n||(o=[It(window,"mousemove",i[5]),It(window,"mouseup",i[6]),It(t,"mousedown",i[4])],n=!0)},p(a,[l]){l&3&&r!==(r="handle "+a[0]+" "+a[1]+" svelte-1x33xzn")&&C(e,"class",r),l&2&&s!==(s="hitbox "+a[1]+" svelte-1x33xzn")&&C(t,"class",s),l&8&&rt(t,"transform",a[3])},i:Rt,o:Rt,d(a){a&&K(t),i[12](null),n=!1,Yr(o)}}}function Iy(i,t,e){let r,{type:s="corner"}=t,{location:n}=t,{x1:o=0}=t,{y1:a=0}=t,{x2:l=0}=t,{y2:h=0}=t,c,u=0,d=0,f=!1;const p=Ze();let{dragging:g=!1}=t,_;function m(S){c=_.getBoundingClientRect(),f=!0,e(11,g=!0),["tl","bl","l"].includes(n)&&(d=S.clientX-c.right),["tl","tr","t"].includes(n)&&(u=S.clientY-c.bottom),["tr","r","br"].includes(n)&&(d=S.clientX-c.left),["br","b","bl"].includes(n)&&(u=S.clientY-c.top)}function v(S){if(!f)return;const w=S.clientY-u,T=S.clientY-u,P=S.clientX-d,F=S.clientX-d;["tl","bl","l"].includes(n)&&e(7,o=P),["tl","tr","t"].includes(n)&&e(8,a=w),["tr","r","br"].includes(n)&&e(9,l=F),["br","b","bl"].includes(n)&&e(10,h=T)}async function y(S){await br(),f=!1,e(11,g=!1)}function b(S,w,T,P,F){let B,D,E,R;return c&&(["tl","l","bl"].includes(S)&&(D=w),["tl","t","tr"].includes(S)&&(B=P),["tr","r","br"].includes(S)&&(E=T),["br","b","bl"].includes(S)&&(R=F)),p("change",{top:B,bottom:R,left:D,right:E}),""}function x(S){At[S?"unshift":"push"](()=>{_=S,e(2,_)})}return i.$$set=S=>{"type"in S&&e(0,s=S.type),"location"in S&&e(1,n=S.location),"x1"in S&&e(7,o=S.x1),"y1"in S&&e(8,a=S.y1),"x2"in S&&e(9,l=S.x2),"y2"in S&&e(10,h=S.y2),"dragging"in S&&e(11,g=S.dragging)},i.$$.update=()=>{i.$$.dirty&1922&&e(3,r=b(n,o,l,a,h))},[s,n,_,r,m,v,y,o,a,l,h,g,x]}class Ry extends kt{constructor(t){super(),Ot(this,t,Iy,Cy,Lt,{type:0,location:1,x1:7,y1:8,x2:9,y2:10,dragging:11})}get type(){return this.$$.ctx[0]}set type(t){this.$$set({type:t}),I()}get location(){return this.$$.ctx[1]}set location(t){this.$$set({location:t}),I()}get x1(){return this.$$.ctx[7]}set x1(t){this.$$set({x1:t}),I()}get y1(){return this.$$.ctx[8]}set y1(t){this.$$set({y1:t}),I()}get x2(){return this.$$.ctx[9]}set x2(t){this.$$set({x2:t}),I()}get y2(){return this.$$.ctx[10]}set y2(t){this.$$set({y2:t}),I()}get dragging(){return this.$$.ctx[11]}set dragging(t){this.$$set({dragging:t}),I()}}function Py(i,t,e){const r=i.slice();return r[30]=t[e],r}function Mh(i,t,e){const r=i.slice();return r[33]=t[e],r}function Bh(i){let t,e,r;function s(a){i[20](a)}function n(...a){return i[21](i[33],...a)}let o={location:i[33]};return i[1]!==void 0&&(o.dragging=i[1]),t=new Ry({props:o}),At.push(()=>qt(t,"dragging",s)),t.$on("change",n),{c(){yt(t.$$.fragment)},m(a,l){vt(t,a,l),r=!0},p(a,l){i=a;const h={};!e&&l[0]&2&&(e=!0,h.dragging=i[1],Zt(()=>e=!1)),t.$set(h)},i(a){r||(H(t.$$.fragment,a),r=!0)},o(a){$(t.$$.fragment,a),r=!1},d(a){bt(t,a)}}}function My(i){let t;return{c(){t=et("div"),C(t,"class","svelte-12y7ld0")},m(e,r){Z(e,t,r)},p:Rt,d(e){e&&K(t)}}}function By(i){let t,e,r,s,n=`${i[3]}px`,o=`${i[2]}px`,a=`${i[4]}px`,l=`${i[5]}px`,h,c,u,d=ce(i[7]),f=[];for(let m=0;m<d.length;m+=1)f[m]=Bh(Mh(i,d,m));const p=m=>$(f[m],1,1,()=>{f[m]=null});let g=ce({length:25}),_=[];for(let m=0;m<g.length;m+=1)_[m]=My(Py(i,g,m));return{c(){t=et("div"),e=et("div");for(let m=0;m<f.length;m+=1)f[m].c();r=pt(),s=et("div");for(let m=0;m<_.length;m+=1)_[m].c();C(s,"class","grid svelte-12y7ld0"),ot(s,"finished",i[6]),C(e,"class","box svelte-12y7ld0"),rt(e,"width",n),rt(e,"height",o),rt(e,"top",a),rt(e,"left",l),C(t,"class","wrap svelte-12y7ld0")},m(m,v){Z(m,t,v),j(t,e);for(let y=0;y<f.length;y+=1)f[y]&&f[y].m(e,null);j(e,r),j(e,s);for(let y=0;y<_.length;y+=1)_[y]&&_[y].m(s,null);h=!0,c||(u=[It(window,"mousemove",i[11]),It(window,"mouseup",i[10]),It(s,"mousedown",i[9])],c=!0)},p(m,v){if(v[0]&386){d=ce(m[7]);let y;for(y=0;y<d.length;y+=1){const b=Mh(m,d,y);f[y]?(f[y].p(b,v),H(f[y],1)):(f[y]=Bh(b),f[y].c(),H(f[y],1),f[y].m(e,r))}for(ne(),y=d.length;y<f.length;y+=1)p(y);oe()}(!h||v[0]&64)&&ot(s,"finished",m[6]),v[0]&8&&n!==(n=`${m[3]}px`)&&rt(e,"width",n),v[0]&4&&o!==(o=`${m[2]}px`)&&rt(e,"height",o),v[0]&16&&a!==(a=`${m[4]}px`)&&rt(e,"top",a),v[0]&32&&l!==(l=`${m[5]}px`)&&rt(e,"left",l)},i(m){if(!h){for(let v=0;v<d.length;v+=1)H(f[v]);h=!0}},o(m){f=f.filter(Boolean);for(let v=0;v<f.length;v+=1)$(f[v]);h=!1},d(m){m&&K(t),Gi(f,m),Gi(_,m),c=!1,Yr(u)}}}function Dy(i,t,e){let r,s=Rt,n=()=>(s(),s=od(o,V=>e(19,r=V)),o);i.$$.on_destroy.push(()=>s());let{editor_box:o}=t;n();let{crop_constraint:a}=t;const l=Ze();let h=r.child_height,c=r.child_width,u=r.child_top-r.parent_top,d=r.child_left-r.parent_left,f=r.child_right-r.parent_left,p=0,g=!1,{w_p:_}=t,{h_p:m}=t,{l_p:v}=t,{t_p:y}=t;const b=["tl","br","tr","bl","t","b","l","r"];let x,S,w=!1;function T(){S&&clearTimeout(S),e(17,S=setTimeout(()=>{w&&(l("crop_end",{x:v,y,width:_,height:m}),w=!1),e(6,x=!0),e(18,E=!1)},1e3))}function P({top:V,bottom:A,left:G,right:J},O){e(4,u=pe(V?V-r.parent_top:u,r.child_top-r.parent_top,r.child_bottom-r.parent_top)),e(5,d=pe(G?G-r.parent_left:d,r.child_left-r.parent_left,r.child_right-r.parent_left)),f=pe(J?J-r.parent_left:f,r.child_left-r.parent_left,r.child_right-r.parent_left),p=pe(A?A-r.parent_top:p,r.child_top-r.parent_top,r.child_bottom-r.parent_top),e(3,c=pe(J?J-d-r.parent_left:c,0,f-d)),e(3,c=pe(G?f-G+r.parent_left:c,0,f-d)),e(2,h=pe(A?A-u-r.parent_top:h,0,p-u)),e(2,h=pe(V?p-V+r.parent_top:h,0,p-u));const M={tl:"br",tr:"bl",bl:"tr",br:"tl",t:"b",b:"t",l:"r",r:"l",c:"c"};if(a){const ut=["t","b"].includes(O)?r.child_width:f-d,ct=["l","r"].includes(O)?r.child_height:p-u;let mt=td(c,h,M[O],a,ut,ct);e(3,c=mt.new_width),e(2,h=mt.new_height),e(5,d=d+mt.x_offset),e(4,u=u+mt.y_offset),f=d+c,p=u+h}e(12,_=c/r.child_width),e(13,m=h/r.child_height),e(14,v=(d-r.child_left+r.parent_left)/r.child_width),e(15,y=(u-r.child_top+r.parent_top)/r.child_height),l(w?"crop_continue":"crop_start",{x:v,y,width:_,height:m}),w=!0}function F(){e(3,c=_*r.child_width),e(2,h=m*r.child_height),e(5,d=v*r.child_width+(r.child_left-r.parent_left)),e(4,u=y*r.child_height+(r.child_top-r.parent_top)),f=d+c,p=u+h}let B=0,D=0,E=!1;function R(V){e(18,E=!0),B=V.clientX,D=V.clientY,x&&(e(6,x=!1),l("crop_start",{x:v,y,width:_,height:m}))}function X(V){E&&e(18,E=!1)}function q(V){if(!E)return;const A=V.clientX-B,G=V.clientY-D;e(5,d=pe(d+A,r.child_left-r.parent_left,r.child_right-r.parent_left-c)),e(4,u=pe(u+G,r.child_top-r.parent_top,r.child_bottom-r.parent_top-h)),f=d+c,p=u+h,e(14,v=(d-r.child_left+r.parent_left)/r.child_width),e(15,y=(u-r.child_top+r.parent_top)/r.child_height),B=V.clientX,D=V.clientY,l("crop_continue",{x:v,y,width:_,height:m}),w=!0}function U(V){g=V,e(1,g)}const lt=(V,{detail:A})=>P(A,V);return i.$$set=V=>{"editor_box"in V&&n(e(0,o=V.editor_box)),"crop_constraint"in V&&e(16,a=V.crop_constraint),"w_p"in V&&e(12,_=V.w_p),"h_p"in V&&e(13,m=V.h_p),"l_p"in V&&e(14,v=V.l_p),"t_p"in V&&e(15,y=V.t_p)},i.$$.update=()=>{i.$$.dirty[0]&393218&&(g||E?(clearTimeout(S),e(6,x=!1)):T()),i.$$.dirty[0]&524288&&r&&F()},[o,g,h,c,u,d,x,b,P,R,X,q,_,m,v,y,a,S,E,r,U,lt]}class Fy extends kt{constructor(t){super(),Ot(this,t,Dy,By,Lt,{editor_box:0,crop_constraint:16,w_p:12,h_p:13,l_p:14,t_p:15},null,[-1,-1])}get editor_box(){return this.$$.ctx[0]}set editor_box(t){this.$$set({editor_box:t}),I()}get crop_constraint(){return this.$$.ctx[16]}set crop_constraint(t){this.$$set({crop_constraint:t}),I()}get w_p(){return this.$$.ctx[12]}set w_p(t){this.$$set({w_p:t}),I()}get h_p(){return this.$$.ctx[13]}set h_p(t){this.$$set({h_p:t}),I()}get l_p(){return this.$$.ctx[14]}set l_p(t){this.$$set({l_p:t}),I()}get t_p(){return this.$$.ctx[15]}set t_p(t){this.$$set({t_p:t}),I()}}function Dh(i){let t,e;return t=new Fy({props:{crop_constraint:i[0],w_p:i[1],h_p:i[2],l_p:i[3],t_p:i[4],editor_box:i[9]}}),t.$on("crop_start",i[20]),t.$on("crop_continue",i[21]),t.$on("crop_end",i[22]),{c(){yt(t.$$.fragment)},m(r,s){vt(t,r,s),e=!0},p(r,s){const n={};s[0]&1&&(n.crop_constraint=r[0]),s[0]&2&&(n.w_p=r[1]),s[0]&4&&(n.h_p=r[2]),s[0]&8&&(n.l_p=r[3]),s[0]&16&&(n.t_p=r[4]),t.$set(n)},i(r){e||(H(t.$$.fragment,r),e=!0)},o(r){$(t.$$.fragment,r),e=!1},d(r){bt(t,r)}}}function ky(i){let t,e,r=i[5]==="crop"&&i[6]&&Dh(i);return{c(){r&&r.c(),t=be()},m(s,n){r&&r.m(s,n),Z(s,t,n),e=!0},p(s,n){s[5]==="crop"&&s[6]?r?(r.p(s,n),n[0]&96&&H(r,1)):(r=Dh(s),r.c(),H(r,1),r.m(t.parentNode,t)):r&&(ne(),$(r,1,1,()=>{r=null}),oe())},i(s){e||(H(r),e=!0)},o(s){$(r),e=!1},d(s){s&&K(t),r&&r.d(s)}}}function Oy(i,t,e){let r,s,n,o,a,l;const{active_tool:h,register_tool:c}=vr(Qs);gt(i,h,A=>e(5,l=A));const{dimensions:u,editor_box:d,pixi:f,crop:p,command_manager:g,current_history:_}=vr(xi);gt(i,u,A=>e(18,n=A)),gt(i,d,A=>e(16,r=A)),gt(i,f,A=>e(19,o=A)),gt(i,p,A=>e(17,s=A)),gt(i,_,A=>e(27,a=A));let m,{crop_constraint:v}=t,y=null,b=1,x=1,S=0,w=0,T=0,P=!1,F=null;async function B(){if(F||a.previous)return;const{new_height:A,new_width:G,x_offset:J,y_offset:O}=td(r.child_width,r.child_height,"c",y,r.child_width,r.child_height);e(1,b=G/r.child_width),e(2,x=A/r.child_height),e(3,S=J/r.child_width),e(4,w=O/r.child_height),F=Ph(o.renderer,o.background_container,p,.2),F.start(...n,X,!1),F.continue([S*n[0],w*n[1],b*n[0],x*n[1]],!1),F.stop(),F.execute(),F=null,T=0}function D(A,{x:G,y:J,width:O,height:M}){if(o){if(A==="start")m&&(T=m.stop(),m=null),m=Ph(o?.renderer,o.background_container,p,T),m.start(...n,X);else if(A==="continue"){if(!m)return;m.continue([G*n[0],J*n[1],O*n[0],M*n[1]])}else if(A==="stop"){if(!m)return;g.execute(m)}e(15,P=!0)}}let E=!1;function R(){if(E||!r.child_height)return;const A=r.child_height,G=r.child_width,J=r.child_top-r.parent_top,O=r.child_left-r.parent_left;e(1,b=G/r.child_width),e(2,x=A/r.child_height),e(3,S=(O-r.child_left+r.parent_left)/r.child_width),e(4,w=(J-r.child_top+r.parent_top)/r.child_height),e(6,E=!0)}let X;const q=c("crop");ad(q);const U=({detail:A})=>D("start",A),lt=({detail:A})=>D("continue",A),V=({detail:A})=>D("stop",A);return i.$$set=A=>{"crop_constraint"in A&&e(14,v=A.crop_constraint)},i.$$.update=()=>{if(i.$$.dirty[0]&16384)if(typeof v=="string"){const[A,G]=v.split(":");e(0,y=parseInt(A)/parseInt(G))}else Array.isArray(v)&&e(0,y=v[0]/v[1]);i.$$.dirty[0]&557089&&!P&&y&&o&&l&&requestAnimationFrame(()=>{B()}),i.$$.dirty[0]&131072&&(e(3,S=s[0]),e(4,w=s[1]),e(1,b=s[2]),e(2,x=s[3])),i.$$.dirty[0]&262174&&(X=[S*n[0],w*n[1],b*n[0],x*n[1]]),i.$$.dirty[0]&65536&&r&&R()},[y,b,x,S,w,l,E,h,u,d,f,p,_,D,v,P,r,s,n,o,U,lt,V]}class Ny extends kt{constructor(t){super(),Ot(this,t,Oy,ky,Lt,{crop_constraint:14},null,[-1,-1])}get crop_constraint(){return this.$$.ctx[14]}set crop_constraint(t){this.$$set({crop_constraint:t}),I()}}function Fh(i,t,e,r){const s=i/t,n=e/r;let o,a;i<=e&&t<=r?(o=i,a=t):s>n?(o=e,a=e/s):(a=r,o=r*s);const l=Math.round((e-o)/2),h=Math.round((r-a)/2);return{width:Math.round(o),height:Math.round(a),x:l,y:h}}function Ly(i,t,e,r,s,n){let o;return{async start(){i.removeChildren();const a=await createImageBitmap(e),l=it.from(a);if(o=new ue(l),n||(s=[o.width,o.height]),n){const[c,u]=s,{width:d,height:f,x:p,y:g}=Fh(o.width,o.height,c,u);return o.width=d,o.height=f,o.x=p,o.y=g,s}const h=Fh(o.width,o.height,s[0],s[1]);return o.width=h.width,o.height=h.height,o.x=0,o.y=0,[h.width,h.height]},async execute(){r(n?s[0]:o.width,n?s[1]:o.height),o.zIndex=0,i.addChild(o)},undo(){i.removeChildAt(0)}}}function Uy(i,t,e,r,s,n){let o;return{start(){i.removeChildren();const a=Ju(1),l=ae.create({width:r,height:s});return a.beginFill(new Ct(e)),a.drawRect(0,0,r,s),a.endFill(),t.render(a,{renderTexture:l}),o=new ue(l),[o.width,o.height]},async execute(){n(o.width,o.height),o.zIndex=1,i.addChild(o)},undo(){i.removeChildren()}}}function kh(i,t,e){const r=i.slice();return r[38]=t[e].icon,r[39]=t[e].label,r[40]=t[e].id,r[41]=t[e].cb,r}function Oh(i){let t,e=[],r=new Map,s,n,o,a,l,h,c,u=`${Math.max(i[12].child_height+(i[12].child_top-i[12].parent_top),100)}px`,d,f=ce(i[10]);const p=v=>v[40];for(let v=0;v<f.length;v+=1){let y=kh(i,f,v),b=p(y);r.set(b,e[v]=Nh(b,y))}function g(v){i[24](v)}let _={hidden:i[2]||i[1]==="webcam"||i[11]!=="bg",filetype:"image/*",root:i[3],disable_click:!i[4].includes("upload"),format:"blob",upload:i[7],stream_handler:i[8]};i[0]!==void 0&&(_.dragging=i[0]),l=new xd({props:_}),i[23](l),At.push(()=>qt(l,"dragging",g)),l.$on("load",i[17]),l.$on("error",i[25]);let m=i[1]==="webcam"&&Lh(i);return{c(){t=et("div");for(let v=0;v<e.length;v+=1)e[v].c();s=pt(),n=et("span"),o=pt(),a=et("div"),yt(l.$$.fragment),c=pt(),m&&m.c(),C(n,"class","sep svelte-ip7ypz"),C(t,"class","source-wrap svelte-ip7ypz"),C(a,"class","upload-container svelte-ip7ypz"),ot(a,"click-disabled",!!i[2]||i[1]==="webcam"||i[11]!=="bg"),rt(a,"height",u)},m(v,y){Z(v,t,y);for(let b=0;b<e.length;b+=1)e[b]&&e[b].m(t,null);j(t,s),j(t,n),Z(v,o,y),Z(v,a,y),vt(l,a,null),j(a,c),m&&m.m(a,null),d=!0},p(v,y){y[0]&1024&&(f=ce(v[10]),ne(),e=oa(e,y,p,1,v,f,r,t,ec,Nh,s,kh),oe());const b={};y[0]&2054&&(b.hidden=v[2]||v[1]==="webcam"||v[11]!=="bg"),y[0]&8&&(b.root=v[3]),y[0]&16&&(b.disable_click=!v[4].includes("upload")),y[0]&128&&(b.upload=v[7]),y[0]&256&&(b.stream_handler=v[8]),!h&&y[0]&1&&(h=!0,b.dragging=v[0],Zt(()=>h=!1)),l.$set(b),v[1]==="webcam"?m?(m.p(v,y),y[0]&2&&H(m,1)):(m=Lh(v),m.c(),H(m,1),m.m(a,null)):m&&(ne(),$(m,1,1,()=>{m=null}),oe()),(!d||y[0]&2054)&&ot(a,"click-disabled",!!v[2]||v[1]==="webcam"||v[11]!=="bg"),y[0]&4096&&u!==(u=`${Math.max(v[12].child_height+(v[12].child_top-v[12].parent_top),100)}px`)&&rt(a,"height",u)},i(v){if(!d){for(let y=0;y<f.length;y+=1)H(e[y]);H(l.$$.fragment,v),H(m),d=!0}},o(v){for(let y=0;y<e.length;y+=1)$(e[y]);$(l.$$.fragment,v),$(m),d=!1},d(v){v&&(K(t),K(o),K(a));for(let y=0;y<e.length;y+=1)e[y].d();i[23](null),bt(l),m&&m.d()}}}function Nh(i,t){let e,r,s;return r=new cc({props:{Icon:t[38],size:"medium",padded:!1,label:t[39]+" button",hasPopup:!0,transparent:!0}}),r.$on("click",function(){sc(t[41])&&t[41].apply(this,arguments)}),{key:i,first:null,c(){e=be(),yt(r.$$.fragment),this.first=e},m(n,o){Z(n,e,o),vt(r,n,o),s=!0},p(n,o){t=n;const a={};o[0]&1024&&(a.Icon=t[38]),o[0]&1024&&(a.label=t[39]+" button"),r.$set(a)},i(n){s||(H(r.$$.fragment,n),s=!0)},o(n){$(r.$$.fragment,n),s=!1},d(n){n&&K(e),bt(r,n)}}}function Lh(i){let t,e,r,s=`${i[12].child_width}px`,n=`${i[12].child_height}px`,o=`${i[12].child_top-i[12].parent_top}px`,a;return r=new dd({props:{upload:i[7],root:i[3],mirror_webcam:i[5],streaming:!1,mode:"image",include_audio:!1,i18n:i[6]}}),r.$on("capture",i[17]),r.$on("error",i[26]),r.$on("drag",i[27]),{c(){t=et("div"),e=et("div"),yt(r.$$.fragment),C(e,"class","modal-inner svelte-ip7ypz"),C(t,"class","modal svelte-ip7ypz"),rt(t,"max-width",s),rt(t,"max-height",n),rt(t,"top",o)},m(l,h){Z(l,t,h),j(t,e),vt(r,e,null),a=!0},p(l,h){const c={};h[0]&128&&(c.upload=l[7]),h[0]&8&&(c.root=l[3]),h[0]&32&&(c.mirror_webcam=l[5]),h[0]&64&&(c.i18n=l[6]),r.$set(c),h[0]&4096&&s!==(s=`${l[12].child_width}px`)&&rt(t,"max-width",s),h[0]&4096&&n!==(n=`${l[12].child_height}px`)&&rt(t,"max-height",n),h[0]&4096&&o!==(o=`${l[12].child_top-l[12].parent_top}px`)&&rt(t,"top",o)},i(l){a||(H(r.$$.fragment,l),a=!0)},o(l){$(r.$$.fragment,l),a=!1},d(l){l&&K(t),bt(r)}}}function Gy(i){let t,e,r,s,n=i[4].length&&Oh(i);return{c(){n&&n.c(),t=be()},m(o,a){n&&n.m(o,a),Z(o,t,a),e=!0,r||(s=It(window,"keydown",i[18]),r=!0)},p(o,a){o[4].length?n?(n.p(o,a),a[0]&16&&H(n,1)):(n=Oh(o),n.c(),H(n,1),n.m(t.parentNode,t)):n&&(ne(),$(n,1,1,()=>{n=null}),oe())},i(o){e||(H(n),e=!0)},o(o){$(n),e=!1},d(o){o&&K(t),n&&n.d(o),r=!1,s()}}}function Hy(i,t,e){let r,s,n,o,a,{background_file:l}=t,{root:h}=t,{sources:c=["upload","webcam","clipboard"]}=t,{mirror_webcam:u=!0}=t,{i18n:d}=t,{upload:f}=t,{stream_handler:p}=t,{dragging:g}=t,{canvas_size:_}=t,{fixed_canvas:m=!1}=t;const{active_tool:v}=vr(Qs);gt(i,v,M=>e(11,o=M));const{pixi:y,dimensions:b,register_context:x,reset:S,editor_box:w}=vr(xi);gt(i,y,M=>e(30,n=M)),gt(i,b,M=>e(29,s=M)),gt(i,w,M=>e(12,a=M));let{active_mode:T=null}=t,P;Ze();const F={upload:{icon:ha,label:"Upload",order:0,id:"bg_upload",cb(){B.open_file_upload(),Be(v,o="bg",o)}},webcam:{icon:bd,label:"Webcam",order:1,id:"bg_webcam",cb(){e(1,T="webcam"),Be(v,o="bg",o)}},clipboard:{icon:vd,label:"Paste",order:2,id:"bg_clipboard",cb(){D(),Be(v,o=null,o)}}};let B;async function D(){const M=await navigator.clipboard.read();for(let ut=0;ut<M.length;ut++){const ct=M[ut].types.find(mt=>mt.startsWith("image/"));if(ct){const mt=await M[ut].getType(ct);e(22,P=mt||null)}}}function E(M){const ut=M.detail;e(22,P=ut),e(1,T=null)}let R=!0;async function X(){if(n&&P){const M=Ly(n.background_container,n.renderer,P,n.resize,_,m);Be(b,s=await M.start(),s),R&&S(!1,s),M.execute(),R=!0,await br(),e(2,lt=!0)}}async function q(M){if(!M||!M.url)return;R=!1;const ct=await(await fetch(M.url)).blob();e(22,P=ct)}function U(M){M.key==="Escape"&&e(1,T=null)}let{bg:lt=!1}=t;x("bg",{init_fn:()=>{if(!n)return;const M=Uy(n.background_container,n.renderer,"black",...s,n.resize);Be(b,s=M.start(),s),M.execute()},reset_fn:()=>{}});function V(M){At[M?"unshift":"push"](()=>{B=M,e(9,B)})}function A(M){g=M,e(0,g)}function G(M){Nr.call(this,i,M)}function J(M){Nr.call(this,i,M)}function O(M){Nr.call(this,i,M)}return i.$$set=M=>{"background_file"in M&&e(19,l=M.background_file),"root"in M&&e(3,h=M.root),"sources"in M&&e(4,c=M.sources),"mirror_webcam"in M&&e(5,u=M.mirror_webcam),"i18n"in M&&e(6,d=M.i18n),"upload"in M&&e(7,f=M.upload),"stream_handler"in M&&e(8,p=M.stream_handler),"dragging"in M&&e(0,g=M.dragging),"canvas_size"in M&&e(20,_=M.canvas_size),"fixed_canvas"in M&&e(21,m=M.fixed_canvas),"active_mode"in M&&e(1,T=M.active_mode),"bg"in M&&e(2,lt=M.bg)},i.$$.update=()=>{i.$$.dirty[0]&16&&e(10,r=c.map(M=>F[M]).sort((M,ut)=>M.order-ut.order)),i.$$.dirty[0]&4194304&&P&&X(),i.$$.dirty[0]&524288&&q(l)},[g,T,lt,h,c,u,d,f,p,B,r,o,a,v,y,b,w,E,U,l,_,m,P,V,A,G,J,O]}class zy extends kt{constructor(t){super(),Ot(this,t,Hy,Gy,Lt,{background_file:19,root:3,sources:4,mirror_webcam:5,i18n:6,upload:7,stream_handler:8,dragging:0,canvas_size:20,fixed_canvas:21,active_mode:1,bg:2},null,[-1,-1])}get background_file(){return this.$$.ctx[19]}set background_file(t){this.$$set({background_file:t}),I()}get root(){return this.$$.ctx[3]}set root(t){this.$$set({root:t}),I()}get sources(){return this.$$.ctx[4]}set sources(t){this.$$set({sources:t}),I()}get mirror_webcam(){return this.$$.ctx[5]}set mirror_webcam(t){this.$$set({mirror_webcam:t}),I()}get i18n(){return this.$$.ctx[6]}set i18n(t){this.$$set({i18n:t}),I()}get upload(){return this.$$.ctx[7]}set upload(t){this.$$set({upload:t}),I()}get stream_handler(){return this.$$.ctx[8]}set stream_handler(t){this.$$set({stream_handler:t}),I()}get dragging(){return this.$$.ctx[0]}set dragging(t){this.$$set({dragging:t}),I()}get canvas_size(){return this.$$.ctx[20]}set canvas_size(t){this.$$set({canvas_size:t}),I()}get fixed_canvas(){return this.$$.ctx[21]}set fixed_canvas(t){this.$$set({fixed_canvas:t}),I()}get active_mode(){return this.$$.ctx[1]}set active_mode(t){this.$$set({active_mode:t}),I()}get bg(){return this.$$.ctx[2]}set bg(t){this.$$set({bg:t}),I()}}function Uh(i){let t,e;return t=new Ts({props:{disabled:!i[2],Icon:pd,label:"Save changes",background:"var(--color-green-500)",color:"#fff"}}),t.$on("click",i[5]),{c(){yt(t.$$.fragment)},m(r,s){vt(t,r,s),e=!0},p(r,s){const n={};s&4&&(n.disabled=!r[2]),t.$set(n)},i(r){e||(H(t.$$.fragment,r),e=!0)},o(r){$(t.$$.fragment,r),e=!1},d(r){bt(t,r)}}}function Xy(i){let t,e,r,s,n,o,a,l=i[3]&&Uh(i);return e=new Ts({props:{disabled:!i[0],Icon:gd,label:"Undo"}}),e.$on("click",i[6]),s=new Ts({props:{disabled:!i[1],Icon:Od,label:"Redo"}}),s.$on("click",i[7]),o=new Ts({props:{Icon:md,label:"Clear canvas"}}),o.$on("click",i[8]),{c(){l&&l.c(),t=pt(),yt(e.$$.fragment),r=pt(),yt(s.$$.fragment),n=pt(),yt(o.$$.fragment)},m(h,c){l&&l.m(h,c),Z(h,t,c),vt(e,h,c),Z(h,r,c),vt(s,h,c),Z(h,n,c),vt(o,h,c),a=!0},p(h,c){h[3]?l?(l.p(h,c),c&8&&H(l,1)):(l=Uh(h),l.c(),H(l,1),l.m(t.parentNode,t)):l&&(ne(),$(l,1,1,()=>{l=null}),oe());const u={};c&1&&(u.disabled=!h[0]),e.$set(u);const d={};c&2&&(d.disabled=!h[1]),s.$set(d)},i(h){a||(H(l),H(e.$$.fragment,h),H(s.$$.fragment,h),H(o.$$.fragment,h),a=!0)},o(h){$(l),$(e.$$.fragment,h),$(s.$$.fragment,h),$(o.$$.fragment,h),a=!1},d(h){h&&(K(t),K(r),K(n)),l&&l.d(h),bt(e,h),bt(s,h),bt(o,h)}}}function Vy(i){let t,e;return t=new _d({props:{$$slots:{default:[Xy]},$$scope:{ctx:i}}}),{c(){yt(t.$$.fragment)},m(r,s){vt(t,r,s),e=!0},p(r,[s]){const n={};s&527&&(n.$$scope={dirty:s,ctx:r}),t.$set(n)},i(r){e||(H(t.$$.fragment,r),e=!0)},o(r){$(t.$$.fragment,r),e=!1},d(r){bt(t,r)}}}function Wy(i,t,e){let{can_undo:r=!1}=t,{can_redo:s=!1}=t,{can_save:n=!1}=t,{changeable:o=!1}=t;const a=Ze(),l=d=>{a("save"),d.stopPropagation()},h=d=>{a("undo"),d.stopPropagation()},c=d=>{a("redo"),d.stopPropagation()},u=d=>{a("remove_image"),d.stopPropagation()};return i.$$set=d=>{"can_undo"in d&&e(0,r=d.can_undo),"can_redo"in d&&e(1,s=d.can_redo),"can_save"in d&&e(2,n=d.can_save),"changeable"in d&&e(3,o=d.changeable)},[r,s,n,o,a,l,h,c,u]}class jy extends kt{constructor(t){super(),Ot(this,t,Wy,Vy,Lt,{can_undo:0,can_redo:1,can_save:2,changeable:3})}get can_undo(){return this.$$.ctx[0]}set can_undo(t){this.$$set({can_undo:t}),I()}get can_redo(){return this.$$.ctx[1]}set can_redo(t){this.$$set({can_redo:t}),I()}get can_save(){return this.$$.ctx[2]}set can_save(t){this.$$set({can_save:t}),I()}get changeable(){return this.$$.ctx[3]}set changeable(t){this.$$set({changeable:t}),I()}}const{window:Yy}=ld;function qy(i){let t,e,r,s,n,o,a,l,h,c,u=`${i[8].child_width+1}px`,d=`${i[8].child_height+1}px`,f=`${i[8].child_top-i[8].parent_top-.5}px`,p=`${i[8].child_left-i[8].parent_left-.5}px`,g,_,m;e=new jy({props:{can_undo:i[10],can_redo:i[11],can_save:i[9]!==i[7],changeable:i[2]}}),e.$on("undo",i[17].undo),e.$on("redo",i[17].redo),e.$on("remove_image",i[3]),e.$on("save",i[26]);const v=i[41].default,y=ea(v,i,i[40],null);return{c(){t=et("div"),yt(e.$$.fragment),r=pt(),s=et("div"),n=et("div"),o=et("div"),a=pt(),l=et("div"),y&&y.c(),h=pt(),c=et("div"),C(o,"class","stage-wrap svelte-t4g8ka"),ot(o,"bg",!i[1]),C(n,"class","wrap svelte-t4g8ka"),C(l,"class","tools-wrap svelte-t4g8ka"),C(c,"class","canvas svelte-t4g8ka"),ot(c,"no-border",!i[1]&&i[6]==="bg"&&!i[0]),rt(c,"width",u),rt(c,"height",d),rt(c,"top",f),rt(c,"left",p),C(s,"class","container svelte-t4g8ka"),C(t,"data-testid","image"),C(t,"class","image-container svelte-t4g8ka")},m(b,x){Z(b,t,x),vt(e,t,null),j(t,r),j(t,s),j(s,n),j(n,o),i[43](o),i[44](n),j(s,a),j(s,l),y&&y.m(l,null),j(s,h),j(s,c),g=!0,_||(m=It(Yy,"scroll",i[42]),_=!0)},p(b,x){const S={};x[0]&1024&&(S.can_undo=b[10]),x[0]&2048&&(S.can_redo=b[11]),x[0]&640&&(S.can_save=b[9]!==b[7]),x[0]&4&&(S.changeable=b[2]),e.$set(S),(!g||x[0]&2)&&ot(o,"bg",!b[1]),y&&y.p&&(!g||x[1]&512)&&ra(y,v,b,b[40],g?sa(v,b[40],x,null):ia(b[40]),null),(!g||x[0]&67)&&ot(c,"no-border",!b[1]&&b[6]==="bg"&&!b[0]),x[0]&256&&u!==(u=`${b[8].child_width+1}px`)&&rt(c,"width",u),x[0]&256&&d!==(d=`${b[8].child_height+1}px`)&&rt(c,"height",d),x[0]&256&&f!==(f=`${b[8].child_top-b[8].parent_top-.5}px`)&&rt(c,"top",f),x[0]&256&&p!==(p=`${b[8].child_left-b[8].parent_left-.5}px`)&&rt(c,"left",p)},i(b){g||(H(e.$$.fragment,b),H(y,b),g=!0)},o(b){$(e.$$.fragment,b),$(y,b),g=!1},d(b){b&&K(t),bt(e),i[43](null),i[44](null),y&&y.d(b),_=!1,m()}}}const xi=Symbol("editor");function ed(i){return i.previous?ed(i.previous):i}function Zy(i,t,e){let r,s,n,o,a,l,h,c,u,d,f,p,g,{$$slots:_={},$$scope:m}=t,{antialias:v=!0}=t,{crop_size:y}=t,{changeable:b=!1}=t,{history:x}=t,{bg:S=!1}=t,{sources:w}=t;const T=Ze();let{crop_constraint:P=!1}=t,{canvas_size:F}=t,{parent_height:B}=t,{full_history:D=null}=t,R=re(F||[800,600]);gt(i,R,W=>e(49,h=W));let{height:X=0}=t,q=re({parent_width:0,parent_height:B,parent_top:0,parent_left:0,parent_right:0,parent_bottom:0,child_width:0,child_height:B,child_top:0,child_left:0,child_right:0,child_bottom:0});gt(i,q,W=>e(8,f=W));let{canvas_height:U=void 0}=t;const lt=re([0,0,1,1]);gt(i,lt,W=>e(39,d=W));const V=ic({x:0,y:0},{stiffness:.1,damping:.5});gt(i,V,W=>e(38,u=W));const A=re(null);gt(i,A,W=>e(48,l=W));const G=Gd(),{can_redo:J,can_undo:O,current_history:M}=G;gt(i,J,W=>e(11,g=W)),gt(i,O,W=>e(10,p=W)),gt(i,M,W=>e(7,n=W));const ut=typeof window<"u",ct=re("bg");gt(i,ct,W=>e(6,s=W));const mt=re({});gt(i,mt,W=>e(46,o=W));const Pt=re({});gt(i,Pt,W=>e(50,c=W));const Nt=re([]);gt(i,Nt,W=>e(47,a=W));const Mt=re(ut?new DOMRect:{}),xt=["bg","layers","crop","draw","erase"],St=tc(xi,{pixi:A,current_layer:re(null),dimensions:R,editor_box:q,toolbar_box:Mt,active_tool:ct,crop:lt,position_spring:V,command_manager:G,current_history:M,register_context:(W,{reset_fn:fe,init_fn:ge})=>{Nt.update(Bt=>[...Bt,W]),Pt.update(Bt=>({...Bt,[W]:ge})),mt.update(Bt=>({...Bt,[W]:fe}))},reset:(W,fe)=>{e(1,S=!1);const ge=a.sort((Bt,jt)=>xt.indexOf(Bt)-xt.indexOf(jt));for(const Bt of ge)Bt in o&&typeof o[Bt]=="function"&&o[Bt]?.();for(const Bt of ge){if(Bt in c&&typeof c[Bt]=="function"){if(Bt==="bg"&&!W)continue;c[Bt]?.(fe)}G.reset(),l?.resize?.(...fe)}}});let Tt,Dt;function z(W,fe){if(!W||!fe)return;const{width:ge,height:Bt,top:jt,left:$e,right:un,bottom:dn}=Dt.getBoundingClientRect(),{width:fn,height:k,top:pn,left:rd,right:id,bottom:sd}=fe.getBoundingClientRect();q.set({child_width:fn,child_height:k,child_left:rd,child_right:id,child_top:pn,child_bottom:sd,parent_width:ge,parent_height:Bt,parent_left:$e,parent_right:un,parent_top:jt,parent_bottom:dn})}function Vt(){requestAnimationFrame(()=>{br().then(W=>Be(ct,s="crop",s))})}function he(){if(!f)return;const W=0,fe=0,ge=f.child_width,Bt=f.child_height,jt=.5*f.child_width-W-ge/2,$e=.5*f.child_height-fe-Bt/2;V.set({x:jt,y:$e})}async function N(){return!l||!l.get_layers?{background:null,layers:[],composite:null}:l?.get_blobs(l.get_layers(),new dt(Math.round(0),Math.round(0),Math.round(1*h[0]),Math.round(1*h[1])),h)}function Se(){St.reset(!0,r||h),w.length?de("bg"):de("draw"),T("clear");let W=F||y||[800,600];St.reset(!0,W)}la(()=>{const fe=oy({target:Tt,dimensions:F||y||[800,600],antialias:v});function ge(jt,$e){fe.resize(jt,$e),R.set([jt,$e])}A.set({...fe,resize:ge});const Bt=new ResizeObserver(jt=>{for(const $e of jt)z(Dt,Tt)});Bt.observe(Dt),Bt.observe(Tt);for(const jt of a)jt in c&&typeof c[jt]=="function"&&c[jt]?.(h);return ge(...h),br().then(()=>{D&&G.hydrate(D)}),()=>{l?.destroy(),Bt.disconnect();for(const jt of a)jt in o&&o[jt]?.()}});let Ce=n;function Ne(){e(9,Ce=n),T("save")}function de(W){Be(ct,s=W,s)}const xe=()=>z(Dt,Tt);function Sr(W){At[W?"unshift":"push"](()=>{Tt=W,e(4,Tt)})}function we(W){At[W?"unshift":"push"](()=>{Dt=W,e(5,Dt)})}return i.$$set=W=>{"antialias"in W&&e(29,v=W.antialias),"crop_size"in W&&e(30,y=W.crop_size),"changeable"in W&&e(2,b=W.changeable),"history"in W&&e(0,x=W.history),"bg"in W&&e(1,S=W.bg),"sources"in W&&e(31,w=W.sources),"crop_constraint"in W&&e(32,P=W.crop_constraint),"canvas_size"in W&&e(33,F=W.canvas_size),"parent_height"in W&&e(34,B=W.parent_height),"full_history"in W&&e(35,D=W.full_history),"height"in W&&e(27,X=W.height),"canvas_height"in W&&e(28,U=W.canvas_height),"$$scope"in W&&e(40,m=W.$$scope)},i.$$.update=()=>{i.$$.dirty[1]&4&&(r=F),i.$$.dirty[0]&256&&e(27,X=f.child_height),i.$$.dirty[0]&256&&e(28,U=f.child_height+1),i.$$.dirty[0]&128&&(n.previous,T("change")),i.$$.dirty[0]&128&&T("history",ed(n)),i.$$.dirty[0]&192&&e(0,x=!!n.previous||s!=="bg"),i.$$.dirty[0]&3|i.$$.dirty[1]&2&&P&&S&&!x&&Vt(),i.$$.dirty[1]&256&&d&&he(),i.$$.dirty[0]&48|i.$$.dirty[1]&128&&u&&z(Dt,Tt)},[x,S,b,Se,Tt,Dt,s,n,f,Ce,p,g,R,q,lt,V,A,G,J,O,M,ct,mt,Pt,Nt,z,Ne,X,U,v,y,w,P,F,B,D,N,de,u,d,m,_,xe,Sr,we]}class Ky extends kt{constructor(t){super(),Ot(this,t,Zy,qy,Lt,{antialias:29,crop_size:30,changeable:2,history:0,bg:1,sources:31,crop_constraint:32,canvas_size:33,parent_height:34,full_history:35,height:27,canvas_height:28,get_blobs:36,handle_remove:3,set_tool:37},null,[-1,-1])}get antialias(){return this.$$.ctx[29]}set antialias(t){this.$$set({antialias:t}),I()}get crop_size(){return this.$$.ctx[30]}set crop_size(t){this.$$set({crop_size:t}),I()}get changeable(){return this.$$.ctx[2]}set changeable(t){this.$$set({changeable:t}),I()}get history(){return this.$$.ctx[0]}set history(t){this.$$set({history:t}),I()}get bg(){return this.$$.ctx[1]}set bg(t){this.$$set({bg:t}),I()}get sources(){return this.$$.ctx[31]}set sources(t){this.$$set({sources:t}),I()}get crop_constraint(){return this.$$.ctx[32]}set crop_constraint(t){this.$$set({crop_constraint:t}),I()}get canvas_size(){return this.$$.ctx[33]}set canvas_size(t){this.$$set({canvas_size:t}),I()}get parent_height(){return this.$$.ctx[34]}set parent_height(t){this.$$set({parent_height:t}),I()}get full_history(){return this.$$.ctx[35]}set full_history(t){this.$$set({full_history:t}),I()}get height(){return this.$$.ctx[27]}set height(t){this.$$set({height:t}),I()}get canvas_height(){return this.$$.ctx[28]}set canvas_height(t){this.$$set({canvas_height:t}),I()}get get_blobs(){return this.$$.ctx[36]}get handle_remove(){return this.$$.ctx[3]}get set_tool(){return this.$$.ctx[37]}}function Gh(i,t,e){const r=i.slice();return r[26]=t[e],r[28]=e,r}function Hh(i){let t,e,r,s,n,o=i[2].findIndex(i[15])+1+"",a,l,h,c,u,d,f,p;s=new Bd({});let g=i[1]&&zh(i);return{c(){t=et("div"),e=et("button"),r=et("span"),yt(s.$$.fragment),n=zr(" Layer "),a=zr(o),l=pt(),g&&g.c(),h=pt(),c=et("span"),C(r,"class","icon svelte-wbw3z5"),C(e,"aria-label","Show Layers"),C(e,"class","svelte-wbw3z5"),C(c,"class","sep svelte-wbw3z5"),C(t,"class","layer-wrap svelte-wbw3z5"),ot(t,"closed",!i[1])},m(_,m){Z(_,t,m),j(t,e),j(e,r),vt(s,r,null),j(e,n),j(e,a),j(t,l),g&&g.m(t,null),j(t,h),j(t,c),d=!0,f||(p=[It(e,"click",i[16]),aa(u=Ca.call(null,t,i[18]))],f=!0)},p(_,m){(!d||m&12)&&o!==(o=_[2].findIndex(_[15])+1+"")&&Wi(a,o),_[1]?g?g.p(_,m):(g=zh(_),g.c(),g.m(t,h)):g&&(g.d(1),g=null),u&&sc(u.update)&&m&2&&u.update.call(null,_[18]),(!d||m&2)&&ot(t,"closed",!_[1])},i(_){d||(H(s.$$.fragment,_),d=!0)},o(_){$(s.$$.fragment,_),d=!1},d(_){_&&K(t),bt(s),g&&g.d(),f=!1,Yr(p)}}}function zh(i){let t,e=[],r=new Map,s,n,o,a,l,h=ce(i[2]);const c=u=>u[28];for(let u=0;u<h.length;u+=1){let d=Gh(i,h,u),f=c(d);r.set(f,e[u]=Xh(f,d))}return{c(){t=et("ul");for(let u=0;u<e.length;u+=1)e[u].c();s=pt(),n=et("li"),o=et("button"),o.textContent="+",C(o,"aria-label","Add Layer"),C(o,"class","svelte-wbw3z5"),C(n,"class","svelte-wbw3z5"),C(t,"class","svelte-wbw3z5")},m(u,d){Z(u,t,d);for(let f=0;f<e.length;f+=1)e[f]&&e[f].m(t,null);j(t,s),j(t,n),j(n,o),a||(l=It(o,"click",i[11]),a=!0)},p(u,d){d&268&&(h=ce(u[2]),e=oa(e,d,c,1,u,h,r,t,hd,Xh,s,Gh))},d(u){u&&K(t);for(let d=0;d<e.length;d+=1)e[d].d();a=!1,l()}}}function Xh(i,t){let e,r,s,n=t[28]+1+"",o,a,l;function h(){return t[17](t[28])}return{key:i,first:null,c(){e=et("li"),r=et("button"),s=zr("Layer "),o=zr(n),C(r,"class","svelte-wbw3z5"),ot(r,"selected_layer",t[3]===t[26]),C(e,"class","svelte-wbw3z5"),this.first=e},m(c,u){Z(c,e,u),j(e,r),j(r,s),j(r,o),a||(l=It(r,"click",h),a=!0)},p(c,u){t=c,u&4&&n!==(n=t[28]+1+"")&&Wi(o,n),u&12&&ot(r,"selected_layer",t[3]===t[26])},d(c){c&&K(e),a=!1,l()}}}function $y(i){let t,e,r=i[0]&&Hh(i);return{c(){r&&r.c(),t=be()},m(s,n){r&&r.m(s,n),Z(s,t,n),e=!0},p(s,[n]){s[0]?r?(r.p(s,n),n&1&&H(r,1)):(r=Hh(s),r.c(),H(r,1),r.m(t.parentNode,t)):r&&(ne(),$(r,1,1,()=>{r=null}),oe())},i(s){e||(H(r),e=!0)},o(s){$(r),e=!1},d(s){s&&K(t),r&&r.d(s)}}}function Jy(i){return i!==null}function Qy(i,t,e){let r,s,n,o,a,l,h=!1,{layer_files:c=[]}=t,{enable_layers:u=!0}=t;const{pixi:d,current_layer:f,dimensions:p,register_context:g,command_manager:_,current_history:m}=vr(xi);gt(i,d,E=>e(19,r=E)),gt(i,f,E=>e(3,l=E)),gt(i,p,E=>e(13,o=E));const{can_undo:v}=_;gt(i,v,E=>e(20,n=E));const y=sy(),b=y.active_layer;gt(i,b,E=>e(14,a=E));const x=y.layers;gt(i,x,E=>e(2,s=E)),g("layers",{init_fn:()=>{w()},reset_fn:()=>{y.reset()}});async function S(){s.some(R=>R.composite.texture?.width!=o[0]||R.composite.texture?.height!=o[1])&&(y.reset(),!c||c.length==0?w():T(c))}async function w(){if(!r)return;const E=y.add_layer(r.layer_container,r.renderer,...o);n||s.length>0?_.execute(E):E.execute()}async function T(E){if(await br(),!E||E.length==0){y.reset(),w();return}if(!r)return;const R=await Promise.all(E.map(q=>!q||!q.url?null:fetch(q.url))),X=await Promise.all(R.map(q=>q?q.blob():null));y.reset();for(const q of X.filter(Jy)){const U=await y.add_layer_from_blob(r.layer_container,r.renderer,q,r.view);n&&s.length===0?_.execute(U):U.execute()}}la(async()=>{await br(),r&&Be(d,r={...r,get_layers:y.get_layers},r)});const P=E=>E===l,F=()=>e(1,h=!h),B=E=>Be(f,l=y.change_active_layer(E),l),D=()=>e(1,h=!1);return i.$$set=E=>{"layer_files"in E&&e(12,c=E.layer_files),"enable_layers"in E&&e(0,u=E.enable_layers)},i.$$.update=()=>{i.$$.dirty&16384&&f.set(a),i.$$.dirty&8192&&S(),i.$$.dirty&4096&&T(c)},[u,h,s,l,d,f,p,v,y,b,x,w,c,o,a,P,F,B,D]}class tv extends kt{constructor(t){super(),Ot(this,t,Qy,$y,Lt,{layer_files:12,enable_layers:0})}get layer_files(){return this.$$.ctx[12]}set layer_files(t){this.$$set({layer_files:t}),I()}get enable_layers(){return this.$$.ctx[0]}set enable_layers(t){this.$$set({enable_layers:t}),I()}}const ev=/^(#\s*)(.+)$/m;function rv(i){const t=i.trim(),e=t.match(ev);if(!e)return[!1,t||!1];const[r,,s]=e,n=s.trim();if(t===r)return[n,!1];const o=e.index!==void 0?e.index+r.length:0,l=t.substring(o).trim()||!1;return[n,l]}function Vh(i){let t,e;return t=new Ny({props:{crop_constraint:i[29]}}),{c(){yt(t.$$.fragment)},m(r,s){vt(t,r,s),e=!0},p(r,s){const n={};s[0]&536870912&&(n.crop_constraint=r[29]),t.$set(n)},i(r){e||(H(t.$$.fragment,r),e=!0)},o(r){$(t.$$.fragment,r),e=!1},d(r){bt(t,r)}}}function Wh(i){let t,e;return t=new Qu({props:{color_mode:i[1].color_mode,default_color:i[1].default_color,default_size:i[1].default_size,colors:i[1].colors,mode:"draw"}}),{c(){yt(t.$$.fragment)},m(r,s){vt(t,r,s),e=!0},p(r,s){const n={};s[0]&2&&(n.color_mode=r[1].color_mode),s[0]&2&&(n.default_color=r[1].default_color),s[0]&2&&(n.default_size=r[1].default_size),s[0]&2&&(n.colors=r[1].colors),t.$set(n)},i(r){e||(H(t.$$.fragment,r),e=!0)},o(r){$(t.$$.fragment,r),e=!1},d(r){bt(t,r)}}}function jh(i){let t,e;return t=new Qu({props:{default_size:i[2].default_size,mode:"erase"}}),{c(){yt(t.$$.fragment)},m(r,s){vt(t,r,s),e=!0},p(r,s){const n={};s[0]&4&&(n.default_size=r[2].default_size),t.$set(n)},i(r){e||(H(t.$$.fragment,r),e=!0)},o(r){$(t.$$.fragment,r),e=!1},d(r){bt(t,r)}}}function iv(i){let t,e,r,s,n,o,a,l=i[11].includes("crop"),h,c,u,d;t=new tv({props:{layer_files:i[10]?.layers||null,enable_layers:i[12]}});function f(b){i[37](b)}function p(b){i[38](b)}function g(b){i[39](b)}let _={i18n:i[5],root:i[6],sources:i[3],upload:i[16],stream_handler:i[17],canvas_size:i[14],background_file:i[10]?.background||i[10]?.composite||null,fixed_canvas:i[15]};i[0]!==void 0&&(_.dragging=i[0]),i[22]!==void 0&&(_.bg=i[22]),i[25]!==void 0&&(_.active_mode=i[25]),r=new zy({props:_}),At.push(()=>qt(r,"dragging",f)),At.push(()=>qt(r,"bg",p)),At.push(()=>qt(r,"active_mode",g));let m=l&&Vh(i),v=i[1]&&Wh(i),y=i[1]&&i[2]&&jh(i);return{c(){yt(t.$$.fragment),e=pt(),yt(r.$$.fragment),a=pt(),m&&m.c(),h=pt(),v&&v.c(),c=pt(),y&&y.c(),u=be()},m(b,x){vt(t,b,x),Z(b,e,x),vt(r,b,x),Z(b,a,x),m&&m.m(b,x),Z(b,h,x),v&&v.m(b,x),Z(b,c,x),y&&y.m(b,x),Z(b,u,x),d=!0},p(b,x){const S={};x[0]&1024&&(S.layer_files=b[10]?.layers||null),x[0]&4096&&(S.enable_layers=b[12]),t.$set(S);const w={};x[0]&32&&(w.i18n=b[5]),x[0]&64&&(w.root=b[6]),x[0]&8&&(w.sources=b[3]),x[0]&65536&&(w.upload=b[16]),x[0]&131072&&(w.stream_handler=b[17]),x[0]&16384&&(w.canvas_size=b[14]),x[0]&1024&&(w.background_file=b[10]?.background||b[10]?.composite||null),x[0]&32768&&(w.fixed_canvas=b[15]),!s&&x[0]&1&&(s=!0,w.dragging=b[0],Zt(()=>s=!1)),!n&&x[0]&4194304&&(n=!0,w.bg=b[22],Zt(()=>n=!1)),!o&&x[0]&33554432&&(o=!0,w.active_mode=b[25],Zt(()=>o=!1)),r.$set(w),x[0]&2048&&(l=b[11].includes("crop")),l?m?(m.p(b,x),x[0]&2048&&H(m,1)):(m=Vh(b),m.c(),H(m,1),m.m(h.parentNode,h)):m&&(ne(),$(m,1,1,()=>{m=null}),oe()),b[1]?v?(v.p(b,x),x[0]&2&&H(v,1)):(v=Wh(b),v.c(),H(v,1),v.m(c.parentNode,c)):v&&(ne(),$(v,1,1,()=>{v=null}),oe()),b[1]&&b[2]?y?(y.p(b,x),x[0]&6&&H(y,1)):(y=jh(b),y.c(),H(y,1),y.m(u.parentNode,u)):y&&(ne(),$(y,1,1,()=>{y=null}),oe())},i(b){d||(H(t.$$.fragment,b),H(r.$$.fragment,b),H(m),H(v),H(y),d=!0)},o(b){$(t.$$.fragment,b),$(r.$$.fragment,b),$(m),$(v),$(y),d=!1},d(b){b&&(K(e),K(a),K(h),K(c),K(u)),bt(t,b),bt(r,b),m&&m.d(b),v&&v.d(b),y&&y.d(b)}}}function Yh(i){let t,e,r,s=i[3]&&i[3].length&&qh(i),n=i[3]&&i[3].length&&i[1]&&!i[18]&&$h(),o=i[1]&&!i[18]&&Jh();return{c(){t=et("div"),s&&s.c(),e=pt(),n&&n.c(),r=pt(),o&&o.c(),C(t,"class","empty wrap svelte-1jsrluz"),rt(t,"height",`${i[26]}px`)},m(a,l){Z(a,t,l),s&&s.m(t,null),j(t,e),n&&n.m(t,null),j(t,r),o&&o.m(t,null)},p(a,l){a[3]&&a[3].length?s?s.p(a,l):(s=qh(a),s.c(),s.m(t,e)):s&&(s.d(1),s=null),a[3]&&a[3].length&&a[1]&&!a[18]?n||(n=$h(),n.c(),n.m(t,r)):n&&(n.d(1),n=null),a[1]&&!a[18]?o||(o=Jh(),o.c(),o.m(t,null)):o&&(o.d(1),o=null),l[0]&67108864&&rt(t,"height",`${a[26]}px`)},d(a){a&&K(t),s&&s.d(),n&&n.d(),o&&o.d()}}}function qh(i){let t;function e(n,o){return n[28]||n[27]?nv:sv}let r=e(i),s=r(i);return{c(){s.c(),t=be()},m(n,o){s.m(n,o),Z(n,t,o)},p(n,o){r===(r=e(n))&&s?s.p(n,o):(s.d(1),s=r(n),s&&(s.c(),s.m(t.parentNode,t)))},d(n){n&&K(t),s.d(n)}}}function sv(i){let t;return{c(){t=et("div"),t.textContent="Upload an image"},m(e,r){Z(e,t,r)},p:Rt,d(e){e&&K(t)}}}function nv(i){let t,e,r=i[28]&&Zh(i),s=i[27]&&Kh(i);return{c(){r&&r.c(),t=pt(),s&&s.c(),e=be()},m(n,o){r&&r.m(n,o),Z(n,t,o),s&&s.m(n,o),Z(n,e,o)},p(n,o){n[28]?r?r.p(n,o):(r=Zh(n),r.c(),r.m(t.parentNode,t)):r&&(r.d(1),r=null),n[27]?s?s.p(n,o):(s=Kh(n),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},d(n){n&&(K(t),K(e)),r&&r.d(n),s&&s.d(n)}}}function Zh(i){let t,e;return{c(){t=et("h2"),e=zr(i[28]),C(t,"class","svelte-1jsrluz")},m(r,s){Z(r,t,s),j(t,e)},p(r,s){s[0]&268435456&&Wi(e,r[28])},d(r){r&&K(t)}}}function Kh(i){let t,e;return{c(){t=et("p"),e=zr(i[27]),C(t,"class","svelte-1jsrluz")},m(r,s){Z(r,t,s),j(t,e)},p(r,s){s[0]&134217728&&Wi(e,r[27])},d(r){r&&K(t)}}}function $h(i){let t;return{c(){t=et("div"),t.textContent="or",C(t,"class","or svelte-1jsrluz")},m(e,r){Z(e,t,r)},d(e){e&&K(t)}}}function Jh(i){let t;return{c(){t=et("div"),t.textContent="select the draw tool to start"},m(e,r){Z(e,t,r)},d(e){e&&K(t)}}}function ov(i){let t,e,r,s;t=new jd({props:{i18n:i[5],$$slots:{default:[iv]},$$scope:{ctx:i}}});let n=!i[22]&&!i[24]&&i[25]!=="webcam"&&i[13]!=="error"&&Yh(i);return{c(){yt(t.$$.fragment),e=pt(),n&&n.c(),r=be()},m(o,a){vt(t,o,a),Z(o,e,a),n&&n.m(o,a),Z(o,r,a),s=!0},p(o,a){const l={};a[0]&32&&(l.i18n=o[5]),a[0]&574872687|a[1]&1048576&&(l.$$scope={dirty:a,ctx:o}),t.$set(l),!o[22]&&!o[24]&&o[25]!=="webcam"&&o[13]!=="error"?n?n.p(o,a):(n=Yh(o),n.c(),n.m(r.parentNode,r)):n&&(n.d(1),n=null)},i(o){s||(H(t.$$.fragment,o),s=!0)},o(o){$(t.$$.fragment,o),s=!1},d(o){o&&(K(e),K(r)),bt(t,o),n&&n.d(o)}}}function av(i){let t,e,r,s,n,o,a,l;t=new wd({props:{show_label:i[8],Icon:ha,label:i[7]||i[5]("image.image")}});function h(p){i[41](p)}function c(p){i[42](p)}function u(p){i[43](p)}function d(p){i[44](p)}let f={canvas_size:i[14],crop_size:Array.isArray(i[4])?i[4]:void 0,parent_height:i[19],changeable:i[9],sources:i[3],crop_constraint:!!i[29],full_history:i[20],$$slots:{default:[ov]},$$scope:{ctx:i}};return i[26]!==void 0&&(f.height=i[26]),i[23]!==void 0&&(f.canvas_height=i[23]),i[24]!==void 0&&(f.history=i[24]),i[22]!==void 0&&(f.bg=i[22]),r=new Ky({props:f}),i[40](r),At.push(()=>qt(r,"height",h)),At.push(()=>qt(r,"canvas_height",c)),At.push(()=>qt(r,"history",u)),At.push(()=>qt(r,"bg",d)),r.$on("history",i[45]),r.$on("save",i[46]),r.$on("change",i[31]),r.$on("clear",i[47]),{c(){yt(t.$$.fragment),e=pt(),yt(r.$$.fragment)},m(p,g){vt(t,p,g),Z(p,e,g),vt(r,p,g),l=!0},p(p,g){const _={};g[0]&256&&(_.show_label=p[8]),g[0]&160&&(_.label=p[7]||p[5]("image.image")),t.$set(_);const m={};g[0]&16384&&(m.canvas_size=p[14]),g[0]&16&&(m.crop_size=Array.isArray(p[4])?p[4]:void 0),g[0]&524288&&(m.parent_height=p[19]),g[0]&512&&(m.changeable=p[9]),g[0]&8&&(m.sources=p[3]),g[0]&536870912&&(m.crop_constraint=!!p[29]),g[0]&1048576&&(m.full_history=p[20]),g[0]&1061682287|g[1]&1048576&&(m.$$scope={dirty:g,ctx:p}),!s&&g[0]&67108864&&(s=!0,m.height=p[26],Zt(()=>s=!1)),!n&&g[0]&8388608&&(n=!0,m.canvas_height=p[23],Zt(()=>n=!1)),!o&&g[0]&16777216&&(o=!0,m.history=p[24],Zt(()=>o=!1)),!a&&g[0]&4194304&&(a=!0,m.bg=p[22],Zt(()=>a=!1)),r.$set(m)},i(p){l||(H(t.$$.fragment,p),H(r.$$.fragment,p),l=!0)},o(p){$(t.$$.fragment,p),$(r.$$.fragment,p),l=!1},d(p){p&&K(e),bt(t,p),i[40](null),bt(r,p)}}}function lv(i){return!!i}function hv(i){return!!i}function Qh(){return new Promise(i=>setTimeout(()=>i(),30))}function cv(i,t,e){let r,s,n,{brush:o}=t,{eraser:a}=t,{sources:l}=t,{crop_size:h=null}=t,{i18n:c}=t,{root:u}=t,{label:d=void 0}=t,{show_label:f}=t,{changeable:p=!1}=t,{value:g={background:null,layers:[],composite:null}}=t,{transforms:_=["crop"]}=t,{layers:m}=t,{accept_blobs:v}=t,{status:y="complete"}=t,{canvas_size:b}=t,{fixed_canvas:x=!1}=t,{realtime:S}=t,{upload:w}=t,{stream_handler:T}=t,{dragging:P}=t,{placeholder:F=void 0}=t,{dynamic_height:B=void 0}=t,{height:D}=t,{full_history:E=null}=t;const R=Ze();let X;async function q(){let N;try{N=await X.get_blobs()}catch{return{background:null,layers:[],composite:null}}const Se=N.background?w(await gn([new File([N.background],"background.png")]),u):Promise.resolve(null),Ce=N.layers.filter(lv).map(async(we,W)=>w(await gn([new File([we],`layer_${W}.png`)]),u)),Ne=N.composite?w(await gn([new File([N.composite],"composite.png")]),u):Promise.resolve(null),[de,xe,...Sr]=await Promise.all([Se,Ne,...Ce]);return{background:Array.isArray(de)?de[0]:de,layers:Sr.flatMap(we=>Array.isArray(we)?we:[we]).filter(hv),composite:Array.isArray(xe)?xe[0]:xe}}function U(N){X&&N==null&&(X.handle_remove(),R("receive_null"))}let lt=!1,V=!1,{image_id:A=null}=t,G=!1,J=!1;async function O(N){if(!S)return;if(G){J=!0;return}G=!0,await Qh();const Se=await X.get_blobs(),Ce=[];let Ne=Math.random().toString(36).substring(2);Se.background&&Ce.push([Ne,"background",new File([Se.background],"background.png"),null]),Se.composite&&Ce.push([Ne,"composite",new File([Se.composite],"composite.png"),null]),Se.layers.forEach((de,xe)=>{de&&Ce.push([Ne,"layer",new File([de],`layer_${xe}.png`),xe])}),await Promise.all(Ce.map(async([de,xe,Sr,we])=>v({binary:!0,data:{file:Sr,id:de,type:xe,index:we}}))),e(33,A=Ne),R("change"),await Qh(),G=!1,J&&(J=!1,G=!1,O())}let M=null,ut=D-100,ct;function mt(N){P=N,e(0,P)}function Pt(N){lt=N,e(22,lt)}function Nt(N){M=N,e(25,M)}function Mt(N){At[N?"unshift":"push"](()=>{X=N,e(21,X)})}function xt(N){ut=N,e(26,ut)}function St(N){ct=N,e(23,ct)}function Tt(N){V=N,e(24,V)}function Dt(N){lt=N,e(22,lt)}function z(N){Nr.call(this,i,N)}function Vt(N){Nr.call(this,i,N)}const he=()=>R("clear");return i.$$set=N=>{"brush"in N&&e(1,o=N.brush),"eraser"in N&&e(2,a=N.eraser),"sources"in N&&e(3,l=N.sources),"crop_size"in N&&e(4,h=N.crop_size),"i18n"in N&&e(5,c=N.i18n),"root"in N&&e(6,u=N.root),"label"in N&&e(7,d=N.label),"show_label"in N&&e(8,f=N.show_label),"changeable"in N&&e(9,p=N.changeable),"value"in N&&e(10,g=N.value),"transforms"in N&&e(11,_=N.transforms),"layers"in N&&e(12,m=N.layers),"accept_blobs"in N&&e(34,v=N.accept_blobs),"status"in N&&e(13,y=N.status),"canvas_size"in N&&e(14,b=N.canvas_size),"fixed_canvas"in N&&e(15,x=N.fixed_canvas),"realtime"in N&&e(35,S=N.realtime),"upload"in N&&e(16,w=N.upload),"stream_handler"in N&&e(17,T=N.stream_handler),"dragging"in N&&e(0,P=N.dragging),"placeholder"in N&&e(18,F=N.placeholder),"dynamic_height"in N&&e(32,B=N.dynamic_height),"height"in N&&e(19,D=N.height),"full_history"in N&&e(20,E=N.full_history),"image_id"in N&&e(33,A=N.image_id)},i.$$.update=()=>{i.$$.dirty[0]&4194304&&lt&&R("upload"),i.$$.dirty[0]&1024&&U(g),i.$$.dirty[0]&16&&e(29,r=h),i.$$.dirty[0]&2097160&&X&&X.set_tool&&(l&&l.length?X.set_tool("bg"):X.set_tool("draw")),i.$$.dirty[0]&8388608&&e(32,B=ct),i.$$.dirty[0]&262144&&e(28,[s,n]=F?rv(F):[!1,!1],s,(e(27,n),e(18,F)))},[P,o,a,l,h,c,u,d,f,p,g,_,m,y,b,x,w,T,F,D,E,X,lt,ct,V,M,ut,n,s,r,R,O,B,A,v,S,q,mt,Pt,Nt,Mt,xt,St,Tt,Dt,z,Vt,he]}class uv extends kt{constructor(t){super(),Ot(this,t,cv,av,Lt,{brush:1,eraser:2,sources:3,crop_size:4,i18n:5,root:6,label:7,show_label:8,changeable:9,value:10,transforms:11,layers:12,accept_blobs:34,status:13,canvas_size:14,fixed_canvas:15,realtime:35,upload:16,stream_handler:17,dragging:0,placeholder:18,dynamic_height:32,height:19,full_history:20,get_data:36,image_id:33},null,[-1,-1])}get brush(){return this.$$.ctx[1]}set brush(t){this.$$set({brush:t}),I()}get eraser(){return this.$$.ctx[2]}set eraser(t){this.$$set({eraser:t}),I()}get sources(){return this.$$.ctx[3]}set sources(t){this.$$set({sources:t}),I()}get crop_size(){return this.$$.ctx[4]}set crop_size(t){this.$$set({crop_size:t}),I()}get i18n(){return this.$$.ctx[5]}set i18n(t){this.$$set({i18n:t}),I()}get root(){return this.$$.ctx[6]}set root(t){this.$$set({root:t}),I()}get label(){return this.$$.ctx[7]}set label(t){this.$$set({label:t}),I()}get show_label(){return this.$$.ctx[8]}set show_label(t){this.$$set({show_label:t}),I()}get changeable(){return this.$$.ctx[9]}set changeable(t){this.$$set({changeable:t}),I()}get value(){return this.$$.ctx[10]}set value(t){this.$$set({value:t}),I()}get transforms(){return this.$$.ctx[11]}set transforms(t){this.$$set({transforms:t}),I()}get layers(){return this.$$.ctx[12]}set layers(t){this.$$set({layers:t}),I()}get accept_blobs(){return this.$$.ctx[34]}set accept_blobs(t){this.$$set({accept_blobs:t}),I()}get status(){return this.$$.ctx[13]}set status(t){this.$$set({status:t}),I()}get canvas_size(){return this.$$.ctx[14]}set canvas_size(t){this.$$set({canvas_size:t}),I()}get fixed_canvas(){return this.$$.ctx[15]}set fixed_canvas(t){this.$$set({fixed_canvas:t}),I()}get realtime(){return this.$$.ctx[35]}set realtime(t){this.$$set({realtime:t}),I()}get upload(){return this.$$.ctx[16]}set upload(t){this.$$set({upload:t}),I()}get stream_handler(){return this.$$.ctx[17]}set stream_handler(t){this.$$set({stream_handler:t}),I()}get dragging(){return this.$$.ctx[0]}set dragging(t){this.$$set({dragging:t}),I()}get placeholder(){return this.$$.ctx[18]}set placeholder(t){this.$$set({placeholder:t}),I()}get dynamic_height(){return this.$$.ctx[32]}set dynamic_height(t){this.$$set({dynamic_height:t}),I()}get height(){return this.$$.ctx[19]}set height(t){this.$$set({height:t}),I()}get full_history(){return this.$$.ctx[20]}set full_history(t){this.$$set({full_history:t}),I()}get get_data(){return this.$$.ctx[36]}get image_id(){return this.$$.ctx[33]}set image_id(t){this.$$set({image_id:t}),I()}}function dv(i){let t,e;return t=new nc({props:{visible:i[5],variant:i[35]?"solid":"dashed",border_mode:i[34]?"focus":"base",padding:!1,elem_id:i[3],elem_classes:i[4],height:i[10]||i[36],width:i[11],allow_overflow:!1,container:i[13],scale:i[14],min_width:i[15],$$slots:{default:[pv]},$$scope:{ctx:i}}}),{c(){yt(t.$$.fragment)},m(r,s){vt(t,r,s),e=!0},p(r,s){const n={};s[0]&32&&(n.visible=r[5]),s[1]&16&&(n.variant=r[35]?"solid":"dashed"),s[1]&8&&(n.border_mode=r[34]?"focus":"base"),s[0]&8&&(n.elem_id=r[3]),s[0]&16&&(n.elem_classes=r[4]),s[0]&1024|s[1]&32&&(n.height=r[10]||r[36]),s[0]&2048&&(n.width=r[11]),s[0]&8192&&(n.container=r[13]),s[0]&16384&&(n.scale=r[14]),s[0]&32768&&(n.min_width=r[15]),s[0]&1610221255|s[1]&15|s[2]&64&&(n.$$scope={dirty:s,ctx:r}),t.$set(n)},i(r){e||(H(t.$$.fragment,r),e=!0)},o(r){$(t.$$.fragment,r),e=!1},d(r){bt(t,r)}}}function fv(i){let t,e;return t=new nc({props:{visible:i[5],variant:"solid",border_mode:i[34]?"focus":"base",padding:!1,elem_id:i[3],elem_classes:i[4],height:i[10],width:i[11],allow_overflow:!1,container:i[13],scale:i[14],min_width:i[15],$$slots:{default:[mv]},$$scope:{ctx:i}}}),{c(){yt(t.$$.fragment)},m(r,s){vt(t,r,s),e=!0},p(r,s){const n={};s[0]&32&&(n.visible=r[5]),s[1]&8&&(n.border_mode=r[34]?"focus":"base"),s[0]&8&&(n.elem_id=r[3]),s[0]&16&&(n.elem_classes=r[4]),s[0]&1024&&(n.height=r[10]),s[0]&2048&&(n.width=r[11]),s[0]&8192&&(n.container=r[13]),s[0]&16384&&(n.scale=r[14]),s[0]&32768&&(n.min_width=r[15]),s[0]&1610682819|s[2]&64&&(n.$$scope={dirty:s,ctx:r}),t.$set(n)},i(r){e||(H(t.$$.fragment,r),e=!0)},o(r){$(t.$$.fragment,r),e=!1},d(r){bt(t,r)}}}function pv(i){let t,e,r,s,n,o,a;const l=[{autoscroll:i[30].autoscroll},{i18n:i[30].i18n},i[1]];let h={};for(let p=0;p<l.length;p+=1)h=oc(h,l[p]);t=new ac({props:h}),t.$on("clear_status",i[45]);function c(p){i[48](p)}function u(p){i[49](p)}function d(p){i[51](p)}let f={canvas_size:i[27],crop_size:i[22],value:i[0],root:i[9],sources:i[17],label:i[6],show_label:i[7],height:i[10],fixed_canvas:i[28],brush:i[20],eraser:i[21],changeable:i[25].includes("apply"),realtime:i[25].includes("change")||i[25].includes("input"),i18n:i[30].i18n,transforms:i[23],accept_blobs:i[26].accept_blobs,layers:i[24],status:i[1]?.status,upload:i[46],stream_handler:i[47],placeholder:i[19],full_history:i[2]};return i[34]!==void 0&&(f.dragging=i[34]),i[33]!==void 0&&(f.image_id=i[33]),i[31]!==void 0&&(f.dynamic_height=i[31]),r=new uv({props:f}),At.push(()=>qt(r,"dragging",c)),At.push(()=>qt(r,"image_id",u)),i[50](r),At.push(()=>qt(r,"dynamic_height",d)),r.$on("history",i[52]),r.$on("change",i[53]),r.$on("save",i[54]),r.$on("edit",i[55]),r.$on("clear",i[56]),r.$on("drag",i[57]),r.$on("upload",i[58]),r.$on("share",i[59]),r.$on("error",i[60]),r.$on("receive_null",i[61]),r.$on("error",i[62]),{c(){yt(t.$$.fragment),e=pt(),yt(r.$$.fragment)},m(p,g){vt(t,p,g),Z(p,e,g),vt(r,p,g),a=!0},p(p,g){const _=g[0]&1073741826?lc(l,[g[0]&1073741824&&{autoscroll:p[30].autoscroll},g[0]&1073741824&&{i18n:p[30].i18n},g[0]&2&&hc(p[1])]):{};t.$set(_);const m={};g[0]&134217728&&(m.canvas_size=p[27]),g[0]&4194304&&(m.crop_size=p[22]),g[0]&1&&(m.value=p[0]),g[0]&512&&(m.root=p[9]),g[0]&131072&&(m.sources=p[17]),g[0]&64&&(m.label=p[6]),g[0]&128&&(m.show_label=p[7]),g[0]&1024&&(m.height=p[10]),g[0]&268435456&&(m.fixed_canvas=p[28]),g[0]&1048576&&(m.brush=p[20]),g[0]&2097152&&(m.eraser=p[21]),g[0]&33554432&&(m.changeable=p[25].includes("apply")),g[0]&33554432&&(m.realtime=p[25].includes("change")||p[25].includes("input")),g[0]&1073741824&&(m.i18n=p[30].i18n),g[0]&8388608&&(m.transforms=p[23]),g[0]&67108864&&(m.accept_blobs=p[26].accept_blobs),g[0]&16777216&&(m.layers=p[24]),g[0]&2&&(m.status=p[1]?.status),g[0]&1073741824&&(m.upload=p[46]),g[0]&1073741824&&(m.stream_handler=p[47]),g[0]&524288&&(m.placeholder=p[19]),g[0]&4&&(m.full_history=p[2]),!s&&g[1]&8&&(s=!0,m.dragging=p[34],Zt(()=>s=!1)),!n&&g[1]&4&&(n=!0,m.image_id=p[33],Zt(()=>n=!1)),!o&&g[1]&1&&(o=!0,m.dynamic_height=p[31],Zt(()=>o=!1)),r.$set(m)},i(p){a||(H(t.$$.fragment,p),H(r.$$.fragment,p),a=!0)},o(p){$(t.$$.fragment,p),$(r.$$.fragment,p),a=!1},d(p){p&&K(e),bt(t,p),i[50](null),bt(r,p)}}}function mv(i){let t,e,r,s;const n=[{autoscroll:i[30].autoscroll},{i18n:i[30].i18n},i[1]];let o={};for(let a=0;a<n.length;a+=1)o=oc(o,n[a]);return t=new ac({props:o}),t.$on("clear_status",i[41]),r=new ud({props:{value:i[0]?.composite||null,label:i[6],show_label:i[7],show_download_button:i[8],selectable:i[12],show_share_button:i[16],i18n:i[30].i18n,show_fullscreen_button:i[29]}}),r.$on("select",i[42]),r.$on("share",i[43]),r.$on("error",i[44]),{c(){yt(t.$$.fragment),e=pt(),yt(r.$$.fragment)},m(a,l){vt(t,a,l),Z(a,e,l),vt(r,a,l),s=!0},p(a,l){const h=l[0]&1073741826?lc(n,[l[0]&1073741824&&{autoscroll:a[30].autoscroll},l[0]&1073741824&&{i18n:a[30].i18n},l[0]&2&&hc(a[1])]):{};t.$set(h);const c={};l[0]&1&&(c.value=a[0]?.composite||null),l[0]&64&&(c.label=a[6]),l[0]&128&&(c.show_label=a[7]),l[0]&256&&(c.show_download_button=a[8]),l[0]&4096&&(c.selectable=a[12]),l[0]&65536&&(c.show_share_button=a[16]),l[0]&1073741824&&(c.i18n=a[30].i18n),l[0]&536870912&&(c.show_fullscreen_button=a[29]),r.$set(c)},i(a){s||(H(t.$$.fragment,a),H(r.$$.fragment,a),s=!0)},o(a){$(t.$$.fragment,a),$(r.$$.fragment,a),s=!1},d(a){a&&K(e),bt(t,a),bt(r,a)}}}function gv(i){let t,e,r,s;const n=[fv,dv],o=[];function a(l,h){return l[18]?1:0}return t=a(i),e=o[t]=n[t](i),{c(){e.c(),r=be()},m(l,h){o[t].m(l,h),Z(l,r,h),s=!0},p(l,h){let c=t;t=a(l),t===c?o[t].p(l,h):(ne(),$(o[c],1,1,()=>{o[c]=null}),oe(),e=o[t],e?e.p(l,h):(e=o[t]=n[t](l),e.c()),H(e,1),e.m(r.parentNode,r))},i(l){s||(H(e),s=!0)},o(l){$(e),s=!1},d(l){l&&K(r),o[t].d(l)}}}function _v(i,t,e){let r,s,{elem_id:n=""}=t,{elem_classes:o=[]}=t,{visible:a=!0}=t,{value:l={background:null,layers:[],composite:null}}=t,{label:h}=t,{show_label:c}=t,{show_download_button:u}=t,{root:d}=t,{value_is_output:f=!1}=t,{height:p}=t,{width:g}=t,{_selectable:_=!1}=t,{container:m=!0}=t,{scale:v=null}=t,{min_width:y=void 0}=t,{loading_status:b}=t,{show_share_button:x=!1}=t,{sources:S=["upload","clipboard","webcam"]}=t,{interactive:w}=t,{placeholder:T}=t,{brush:P}=t,{eraser:F}=t,{crop_size:B=null}=t,{transforms:D=["crop"]}=t,{layers:E=!0}=t,{attached_events:R=[]}=t,{server:X}=t,{canvas_size:q}=t,{fixed_canvas:U=!1}=t,{show_fullscreen_button:lt=!0}=t,{full_history:V=null}=t,{gradio:A}=t,G,J=null;async function O(){if(J){const pn={id:J};return e(33,J=null),pn}return await G.get_data()}let M;const ut=typeof window<"u",ct=ut?window.requestAnimationFrame:k=>k();function mt(){return new Promise(k=>{ct(()=>ct(()=>k()))})}async function Pt(){await mt(),l&&(l.background||l.layers?.length||l.composite)&&A.dispatch("change")}function Nt(){A.dispatch("apply")}function Mt(){A.dispatch("change"),f||(A.dispatch("input"),br().then(k=>e(39,f=!1)))}let xt,St=Math.max(q[1]/(ut?window.devicePixelRatio:1),250);const Tt=()=>A.dispatch("clear_status",b),Dt=({detail:k})=>A.dispatch("select",k),z=({detail:k})=>A.dispatch("share",k),Vt=({detail:k})=>A.dispatch("error",k),he=()=>A.dispatch("clear_status",b),N=(...k)=>A.client.upload(...k),Se=(...k)=>A.client.stream(...k);function Ce(k){M=k,e(34,M)}function Ne(k){J=k,e(33,J)}function de(k){At[k?"unshift":"push"](()=>{G=k,e(32,G)})}function xe(k){xt=k,e(31,xt)}const Sr=k=>e(2,V=k.detail),we=()=>Mt(),W=k=>Nt(),fe=()=>A.dispatch("edit"),ge=()=>A.dispatch("clear"),Bt=({detail:k})=>e(34,M=k),jt=()=>A.dispatch("upload"),$e=({detail:k})=>A.dispatch("share",k),un=({detail:k})=>{e(1,b=b||{}),e(1,b.status="error",b),A.dispatch("error",k)},dn=()=>e(0,l={background:null,layers:[],composite:null});function fn(k){Nr.call(this,i,k)}return i.$$set=k=>{"elem_id"in k&&e(3,n=k.elem_id),"elem_classes"in k&&e(4,o=k.elem_classes),"visible"in k&&e(5,a=k.visible),"value"in k&&e(0,l=k.value),"label"in k&&e(6,h=k.label),"show_label"in k&&e(7,c=k.show_label),"show_download_button"in k&&e(8,u=k.show_download_button),"root"in k&&e(9,d=k.root),"value_is_output"in k&&e(39,f=k.value_is_output),"height"in k&&e(10,p=k.height),"width"in k&&e(11,g=k.width),"_selectable"in k&&e(12,_=k._selectable),"container"in k&&e(13,m=k.container),"scale"in k&&e(14,v=k.scale),"min_width"in k&&e(15,y=k.min_width),"loading_status"in k&&e(1,b=k.loading_status),"show_share_button"in k&&e(16,x=k.show_share_button),"sources"in k&&e(17,S=k.sources),"interactive"in k&&e(18,w=k.interactive),"placeholder"in k&&e(19,T=k.placeholder),"brush"in k&&e(20,P=k.brush),"eraser"in k&&e(21,F=k.eraser),"crop_size"in k&&e(22,B=k.crop_size),"transforms"in k&&e(23,D=k.transforms),"layers"in k&&e(24,E=k.layers),"attached_events"in k&&e(25,R=k.attached_events),"server"in k&&e(26,X=k.server),"canvas_size"in k&&e(27,q=k.canvas_size),"fixed_canvas"in k&&e(28,U=k.fixed_canvas),"show_fullscreen_button"in k&&e(29,lt=k.show_fullscreen_button),"full_history"in k&&e(2,V=k.full_history),"gradio"in k&&e(30,A=k.gradio)},i.$$.update=()=>{i.$$.dirty[0]&1&&l&&Pt(),i.$$.dirty[1]&1&&e(36,r=Math.max((xt??St)+100,250)),i.$$.dirty[0]&1&&e(35,s=l?.background||l?.layers?.length||l?.composite)},[l,b,V,n,o,a,h,c,u,d,p,g,_,m,v,y,x,S,w,T,P,F,B,D,E,R,X,q,U,lt,A,xt,G,J,M,s,r,Nt,Mt,f,O,Tt,Dt,z,Vt,he,N,Se,Ce,Ne,de,xe,Sr,we,W,fe,ge,Bt,jt,$e,un,dn,fn]}class Jv extends kt{constructor(t){super(),Ot(this,t,_v,gv,cd,{elem_id:3,elem_classes:4,visible:5,value:0,label:6,show_label:7,show_download_button:8,root:9,value_is_output:39,height:10,width:11,_selectable:12,container:13,scale:14,min_width:15,loading_status:1,show_share_button:16,sources:17,interactive:18,placeholder:19,brush:20,eraser:21,crop_size:22,transforms:23,layers:24,attached_events:25,server:26,canvas_size:27,fixed_canvas:28,show_fullscreen_button:29,full_history:2,gradio:30,get_value:40},null,[-1,-1,-1])}get elem_id(){return this.$$.ctx[3]}set elem_id(t){this.$$set({elem_id:t}),I()}get elem_classes(){return this.$$.ctx[4]}set elem_classes(t){this.$$set({elem_classes:t}),I()}get visible(){return this.$$.ctx[5]}set visible(t){this.$$set({visible:t}),I()}get value(){return this.$$.ctx[0]}set value(t){this.$$set({value:t}),I()}get label(){return this.$$.ctx[6]}set label(t){this.$$set({label:t}),I()}get show_label(){return this.$$.ctx[7]}set show_label(t){this.$$set({show_label:t}),I()}get show_download_button(){return this.$$.ctx[8]}set show_download_button(t){this.$$set({show_download_button:t}),I()}get root(){return this.$$.ctx[9]}set root(t){this.$$set({root:t}),I()}get value_is_output(){return this.$$.ctx[39]}set value_is_output(t){this.$$set({value_is_output:t}),I()}get height(){return this.$$.ctx[10]}set height(t){this.$$set({height:t}),I()}get width(){return this.$$.ctx[11]}set width(t){this.$$set({width:t}),I()}get _selectable(){return this.$$.ctx[12]}set _selectable(t){this.$$set({_selectable:t}),I()}get container(){return this.$$.ctx[13]}set container(t){this.$$set({container:t}),I()}get scale(){return this.$$.ctx[14]}set scale(t){this.$$set({scale:t}),I()}get min_width(){return this.$$.ctx[15]}set min_width(t){this.$$set({min_width:t}),I()}get loading_status(){return this.$$.ctx[1]}set loading_status(t){this.$$set({loading_status:t}),I()}get show_share_button(){return this.$$.ctx[16]}set show_share_button(t){this.$$set({show_share_button:t}),I()}get sources(){return this.$$.ctx[17]}set sources(t){this.$$set({sources:t}),I()}get interactive(){return this.$$.ctx[18]}set interactive(t){this.$$set({interactive:t}),I()}get placeholder(){return this.$$.ctx[19]}set placeholder(t){this.$$set({placeholder:t}),I()}get brush(){return this.$$.ctx[20]}set brush(t){this.$$set({brush:t}),I()}get eraser(){return this.$$.ctx[21]}set eraser(t){this.$$set({eraser:t}),I()}get crop_size(){return this.$$.ctx[22]}set crop_size(t){this.$$set({crop_size:t}),I()}get transforms(){return this.$$.ctx[23]}set transforms(t){this.$$set({transforms:t}),I()}get layers(){return this.$$.ctx[24]}set layers(t){this.$$set({layers:t}),I()}get attached_events(){return this.$$.ctx[25]}set attached_events(t){this.$$set({attached_events:t}),I()}get server(){return this.$$.ctx[26]}set server(t){this.$$set({server:t}),I()}get canvas_size(){return this.$$.ctx[27]}set canvas_size(t){this.$$set({canvas_size:t}),I()}get fixed_canvas(){return this.$$.ctx[28]}set fixed_canvas(t){this.$$set({fixed_canvas:t}),I()}get show_fullscreen_button(){return this.$$.ctx[29]}set show_fullscreen_button(t){this.$$set({show_fullscreen_button:t}),I()}get full_history(){return this.$$.ctx[2]}set full_history(t){this.$$set({full_history:t}),I()}get gradio(){return this.$$.ctx[30]}set gradio(t){this.$$set({gradio:t}),I()}get get_value(){return this.$$.ctx[40]}}export{Jv as default};
//# sourceMappingURL=Index-Ak6UQIkC.js.map
