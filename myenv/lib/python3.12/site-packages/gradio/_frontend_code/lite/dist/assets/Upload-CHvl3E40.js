import{a as le,i as ne,s as se,f as y,y as W,w as N,b as M,z as b,A as p,d as S,C as A,x as R,D as ee,l as j,o as re,a5 as Te,aa as Ue,$ as L,e as ae,h as oe,t as O,j as ue,k as D,ax as Le,p as E,K as Oe,q as fe,H as z,ay as T,a1 as U,u as de,r as _e,v as he,R as Ie,c as Ne,m as Se,n as je,J as qe}from"../lite.js";/* empty css                                             */function te(t){let e,l,i,s,d=q(t[2])+"",o,f,r,a,k=t[2].orig_name+"",_;return{c(){e=W("div"),l=W("span"),i=W("div"),s=W("progress"),o=N(d),r=M(),a=W("span"),_=N(k),L(s,"visibility","hidden"),L(s,"height","0"),L(s,"width","0"),s.value=f=q(t[2]),b(s,"max","100"),b(s,"class","svelte-1vsfomn"),b(i,"class","progress-bar svelte-1vsfomn"),b(a,"class","file-name svelte-1vsfomn"),b(e,"class","file svelte-1vsfomn")},m(g,h){S(g,e,h),A(e,l),A(l,i),A(i,s),A(s,o),A(e,r),A(e,a),A(a,_)},p(g,h){h&4&&d!==(d=q(g[2])+"")&&R(o,d),h&4&&f!==(f=q(g[2]))&&(s.value=f),h&4&&k!==(k=g[2].orig_name+"")&&R(_,k)},d(g){g&&j(e)}}}function Je(t){let e,l,i,s=t[0].length+"",d,o,f=t[0].length>1?"files":"file",r,a,k,_=t[2]&&te(t);return{c(){e=W("div"),l=W("span"),i=N("Uploading "),d=N(s),o=M(),r=N(f),a=N("..."),k=M(),_&&_.c(),b(l,"class","uploading svelte-1vsfomn"),b(e,"class","wrap svelte-1vsfomn"),p(e,"progress",t[1])},m(g,h){S(g,e,h),A(e,l),A(l,i),A(l,d),A(l,o),A(l,r),A(l,a),A(e,k),_&&_.m(e,null)},p(g,[h]){h&1&&s!==(s=g[0].length+"")&&R(d,s),h&1&&f!==(f=g[0].length>1?"files":"file")&&R(r,f),g[2]?_?_.p(g,h):(_=te(g),_.c(),_.m(e,null)):_&&(_.d(1),_=null),h&2&&p(e,"progress",g[1])},i:ee,o:ee,d(g){g&&j(e),_&&_.d()}}}function q(t){return t.progress*100/(t.size||0)||0}function Me(t){let e=0;return t.forEach(l=>{e+=q(l)}),document.documentElement.style.setProperty("--upload-progress-width",(e/t.length).toFixed(2)+"%"),e/t.length}function Re(t,e,l){let{upload_id:i}=e,{root:s}=e,{files:d}=e,{stream_handler:o}=e,f,r=!1,a,k,_=d.map(u=>({...u,progress:0}));const g=re();function h(u,c){l(0,_=_.map(F=>(F.orig_name===u&&(F.progress+=c),F)))}return Te(async()=>{if(f=await o(new URL(`${s}/gradio_api/upload_progress?upload_id=${i}`)),f==null)throw new Error("Event source is not defined");f.onmessage=async function(u){const c=JSON.parse(u.data);r||l(1,r=!0),c.msg==="done"?(f?.close(),g("done")):(l(7,a=c),h(c.orig_name,c.chunk_size))}}),Ue(()=>{(f!=null||f!=null)&&f.close()}),t.$$set=u=>{"upload_id"in u&&l(3,i=u.upload_id),"root"in u&&l(4,s=u.root),"files"in u&&l(5,d=u.files),"stream_handler"in u&&l(6,o=u.stream_handler)},t.$$.update=()=>{t.$$.dirty&1&&Me(_),t.$$.dirty&129&&l(2,k=a||_[0])},[_,r,k,i,s,d,o,a]}class He extends le{constructor(e){super(),ne(this,e,Re,Je,se,{upload_id:3,root:4,files:5,stream_handler:6})}get upload_id(){return this.$$.ctx[3]}set upload_id(e){this.$$set({upload_id:e}),y()}get root(){return this.$$.ctx[4]}set root(e){this.$$set({root:e}),y()}get files(){return this.$$.ctx[5]}set files(e){this.$$set({files:e}),y()}get stream_handler(){return this.$$.ctx[6]}set stream_handler(e){this.$$set({stream_handler:e}),y()}}function Ke(t){let e,l,i,s,d,o,f,r,a,k,_;const g=t[29].default,h=fe(g,t,t[28],null);return{c(){e=W("button"),h&&h.c(),l=M(),i=W("input"),b(i,"aria-label","file upload"),b(i,"data-testid","file-upload"),b(i,"type","file"),b(i,"accept",s=t[18]||void 0),i.multiple=d=t[6]==="multiple"||void 0,b(i,"webkitdirectory",o=t[6]==="directory"||void 0),b(i,"mozdirectory",f=t[6]==="directory"||void 0),b(i,"class","svelte-1b742ao"),b(e,"tabindex",r=t[9]?-1:0),b(e,"class","svelte-1b742ao"),p(e,"hidden",t[9]),p(e,"center",t[4]),p(e,"boundedheight",t[3]),p(e,"flex",t[5]),p(e,"disable_click",t[7]),p(e,"icon-mode",t[12]),L(e,"height",t[12]?"":t[13]?typeof t[13]=="number"?t[13]+"px":t[13]:"100%")},m(u,c){S(u,e,c),h&&h.m(e,null),A(e,l),A(e,i),t[37](i),a=!0,k||(_=[z(i,"change",t[20]),z(e,"drag",T(U(t[30]))),z(e,"dragstart",T(U(t[31]))),z(e,"dragend",T(U(t[32]))),z(e,"dragover",T(U(t[33]))),z(e,"dragenter",T(U(t[34]))),z(e,"dragleave",T(U(t[35]))),z(e,"drop",T(U(t[36]))),z(e,"click",t[15]),z(e,"drop",t[21]),z(e,"dragenter",t[19]),z(e,"dragleave",t[19])],k=!0)},p(u,c){h&&h.p&&(!a||c[0]&268435456)&&de(h,g,u,u[28],a?he(g,u[28],c,null):_e(u[28]),null),(!a||c[0]&262144&&s!==(s=u[18]||void 0))&&b(i,"accept",s),(!a||c[0]&64&&d!==(d=u[6]==="multiple"||void 0))&&(i.multiple=d),(!a||c[0]&64&&o!==(o=u[6]==="directory"||void 0))&&b(i,"webkitdirectory",o),(!a||c[0]&64&&f!==(f=u[6]==="directory"||void 0))&&b(i,"mozdirectory",f),(!a||c[0]&512&&r!==(r=u[9]?-1:0))&&b(e,"tabindex",r),(!a||c[0]&512)&&p(e,"hidden",u[9]),(!a||c[0]&16)&&p(e,"center",u[4]),(!a||c[0]&8)&&p(e,"boundedheight",u[3]),(!a||c[0]&32)&&p(e,"flex",u[5]),(!a||c[0]&128)&&p(e,"disable_click",u[7]),(!a||c[0]&4096)&&p(e,"icon-mode",u[12]),c[0]&12288&&L(e,"height",u[12]?"":u[13]?typeof u[13]=="number"?u[13]+"px":u[13]:"100%")},i(u){a||(D(h,u),a=!0)},o(u){O(h,u),a=!1},d(u){u&&j(e),h&&h.d(u),t[37](null),k=!1,Ie(_)}}}function Be(t){let e,l,i=!t[9]&&ie(t);return{c(){i&&i.c(),e=ae()},m(s,d){i&&i.m(s,d),S(s,e,d),l=!0},p(s,d){s[9]?i&&(oe(),O(i,1,1,()=>{i=null}),ue()):i?(i.p(s,d),d[0]&512&&D(i,1)):(i=ie(s),i.c(),D(i,1),i.m(e.parentNode,e))},i(s){l||(D(i),l=!0)},o(s){O(i),l=!1},d(s){s&&j(e),i&&i.d(s)}}}function Ge(t){let e,l,i,s,d;const o=t[29].default,f=fe(o,t,t[28],null);return{c(){e=W("button"),f&&f.c(),b(e,"tabindex",l=t[9]?-1:0),b(e,"class","svelte-1b742ao"),p(e,"hidden",t[9]),p(e,"center",t[4]),p(e,"boundedheight",t[3]),p(e,"flex",t[5]),p(e,"icon-mode",t[12]),L(e,"height",t[12]?"":t[13]?typeof t[13]=="number"?t[13]+"px":t[13]:"100%")},m(r,a){S(r,e,a),f&&f.m(e,null),i=!0,s||(d=z(e,"click",t[14]),s=!0)},p(r,a){f&&f.p&&(!i||a[0]&268435456)&&de(f,o,r,r[28],i?he(o,r[28],a,null):_e(r[28]),null),(!i||a[0]&512&&l!==(l=r[9]?-1:0))&&b(e,"tabindex",l),(!i||a[0]&512)&&p(e,"hidden",r[9]),(!i||a[0]&16)&&p(e,"center",r[4]),(!i||a[0]&8)&&p(e,"boundedheight",r[3]),(!i||a[0]&32)&&p(e,"flex",r[5]),(!i||a[0]&4096)&&p(e,"icon-mode",r[12]),a[0]&12288&&L(e,"height",r[12]?"":r[13]?typeof r[13]=="number"?r[13]+"px":r[13]:"100%")},i(r){i||(D(f,r),i=!0)},o(r){O(f,r),i=!1},d(r){r&&j(e),f&&f.d(r),s=!1,d()}}}function ie(t){let e,l;return e=new He({props:{root:t[8],upload_id:t[16],files:t[17],stream_handler:t[11]}}),{c(){Ne(e.$$.fragment)},m(i,s){Se(e,i,s),l=!0},p(i,s){const d={};s[0]&256&&(d.root=i[8]),s[0]&65536&&(d.upload_id=i[16]),s[0]&131072&&(d.files=i[17]),s[0]&2048&&(d.stream_handler=i[11]),e.$set(d)},i(i){l||(D(e.$$.fragment,i),l=!0)},o(i){O(e.$$.fragment,i),l=!1},d(i){je(e,i)}}}function Qe(t){let e,l,i,s;const d=[Ge,Be,Ke],o=[];function f(r,a){return r[0]==="clipboard"?0:r[1]&&r[10]?1:2}return e=f(t),l=o[e]=d[e](t),{c(){l.c(),i=ae()},m(r,a){o[e].m(r,a),S(r,i,a),s=!0},p(r,a){let k=e;e=f(r),e===k?o[e].p(r,a):(oe(),O(o[k],1,1,()=>{o[k]=null}),ue(),l=o[e],l?l.p(r,a):(l=o[e]=d[e](r),l.c()),D(l,1),l.m(i.parentNode,i))},i(r){s||(D(l),s=!0)},o(r){O(l),s=!1},d(r){r&&j(i),o[e].d(r)}}}function Ve(t,e,l){if(!t||t==="*"||t==="file/*"||Array.isArray(t)&&t.some(s=>s==="*"||s==="file/*"))return!0;let i;if(typeof t=="string")i=t.split(",").map(s=>s.trim());else if(Array.isArray(t))i=t;else return!1;return i.includes(e)||i.some(s=>{const[d]=s.split("/").map(o=>o.trim());return s.endsWith("/*")&&l.startsWith(d+"/")})}function Xe(t,e,l){let i,{$$slots:s={},$$scope:d}=e,{filetype:o=null}=e,{dragging:f=!1}=e,{boundedheight:r=!0}=e,{center:a=!0}=e,{flex:k=!0}=e,{file_count:_="single"}=e,{disable_click:g=!1}=e,{root:h}=e,{hidden:u=!1}=e,{format:c="file"}=e,{uploading:F=!1}=e,{hidden_upload:P=null}=e,{show_progress:X=!0}=e,{max_file_size:H=null}=e,{upload:K}=e,{stream_handler:Y}=e,{icon_upload:Z=!1}=e,{height:x=void 0}=e,B,G,I,$=null;const ge=()=>{if(typeof navigator<"u"){const n=navigator.userAgent.toLowerCase();return n.indexOf("iphone")>-1||n.indexOf("ipad")>-1}return!1},C=re(),ce=["image","video","audio","text","file"],Q=n=>i&&n.startsWith(".")?($=!0,n):i&&n.includes("file/*")?"*":n.startsWith(".")||n.endsWith("/*")?n:ce.includes(n)?n+"/*":"."+n;function me(){l(22,f=!f)}function pe(){navigator.clipboard.read().then(async n=>{for(let m=0;m<n.length;m++){const w=n[m].types.find(v=>v.startsWith("image/"));if(w){n[m].getType(w).then(async v=>{const V=new File([v],`clipboard.${w.replace("image/","")}`);await J([V])});break}}})}function be(){g||P&&(l(2,P.value="",P),P.click())}async function ye(n){await qe(),l(16,B=Math.random().toString(36).substring(2,15)),l(1,F=!0);try{const m=await K(n,h,B,H??1/0);return C("load",_==="single"?m?.[0]:m),l(1,F=!1),m||[]}catch(m){return C("error",m.message),l(1,F=!1),[]}}async function J(n){if(!n.length)return;let m=n.map(w=>new File([w],w instanceof File?w.name:"file",{type:w.type}));return i&&$&&(m=m.filter(w=>ke(w)?!0:(C("error",`Invalid file type: ${w.name}. Only ${o} allowed.`),!1)),m.length===0)?[]:(l(17,G=await Le(m)),await ye(G))}function ke(n){return o?(Array.isArray(o)?o:[o]).some(w=>{const v=Q(w);if(v.startsWith("."))return n.name.toLowerCase().endsWith(v.toLowerCase());if(v==="*")return!0;if(v.endsWith("/*")){const[V]=v.split("/");return n.type.startsWith(V+"/")}return n.type===v}):!0}async function we(n){const m=n.target;if(m.files)if(c!="blob")await J(Array.from(m.files));else{if(_==="single"){C("load",m.files[0]);return}C("load",m.files)}}async function ve(n){if(l(22,f=!1),!n.dataTransfer?.files)return;const m=Array.from(n.dataTransfer.files).filter(w=>{const v="."+w.name.split(".").pop();return v&&Ve(I,v,w.type)||(v&&Array.isArray(o)?o.includes(v):v===o)?!0:(C("error",`Invalid file type only ${o} allowed.`),!1)});if(c!="blob")await J(m);else{if(_==="single"){C("load",m[0]);return}C("load",m)}}function Ae(n){E.call(this,t,n)}function ze(n){E.call(this,t,n)}function We(n){E.call(this,t,n)}function Fe(n){E.call(this,t,n)}function Pe(n){E.call(this,t,n)}function Ce(n){E.call(this,t,n)}function De(n){E.call(this,t,n)}function Ee(n){Oe[n?"unshift":"push"](()=>{P=n,l(2,P)})}return t.$$set=n=>{"filetype"in n&&l(0,o=n.filetype),"dragging"in n&&l(22,f=n.dragging),"boundedheight"in n&&l(3,r=n.boundedheight),"center"in n&&l(4,a=n.center),"flex"in n&&l(5,k=n.flex),"file_count"in n&&l(6,_=n.file_count),"disable_click"in n&&l(7,g=n.disable_click),"root"in n&&l(8,h=n.root),"hidden"in n&&l(9,u=n.hidden),"format"in n&&l(23,c=n.format),"uploading"in n&&l(1,F=n.uploading),"hidden_upload"in n&&l(2,P=n.hidden_upload),"show_progress"in n&&l(10,X=n.show_progress),"max_file_size"in n&&l(24,H=n.max_file_size),"upload"in n&&l(25,K=n.upload),"stream_handler"in n&&l(11,Y=n.stream_handler),"icon_upload"in n&&l(12,Z=n.icon_upload),"height"in n&&l(13,x=n.height),"$$scope"in n&&l(28,d=n.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&134217729&&(o==null?l(18,I=null):typeof o=="string"?l(18,I=Q(o)):i&&o.includes("file/*")?l(18,I="*"):(l(0,o=o.map(Q)),l(18,I=o.join(", "))))},l(27,i=ge()),[o,F,P,r,a,k,_,g,h,u,X,Y,Z,x,pe,be,B,G,I,me,we,ve,f,c,H,K,J,i,d,s,Ae,ze,We,Fe,Pe,Ce,De,Ee]}class xe extends le{constructor(e){super(),ne(this,e,Xe,Qe,se,{filetype:0,dragging:22,boundedheight:3,center:4,flex:5,file_count:6,disable_click:7,root:8,hidden:9,format:23,uploading:1,hidden_upload:2,show_progress:10,max_file_size:24,upload:25,stream_handler:11,icon_upload:12,height:13,paste_clipboard:14,open_file_upload:15,load_files:26},null,[-1,-1])}get filetype(){return this.$$.ctx[0]}set filetype(e){this.$$set({filetype:e}),y()}get dragging(){return this.$$.ctx[22]}set dragging(e){this.$$set({dragging:e}),y()}get boundedheight(){return this.$$.ctx[3]}set boundedheight(e){this.$$set({boundedheight:e}),y()}get center(){return this.$$.ctx[4]}set center(e){this.$$set({center:e}),y()}get flex(){return this.$$.ctx[5]}set flex(e){this.$$set({flex:e}),y()}get file_count(){return this.$$.ctx[6]}set file_count(e){this.$$set({file_count:e}),y()}get disable_click(){return this.$$.ctx[7]}set disable_click(e){this.$$set({disable_click:e}),y()}get root(){return this.$$.ctx[8]}set root(e){this.$$set({root:e}),y()}get hidden(){return this.$$.ctx[9]}set hidden(e){this.$$set({hidden:e}),y()}get format(){return this.$$.ctx[23]}set format(e){this.$$set({format:e}),y()}get uploading(){return this.$$.ctx[1]}set uploading(e){this.$$set({uploading:e}),y()}get hidden_upload(){return this.$$.ctx[2]}set hidden_upload(e){this.$$set({hidden_upload:e}),y()}get show_progress(){return this.$$.ctx[10]}set show_progress(e){this.$$set({show_progress:e}),y()}get max_file_size(){return this.$$.ctx[24]}set max_file_size(e){this.$$set({max_file_size:e}),y()}get upload(){return this.$$.ctx[25]}set upload(e){this.$$set({upload:e}),y()}get stream_handler(){return this.$$.ctx[11]}set stream_handler(e){this.$$set({stream_handler:e}),y()}get icon_upload(){return this.$$.ctx[12]}set icon_upload(e){this.$$set({icon_upload:e}),y()}get height(){return this.$$.ctx[13]}set height(e){this.$$set({height:e}),y()}get paste_clipboard(){return this.$$.ctx[14]}get open_file_upload(){return this.$$.ctx[15]}get load_files(){return this.$$.ctx[26]}}export{xe as U};
//# sourceMappingURL=Upload-CHvl3E40.js.map
